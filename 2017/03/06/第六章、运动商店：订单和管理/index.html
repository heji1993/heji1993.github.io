

<!DOCTYPE html>
<html lang="zh-Hans">
<head>
    
    <meta name="author" content="何机">
    
    <meta name="description" content="在本章中，我会收集并验证运输详情以完成运动商店应用程序，并把订单存储在Deployd服务器上。我还会创建管理应用程序，让认证的用户看到订单并管理产品目录。">
    
    <meta name="keywords" content="AngularJS,MVVM,前端框架,运动商店, 何机的技术博客,何机,博客,blog,IT,技术">
    

    
    <link rel="alternative" href="atom.xml" title="何机的技术博客" type="application/atom+xml">
    
    
    

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>第六章、运动商店：订单和管理 | 何机的技术博客 · No pains,no gains</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/style.css">

    <!-- Javascript -->
    <script src="/js/jquery-2.1.0.min.js"></script>
    <script src="/js/jquery.backstretch.min.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>
    <script src="/js/headroom.min.js"></script>
    <script src="/js/jquery.headroom.min.js"></script>
    <script src="/js/common.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    
    <meta name="baidu-site-verification" content="SzJ3MGdmeo" />


    <meta name="360-site-verification" content="afe5dc96bbb8d111b618f78493b95bb8" />


    <!--<meta name="baidu-site-verification" content="SzJ3MGdmeo" />-->
    <!--<meta name="360-site-verification" content="afe5dc96bbb8d111b618f78493b95bb8" />-->

</head>
<body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-inverse" role="banner">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://heji.website" title="何机的技术博客">何机的技术博客</a>
            </div>

            <div role="navigation" class="collapse navbar-collapse bs-navbar-collapse">
                
                <ul class="nav navbar-nav pull-right">
                    <li>
                        <!--<a class="max-width max-w300" title="No pains,no gains" href="/feelings">No pains,no gains</a>-->
						<a class="max-width max-w300" title="No pains,no gains">No pains,no gains</a>
                    </li>
                </ul>
                

                <ul class="nav navbar-nav">
                    
                    <li id="nav-index">
                        <a href="/" target="">首页</a>
                    </li>
                    
                    <li id="nav-archives">
                        <a href="/archives" target="">归档</a>
                    </li>
                    
                    <li id="nav-categories">
                        <a href="/categories" target="">分类</a>
                    </li>
                    
                    <li id="nav-tags">
                        <a href="/tags" target="">标签</a>
                    </li>
                    
                    <li id="nav-about">
                        <a href="/about" target="">关于</a>
                    </li>
                    

                    <li id="nav-github"><a href="https://github.com/heji1993" target="_blank">GitHub</a></li>
                    <!--<li id="nav-rss"><a href="/atom.xml" target="_blank">Rss</a></li>-->
                    <li id="nav-search"><input type="text" id="search" placeholder="search" /></li>
                </ul>
            </div>
        </div>
    </nav>

    <script>
    var bgRoot = "http://7xkwt1.com1.z0.glb.clouddn.com/background-";
    var bgLength = "74";
    var bgRandom = false;
    var bgImage = "/images/bg.jpg";

    $(function() {
        // page-id...
        var pageId = "2017/03/06/第六章、运动商店：订单和管理/";
        pageId = pageId.substr(0, pageId.indexOf("/"));
        if(pageId === "") pageId = "index";

        $("#nav-" + pageId).addClass("active");
    });
    </script>

    <article class="post container">
    <div class="well post-body first-post last-post">
        <h1>第六章、运动商店：订单和管理</h1>

        <div class="time-info">
            
<span class="article-tags">
    
    Tags: <a href="/tags/AngularJS/">AngularJS</a>&nbsp;
</span>



<span class="article-categories">
    Category:
    <a class="article-category-link" href="/categories/AngularJS/">AngularJS</a>
</span>


        </div>
        <div class="time-info">
            发表: <time datetime="2017-03-06T06:52:34.439Z"
                       itemprop="datePublished">2017-03-06</time>
            
            更新: <time datetime="2017-03-06T06:54:35.147Z"
                       itemprop="dateModified">2017-03-06</time>
            
        </div>

        <div class="post-body-inner">
            
                <div id="toc" class="toc-article well">
                    <strong class="toc-title">大纲</strong>
                    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#准备示例程序"><span class="toc-number">1.</span> <span class="toc-text">准备示例程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#获取运输详情"><span class="toc-number">2.</span> <span class="toc-text">获取运输详情</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#添加表单验证"><span class="toc-number">2.1.</span> <span class="toc-text">添加表单验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加剩下的表单字段"><span class="toc-number">2.2.</span> <span class="toc-text">添加剩下的表单字段</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#下单"><span class="toc-number">3.</span> <span class="toc-text">下单</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#扩展Deployd服务"><span class="toc-number">3.1.</span> <span class="toc-text">扩展Deployd服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#定义控制器行为"><span class="toc-number">3.2.</span> <span class="toc-text">定义控制器行为</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#调用控制器行为"><span class="toc-number">3.3.</span> <span class="toc-text">调用控制器行为</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#定义视图"><span class="toc-number">3.4.</span> <span class="toc-text">定义视图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#改进"><span class="toc-number">4.</span> <span class="toc-text">改进</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#管理产品分类"><span class="toc-number">5.</span> <span class="toc-text">管理产品分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#准备Deployd"><span class="toc-number">5.1.</span> <span class="toc-text">准备Deployd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建管理应用程序"><span class="toc-number">5.2.</span> <span class="toc-text">创建管理应用程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现验证"><span class="toc-number">5.3.</span> <span class="toc-text">实现验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#定义主视图和控制器"><span class="toc-number">5.4.</span> <span class="toc-text">定义主视图和控制器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现订单特性"><span class="toc-number">5.5.</span> <span class="toc-text">实现订单特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现产品特性"><span class="toc-number">5.6.</span> <span class="toc-text">实现产品特性</span></a></li></ol></li></ol>
                </div>
            

            <p>在本章中，我会收集并验证运输详情以完成运动商店应用程序，并把订单存储在Deployd服务器上。我还会创建管理应用程序，让认证的用户看到订单并管理产品目录。</p>
<a id="more"></a>
<h2 id="准备示例程序"><a href="#准备示例程序" class="headerlink" title="准备示例程序"></a>准备示例程序</h2><p>我将继续在上一章的项目上构建，你可以从<code>https://github.com/heji1993/angular-sportsstore.git</code>上获取源码。<br>在上一章中，我在<code>app.html</code>添加了两个URL路由，它们是本章完成结账过程所需的：<br><img src="imgs/1486699645094_2.png" alt=""></p>
<h2 id="获取运输详情"><a href="#获取运输详情" class="headerlink" title="获取运输详情"></a>获取运输详情</h2><p>在购物车中为用户显示商品总览后，我想获取订单的运输详情，这带我来到了AngularJS与表单相关的特性面前。我创建<code>views/placeorder.html</code>文件捕获用户的运输详情。下面是该文件的内容：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>提交订单<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>请输入你的相关信息，我们会直接把你的商品邮寄给你<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">h3</span>&gt;</span>收件人<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">label</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.name"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">h3</span>&gt;</span>收货地址<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">label</span>&gt;</span>街道地址<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.street"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>完成订单<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>关于该视图，首先要注意的是我没有使用ng-controller指令指定控制器，这意味着视图将被顶级控制器<code>sportsStoreCtrl</code>支持。另外，在输入框元素上，我使用了ng-model指令进行数据绑定，与双花括号不同的是，ng-model是双向数据绑定，视图上模型的改变会更新到作用域，而双花括号是单向绑定，通常用于展示。当data对象没有shipping属性时，AngularJS会动态创建这个属性。</p>
<h3 id="添加表单验证"><a href="#添加表单验证" class="headerlink" title="添加表单验证"></a>添加表单验证</h3><p>AngularJS支持表单验证，它能检查数值的适用性。<br>AngularJS表单校验基于元素上标准的HTML属性，比如type和required。表单验证自动执行，但仍需要一些工作来将验证的反馈呈现给用户，并在应用程序中整合整体的验证不通过的提示。</p>
<ul>
<li><p>验证的准备<br>  设置表单验证的第一步是在视图上添加form元素并在我的input元素上添加验证属性。下面是<code>views/placeorder.html</code>文件修改的内容：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"shippingForm"</span> <span class="attr">novalidate</span>=<span class="string">""</span>&gt;</span></div><div class="line">    ...</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.name"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">    ...</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.street"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">    ...</div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  新增一个form元素有三个目的：开启表单验证；<code>novalidate</code>属性是H5的标准属性，表示禁用浏览器的默认校验，让表单校验统一由AngularJS执行；定义一个变量，用来报告表单的有效性，它通过name属性实现，我把它设置为shippingForm，在后面将会演示如何使用。</p>
</li>
<li><p>显示验证反馈<br>  一旦form元素和验证属性被放好，AngularJS就会开始验证用户所提供的数据，AngularJS提供两种验证结果的反馈形式：1.使用AngularJS赋予form元素的通过验证和未通过验证的类来定义CSS样式，当通过校验时，元素会有<code>ng-valid</code>类，当没有通过校验时，元素会有<code>ng-invalid</code>类。2.使用作用域变量的属性判断，比如，不满足 <code>required</code>时,<code>formName.inputName.$error</code>为<code>{required: true}</code>，更多验证请查看官方API。下面是<code>views/placeorder.html</code>文件部分修改的代码：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">      ...</div><div class="line">      <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">      	<span class="selector-class">.ng-valid</span>&#123;</div><div class="line">      		<span class="attribute">border-color</span>: lightgreen;</div><div class="line">      	&#125;</div><div class="line">      	<span class="selector-class">.ng-invalid</span>&#123;</div><div class="line">      		<span class="attribute">border-color</span>: lightpink;</div><div class="line">      	&#125;</div><div class="line">      	<span class="selector-tag">span</span><span class="selector-class">.error</span>&#123;</div><div class="line">      		<span class="attribute">font-weight</span>: bold;</div><div class="line">      		<span class="attribute">color</span>: red;</div><div class="line">      	&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">      ...</div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">label</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.name"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"shippingForm.name.$error.required"</span>&gt;</span>请输入姓名<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>收货地址<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">label</span>&gt;</span>街道地址<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"street"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.street"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"shippingForm.street.$error.required"</span>&gt;</span>请输入街道地址<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>连接按钮来验证<br>  当表单内一个或多个input元素未通过验证，<code>formName.$invalid</code>属性的值将会被AngularJS设为true，我们可以把它和ng-disabled指令联合来管理button元素的状态（校验未通过不允许点击提交），下面是<code>views/placeorder.html</code>文件部分修改的代码：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">      ...</div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">ng-disabled</span>=<span class="string">"shippingForm.$invalid"</span>&gt;</span>完成订单<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">...</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="添加剩下的表单字段"><a href="#添加剩下的表单字段" class="headerlink" title="添加剩下的表单字段"></a>添加剩下的表单字段</h3><p>现在我将在表单中添加剩下的input元素，下面是<code>views/placeorder.html</code>文件的完整代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">	<span class="selector-class">.ng-valid</span>&#123;</div><div class="line">		<span class="attribute">border-color</span>: lightgreen;</div><div class="line">	&#125;</div><div class="line">	<span class="selector-class">.ng-invalid</span>&#123;</div><div class="line">		<span class="attribute">border-color</span>: lightpink;</div><div class="line">	&#125;</div><div class="line">	<span class="selector-tag">span</span><span class="selector-class">.error</span>&#123;</div><div class="line">		<span class="attribute">font-weight</span>: bold;</div><div class="line">		<span class="attribute">color</span>: red;</div><div class="line">	&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>提交订单<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>请输入你的相关信息，我们会直接把你的商品邮寄给你<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"shippingForm"</span> <span class="attr">novalidate</span>=<span class="string">""</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">h3</span>&gt;</span>收件人<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">label</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.name"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"shippingForm.name.$error.required"</span>&gt;</span>请输入姓名<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">h3</span>&gt;</span>收货地址<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">label</span>&gt;</span>街道<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"street"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.street"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"shippingForm.street.$error.required"</span>&gt;</span>请输入街道地址<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">label</span>&gt;</span>区<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"county"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.county"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"shippingForm.county.$error.required"</span>&gt;</span>请输入所在区<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">label</span>&gt;</span>市<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"city"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.city"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"shippingForm.city.$error.required"</span>&gt;</span>请输入所在市<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">label</span>&gt;</span>国家<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"country"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.country"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"shippingForm.country.$error.required"</span>&gt;</span>请输入所在国家<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">label</span>&gt;</span>邮政编码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"zip"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.zip"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"shippingForm.zip.$error.required"</span>&gt;</span>请输入所在市、区<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">h3</span>&gt;</span>可选<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"checkbox"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">label</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"giftwarp"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.giftwrap"</span>/&gt;</span></div><div class="line">				是否礼盒包装</div><div class="line">			<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">ng-disabled</span>=<span class="string">"shippingForm.$invalid"</span>&gt;</span>完成订单<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="下单"><a href="#下单" class="headerlink" title="下单"></a>下单</h2><p>现在，我将扩展由Deployd服务器提供的数据库，使用Ajax请求发送订单数据到服务器，并最终显示感谢消息来完成这一过程。</p>
<h3 id="扩展Deployd服务"><a href="#扩展Deployd服务" class="headerlink" title="扩展Deployd服务"></a>扩展Deployd服务</h3><p>为管理订单，新增一个order集合，方式和之前创建product集合一样，下面是order必要的属性，与placeorder.html的表单字段对应。<br><img src="imgs/1487743819803_2.png" alt=""></p>
<h3 id="定义控制器行为"><a href="#定义控制器行为" class="headerlink" title="定义控制器行为"></a>定义控制器行为</h3><p>下一步是定义控制器行为，他将使用Ajax请求发送订单明细到Deployd服务器。我们可以使用不同的方法定义该功能，比如服务或新控制器。这种灵活性是使用AngularJS的标志之一。当谈到AngularJS应用程序的架构时，没有绝对的正确或错误，你会开发出属于自己的风格和偏好，积累到你的经验中。我将保持简单，向顶级控制器sportsStore控制器中添加行为，它目前已包含了产生Ajax请求加载产品数据的代码。下面是修改后的<code>controllers/sportsStore.js</code>文件的内容：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//module方法值传一个参数表示我们尝试找到sportsStore这个模块,必须先有sportsStore模块,否则会报错</span></div><div class="line">angular.module(<span class="string">"sportsStore"</span>)</div><div class="line">.constant(<span class="string">"dataUrl"</span>,<span class="string">"http://localhost:5500/products"</span>)</div><div class="line">.constant(<span class="string">"orderUrl"</span>,<span class="string">"http://localhost:5500/orders"</span>)</div><div class="line">.controller(<span class="string">"sportsStoreCtrl"</span>,[<span class="string">"$scope"</span>,<span class="string">"$http"</span>,<span class="string">"$location"</span>,<span class="string">"dataUrl"</span>,<span class="string">"orderUrl"</span>,<span class="string">"cartService"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope,$http,$location,dataUrl,orderUrl,cartService</span>)</span>&#123;</div><div class="line">	$scope.data = &#123;&#125;;</div><div class="line">	<span class="comment">//使用$http服务查询数据</span></div><div class="line">	$http.get(dataUrl)</div><div class="line">	.success(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</div><div class="line">		$scope.data.products = result;</div><div class="line">	&#125;)</div><div class="line">	.error(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</div><div class="line">		$scope.data.error = error;</div><div class="line">	&#125;);</div><div class="line">	<span class="comment">//发送订单</span></div><div class="line">	$scope.sendOrder = <span class="function"><span class="keyword">function</span>(<span class="params">shippingDetails</span>)</span>&#123;</div><div class="line">		<span class="comment">//创建运输详情对象的副本,以便修改不影响程序的其他部分</span></div><div class="line">		<span class="keyword">var</span> order = angular.copy(shippingDetails);</div><div class="line">		<span class="comment">//从购物车获取所有商品</span></div><div class="line">		order.products = cartService.getProducts();</div><div class="line">		<span class="comment">//发送请求提交订单（以post方法提交请求到Deployd服务器并发送数据即完成对象的创建）</span></div><div class="line">		$http.post(orderUrl,order)</div><div class="line">		.success(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">			$scope.data.orderId = data.id;</div><div class="line">			<span class="comment">//清空购物车</span></div><div class="line">			cartService.getProducts().length = <span class="number">0</span>;</div><div class="line">		&#125;)</div><div class="line">		.error(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</div><div class="line">			$scope.data.orderError = error;</div><div class="line">		&#125;)</div><div class="line">		.finally(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">			<span class="comment">//最后导航到订单完成页面</span></div><div class="line">			$location.path(<span class="string">"/complete"</span>);</div><div class="line">		&#125;)</div><div class="line">	&#125;</div><div class="line">&#125;])</div></pre></td></tr></table></figure></p>
<h3 id="调用控制器行为"><a href="#调用控制器行为" class="headerlink" title="调用控制器行为"></a>调用控制器行为</h3><p>调用新控制器行为，我们需要在运输详情视图中为button元素添加ng-click指令调用行为即可。下面是<code>views/placeorder.html</code>页面部分修改的代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">ng-click</span>=<span class="string">"sendOrder(data.shipping);"</span> <span class="attr">ng-disabled</span>=<span class="string">"shippingForm.$invalid"</span>&gt;</span>完成订单<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="定义视图"><a href="#定义视图" class="headerlink" title="定义视图"></a>定义视图</h3><p>在Ajax请求被完成之后，我所指定的URL路径是<code>/complete</code>，URL路由配置会映射它到文件<code>/views/thankYou.html</code>。我创建了该文件，下面是<code>/views/thankYou.html</code>的内容：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert alert-danger"</span> <span class="attr">ng-show</span>=<span class="string">"data.orderError"</span>&gt;</span></div><div class="line">	发生错误&#123;&#123;data.orderError.status&#125;&#125;.订单尚未完成<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/placeorder"</span> <span class="attr">class</span>=<span class="string">"alert-link"</span>&gt;</span>点击这里重试<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span> <span class="attr">ng-hide</span>=<span class="string">"data.orderError"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">h2</span>&gt;</span>已下单！<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line">	感谢您使用我们的购物平台，您的订单编号是&#123;&#123;data.orderId&#125;&#125;，我们会尽快将商品派送到您手里。</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="改进"><a href="#改进" class="headerlink" title="改进"></a>改进</h2><ul>
<li>当浏览器载入app.html文件时，视图被显示和产品及分类元素被生成之间有一点延迟。在后面的章节，会讲解如何使用URL路由特性来组织AngularJS在Ajax请求完成之前显示视图。</li>
<li>为了显示导航和分页，我处理产品数据并筛出分类。在实际项目中，我会考虑在产品数据首次到达时只生成该信息一次，之后就复用它，在后续章节介绍如何使用承诺来构建行为链，那是适用于这种任务的理想方式。</li>
<li>最后我会介绍如何使用<code>$animate</code>服务在URL路径改变时显示简短的过渡动画。</li>
</ul>
<h2 id="管理产品分类"><a href="#管理产品分类" class="headerlink" title="管理产品分类"></a>管理产品分类</h2><h3 id="准备Deployd"><a href="#准备Deployd" class="headerlink" title="准备Deployd"></a>准备Deployd</h3><p>我们要对产品进行管理，需要有用户集合。普通用户和管理员还有权限之分。<br>点击新建一个<code>User Collection</code>，User集默认定义了id、username和password属性，全是我所需要的属性。创建集合之后，点击data创建一条数据：<code>{username:&quot;admin&quot;,password:&quot;secret&quot;}</code>。</p>
<ul>
<li><p>巩固集合<br>  Deployd最棒的特性之一是它定义了可用于实现服务端功能的简单JavaScript API（比如验证用户），当对集合进行操作时可以触发一系列的事件。在控制台点击products集合然后单击events，你将看到一系列代表不同集事件的选项卡,如下图：<br>  <img src="imgs/1488251043574_2.png" alt=""><br>  这些事件为所有集定义，你能做许多事情，其中就有使用JavaScript加强验证策略。在On Put和On Delete标签中输入以下JavaScript：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(!me || me.username!=<span class="string">"admin"</span>)&#123;</div><div class="line">    <span class="comment">//401表示被请求的页面要求身份验证</span></div><div class="line">    cancel(<span class="string">"没有权限"</span>,<span class="number">401</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  在Deployd的API中，me表示当前用户，而cancel函数终止指定消息和HTTP状态码的请求。这段代码允许验证后的admin用户访问，终止所有其他401状态码的请求。<br>  在orders集合中为ON GET、ON PUT和ON DELETE 事件重复这一过程，因为这些事件都需要验证用户身份，下面是需要添加验证控制的事件：<br>  <img src="imgs/1488252583879_3.png" alt=""></p>
</li>
</ul>
<h3 id="创建管理应用程序"><a href="#创建管理应用程序" class="headerlink" title="创建管理应用程序"></a>创建管理应用程序</h3><p>我将为管理任务创建单独的AngularJS应用程序。但我会把它相关代码整合到主应用程序中。我向<code>angular-sportsstore</code>项目根目录添加一个新文件<code>admin.html</code>，下面是它的内容：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">ng-app</span>=<span class="string">"sportsStoreAdmin"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"angular.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"ngmodules/angular-route.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"bootstrap.css"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"bootstrap-theme.css"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">			angular.module(<span class="string">"sportsStoreAdmin"</span>,[<span class="string">"ngRoute"</span>])</div><div class="line">			.config([<span class="string">"$routeProvider"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$routeProvider</span>)</span>&#123;</div><div class="line">				$routeProvider.when(<span class="string">"/login"</span>,&#123;</div><div class="line">					templateUrl : <span class="string">"views/adminLogin.html"</span></div><div class="line">				&#125;);</div><div class="line">				$routeProvider.when(<span class="string">"/main"</span>,&#123;</div><div class="line">					templateUrl : <span class="string">"views/adminMain.html"</span></div><div class="line">				&#125;);</div><div class="line">				$routeProvider.otherwise(&#123;</div><div class="line">					redirectTo : <span class="string">"/login"</span></div><div class="line">				&#125;);</div><div class="line">			&#125;])</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">ng-view</span>&gt;</span><span class="tag">&lt;/<span class="name">ng-view</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>该html文件引入一些必须的文件，以及定义sportsstoreAdmin模块并配置了路由。为了定义路由的otherwise方法，我使用了redirectTo，它改变URL路径到其他路由，这将是我可以验证用户。后面章节会详细讲述URL路由的配置项。</p>
<ul>
<li><p>添加占位符<br>  我将首先实现验证特性，但我需要为<code>/views/adminMain.html</code>视图文件创建一些占位内容，以让我有一些东西在验证成功后显示。下面是文件内容（临时的）：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span>&gt;</span></div><div class="line">	这是主页面</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="实现验证"><a href="#实现验证" class="headerlink" title="实现验证"></a>实现验证</h3><p>Deployd验证用户使用标准HTTP请求，应用程序发送POST请求到/users/login（这是Deployd进行登录验证的URL），需要在请求提包含username和password。如果验证尝试成功了服务器就响应状态码200，在用户无法验证时状态码是401。为实现验证，我先定义产生Ajax调用的控制器并处理响应，下面是<code>controllers/adminControllers.js</code>文件的内容：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">"sportsStoreAdmin"</span>)</div><div class="line">.constant(<span class="string">"authUrl"</span>,<span class="string">"http://localhost:5500/users/login"</span>)</div><div class="line">.controller(<span class="string">"authCtrl"</span>,[<span class="string">"$scope"</span>,<span class="string">"$http"</span>,<span class="string">"$location"</span>,<span class="string">"authUrl"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope,$http,$location,authUrl</span>)</span>&#123;</div><div class="line">	$scope.authenticate = <span class="function"><span class="keyword">function</span>(<span class="params">username,password</span>)</span>&#123;</div><div class="line">		$http.post(authUrl,&#123;</div><div class="line">			username:username,</div><div class="line">			password:password</div><div class="line">		&#125;,&#123;</div><div class="line">			<span class="comment">//设置为true,会企业跨域请求的支持,允许Ajax请求使用cookie处理验证。后面会介绍</span></div><div class="line">			withCredentials : <span class="literal">true</span></div><div class="line">		&#125;).success(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">			$location.path(<span class="string">"/main"</span>);</div><div class="line">		&#125;).error(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</div><div class="line">			$scope.authenticationError = error;</div><div class="line">		&#125;);</div><div class="line">	&#125;</div><div class="line">&#125;])</div></pre></td></tr></table></figure>
<p>使用控制器，在<code>admin.html</code>页面引入<code>controllers/adminControllers.js</code>文件即可，注意确保它出现在模块定义的代码后面。</p>
<ul>
<li><p>定义验证视图<br>  下一步是创建允许用户输入用户名和密码的视图，调用authCtrl控制器所定义的行为<code>authenticate</code>，然后显示任何错误的详情。下面是<code>views/adminLogin.html</code>文件的内容：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span> <span class="attr">ng-controller</span>=<span class="string">"authCtrl"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert alert-info"</span> <span class="attr">ng-hide</span>=<span class="string">"authenticationError"</span>&gt;</span></div><div class="line">		请输入你的用户名和密码进行登录验证</div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert alert-danger"</span> <span class="attr">ng-show</span>=<span class="string">"authenticationError"</span>&gt;</span></div><div class="line">		验证失败(&#123;&#123;authenticationError.status&#125;&#125;)。请重新尝试。</div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">novalidate</span>=<span class="string">"novalidate"</span> <span class="attr">name</span>=<span class="string">"authForm"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"username"</span> <span class="attr">required</span>=<span class="string">"required"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"password"</span> <span class="attr">required</span>=<span class="string">"required"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">ng-disabled</span>=<span class="string">"authForm.$invalid"</span> <span class="attr">ng-click</span>=<span class="string">"authenticate(username,password)"</span>&gt;</span></div><div class="line">				登录</div><div class="line">			<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="定义主视图和控制器"><a href="#定义主视图和控制器" class="headerlink" title="定义主视图和控制器"></a>定义主视图和控制器</h3><p>一旦用户验证通过，ng-view指令就显示adminMain.html视图，该视图将允许管理员管理产品分类的内容以及查看订单队列。<br>在开始之前，我先定义占位内容用于显示产品分类视图和订单列表视图。首先，我创建<code>views/adminProducts.html</code>，下面是文件内容：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span>&gt;</span></div><div class="line">	这是产品视图</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>类似地，我创建了<code>views/adminOrders.html</code>文件，并定义了相似的占位内容，下面是文件内容：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span>&gt;</span></div><div class="line">	这是订单视图</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>由于在主视图<code>views/adminMain.html</code>需要切换产品视图和订单视图，但遗憾的是<code>ng-view</code>指令不能嵌套使用，所以，我将使用<code>ng-include</code>指令来处理它，作为不太优雅（但功能完善）的代替品。现在，我在<code>controllers/adminControllers.js</code>文件中定义新的控制器，下面是部分修改的内容：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">.controller(<span class="string">"mainCtrl"</span>,[<span class="string">"$scope"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>)</span>&#123;</div><div class="line">	$scope.screens = [<span class="string">"Products"</span>,<span class="string">"Orders"</span>];</div><div class="line">	$scope.current = $scope.screens[<span class="number">0</span>];</div><div class="line">	<span class="comment">//设置视图</span></div><div class="line">	$scope.setScreen = <span class="function"><span class="keyword">function</span>(<span class="params">index</span>)</span>&#123;</div><div class="line">		$scope.current = $scope.screens[index];</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//获取视图</span></div><div class="line">	$scope.getScreen = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="keyword">return</span> $scope.current == <span class="string">"Products"</span> ?</div><div class="line">				<span class="string">"views/adminProducts.html"</span> : <span class="string">"views/adminOrders.html"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;]);</div></pre></td></tr></table></figure>
<p>下面是修改后的<code>views/adminMain.html</code>文件：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default row"</span> <span class="attr">ng-controller</span>=<span class="string">"mainCtrl"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-xs-3 panel-body"</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!--ng-class:如果是一个对象。那么如果某个键所对应的的值是true则该键将会作为一个类名--&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-repeat</span>=<span class="string">"item in screens"</span> </span></div><div class="line">			<span class="attr">class</span>=<span class="string">"btn btn-block btn-default"</span></div><div class="line">			<span class="attr">ng-class</span>=<span class="string">"&#123;'btn-primary':item == current&#125;"</span></div><div class="line">			<span class="attr">ng-click</span>=<span class="string">"setScreen($index);"</span>&gt;</div><div class="line">			&#123;&#123;item&#125;&#125;</div><div class="line">		<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-xs-8 panel-body"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-include</span>=<span class="string">"getScreen()"</span>&gt;</span></div><div class="line">			</div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="实现订单特性"><a href="#实现订单特性" class="headerlink" title="实现订单特性"></a>实现订单特性</h3><p>我现在开始订单列表，它处理起来是最简单的，因为我仅仅是要显示只读列表，在实际中可能会更复杂。我想<code>controllers/adminControllers.js</code>添加订单控制器，下面是部分修改的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">.controller(<span class="string">"ordersCtrl"</span>,[<span class="string">"$scope"</span>,<span class="string">"$http"</span>,<span class="string">"ordersUrl"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope,$http,ordersUrl</span>)</span>&#123;</div><div class="line">	$http.get(ordersUrl,&#123;withCredentials:<span class="literal">true</span>&#125;)</div><div class="line">		.success(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">			$scope.orders = data;</div><div class="line">		&#125;)</div><div class="line">		.error(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</div><div class="line">			$scope.error = error;</div><div class="line">		&#125;);</div><div class="line">	$scope.selectedOrder;</div><div class="line">	<span class="comment">//选择订单</span></div><div class="line">	$scope.selectOrder = <span class="function"><span class="keyword">function</span>(<span class="params">order</span>)</span>&#123;</div><div class="line">		$scope.selectedOrder = order;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//计算总价</span></div><div class="line">	$scope.calcTotal = <span class="function"><span class="keyword">function</span>(<span class="params">order</span>)</span>&#123;</div><div class="line">		<span class="keyword">var</span> total = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; order.products.length ; i++)&#123;</div><div class="line">			total += order.products[i].count * order.products[i].price;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> total;</div><div class="line">	&#125;</div><div class="line">&#125;]);</div></pre></td></tr></table></figure>
<p>有了ordersCtrl控制器，我修改<code>views/adminOrders.html</code>页面的内容并使用控制器，下面是修改后的文件内容：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"ordersCtrl"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped table-bordered"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>所在城市<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>订单总价<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-repeat</span>=<span class="string">"order in orders"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;order.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;order.city&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;calcTotal(order) | currency&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">ng-click</span>=<span class="string">"selectOrder(order);"</span> <span class="attr">class</span>=<span class="string">"btn btn-xs btn-primary"</span>&gt;</span></div><div class="line">					订单详情</div><div class="line">				<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!--显示选择的订单详情--&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-show</span>=<span class="string">"selectedOrder"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">h3</span>&gt;</span>订单详情<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped table-bordered"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">th</span>&gt;</span>商品名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">th</span>&gt;</span>商品数量<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">th</span>&gt;</span>商品单价<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-repeat</span>=<span class="string">"product in selectedOrder.products"</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;product.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;product.count&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;product.price | currency&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>视图由两个table组成。第一个table显示订单摘要，第二个table只在订单被选中时可见，它显示订单的详情。</p>
<h3 id="实现产品特性"><a href="#实现产品特性" class="headerlink" title="实现产品特性"></a>实现产品特性</h3><p>为实现产品特性，管理员需要对产品进行增删改查。在Deployd控制面板，选择products集合并点击API，会看到RESTful API的更多细节，我会在后续章节详细介绍RESTful API。你可以使用<code>$http</code>服务来做RESTful API，这样做会暴露整组执行贯穿应用程序的操作的URL。更优雅的做法是使用可选模块<code>ngResource</code>中的<code>$resource</code>服务，它有漂亮的方式处理发送到服务器的URL的定义。</p>
<ul>
<li><p>定义RESTful控制器<br>  我要开始通过AngularJS的<code>$resource</code>服务来定义控制器以提供访问权限给Deployd的RESTful API。我在controllers文件夹中创建了新文件<code>adminProductController.js</code>并用它定义控制器，下面是文件内容：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">"sportsStoreAdmin"</span>)</div><div class="line">.constant(<span class="string">"productUrl"</span>,<span class="string">"http://localhost:5500/products/"</span>)</div><div class="line">.config(<span class="function"><span class="keyword">function</span>(<span class="params">$httpProvider</span>)</span>&#123;</div><div class="line">	$httpProvider.defaults.withCredentials = <span class="literal">true</span>;</div><div class="line">&#125;)</div><div class="line">.controller(<span class="string">"productCtrl"</span>,[<span class="string">"$scope"</span>,<span class="string">"$resource"</span>,<span class="string">"productUrl"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope,$resource,productUrl</span>)</span>&#123;</div><div class="line">	$scope.productResource = $resource(productUrl+<span class="string">":id"</span>,&#123;id:<span class="string">"@id"</span>&#125;);</div><div class="line">	<span class="comment">//查询列表</span></div><div class="line">	$scope.listProducts = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		$scope.products = $scope.productResource.query();</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//删除指定产品</span></div><div class="line">	$scope.deleteProduct = <span class="function"><span class="keyword">function</span>(<span class="params">product</span>)</span>&#123;</div><div class="line">		product.$<span class="keyword">delete</span>().then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">			$scope.products.splice($scope.products.indexOf(product),<span class="number">1</span>);</div><div class="line">		&#125;)</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//创建产品</span></div><div class="line">	$scope.createProduct = <span class="function"><span class="keyword">function</span>(<span class="params">product</span>)</span>&#123;</div><div class="line">		<span class="keyword">new</span> $scope.productResource(product).$save().then(<span class="function"><span class="keyword">function</span>(<span class="params">newProduct</span>)</span>&#123;</div><div class="line">			$scope.products.push(newProduct);</div><div class="line">			$scope.editedProduct = <span class="literal">null</span>;</div><div class="line">		&#125;)</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//更新指定产品</span></div><div class="line">	$scope.updateProduct = <span class="function"><span class="keyword">function</span>(<span class="params">product</span>)</span>&#123;</div><div class="line">		product.$save();</div><div class="line">		$scope.editedProduct = <span class="literal">null</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//编辑指定产品</span></div><div class="line">	$scope.startEdit = <span class="function"><span class="keyword">function</span>(<span class="params">product</span>)</span>&#123;</div><div class="line">		$scope.editedProduct = product;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//取消编辑</span></div><div class="line">	$scope.cancelEdit = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		$scope.editedProduct = <span class="literal">null</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//默认查询列表数据</span></div><div class="line">	$scope.listProducts();</div><div class="line">&#125;]);</div></pre></td></tr></table></figure>
<p>  这里不深入讨论该清单代码（后面详细讲解），只介绍部分重点代码。<br>  首先，<code>$resource</code>服务是建立在<code>$http</code>服务所提供的特性的基础上的。这需要我启用withCredentials选项，我没有权限访问由<code>$http</code>服务产生的请求，但我可以使用模块上的config方法改变所有Ajax请求的默认设置。<br>  本例中最重要的一部分是下面这句代码：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$scope.productResource = $resource(productUrl+<span class="string">":id"</span>,&#123;id:<span class="string">"@id"</span>&#125;);</div></pre></td></tr></table></figure>
<p>  传入<code>$resource</code>的第一个参数用来定义将用于产生查询的URL格式。”:id”部分与第二个参数的映射对象一致，告诉AngularJS如果数据对象中有id属性，那它应该被添加到用于Ajax请求的URL中。用于访问RESTful的API的URL 和HTTP方法是由这两个参数推断出的。<br>  访问对象是由<code>$resource</code>服务的结果，有query、get、delete、remove和save方法。调用这些方法触发执行相应操作的Ajax请求。</p>
</li>
<li><p>定义视图<br>  现在，我将视图<code>adminProducts.html</code>的占位内容替换为以下内容：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">	<span class="selector-id">#productTable</span>&#123;<span class="attribute">width</span>: auto;&#125;</div><div class="line">	<span class="selector-id">#productTable</span> <span class="selector-tag">td</span>&#123;<span class="attribute">max-width</span>: <span class="number">150px</span>;<span class="attribute">text-overflow</span>: ellipsis;<span class="attribute">overflow</span>: hidden;<span class="attribute">white-space</span>: nowrap;&#125;</div><div class="line">	<span class="selector-id">#productTable</span> <span class="selector-tag">td</span> <span class="selector-tag">input</span>&#123;<span class="attribute">max-width</span>: <span class="number">125px</span>;&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"productCtrl"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped table-bordered"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>产品名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>产品描述<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>产品目录<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>产品价格<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-repeat</span>=<span class="string">"item in products"</span> <span class="attr">ng-hide</span>=<span class="string">"item.id == editedProduct.id"</span> &gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"description"</span>&gt;</span>&#123;&#123;item.description&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;item.category&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;item.price | currency&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">ng-click</span>=<span class="string">"startEdit(item);"</span> <span class="attr">class</span>=<span class="string">"btn btn-xs btn-primary"</span>&gt;</span></div><div class="line">					编辑</div><div class="line">				<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">ng-click</span>=<span class="string">"deleteProduct(item);"</span> <span class="attr">class</span>=<span class="string">"btn btn-xs btn-danger"</span>&gt;</span></div><div class="line">					删除</div><div class="line">				<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-class</span>=<span class="string">"&#123;danger:editedProduct&#125;"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"editedProduct.name"</span> <span class="attr">required</span>=<span class="string">"required"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"editedProduct.description"</span> <span class="attr">required</span>=<span class="string">"required"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"editedProduct.category"</span> <span class="attr">required</span>=<span class="string">"required"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"editedProduct.price"</span> <span class="attr">required</span>=<span class="string">"required"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">ng-hide</span>=<span class="string">"editedProduct.id"</span> <span class="attr">ng-click</span>=<span class="string">"createProduct(editedProduct);"</span> <span class="attr">class</span>=<span class="string">"btn btn-xs btn-primary"</span>&gt;</span></div><div class="line">					创建</div><div class="line">				<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">ng-show</span>=<span class="string">"editedProduct.id"</span> <span class="attr">ng-click</span>=<span class="string">"updateProduct(editedProduct);"</span> <span class="attr">class</span>=<span class="string">"btn btn-xs btn-primary"</span>&gt;</span></div><div class="line">					保存</div><div class="line">				<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">ng-show</span>=<span class="string">"editedProduct"</span> <span class="attr">ng-click</span>=<span class="string">"cancelEdit(editedProduct);"</span> <span class="attr">class</span>=<span class="string">"btn btn-xs btn-danger"</span>&gt;</span></div><div class="line">					取消</div><div class="line">				<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>添加HTML文件的引用<br>  剩下的就是在admin.html文件中添加<code>script</code>元素来引入新模块和新控制器并更新主应用程序模块，依赖于<code>ngResource</code>，下面是admin.html文件修改后的内容：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">ng-app</span>=<span class="string">"sportsStoreAdmin"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"angular.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"ngmodules/angular-route.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"ngmodules/angular-resource.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"bootstrap.css"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"bootstrap-theme.css"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">			angular.module(<span class="string">"sportsStoreAdmin"</span>,[<span class="string">"ngRoute"</span>,<span class="string">"ngResource"</span>])</div><div class="line">			.config([<span class="string">"$routeProvider"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$routeProvider</span>)</span>&#123;</div><div class="line">				$routeProvider.when(<span class="string">"/login"</span>,&#123;</div><div class="line">					templateUrl : <span class="string">"views/adminLogin.html"</span></div><div class="line">				&#125;);</div><div class="line">				$routeProvider.when(<span class="string">"/main"</span>,&#123;</div><div class="line">					templateUrl : <span class="string">"views/adminMain.html"</span></div><div class="line">				&#125;);</div><div class="line">				$routeProvider.otherwise(&#123;</div><div class="line">					redirectTo : <span class="string">"/login"</span></div><div class="line">				&#125;);</div><div class="line">			&#125;])</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"controllers/adminControllers.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"controllers/adminProductController.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">ng-view</span>&gt;</span><span class="tag">&lt;/<span class="name">ng-view</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  现在，一个简单但完整的运动商店应用程序已经完成。你可以从<code>https://github.com/heji1993/angular-sportsstore.git</code>下载完整代码。</p>
</li>
</ul>


            <div class="post-info">
    <p class="link">本文链接：<a href="http://heji.website/2017/03/06/第六章、运动商店：订单和管理/">http://heji.website/2017/03/06/第六章、运动商店：订单和管理/</a></p>
    <div class="share">
    分享本页：
    
        <div class="bdsharebuttonbox"><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间">QQ空间</a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博">腾讯微博</a><a href="#" class="bds_more" data-cmd="more"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>

    
    
</div>

</div>


            
    <section class="comment">
    <div class="ds-thread" data-thread-key="undefined" data-title="第六章、运动商店：订单和管理" data-url="http://heji.website/2017/03/06/第六章、运动商店：订单和管理/" data-author-key="何机"></div>
</section>


<script type="text/javascript">
var duoshuoQuery = {short_name:"heji"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';
        ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>





        </div>
    </div>
</article>

    <footer id="footer">
        <div id="bottom-tip">
            何机的技术博客 —— <small>No pains,no gains</small>
        </div>
        <small>该博客由 <a href="https://hexo.io/" target="_blank">Hexo</a> 强力驱动，搭载 <a href="https://github.com/gejiawen/hexadillax2" target="_blank">Hexadillax2</a> 主题</small><br />
        <!--<small>如果你访问github速度过慢，可移步本站的备份站点<a href="http://gejiawen.gitcafe.io">gejiawen.gitcafe.io</a></small><br />-->
        <small>&copy; 2017 <a href="http://heji.website" target="_blank">何机</a></small>
    </footer>
    
    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e4dd778a6204eb51e4f25460e37481ad";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


    <script type="text/javascript" src="http://tajs.qq.com/stats?sId=58628762" charset="UTF-8"></script>


    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-51347904-1', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>

