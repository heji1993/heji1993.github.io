<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[关于JavaScript原型与继承的理解]]></title>
      <url>http://heji.website/2017/03/07/Javascript%E5%8E%9F%E5%9E%8B%E4%B8%8E%E7%BB%A7%E6%89%BF/</url>
      <content type="html"><![CDATA[<p>原型是JavaScript的难点之一，所以有必要把相关知识点记录下来。</p>
<a id="more"></a>
<h3 id="私有变量和函数"><a href="#私有变量和函数" class="headerlink" title="私有变量和函数"></a>私有变量和函数</h3><p>在函数内部定义的变量和函数，如果不对外提供接口，外部是无法访问到的，也就是该函数的私有的变量和函数。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Box</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> color = <span class="string">"blue"</span>;<span class="comment">//私有变量</span></div><div class="line">        <span class="keyword">var</span> fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) //私有函数</span></div><div class="line">        &#123;</div><div class="line">            </div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&lt;<span class="regexp">/script&gt;</span></div></pre></td></tr></table></figure></p>
<p>这样在函数对象<code>Box</code>外部无法访问变量<code>color</code>和<code>fn</code>，他们就变成私有的了：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> Box();</div><div class="line">    alert(obj.color);<span class="comment">//弹出 undefined</span></div><div class="line">    alert(obj.fn);<span class="comment">//同上</span></div></pre></td></tr></table></figure></p>
<h3 id="静态变量和函数"><a href="#静态变量和函数" class="headerlink" title="静态变量和函数"></a>静态变量和函数</h3><p>当定义一个函数后通过点号 “.”为其添加的属性和函数，通过对象本身仍然可以访问得到，但是其实例却访问不到，这样的变量和函数分别被称为<code>静态变量</code>和<code>静态函数</code>。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Obj</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line">    Obj.num = <span class="number">72</span>;<span class="comment">//静态变量</span></div><div class="line">    Obj.fn = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="comment">//静态函数</span></div><div class="line">    &#125;  </div><div class="line">    </div><div class="line">    alert(Obj.num);<span class="comment">//72</span></div><div class="line">    alert(<span class="keyword">typeof</span> Obj.fn)<span class="comment">//function</span></div><div class="line">    </div><div class="line">    <span class="keyword">var</span> t = <span class="keyword">new</span> Obj();</div><div class="line">    alert(t.name);<span class="comment">//undefined</span></div><div class="line">    alert(<span class="keyword">typeof</span> t.fn);<span class="comment">//undefined</span></div><div class="line">&lt;<span class="regexp">/script&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="实例变量和函数"><a href="#实例变量和函数" class="headerlink" title="实例变量和函数"></a>实例变量和函数</h3><p>在面向对象编程中除了一些库函数我们还是希望在对象定义的时候同时定义一些属性和方法，实例化后可以访问，js也能做到这样<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Box</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.a=[]; <span class="comment">//实例变量</span></div><div class="line">        <span class="keyword">this</span>.fn=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">//实例方法</span></div><div class="line">            </div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">typeof</span> Box.a); <span class="comment">//undefined</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">typeof</span> Box.fn); <span class="comment">//undefined</span></div><div class="line">    <span class="keyword">var</span> box=<span class="keyword">new</span> Box();</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">typeof</span> box.a); <span class="comment">//object</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">typeof</span> box.fn); <span class="comment">//function</span></div><div class="line">&lt;<span class="regexp">/script&gt;</span></div></pre></td></tr></table></figure></p>
<p>为实例变量和方法添加新的方法和属性:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Box</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.a=[]; <span class="comment">//实例变量</span></div><div class="line">        <span class="keyword">this</span>.fn=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">//实例方法</span></div><div class="line">            </div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> box1=<span class="keyword">new</span> Box();</div><div class="line">    box1.a.push(<span class="number">1</span>);</div><div class="line">    box1.fn=&#123;&#125;;</div><div class="line">    <span class="built_in">console</span>.log(box1.a); <span class="comment">//[1]</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">typeof</span> box1.fn); <span class="comment">//object</span></div><div class="line"></div><div class="line">    <span class="keyword">var</span> box2=<span class="keyword">new</span> Box();</div><div class="line">    <span class="built_in">console</span>.log(box2.a); <span class="comment">//[]</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">typeof</span> box2.fn); <span class="comment">//function</span></div><div class="line">&lt;<span class="regexp">/script&gt;</span></div></pre></td></tr></table></figure></p>
<p>在<code>box1</code>中修改了<code>a</code>和<code>fn</code>，而在<code>box2</code>中没有改变，由于数组和函数都是对象，是引用类型，这就说明<code>box1</code>中的属性和方法与<code>box2</code>中的属性与方法虽然同名但却不是一个引用，而是对<code>Box</code>对象定义的属性和方法的一个复制。<br>这个对属性来说没有什么问题，但是对于方法来说问题就很大了，因为方法都是在做完全一样的功能，但是却又两份复制，如果一个函数对象有上千和实例方法，那么它的每个实例都要保持一份上千个方法的复制，这显然是不科学的，这可肿么办呢，<code>prototype</code>应运而生。</p>
<h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><ul>
<li>普通函数与构造函数<br>  <table><tr><th>函数类型</th><th>是否需要<code>new</code>调用</th><th>是否需要返回</th><th>是否建议使用<code>this</code>关键字</th><th>命名方式</th></tr><tr><th>普通函数</th><th>不需要<code>new</code>,直接调用</th><th>可以返回</th><th>不应该使用this，此时this表示window对象</th><th>驼峰式命名，首字母小写</th></tr><tr><th>构造函数</th><th>用<code>new</code>关键字实例化</th><th>不需要返回,默认返回<code>this</code>，当前实例对象</th><th>内部经常使用this,this指向<code>new</code>创建的实例</th><th>函数名建议首字母大写</th></tr></table>其实普通函数和构造函数本质上都是函数，只是用法不大一样。</li>
<li><p>prototype属性（指向原型对象）<br>  在<code>JavaScript</code>中,一共有两种类型的值,原始值和对象值。每个对象的构造函数都有一个内部属性<code>prototype</code> ,我们通常称之为原型。原型的值可以是一个对象,也可以是<code>null</code>。如果它的值是一个对象，则这个对象的构造函数也一定有自己的原型。这样就形成了一条线性的链，我们称之为<code>原型链</code>。<br>  使用原型的好处是可以让对象实例共享它所包含的属性和方法。也就是说，不必在构造函数中添加定义对象信息，而是可以直接将这些信息添加到原型中。这样就解决了构造函数中每个方法都会在每个实例中重新创建的不科学的问题。<br>  <strong>注意：只有函数才有<code>prototype</code>属性（原型），该属性指向一个对象，但对象实例有一个<code>__proto__</code>属性，该属性又指向了对象的构造函数的原型，所以<code>对象.__proto__===构造函数.prototype</code>是成立的</strong><br>  下面有一个例子：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</div><div class="line">    <span class="keyword">var</span> Browser = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line">    Browser.prototype.run = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        alert(<span class="string">"I'm Gecko,a kernel of firefox￼"</span>);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> Bro = <span class="keyword">new</span> Browser();</div><div class="line">    <span class="comment">//Bro对象本身没有run属性，所以，他就会去他的`__proto__`中去找，也就是`Browser.prototype`，最终执行了run方法</span></div><div class="line">    Bro.run();</div><div class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div></pre></td></tr></table></figure>
<p>  原型对象初始化的时候是空的，我们可以在里面自定义任何属性和方法，这些方法和属性都将被该构造函数所创建的对象继承。</p>
</li>
<li><p>constructor属性（指向构造函数）以及<br>  实例一创造出来就具有constructor属性（指向构造函数）。原型对象内部也有一个指针（constructor属性）指向构造函数:Person.prototype.constructor = Person;<br>  所以它们的关系如下图所示：</p>
<p>  <img src="imgs/1488874915354_3.png" alt=""><br>  举个例子：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;<span class="comment">//设置对象属性</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">//给基类构造函数的prototype添加behavior方法</span></div><div class="line">    Animal.prototype.behavior = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        alert(<span class="string">"this is a "</span>+<span class="keyword">this</span>.name);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> Dog = <span class="keyword">new</span> Animal(<span class="string">"dog"</span>);<span class="comment">//创建Dog对象</span></div><div class="line">    <span class="keyword">var</span> Cat = <span class="keyword">new</span> Animal(<span class="string">"cat"</span>);<span class="comment">//创建Cat对象</span></div><div class="line">    Dog.behavior();<span class="comment">//output "this is a dog"</span></div><div class="line">    Cat.behavior();<span class="comment">//output "this is a cat"</span></div><div class="line">    alert(Dog.behavior==Cat.behavior);<span class="comment">//output true;</span></div><div class="line">&lt;<span class="regexp">/script&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h3><p>当从一个对象那里调取属性或方法时，如果该对象自身不存在这样的属性或方法，就会去自己关联的<code>prototype</code>对象那里寻找(通过实例的<code>__proto__</code>属性)，如果<code>prototype</code>没有，就会去<code>prototype</code>关联的前辈<code>prototype</code>那里寻找，如果再没有则继续查找<code>Prototype.Prototype</code>引用的对象，依次类推，直到Prototype.….Prototype为<code>undefined</code>（<code>Object</code>的<code>Prototype</code>就是<code>undefined</code>）从而形成了所谓的“原型链”。</p>
<h3 id="原型继承"><a href="#原型继承" class="headerlink" title="原型继承"></a>原型继承</h3><p>在原型链的末端，就是<code>Object</code>构造函数<code>prototype</code>属性指向的那个原型对象。这个原型对象是所有对象的祖先，这个老祖宗实现了诸如<code>toString</code>等所有对象天生就该具有的方法。其他内置构造函数，如<code>Function</code>，<code>Boolean</code>，<code>String</code>，<code>Date</code>和<code>RegExp</code>等的<code>prototype</code>都是从这个老祖宗传承下来的，但他们各自又定义了自身的属性和方法，从而他们的子孙就表现出各自宗族的那些特征。<br>另外，实例还能覆盖从原型继承来的属性，如下例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;<span class="comment">//设置对象属性</span></div><div class="line">    &#125;;</div><div class="line">    <span class="comment">//设置原型的属性</span></div><div class="line">    Person.prototype.company = <span class="string">"Microsoft"</span>;</div><div class="line">     <span class="comment">//原型的方法</span></div><div class="line">    Person.prototype.SayHello = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;  </div><div class="line">        alert(<span class="string">"Hello,I'm "</span>+ <span class="keyword">this</span>.name+ <span class="string">" of "</span> + <span class="keyword">this</span>.company);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">//创建person对象</span></div><div class="line">    <span class="keyword">var</span> BillGates = <span class="keyword">new</span> Person(<span class="string">"BillGates"</span>);</div><div class="line">    <span class="comment">//继承了原型的内容，输出"Hello,I'm BillGates of Microsoft"</span></div><div class="line">    BillGates.SayHello();</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> Jobs = <span class="keyword">new</span> Person(<span class="string">"Jobs"</span>);</div><div class="line">    <span class="comment">//设置自己的company属性，掩盖了原型的company属性</span></div><div class="line">    Jobs.company = <span class="string">"Apple"</span>;</div><div class="line">    Jobs.SayHello = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        alert(<span class="string">"Hi,"</span>+<span class="keyword">this</span>.name + <span class="string">" like "</span> + <span class="keyword">this</span>.company);</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">//自己覆盖的属性和方法，输出"Hi,Jobs like Apple"</span></div><div class="line">    Jobs.SayHello();</div><div class="line">    <span class="comment">//Jobs的覆盖没有影响原型，BillGates还是照样输出</span></div><div class="line">    BillGates.SayHello();</div><div class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div></pre></td></tr></table></figure>
<h3 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h3><table>
<thead>
<tr>
<th>方法名</th>
<th>说明</th>
<th>例子</th>
</tr>
</thead>
<tbody>
<tr>
<td>isPrototypeof</td>
<td>判断对象是不是实例对象的原型</td>
<td>原型对象.isPrototypeof(实例对象)</td>
</tr>
<tr>
<td>hasOwnProperty</td>
<td>监测实例对象是否含有指定属性，但不能检测到原型</td>
<td>“Test”.hasOwnProperty(“split”); //false<br>String.prototype.hasOwnProperty(“split”); //true</td>
</tr>
</tbody>
</table>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[第六章、运动商店：订单和管理]]></title>
      <url>http://heji.website/2017/03/06/%E7%AC%AC%E5%85%AD%E7%AB%A0%E3%80%81%E8%BF%90%E5%8A%A8%E5%95%86%E5%BA%97%EF%BC%9A%E8%AE%A2%E5%8D%95%E5%92%8C%E7%AE%A1%E7%90%86/</url>
      <content type="html"><![CDATA[<p>在本章中，我会收集并验证运输详情以完成运动商店应用程序，并把订单存储在Deployd服务器上。我还会创建管理应用程序，让认证的用户看到订单并管理产品目录。</p>
<a id="more"></a>
<h2 id="准备示例程序"><a href="#准备示例程序" class="headerlink" title="准备示例程序"></a>准备示例程序</h2><p>我将继续在上一章的项目上构建，你可以从<code>https://github.com/heji1993/angular-sportsstore.git</code>上获取源码。<br>在上一章中，我在<code>app.html</code>添加了两个URL路由，它们是本章完成结账过程所需的：<br><img src="imgs/1486699645094_2.png" alt=""></p>
<h2 id="获取运输详情"><a href="#获取运输详情" class="headerlink" title="获取运输详情"></a>获取运输详情</h2><p>在购物车中为用户显示商品总览后，我想获取订单的运输详情，这带我来到了AngularJS与表单相关的特性面前。我创建<code>views/placeorder.html</code>文件捕获用户的运输详情。下面是该文件的内容：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>提交订单<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>请输入你的相关信息，我们会直接把你的商品邮寄给你<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">h3</span>&gt;</span>收件人<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">label</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.name"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">h3</span>&gt;</span>收货地址<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">label</span>&gt;</span>街道地址<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.street"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>完成订单<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>关于该视图，首先要注意的是我没有使用ng-controller指令指定控制器，这意味着视图将被顶级控制器<code>sportsStoreCtrl</code>支持。另外，在输入框元素上，我使用了ng-model指令进行数据绑定，与双花括号不同的是，ng-model是双向数据绑定，视图上模型的改变会更新到作用域，而双花括号是单向绑定，通常用于展示。当data对象没有shipping属性时，AngularJS会动态创建这个属性。</p>
<h3 id="添加表单验证"><a href="#添加表单验证" class="headerlink" title="添加表单验证"></a>添加表单验证</h3><p>AngularJS支持表单验证，它能检查数值的适用性。<br>AngularJS表单校验基于元素上标准的HTML属性，比如type和required。表单验证自动执行，但仍需要一些工作来将验证的反馈呈现给用户，并在应用程序中整合整体的验证不通过的提示。</p>
<ul>
<li><p>验证的准备<br>  设置表单验证的第一步是在视图上添加form元素并在我的input元素上添加验证属性。下面是<code>views/placeorder.html</code>文件修改的内容：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"shippingForm"</span> <span class="attr">novalidate</span>=<span class="string">""</span>&gt;</span></div><div class="line">    ...</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.name"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">    ...</div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.street"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">    ...</div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  新增一个form元素有三个目的：开启表单验证；<code>novalidate</code>属性是H5的标准属性，表示禁用浏览器的默认校验，让表单校验统一由AngularJS执行；定义一个变量，用来报告表单的有效性，它通过name属性实现，我把它设置为shippingForm，在后面将会演示如何使用。</p>
</li>
<li><p>显示验证反馈<br>  一旦form元素和验证属性被放好，AngularJS就会开始验证用户所提供的数据，AngularJS提供两种验证结果的反馈形式：1.使用AngularJS赋予form元素的通过验证和未通过验证的类来定义CSS样式，当通过校验时，元素会有<code>ng-valid</code>类，当没有通过校验时，元素会有<code>ng-invalid</code>类。2.使用作用域变量的属性判断，比如，不满足 <code>required</code>时,<code>formName.inputName.$error</code>为<code>{required: true}</code>，更多验证请查看官方API。下面是<code>views/placeorder.html</code>文件部分修改的代码：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">      ...</div><div class="line">      <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">      	<span class="selector-class">.ng-valid</span>&#123;</div><div class="line">      		<span class="attribute">border-color</span>: lightgreen;</div><div class="line">      	&#125;</div><div class="line">      	<span class="selector-class">.ng-invalid</span>&#123;</div><div class="line">      		<span class="attribute">border-color</span>: lightpink;</div><div class="line">      	&#125;</div><div class="line">      	<span class="selector-tag">span</span><span class="selector-class">.error</span>&#123;</div><div class="line">      		<span class="attribute">font-weight</span>: bold;</div><div class="line">      		<span class="attribute">color</span>: red;</div><div class="line">      	&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">      ...</div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">label</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.name"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"shippingForm.name.$error.required"</span>&gt;</span>请输入姓名<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>收货地址<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">label</span>&gt;</span>街道地址<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"street"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.street"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"shippingForm.street.$error.required"</span>&gt;</span>请输入街道地址<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>连接按钮来验证<br>  当表单内一个或多个input元素未通过验证，<code>formName.$invalid</code>属性的值将会被AngularJS设为true，我们可以把它和ng-disabled指令联合来管理button元素的状态（校验未通过不允许点击提交），下面是<code>views/placeorder.html</code>文件部分修改的代码：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">      ...</div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">ng-disabled</span>=<span class="string">"shippingForm.$invalid"</span>&gt;</span>完成订单<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">...</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="添加剩下的表单字段"><a href="#添加剩下的表单字段" class="headerlink" title="添加剩下的表单字段"></a>添加剩下的表单字段</h3><p>现在我将在表单中添加剩下的input元素，下面是<code>views/placeorder.html</code>文件的完整代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">	<span class="selector-class">.ng-valid</span>&#123;</div><div class="line">		<span class="attribute">border-color</span>: lightgreen;</div><div class="line">	&#125;</div><div class="line">	<span class="selector-class">.ng-invalid</span>&#123;</div><div class="line">		<span class="attribute">border-color</span>: lightpink;</div><div class="line">	&#125;</div><div class="line">	<span class="selector-tag">span</span><span class="selector-class">.error</span>&#123;</div><div class="line">		<span class="attribute">font-weight</span>: bold;</div><div class="line">		<span class="attribute">color</span>: red;</div><div class="line">	&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>提交订单<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>请输入你的相关信息，我们会直接把你的商品邮寄给你<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"shippingForm"</span> <span class="attr">novalidate</span>=<span class="string">""</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">h3</span>&gt;</span>收件人<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">label</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.name"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"shippingForm.name.$error.required"</span>&gt;</span>请输入姓名<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">h3</span>&gt;</span>收货地址<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">label</span>&gt;</span>街道<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"street"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.street"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"shippingForm.street.$error.required"</span>&gt;</span>请输入街道地址<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">label</span>&gt;</span>区<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"county"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.county"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"shippingForm.county.$error.required"</span>&gt;</span>请输入所在区<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">label</span>&gt;</span>市<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"city"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.city"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"shippingForm.city.$error.required"</span>&gt;</span>请输入所在市<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">label</span>&gt;</span>国家<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"country"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.country"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"shippingForm.country.$error.required"</span>&gt;</span>请输入所在国家<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">label</span>&gt;</span>邮政编码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"zip"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.zip"</span> <span class="attr">required</span>=<span class="string">"required"</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"shippingForm.zip.$error.required"</span>&gt;</span>请输入所在市、区<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">h3</span>&gt;</span>可选<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"checkbox"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">label</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"giftwarp"</span> <span class="attr">ng-model</span>=<span class="string">"data.shipping.giftwrap"</span>/&gt;</span></div><div class="line">				是否礼盒包装</div><div class="line">			<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">ng-disabled</span>=<span class="string">"shippingForm.$invalid"</span>&gt;</span>完成订单<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="下单"><a href="#下单" class="headerlink" title="下单"></a>下单</h2><p>现在，我将扩展由Deployd服务器提供的数据库，使用Ajax请求发送订单数据到服务器，并最终显示感谢消息来完成这一过程。</p>
<h3 id="扩展Deployd服务"><a href="#扩展Deployd服务" class="headerlink" title="扩展Deployd服务"></a>扩展Deployd服务</h3><p>为管理订单，新增一个order集合，方式和之前创建product集合一样，下面是order必要的属性，与placeorder.html的表单字段对应。<br><img src="imgs/1487743819803_2.png" alt=""></p>
<h3 id="定义控制器行为"><a href="#定义控制器行为" class="headerlink" title="定义控制器行为"></a>定义控制器行为</h3><p>下一步是定义控制器行为，他将使用Ajax请求发送订单明细到Deployd服务器。我们可以使用不同的方法定义该功能，比如服务或新控制器。这种灵活性是使用AngularJS的标志之一。当谈到AngularJS应用程序的架构时，没有绝对的正确或错误，你会开发出属于自己的风格和偏好，积累到你的经验中。我将保持简单，向顶级控制器sportsStore控制器中添加行为，它目前已包含了产生Ajax请求加载产品数据的代码。下面是修改后的<code>controllers/sportsStore.js</code>文件的内容：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//module方法值传一个参数表示我们尝试找到sportsStore这个模块,必须先有sportsStore模块,否则会报错</span></div><div class="line">angular.module(<span class="string">"sportsStore"</span>)</div><div class="line">.constant(<span class="string">"dataUrl"</span>,<span class="string">"http://localhost:5500/products"</span>)</div><div class="line">.constant(<span class="string">"orderUrl"</span>,<span class="string">"http://localhost:5500/orders"</span>)</div><div class="line">.controller(<span class="string">"sportsStoreCtrl"</span>,[<span class="string">"$scope"</span>,<span class="string">"$http"</span>,<span class="string">"$location"</span>,<span class="string">"dataUrl"</span>,<span class="string">"orderUrl"</span>,<span class="string">"cartService"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope,$http,$location,dataUrl,orderUrl,cartService</span>)</span>&#123;</div><div class="line">	$scope.data = &#123;&#125;;</div><div class="line">	<span class="comment">//使用$http服务查询数据</span></div><div class="line">	$http.get(dataUrl)</div><div class="line">	.success(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</div><div class="line">		$scope.data.products = result;</div><div class="line">	&#125;)</div><div class="line">	.error(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</div><div class="line">		$scope.data.error = error;</div><div class="line">	&#125;);</div><div class="line">	<span class="comment">//发送订单</span></div><div class="line">	$scope.sendOrder = <span class="function"><span class="keyword">function</span>(<span class="params">shippingDetails</span>)</span>&#123;</div><div class="line">		<span class="comment">//创建运输详情对象的副本,以便修改不影响程序的其他部分</span></div><div class="line">		<span class="keyword">var</span> order = angular.copy(shippingDetails);</div><div class="line">		<span class="comment">//从购物车获取所有商品</span></div><div class="line">		order.products = cartService.getProducts();</div><div class="line">		<span class="comment">//发送请求提交订单（以post方法提交请求到Deployd服务器并发送数据即完成对象的创建）</span></div><div class="line">		$http.post(orderUrl,order)</div><div class="line">		.success(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">			$scope.data.orderId = data.id;</div><div class="line">			<span class="comment">//清空购物车</span></div><div class="line">			cartService.getProducts().length = <span class="number">0</span>;</div><div class="line">		&#125;)</div><div class="line">		.error(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</div><div class="line">			$scope.data.orderError = error;</div><div class="line">		&#125;)</div><div class="line">		.finally(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">			<span class="comment">//最后导航到订单完成页面</span></div><div class="line">			$location.path(<span class="string">"/complete"</span>);</div><div class="line">		&#125;)</div><div class="line">	&#125;</div><div class="line">&#125;])</div></pre></td></tr></table></figure></p>
<h3 id="调用控制器行为"><a href="#调用控制器行为" class="headerlink" title="调用控制器行为"></a>调用控制器行为</h3><p>调用新控制器行为，我们需要在运输详情视图中为button元素添加ng-click指令调用行为即可。下面是<code>views/placeorder.html</code>页面部分修改的代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">ng-click</span>=<span class="string">"sendOrder(data.shipping);"</span> <span class="attr">ng-disabled</span>=<span class="string">"shippingForm.$invalid"</span>&gt;</span>完成订单<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="定义视图"><a href="#定义视图" class="headerlink" title="定义视图"></a>定义视图</h3><p>在Ajax请求被完成之后，我所指定的URL路径是<code>/complete</code>，URL路由配置会映射它到文件<code>/views/thankYou.html</code>。我创建了该文件，下面是<code>/views/thankYou.html</code>的内容：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert alert-danger"</span> <span class="attr">ng-show</span>=<span class="string">"data.orderError"</span>&gt;</span></div><div class="line">	发生错误&#123;&#123;data.orderError.status&#125;&#125;.订单尚未完成<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/placeorder"</span> <span class="attr">class</span>=<span class="string">"alert-link"</span>&gt;</span>点击这里重试<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span> <span class="attr">ng-hide</span>=<span class="string">"data.orderError"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">h2</span>&gt;</span>已下单！<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line">	感谢您使用我们的购物平台，您的订单编号是&#123;&#123;data.orderId&#125;&#125;，我们会尽快将商品派送到您手里。</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="改进"><a href="#改进" class="headerlink" title="改进"></a>改进</h2><ul>
<li>当浏览器载入app.html文件时，视图被显示和产品及分类元素被生成之间有一点延迟。在后面的章节，会讲解如何使用URL路由特性来组织AngularJS在Ajax请求完成之前显示视图。</li>
<li>为了显示导航和分页，我处理产品数据并筛出分类。在实际项目中，我会考虑在产品数据首次到达时只生成该信息一次，之后就复用它，在后续章节介绍如何使用承诺来构建行为链，那是适用于这种任务的理想方式。</li>
<li>最后我会介绍如何使用<code>$animate</code>服务在URL路径改变时显示简短的过渡动画。</li>
</ul>
<h2 id="管理产品分类"><a href="#管理产品分类" class="headerlink" title="管理产品分类"></a>管理产品分类</h2><h3 id="准备Deployd"><a href="#准备Deployd" class="headerlink" title="准备Deployd"></a>准备Deployd</h3><p>我们要对产品进行管理，需要有用户集合。普通用户和管理员还有权限之分。<br>点击新建一个<code>User Collection</code>，User集默认定义了id、username和password属性，全是我所需要的属性。创建集合之后，点击data创建一条数据：<code>{username:&quot;admin&quot;,password:&quot;secret&quot;}</code>。</p>
<ul>
<li><p>巩固集合<br>  Deployd最棒的特性之一是它定义了可用于实现服务端功能的简单JavaScript API（比如验证用户），当对集合进行操作时可以触发一系列的事件。在控制台点击products集合然后单击events，你将看到一系列代表不同集事件的选项卡,如下图：<br>  <img src="imgs/1488251043574_2.png" alt=""><br>  这些事件为所有集定义，你能做许多事情，其中就有使用JavaScript加强验证策略。在On Put和On Delete标签中输入以下JavaScript：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(!me || me.username!=<span class="string">"admin"</span>)&#123;</div><div class="line">    <span class="comment">//401表示被请求的页面要求身份验证</span></div><div class="line">    cancel(<span class="string">"没有权限"</span>,<span class="number">401</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  在Deployd的API中，me表示当前用户，而cancel函数终止指定消息和HTTP状态码的请求。这段代码允许验证后的admin用户访问，终止所有其他401状态码的请求。<br>  在orders集合中为ON GET、ON PUT和ON DELETE 事件重复这一过程，因为这些事件都需要验证用户身份，下面是需要添加验证控制的事件：<br>  <img src="imgs/1488252583879_3.png" alt=""></p>
</li>
</ul>
<h3 id="创建管理应用程序"><a href="#创建管理应用程序" class="headerlink" title="创建管理应用程序"></a>创建管理应用程序</h3><p>我将为管理任务创建单独的AngularJS应用程序。但我会把它相关代码整合到主应用程序中。我向<code>angular-sportsstore</code>项目根目录添加一个新文件<code>admin.html</code>，下面是它的内容：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">ng-app</span>=<span class="string">"sportsStoreAdmin"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"angular.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"ngmodules/angular-route.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"bootstrap.css"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"bootstrap-theme.css"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">			angular.module(<span class="string">"sportsStoreAdmin"</span>,[<span class="string">"ngRoute"</span>])</div><div class="line">			.config([<span class="string">"$routeProvider"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$routeProvider</span>)</span>&#123;</div><div class="line">				$routeProvider.when(<span class="string">"/login"</span>,&#123;</div><div class="line">					templateUrl : <span class="string">"views/adminLogin.html"</span></div><div class="line">				&#125;);</div><div class="line">				$routeProvider.when(<span class="string">"/main"</span>,&#123;</div><div class="line">					templateUrl : <span class="string">"views/adminMain.html"</span></div><div class="line">				&#125;);</div><div class="line">				$routeProvider.otherwise(&#123;</div><div class="line">					redirectTo : <span class="string">"/login"</span></div><div class="line">				&#125;);</div><div class="line">			&#125;])</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">ng-view</span>&gt;</span><span class="tag">&lt;/<span class="name">ng-view</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>该html文件引入一些必须的文件，以及定义sportsstoreAdmin模块并配置了路由。为了定义路由的otherwise方法，我使用了redirectTo，它改变URL路径到其他路由，这将是我可以验证用户。后面章节会详细讲述URL路由的配置项。</p>
<ul>
<li><p>添加占位符<br>  我将首先实现验证特性，但我需要为<code>/views/adminMain.html</code>视图文件创建一些占位内容，以让我有一些东西在验证成功后显示。下面是文件内容（临时的）：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span>&gt;</span></div><div class="line">	这是主页面</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="实现验证"><a href="#实现验证" class="headerlink" title="实现验证"></a>实现验证</h3><p>Deployd验证用户使用标准HTTP请求，应用程序发送POST请求到/users/login（这是Deployd进行登录验证的URL），需要在请求提包含username和password。如果验证尝试成功了服务器就响应状态码200，在用户无法验证时状态码是401。为实现验证，我先定义产生Ajax调用的控制器并处理响应，下面是<code>controllers/adminControllers.js</code>文件的内容：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">"sportsStoreAdmin"</span>)</div><div class="line">.constant(<span class="string">"authUrl"</span>,<span class="string">"http://localhost:5500/users/login"</span>)</div><div class="line">.controller(<span class="string">"authCtrl"</span>,[<span class="string">"$scope"</span>,<span class="string">"$http"</span>,<span class="string">"$location"</span>,<span class="string">"authUrl"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope,$http,$location,authUrl</span>)</span>&#123;</div><div class="line">	$scope.authenticate = <span class="function"><span class="keyword">function</span>(<span class="params">username,password</span>)</span>&#123;</div><div class="line">		$http.post(authUrl,&#123;</div><div class="line">			username:username,</div><div class="line">			password:password</div><div class="line">		&#125;,&#123;</div><div class="line">			<span class="comment">//设置为true,会企业跨域请求的支持,允许Ajax请求使用cookie处理验证。后面会介绍</span></div><div class="line">			withCredentials : <span class="literal">true</span></div><div class="line">		&#125;).success(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">			$location.path(<span class="string">"/main"</span>);</div><div class="line">		&#125;).error(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</div><div class="line">			$scope.authenticationError = error;</div><div class="line">		&#125;);</div><div class="line">	&#125;</div><div class="line">&#125;])</div></pre></td></tr></table></figure>
<p>使用控制器，在<code>admin.html</code>页面引入<code>controllers/adminControllers.js</code>文件即可，注意确保它出现在模块定义的代码后面。</p>
<ul>
<li><p>定义验证视图<br>  下一步是创建允许用户输入用户名和密码的视图，调用authCtrl控制器所定义的行为<code>authenticate</code>，然后显示任何错误的详情。下面是<code>views/adminLogin.html</code>文件的内容：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span> <span class="attr">ng-controller</span>=<span class="string">"authCtrl"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert alert-info"</span> <span class="attr">ng-hide</span>=<span class="string">"authenticationError"</span>&gt;</span></div><div class="line">		请输入你的用户名和密码进行登录验证</div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert alert-danger"</span> <span class="attr">ng-show</span>=<span class="string">"authenticationError"</span>&gt;</span></div><div class="line">		验证失败(&#123;&#123;authenticationError.status&#125;&#125;)。请重新尝试。</div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">novalidate</span>=<span class="string">"novalidate"</span> <span class="attr">name</span>=<span class="string">"authForm"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"username"</span> <span class="attr">required</span>=<span class="string">"required"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"password"</span> <span class="attr">required</span>=<span class="string">"required"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">ng-disabled</span>=<span class="string">"authForm.$invalid"</span> <span class="attr">ng-click</span>=<span class="string">"authenticate(username,password)"</span>&gt;</span></div><div class="line">				登录</div><div class="line">			<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="定义主视图和控制器"><a href="#定义主视图和控制器" class="headerlink" title="定义主视图和控制器"></a>定义主视图和控制器</h3><p>一旦用户验证通过，ng-view指令就显示adminMain.html视图，该视图将允许管理员管理产品分类的内容以及查看订单队列。<br>在开始之前，我先定义占位内容用于显示产品分类视图和订单列表视图。首先，我创建<code>views/adminProducts.html</code>，下面是文件内容：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span>&gt;</span></div><div class="line">	这是产品视图</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>类似地，我创建了<code>views/adminOrders.html</code>文件，并定义了相似的占位内容，下面是文件内容：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span>&gt;</span></div><div class="line">	这是订单视图</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>由于在主视图<code>views/adminMain.html</code>需要切换产品视图和订单视图，但遗憾的是<code>ng-view</code>指令不能嵌套使用，所以，我将使用<code>ng-include</code>指令来处理它，作为不太优雅（但功能完善）的代替品。现在，我在<code>controllers/adminControllers.js</code>文件中定义新的控制器，下面是部分修改的内容：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">.controller(<span class="string">"mainCtrl"</span>,[<span class="string">"$scope"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>)</span>&#123;</div><div class="line">	$scope.screens = [<span class="string">"Products"</span>,<span class="string">"Orders"</span>];</div><div class="line">	$scope.current = $scope.screens[<span class="number">0</span>];</div><div class="line">	<span class="comment">//设置视图</span></div><div class="line">	$scope.setScreen = <span class="function"><span class="keyword">function</span>(<span class="params">index</span>)</span>&#123;</div><div class="line">		$scope.current = $scope.screens[index];</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//获取视图</span></div><div class="line">	$scope.getScreen = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="keyword">return</span> $scope.current == <span class="string">"Products"</span> ?</div><div class="line">				<span class="string">"views/adminProducts.html"</span> : <span class="string">"views/adminOrders.html"</span>;</div><div class="line">	&#125;</div><div class="line">&#125;]);</div></pre></td></tr></table></figure>
<p>下面是修改后的<code>views/adminMain.html</code>文件：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default row"</span> <span class="attr">ng-controller</span>=<span class="string">"mainCtrl"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-xs-3 panel-body"</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!--ng-class:如果是一个对象。那么如果某个键所对应的的值是true则该键将会作为一个类名--&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-repeat</span>=<span class="string">"item in screens"</span> </span></div><div class="line">			<span class="attr">class</span>=<span class="string">"btn btn-block btn-default"</span></div><div class="line">			<span class="attr">ng-class</span>=<span class="string">"&#123;'btn-primary':item == current&#125;"</span></div><div class="line">			<span class="attr">ng-click</span>=<span class="string">"setScreen($index);"</span>&gt;</div><div class="line">			&#123;&#123;item&#125;&#125;</div><div class="line">		<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-xs-8 panel-body"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-include</span>=<span class="string">"getScreen()"</span>&gt;</span></div><div class="line">			</div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="实现订单特性"><a href="#实现订单特性" class="headerlink" title="实现订单特性"></a>实现订单特性</h3><p>我现在开始订单列表，它处理起来是最简单的，因为我仅仅是要显示只读列表，在实际中可能会更复杂。我想<code>controllers/adminControllers.js</code>添加订单控制器，下面是部分修改的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">.controller(<span class="string">"ordersCtrl"</span>,[<span class="string">"$scope"</span>,<span class="string">"$http"</span>,<span class="string">"ordersUrl"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope,$http,ordersUrl</span>)</span>&#123;</div><div class="line">	$http.get(ordersUrl,&#123;withCredentials:<span class="literal">true</span>&#125;)</div><div class="line">		.success(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">			$scope.orders = data;</div><div class="line">		&#125;)</div><div class="line">		.error(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</div><div class="line">			$scope.error = error;</div><div class="line">		&#125;);</div><div class="line">	$scope.selectedOrder;</div><div class="line">	<span class="comment">//选择订单</span></div><div class="line">	$scope.selectOrder = <span class="function"><span class="keyword">function</span>(<span class="params">order</span>)</span>&#123;</div><div class="line">		$scope.selectedOrder = order;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//计算总价</span></div><div class="line">	$scope.calcTotal = <span class="function"><span class="keyword">function</span>(<span class="params">order</span>)</span>&#123;</div><div class="line">		<span class="keyword">var</span> total = <span class="number">0</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; order.products.length ; i++)&#123;</div><div class="line">			total += order.products[i].count * order.products[i].price;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> total;</div><div class="line">	&#125;</div><div class="line">&#125;]);</div></pre></td></tr></table></figure>
<p>有了ordersCtrl控制器，我修改<code>views/adminOrders.html</code>页面的内容并使用控制器，下面是修改后的文件内容：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"ordersCtrl"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped table-bordered"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>所在城市<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>订单总价<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-repeat</span>=<span class="string">"order in orders"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;order.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;order.city&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;calcTotal(order) | currency&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">ng-click</span>=<span class="string">"selectOrder(order);"</span> <span class="attr">class</span>=<span class="string">"btn btn-xs btn-primary"</span>&gt;</span></div><div class="line">					订单详情</div><div class="line">				<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!--显示选择的订单详情--&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-show</span>=<span class="string">"selectedOrder"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">h3</span>&gt;</span>订单详情<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped table-bordered"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">th</span>&gt;</span>商品名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">th</span>&gt;</span>商品数量<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">th</span>&gt;</span>商品单价<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-repeat</span>=<span class="string">"product in selectedOrder.products"</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;product.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;product.count&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;product.price | currency&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>视图由两个table组成。第一个table显示订单摘要，第二个table只在订单被选中时可见，它显示订单的详情。</p>
<h3 id="实现产品特性"><a href="#实现产品特性" class="headerlink" title="实现产品特性"></a>实现产品特性</h3><p>为实现产品特性，管理员需要对产品进行增删改查。在Deployd控制面板，选择products集合并点击API，会看到RESTful API的更多细节，我会在后续章节详细介绍RESTful API。你可以使用<code>$http</code>服务来做RESTful API，这样做会暴露整组执行贯穿应用程序的操作的URL。更优雅的做法是使用可选模块<code>ngResource</code>中的<code>$resource</code>服务，它有漂亮的方式处理发送到服务器的URL的定义。</p>
<ul>
<li><p>定义RESTful控制器<br>  我要开始通过AngularJS的<code>$resource</code>服务来定义控制器以提供访问权限给Deployd的RESTful API。我在controllers文件夹中创建了新文件<code>adminProductController.js</code>并用它定义控制器，下面是文件内容：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">"sportsStoreAdmin"</span>)</div><div class="line">.constant(<span class="string">"productUrl"</span>,<span class="string">"http://localhost:5500/products/"</span>)</div><div class="line">.config(<span class="function"><span class="keyword">function</span>(<span class="params">$httpProvider</span>)</span>&#123;</div><div class="line">	$httpProvider.defaults.withCredentials = <span class="literal">true</span>;</div><div class="line">&#125;)</div><div class="line">.controller(<span class="string">"productCtrl"</span>,[<span class="string">"$scope"</span>,<span class="string">"$resource"</span>,<span class="string">"productUrl"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope,$resource,productUrl</span>)</span>&#123;</div><div class="line">	$scope.productResource = $resource(productUrl+<span class="string">":id"</span>,&#123;id:<span class="string">"@id"</span>&#125;);</div><div class="line">	<span class="comment">//查询列表</span></div><div class="line">	$scope.listProducts = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		$scope.products = $scope.productResource.query();</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//删除指定产品</span></div><div class="line">	$scope.deleteProduct = <span class="function"><span class="keyword">function</span>(<span class="params">product</span>)</span>&#123;</div><div class="line">		product.$<span class="keyword">delete</span>().then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">			$scope.products.splice($scope.products.indexOf(product),<span class="number">1</span>);</div><div class="line">		&#125;)</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//创建产品</span></div><div class="line">	$scope.createProduct = <span class="function"><span class="keyword">function</span>(<span class="params">product</span>)</span>&#123;</div><div class="line">		<span class="keyword">new</span> $scope.productResource(product).$save().then(<span class="function"><span class="keyword">function</span>(<span class="params">newProduct</span>)</span>&#123;</div><div class="line">			$scope.products.push(newProduct);</div><div class="line">			$scope.editedProduct = <span class="literal">null</span>;</div><div class="line">		&#125;)</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//更新指定产品</span></div><div class="line">	$scope.updateProduct = <span class="function"><span class="keyword">function</span>(<span class="params">product</span>)</span>&#123;</div><div class="line">		product.$save();</div><div class="line">		$scope.editedProduct = <span class="literal">null</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//编辑指定产品</span></div><div class="line">	$scope.startEdit = <span class="function"><span class="keyword">function</span>(<span class="params">product</span>)</span>&#123;</div><div class="line">		$scope.editedProduct = product;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//取消编辑</span></div><div class="line">	$scope.cancelEdit = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		$scope.editedProduct = <span class="literal">null</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//默认查询列表数据</span></div><div class="line">	$scope.listProducts();</div><div class="line">&#125;]);</div></pre></td></tr></table></figure>
<p>  这里不深入讨论该清单代码（后面详细讲解），只介绍部分重点代码。<br>  首先，<code>$resource</code>服务是建立在<code>$http</code>服务所提供的特性的基础上的。这需要我启用withCredentials选项，我没有权限访问由<code>$http</code>服务产生的请求，但我可以使用模块上的config方法改变所有Ajax请求的默认设置。<br>  本例中最重要的一部分是下面这句代码：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$scope.productResource = $resource(productUrl+<span class="string">":id"</span>,&#123;id:<span class="string">"@id"</span>&#125;);</div></pre></td></tr></table></figure>
<p>  传入<code>$resource</code>的第一个参数用来定义将用于产生查询的URL格式。”:id”部分与第二个参数的映射对象一致，告诉AngularJS如果数据对象中有id属性，那它应该被添加到用于Ajax请求的URL中。用于访问RESTful的API的URL 和HTTP方法是由这两个参数推断出的。<br>  访问对象是由<code>$resource</code>服务的结果，有query、get、delete、remove和save方法。调用这些方法触发执行相应操作的Ajax请求。</p>
</li>
<li><p>定义视图<br>  现在，我将视图<code>adminProducts.html</code>的占位内容替换为以下内容：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">	<span class="selector-id">#productTable</span>&#123;<span class="attribute">width</span>: auto;&#125;</div><div class="line">	<span class="selector-id">#productTable</span> <span class="selector-tag">td</span>&#123;<span class="attribute">max-width</span>: <span class="number">150px</span>;<span class="attribute">text-overflow</span>: ellipsis;<span class="attribute">overflow</span>: hidden;<span class="attribute">white-space</span>: nowrap;&#125;</div><div class="line">	<span class="selector-id">#productTable</span> <span class="selector-tag">td</span> <span class="selector-tag">input</span>&#123;<span class="attribute">max-width</span>: <span class="number">125px</span>;&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"productCtrl"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped table-bordered"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>产品名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>产品描述<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>产品目录<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>产品价格<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-repeat</span>=<span class="string">"item in products"</span> <span class="attr">ng-hide</span>=<span class="string">"item.id == editedProduct.id"</span> &gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"description"</span>&gt;</span>&#123;&#123;item.description&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;item.category&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;item.price | currency&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">ng-click</span>=<span class="string">"startEdit(item);"</span> <span class="attr">class</span>=<span class="string">"btn btn-xs btn-primary"</span>&gt;</span></div><div class="line">					编辑</div><div class="line">				<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">ng-click</span>=<span class="string">"deleteProduct(item);"</span> <span class="attr">class</span>=<span class="string">"btn btn-xs btn-danger"</span>&gt;</span></div><div class="line">					删除</div><div class="line">				<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-class</span>=<span class="string">"&#123;danger:editedProduct&#125;"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"editedProduct.name"</span> <span class="attr">required</span>=<span class="string">"required"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"editedProduct.description"</span> <span class="attr">required</span>=<span class="string">"required"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"editedProduct.category"</span> <span class="attr">required</span>=<span class="string">"required"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"editedProduct.price"</span> <span class="attr">required</span>=<span class="string">"required"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">ng-hide</span>=<span class="string">"editedProduct.id"</span> <span class="attr">ng-click</span>=<span class="string">"createProduct(editedProduct);"</span> <span class="attr">class</span>=<span class="string">"btn btn-xs btn-primary"</span>&gt;</span></div><div class="line">					创建</div><div class="line">				<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">ng-show</span>=<span class="string">"editedProduct.id"</span> <span class="attr">ng-click</span>=<span class="string">"updateProduct(editedProduct);"</span> <span class="attr">class</span>=<span class="string">"btn btn-xs btn-primary"</span>&gt;</span></div><div class="line">					保存</div><div class="line">				<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">ng-show</span>=<span class="string">"editedProduct"</span> <span class="attr">ng-click</span>=<span class="string">"cancelEdit(editedProduct);"</span> <span class="attr">class</span>=<span class="string">"btn btn-xs btn-danger"</span>&gt;</span></div><div class="line">					取消</div><div class="line">				<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>添加HTML文件的引用<br>  剩下的就是在admin.html文件中添加<code>script</code>元素来引入新模块和新控制器并更新主应用程序模块，依赖于<code>ngResource</code>，下面是admin.html文件修改后的内容：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">ng-app</span>=<span class="string">"sportsStoreAdmin"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"angular.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"ngmodules/angular-route.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"ngmodules/angular-resource.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"bootstrap.css"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"bootstrap-theme.css"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">			angular.module(<span class="string">"sportsStoreAdmin"</span>,[<span class="string">"ngRoute"</span>,<span class="string">"ngResource"</span>])</div><div class="line">			.config([<span class="string">"$routeProvider"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$routeProvider</span>)</span>&#123;</div><div class="line">				$routeProvider.when(<span class="string">"/login"</span>,&#123;</div><div class="line">					templateUrl : <span class="string">"views/adminLogin.html"</span></div><div class="line">				&#125;);</div><div class="line">				$routeProvider.when(<span class="string">"/main"</span>,&#123;</div><div class="line">					templateUrl : <span class="string">"views/adminMain.html"</span></div><div class="line">				&#125;);</div><div class="line">				$routeProvider.otherwise(&#123;</div><div class="line">					redirectTo : <span class="string">"/login"</span></div><div class="line">				&#125;);</div><div class="line">			&#125;])</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"controllers/adminControllers.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"controllers/adminProductController.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">ng-view</span>&gt;</span><span class="tag">&lt;/<span class="name">ng-view</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  现在，一个简单但完整的运动商店应用程序已经完成。你可以从<code>https://github.com/heji1993/angular-sportsstore.git</code>下载完整代码。</p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[第五章、运动商店：导航和结账]]></title>
      <url>http://heji.website/2017/03/06/%E7%AC%AC%E4%BA%94%E7%AB%A0%E3%80%81%E8%BF%90%E5%8A%A8%E5%95%86%E5%BA%97%EF%BC%9A%E5%AF%BC%E8%88%AA%E5%92%8C%E7%BB%93%E8%B4%A6/</url>
      <content type="html"><![CDATA[<p>在本章中，我将通过添加对真实数据的支持，实现购物车并开始订单结账的过程，继续运动商店应用程序的开发。</p>
<a id="more"></a>
<h2 id="使用真实数据-请先启动Deployd"><a href="#使用真实数据-请先启动Deployd" class="headerlink" title="使用真实数据(请先启动Deployd )"></a>使用真实数据(请先启动Deployd )</h2><h3 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h3><p> AngularJS通过服务<code>$http</code>提供对产生Ajax请求的支持，后续章节讲述服务的工作细节以及<code>$http</code>本身。下面是修改后的<code>controllers/sportsStore.js</code>文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//module方法值传一个参数表示我们尝试找到sportsStore这个模块,必须先有sportsStore模块,否则会报错</span></div><div class="line">angular.module(<span class="string">"sportsStore"</span>)</div><div class="line">.constant(<span class="string">"dataUrl"</span>,<span class="string">"http://localhost:5550/products"</span>)</div><div class="line">.controller(<span class="string">"sportsStoreCtrl"</span>,[<span class="string">"$scope"</span>,<span class="string">"$http"</span>,<span class="string">"dataUrl"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope,$http,dataUrl</span>)</span>&#123;</div><div class="line">	$scope.data = &#123;&#125;;</div><div class="line">	<span class="comment">//使用$http服务查询数据</span></div><div class="line">	$http.get(dataUrl)</div><div class="line">	.success(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</div><div class="line">		$scope.data.products = result;</div><div class="line">	&#125;)</div><div class="line">	.error(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</div><div class="line">		$scope.data.error = error;</div><div class="line">	&#125;)</div><div class="line">&#125;])</div></pre></td></tr></table></figure>
<h3 id="处理错误"><a href="#处理错误" class="headerlink" title="处理错误"></a>处理错误</h3><p>当有错误时，应该在页面显示错误信息，为此，需要对<code>app.html</code>页面进行修改，下面是修改的部分代码：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">    &lt;header class="navbar navbar-inverse"&gt;</div><div class="line">		&lt;a href="#" class="navbar-brand"&gt;运动商店&lt;/a&gt;</div><div class="line">	&lt;/header&gt;</div><div class="line">	&lt;!--有错误时显示--&gt;</div><div class="line">	&#123;&#123;data.error.status&#125;&#125;</div><div class="line">	&lt;section class="alert alert-danger" ng-show="data.error"&gt;</div><div class="line">		Error (&#123;&#123;data.error.status&#125;&#125;).The product data was not loaded.</div><div class="line">		&lt;a href="/app.html" class="alert-link"&gt;Click here to try again&lt;/a&gt;</div><div class="line">	&lt;/section&gt;</div><div class="line">	&lt;!--没有错误时显示--&gt;</div><div class="line">	&lt;section class="panel panel-default row" ng-controller="productListCtrl" ng-hide="data.error"&gt;</div><div class="line">...</div></pre></td></tr></table></figure>
<h2 id="创建局部视图"><a href="#创建局部视图" class="headerlink" title="创建局部视图"></a>创建局部视图</h2><p>在<code>app.html</code>文件中的HTML错综复杂，随着应用程序功能的增加，情况会变得更加糟糕，幸运的是，我们可以把<code>app.html</code>拆分成多个独立的文件，然后使用AngularJS提供的<code>ng-include</code>指令在运行时引入这些文件。为了这个目的，我创建了<code>views/productList.html</code>文件，下面是该文件的内容：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"panel panel-default row"</span> <span class="attr">ng-controller</span>=<span class="string">"productListCtrl"</span> <span class="attr">ng-hide</span>=<span class="string">"data.error"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"col-xs-3"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">ng-click</span>=<span class="string">"selectCategory()"</span> <span class="attr">class</span>=<span class="string">"btn btn-block btn-default"</span> </span></div><div class="line">			<span class="attr">ng-class</span>=<span class="string">"getCategoryClass()"</span>&gt;Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!--先对商品按目录进行排序,然后再返回去重后的目录--&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">ng-repeat</span>=<span class="string">"item in data.products | orderBy:'category' | unique:'category'"</span></span></div><div class="line">			<span class="attr">ng-click</span>=<span class="string">"selectCategory(item)"</span> <span class="attr">class</span>=<span class="string">"btn btn-block btn-default btn-lg"</span> </div><div class="line">			<span class="attr">ng-class</span>=<span class="string">"getCategoryClass(item)"</span>&gt;&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">nav</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-xs-8"</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!--遍历添加商品--&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span> <span class="attr">ng-repeat</span>=<span class="string">"item in data.products | filter:categoryFilterFn | range:selectedPage:pageSize"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">h3</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">strong</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></div><div class="line">				<span class="comment">&lt;!--使用金额过滤器，将数值转换为金额--&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"pull-right label label-primary"</span>&gt;</span></div><div class="line">					&#123;&#123;item.price | currency&#125;&#125;</div><div class="line">				<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"lead"</span>&gt;</span>&#123;&#123;item.description &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"pull-right btn-group"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">a</span> <span class="attr">ng-repeat</span>=<span class="string">"page in data.products | filter:categoryFilterFn | pageCount:pageSize"</span></span></div><div class="line">				<span class="attr">ng-click</span>=<span class="string">"selectPage($index + 1)"</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span> <span class="attr">ng-class</span>=<span class="string">"getPageClass($index + 1)"</span>&gt;</div><div class="line">				&#123;&#123;$index + 1&#125;&#125;</div><div class="line">			<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>下面是<code>app.html</code>文件的内容：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">ng-app</span>=<span class="string">"sportsStore"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>SportsStore<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"angular.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"bootstrap.css"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"bootstrap-theme.css"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">			<span class="comment">//依赖customFilter模块</span></div><div class="line">			angular.module(<span class="string">"sportsStore"</span>,[<span class="string">"customFilter"</span>]);</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!--引入顶级控制器--&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"controllers/sportsStore.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!--引入自定义过滤器--&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"filters/customFilters.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!--引入产品列表控制器--&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"controllers/productListController.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!--使用控制器--&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"sportsStoreCtrl"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span>&gt;</span>运动商店<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">header</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!--有错误时显示--&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"alert alert-danger"</span> <span class="attr">ng-show</span>=<span class="string">"data.error"</span>&gt;</span></div><div class="line">			Error (&#123;&#123;data.error.status&#125;&#125;).The product data was not loaded.</div><div class="line">			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/app.html"</span> <span class="attr">class</span>=<span class="string">"alert-link"</span>&gt;</span>Click here to try again<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">ng-include</span> <span class="attr">src</span>=<span class="string">"'views/productList.html'"</span>&gt;</span><span class="tag">&lt;/<span class="name">ng-include</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><strong>注意：当AngularJS遇到ng-include指令时，它会产生Ajax请求，载入src属性所指定的文件，并插入其内容以替换该元素。在使用ng-include指令时，我将文件名写成单引号的字面量。如果我不这么做，那指令会在作用域属性上寻找文件名</strong></p>
<h2 id="创建购物车"><a href="#创建购物车" class="headerlink" title="创建购物车"></a>创建购物车</h2><p>用户能看到我的有效产品，但我没有购物车就没法出售任何东西。在本段中，我将构建购物车功能，下图是它的基本流程：<br><img src="imgs/1486461273494_2.png" alt=""><br>实现购物车特性需要若干组改动，包括创建自定义的AngularJS组件。</p>
<h3 id="定义购物车模块和服务"><a href="#定义购物车模块和服务" class="headerlink" title="定义购物车模块和服务"></a>定义购物车模块和服务</h3><p>通常，我们习惯把控制器放在<code>controllers</code>目录，过滤器放在<code>filters</code>目录下，视图放在<code>views</code>目录下等。我们也可以根据具体情况，把实现某一功能的全部代码写成一个组件，为此，我定义了<code>components</code>文件夹专门存放自定义的组件。在本例中，我将创建购物车模块。我首先创建<code>components/cart</code>目录，并向其添加新的javascript文件<code>cart.js</code>，下面是<code>cart.js</code>文件的内容：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">"cart"</span>,[])</div><div class="line">.factory(<span class="string">"cartService"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> cartData = [];</div><div class="line">	<span class="keyword">return</span> &#123;</div><div class="line">		<span class="comment">//添加产品</span></div><div class="line">		addProduct : <span class="function"><span class="keyword">function</span>(<span class="params">id,name,price</span>)</span>&#123;</div><div class="line">			<span class="keyword">var</span> addToExistingItem = <span class="literal">false</span>;</div><div class="line">			<span class="comment">//如果已经存在相同id的产品,只增加其数量</span></div><div class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; cartData.length ; i++)&#123;</div><div class="line">				<span class="keyword">if</span>(cartData[i].id == id)&#123;</div><div class="line">					cartData[i].count ++;</div><div class="line">					addToExistingItem = <span class="literal">true</span>;</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span>(!addToExistingItem)&#123;</div><div class="line">				cartData.push(&#123;</div><div class="line">					count:<span class="number">1</span>,id:id,price:price,name:name</div><div class="line">				&#125;);</div><div class="line">			&#125;</div><div class="line">		&#125;,</div><div class="line">		<span class="comment">//移除产品</span></div><div class="line">		removeProduct : <span class="function"><span class="keyword">function</span>(<span class="params">id</span>)</span>&#123;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; cartData.length ; i++)&#123;</div><div class="line">				<span class="keyword">if</span>(cartData[i].id == id)&#123;</div><div class="line">					cartData.splice(i,<span class="number">1</span>);</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;,</div><div class="line">		<span class="comment">//获取所有产品</span></div><div class="line">		getProducts : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">			<span class="keyword">return</span> cartData;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>我先在新模块<code>cart</code>自定义了<code>cartService</code>服务，创建服务有不同的方法，比如<code>service</code>、<code>factory</code>和<code>provider</code>，后面讲讲解它们的区别。创建服务第一个参数是服务名，第二个参数是工厂函数，在服务被注入应用于应用程序时，工厂函数只被调用一次(第一次注入时调用)。在本例中，我的cart服务工厂函数返回对象，对象有三个方法，下面是<code>cartService</code>服务所定义的方法：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>addProduct(id,name,price)</td>
<td>添加指定的产品到购物车，或者如果购物车以及包含该产品，就增加产品的数量</td>
</tr>
<tr>
<td>removeProduct(id)</td>
<td>删除指定ID的产品</td>
</tr>
<tr>
<td>getProducts()</td>
<td>返回购物车中所有商品</td>
</tr>
</tbody>
</table>
<h3 id="创建购物车部件"><a href="#创建购物车部件" class="headerlink" title="创建购物车部件"></a>创建购物车部件</h3><p>我下一步要创建囊括购物车内容的部件，提供给用户以开始结账流程，我将创建自定义指令来做。指令是自包含的，复用功能单元是AngularJS开发的核心。下面是我在<code>components/cart/cart.js</code>文件添加的内容：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="comment">//自定义cartSummary指令,依赖于cartService服务</span></div><div class="line">.directive(<span class="string">"cartSummary"</span>,[<span class="string">"cartService"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">cartService</span>)</span>&#123;</div><div class="line">	<span class="keyword">return</span> &#123;</div><div class="line">		restrict : <span class="string">"E"</span>,</div><div class="line">		templateUrl : <span class="string">"components/cart/cartSummary.html"</span>,</div><div class="line">		controller : [<span class="string">"$scope"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>)</span>&#123;</div><div class="line">			<span class="keyword">var</span> cartData = cartService.getProducts();</div><div class="line">			<span class="comment">//计算购物车商品总价</span></div><div class="line">			$scope.total = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">				<span class="keyword">var</span> total = <span class="number">0</span>;</div><div class="line">				<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; cartData.length ; i++)&#123;</div><div class="line">					total += (cartData[i].count * cartData[i].price);</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">return</span> total;</div><div class="line">			&#125;</div><div class="line">			<span class="comment">//计算购物车商品总数</span></div><div class="line">			$scope.itemCount = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">				<span class="keyword">var</span> total = <span class="number">0</span>;</div><div class="line">				<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; cartData.length ; i++)&#123;</div><div class="line">					total += cartData[i].count;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">return</span> total;</div><div class="line">			&#125;</div><div class="line">		&#125;]</div><div class="line">	&#125;</div><div class="line">&#125;]);</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>指令由AngularJS模块上的 directive方法创建，第一个参数是指令名（驼峰式命名），第二个参数是返回指令释义对象的工厂函数。指令释义对象定义属性告诉AngularJS你的指令做什么和如何做。我在定义cartSummary指令时指定了三个属性，下面是三个属性的说明（后续章节讲解并演示整套属性）</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>restrict</td>
<td>指定指令如果应用，E值表示指令只能作为元素使用，A值表示指令只能作为属性使用，EA表示指令可作为元素或属性使用</td>
</tr>
<tr>
<td>templateUrl</td>
<td>指定将被插入指令的元素内容的局部视图</td>
</tr>
<tr>
<td>controller</td>
<td>指定向局部视图提供数据和行为的控制器</td>
</tr>
</tbody>
</table>
<p>简单地说，我的指令释义定义了控制器，告诉AngularJS使用<code>components/cart/cartSummary.html</code>视图，还有约束指令，让其可以仅作为元素而被使用。<br>另外，因为我使用了<code>cartService</code>服务，需要注入服务。我又在指令的控制器定义了两个行为<code>total</code>和<code>itemCount</code>，这让我可以直接在局部视图内使用这些行为。下面是<code>components/cart/cartSummary.html</code>文件的内容：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;style type="text/css"&gt;</div><div class="line">	.navbar-right&#123;</div><div class="line">		float: right !important;</div><div class="line">		margin-right: 5px; </div><div class="line">	&#125;</div><div class="line">	.navbar-text&#123;</div><div class="line">		margin-right: 10px;</div><div class="line">	&#125;</div><div class="line">&lt;/style&gt;</div><div class="line">&lt;div class="navbar-right"&gt;</div><div class="line">	&lt;div class="navbar-text"&gt;</div><div class="line">		&lt;b&gt;Your cart:&lt;/b&gt;</div><div class="line">		&#123;&#123;itemCount()&#125;&#125; item(s),</div><div class="line">		&#123;&#123;total() | currency&#125;&#125;</div><div class="line">	&lt;/div&gt;</div><div class="line">	&lt;!--按钮功能后面实现--&gt;</div><div class="line">	&lt;a href="#" class="btn btn-default navbar-btn"&gt;Checkout&lt;/a&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>下面在<code>app.html</code>应用模块：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">	<span class="comment">//依赖customFilter模块</span></div><div class="line">	angular.module(<span class="string">"sportsStore"</span>,[<span class="string">"customFilter"</span>,<span class="string">"cart"</span>]);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--引入顶级控制器--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"controllers/sportsStore.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--引入自定义过滤器--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"filters/customFilters.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--引入产品列表控制器--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"controllers/productListController.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--引入购物车模块--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"components/cart/cart.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">...</div><div class="line"><span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span>&gt;</span>运动商店<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">cart-summary</span>&gt;</span><span class="tag">&lt;/<span class="name">cart-summary</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></div><div class="line">...</div></pre></td></tr></table></figure></p>
<h3 id="添加产品选择按钮"><a href="#添加产品选择按钮" class="headerlink" title="添加产品选择按钮"></a>添加产品选择按钮</h3><p>我下一步是在产品详情添加按钮，让用户可以添加产品到购物车，下面是我对<code>controllers/productListController.js</code>文件所做的修改：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="comment">//控制器注入cartService模块</span></div><div class="line">.controller(<span class="string">"productListCtrl"</span>,[<span class="string">"$scope"</span>,<span class="string">"$filter"</span>,<span class="string">"productListActiveClass"</span>,<span class="string">"productListPageCount"</span>,<span class="string">"cartService"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope,$filter,productListActiveClass,productListPageCount,cartService</span>)</span>&#123;</div><div class="line">    ...</div><div class="line">    <span class="comment">//往购物车添加商品</span></div><div class="line">	$scope.addProductToCart = <span class="function"><span class="keyword">function</span>(<span class="params">product</span>)</span>&#123;</div><div class="line">		cartService.addProduct(product.id,product.name,product.price);</div><div class="line">	&#125;</div><div class="line">&#125;]);</div></pre></td></tr></table></figure></p>
<p>我声明了对<code>cartService</code>的依赖，并定义了行为<code>addProductToCart</code>用于往购物车添加商品。<br>然后，往局部视图<code>views/productList.html</code>添加按钮调用<code>addProductToCart</code>行为：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="comment">&lt;!--遍历添加商品--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span> <span class="attr">ng-repeat</span>=<span class="string">"item in data.products | filter:categoryFilterFn | range:selectedPage:pageSize"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">h3</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">strong</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!--使用金额过滤器，将数值转换为金额--&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"pull-right label label-primary"</span>&gt;</span></div><div class="line">			&#123;&#123;item.price | currency&#125;&#125;</div><div class="line">		<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!--产品选择按钮--&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-success pull-right"</span> <span class="attr">ng-click</span>=<span class="string">"addProductToCart(item)"</span>&gt;</span>Add to cart<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"lead"</span>&gt;</span>&#123;&#123;item.description &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>现在，你可以往购物车添加商品并自动计算购物车商品的数量和总价。</p>
<h2 id="添加URL导航"><a href="#添加URL导航" class="headerlink" title="添加URL导航"></a>添加URL导航</h2><p>在添加结账功能的支持之前，我要加强运动商店应用程序的基础设施，添加URL路由的支持。我会在后续章节详细介绍路由，简单地说，路由可以基于当前的URL自动地显示不同的局部视图。这使得它更易于建立更大的应用程序。<br>为实现路由功能，我先创建结账页面的局部视图，因为还没开始开阿发结账流程，所以局部视图只包含简单的占位符。下面是<code>views/checkoutSunmary.html</code>页面的内容：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"lead"</span>&gt;</span></div><div class="line">	This is the checkout summary view</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/products"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>返回<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="定义和使用URL路由"><a href="#定义和使用URL路由" class="headerlink" title="定义和使用URL路由"></a>定义和使用URL路由</h3><p>现在，我需要分别映射<code>/product</code>和<code>/checkout</code>到<code>productList.html</code>页面和<code>checkoutSummary.html</code>页面，其他的URL都默认映射到<code>productList.html</code>页面，下面是<code>app.html</code>文件的改动:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">	<span class="comment">//依赖customFilter模块、cart模块和ngRoute模块</span></div><div class="line">	angular.module(<span class="string">"sportsStore"</span>,[<span class="string">"customFilter"</span>,<span class="string">"cart"</span>,<span class="string">"ngRoute"</span>])</div><div class="line">	<span class="comment">//配置路由</span></div><div class="line">	.config([<span class="string">"$routeProvider"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$routeProvider</span>)</span>&#123;</div><div class="line">		$routeProvider.when(<span class="string">"/checkout"</span>,&#123;</div><div class="line">			templateUrl:<span class="string">"views/checkoutSunmary.html"</span></div><div class="line">		&#125;)</div><div class="line">		.when(<span class="string">"/pruducts"</span>,&#123;</div><div class="line">			templateUrl:<span class="string">"views/productList.html"</span></div><div class="line">		&#125;)</div><div class="line">		.otherwise(&#123;</div><div class="line">			templateUrl:<span class="string">"views/productList.html"</span></div><div class="line">		&#125;);</div><div class="line">	&#125;]);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--引入顶级控制器--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"controllers/sportsStore.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--引入自定义过滤器--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"filters/customFilters.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--引入产品列表控制器--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"controllers/productListController.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--引入购物车模块--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"components/cart/cart.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--引入路由模块--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"ngmodules/angular-route.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">...</div><div class="line"><span class="comment">&lt;!--有错误时显示--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"alert alert-danger"</span> <span class="attr">ng-show</span>=<span class="string">"data.error"</span>&gt;</span></div><div class="line">	出现错误 (&#123;&#123;data.error.status&#125;&#125;).商品的数据不能加载.</div><div class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/app.html"</span> <span class="attr">class</span>=<span class="string">"alert-link"</span>&gt;</span>点击这里再次尝试<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">ng-view</span>&gt;</span><span class="tag">&lt;/<span class="name">ng-view</span>&gt;</span></div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>在<code>cartSummary.html</code>页面点击结账按钮需要跳转到结账页面，为此，需要对<code>components/cart/cartSummary.html</code>进行跳转：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="comment">&lt;!--按钮功能后面实现--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/checkout"</span> <span class="attr">class</span>=<span class="string">"btn btn-default navbar-btn"</span>&gt;</span>back<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">...</div></pre></td></tr></table></figure></p>
<h2 id="开始结账流程"><a href="#开始结账流程" class="headerlink" title="开始结账流程"></a>开始结账流程</h2><p>现在，我将转向结账流程。我的第一个任务是定义新的控制器<code>cartSummaryCtrl</code>，我把它放在<code>controllers/checkoutController.js</code>文件。因为cartSummary指令需要使用计算总价和商品数量的行为，<code>cartSummaryCtrl</code>也需要使用计算总价行为，为此，我修改<code>components/cart/cart.js</code>文件，把这些行为定义在<code>cartService</code>内，下面是修改后的<code>components/cart/cart.js</code>文件：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">"cart"</span>,[])</div><div class="line">.factory(<span class="string">"cartService"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> cartData = [];</div><div class="line">	<span class="keyword">return</span> &#123;</div><div class="line">		<span class="comment">//添加产品</span></div><div class="line">		addProduct : <span class="function"><span class="keyword">function</span>(<span class="params">id,name,price</span>)</span>&#123;</div><div class="line">			<span class="keyword">var</span> addToExistingItem = <span class="literal">false</span>;</div><div class="line">			<span class="comment">//如果已经存在相同id的产品,只增加其数量</span></div><div class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; cartData.length ; i++)&#123;</div><div class="line">				<span class="keyword">if</span>(cartData[i].id == id)&#123;</div><div class="line">					cartData[i].count ++;</div><div class="line">					addToExistingItem = <span class="literal">true</span>;</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span>(!addToExistingItem)&#123;</div><div class="line">				cartData.push(&#123;</div><div class="line">					count:<span class="number">1</span>,id:id,price:price,name:name</div><div class="line">				&#125;);</div><div class="line">			&#125;</div><div class="line">		&#125;,</div><div class="line">		<span class="comment">//移除产品</span></div><div class="line">		removeProduct : <span class="function"><span class="keyword">function</span>(<span class="params">id</span>)</span>&#123;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; cartData.length ; i++)&#123;</div><div class="line">				<span class="keyword">if</span>(cartData[i].id == id)&#123;</div><div class="line">					cartData.slice(i,<span class="number">1</span>);</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;,</div><div class="line">		<span class="comment">//获取所有产品</span></div><div class="line">		getProducts : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">			<span class="keyword">return</span> cartData;</div><div class="line">		&#125;,</div><div class="line">		<span class="comment">//计算购物车商品总价</span></div><div class="line">		total : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">			<span class="keyword">var</span> total = <span class="number">0</span>;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; cartData.length ; i++)&#123;</div><div class="line">				total += (cartData[i].count * cartData[i].price);</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">return</span> total;</div><div class="line">		&#125;,</div><div class="line">		<span class="comment">//计算购物车商品总数</span></div><div class="line">		itemCount : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">			<span class="keyword">var</span> total = <span class="number">0</span>;</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; cartData.length ; i++)&#123;</div><div class="line">				total += cartData[i].count;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">return</span> total;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;)</div><div class="line"><span class="comment">//自定义cartSummary指令,依赖于cartService服务</span></div><div class="line">.directive(<span class="string">"cartSummary"</span>,[<span class="string">"cartService"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">cartService</span>)</span>&#123;</div><div class="line">	<span class="keyword">return</span> &#123;</div><div class="line">		restrict : <span class="string">"E"</span>,</div><div class="line">		templateUrl : <span class="string">"components/cart/cartSummary.html"</span>,</div><div class="line">		controller : [<span class="string">"$scope"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>)</span>&#123;</div><div class="line">			<span class="keyword">var</span> cartData = cartService.getProducts();</div><div class="line">			<span class="comment">//计算购物车商品总价</span></div><div class="line">			$scope.total = cartService.total;</div><div class="line">			<span class="comment">//计算购物车商品总数</span></div><div class="line">			$scope.itemCount = cartService.itemCount;</div><div class="line">		&#125;]</div><div class="line">	&#125;</div><div class="line">&#125;]);</div></pre></td></tr></table></figure></p>
<p>下面是<code>controllers/checkoutController.js</code>文件的内容：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">"sportsStore"</span>)</div><div class="line">.controller(<span class="string">"cartSummaryCtrl"</span>,[<span class="string">"$scope"</span>,<span class="string">"cartService"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope,cartService</span>)</span>&#123;</div><div class="line">	<span class="comment">//获取购物车所有商品</span></div><div class="line">	$scope.cartData = cartService.getProducts();</div><div class="line">	<span class="comment">//计算商品总价</span></div><div class="line">	$scope.total = cartService.total;</div><div class="line">	<span class="comment">//移除商品</span></div><div class="line">	$scope.remove = cartService.removeProduct;</div><div class="line">&#125;]);</div></pre></td></tr></table></figure></p>
<p>为应用控制器，实现结账流程，我需要对<code>views/checkoutSunmary.html</code>文件进行修改，下面是修改后的内容：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>我的购物车<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"cartSummaryCtrl"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert alert-warning"</span> <span class="attr">ng-show</span>=<span class="string">"cartData.length == 0"</span>&gt;</span></div><div class="line">		你的购物车没有商品，点击<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/products"</span> <span class="attr">class</span>=<span class="string">"alert-link"</span>&gt;</span>这里<span class="tag">&lt;/<span class="name">a</span>&gt;</span>返回购物。</div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-hide</span>=<span class="string">"cartData.length == 0"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">thead</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span>数量<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">th</span>&gt;</span>商品名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">"text-right"</span>&gt;</span>商品单价<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">th</span> <span class="attr">class</span>=<span class="string">"text-right"</span>&gt;</span>商品总价<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">thead</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">tbody</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-repeat</span>=<span class="string">"item in cartData"</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span>&#123;&#123;item.count&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"text-left"</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"text-right"</span>&gt;</span>&#123;&#123;item.price | currency&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"text-right"</span>&gt;</span>&#123;&#123;(item.price * item.count) | currency&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"remove(item.id)"</span> <span class="attr">class</span>=<span class="string">"btn btn-sm btn-warning"</span>&gt;</span>移除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">					<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">tfoot</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">"4"</span> <span class="attr">class</span>=<span class="string">"text-right"</span>&gt;</span>总计：<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"text-left"</span>&gt;</span></div><div class="line">						&#123;&#123;total() | currency&#125;&#125;</div><div class="line">					<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">tfoot</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"text-center"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/products"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>继续购物<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/placeorder"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>支付<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span>	</div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>接着，我需要在<code>app.html</code>引入控制器并添加支付路由、感谢页面路由，这两个页面我在接下来的章节会补充，下面是<code>app.html</code>修改的内容：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">	<span class="comment">//依赖customFilter模块、cart模块和ngRoute模块</span></div><div class="line">	angular.module(<span class="string">"sportsStore"</span>,[<span class="string">"customFilter"</span>,<span class="string">"cart"</span>,<span class="string">"ngRoute"</span>])</div><div class="line">	<span class="comment">//配置路由</span></div><div class="line">	.config([<span class="string">"$routeProvider"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$routeProvider</span>)</span>&#123;</div><div class="line">		$routeProvider.when(<span class="string">"/checkout"</span>,&#123;</div><div class="line">			templateUrl:<span class="string">"views/checkoutSunmary.html"</span></div><div class="line">		&#125;)</div><div class="line">		.when(<span class="string">"/placeorder"</span>,&#123;</div><div class="line">			templateUrl:<span class="string">"views/placeorder.html"</span></div><div class="line">		&#125;)</div><div class="line">		.when(<span class="string">"/complete"</span>,&#123;</div><div class="line">			templateUrl:<span class="string">"views/thankYou.html"</span></div><div class="line">		&#125;)</div><div class="line">		.when(<span class="string">"/pruducts"</span>,&#123;</div><div class="line">			templateUrl:<span class="string">"views/productList.html"</span></div><div class="line">		&#125;)</div><div class="line">		.otherwise(&#123;</div><div class="line">			templateUrl:<span class="string">"views/productList.html"</span></div><div class="line">		&#125;);</div><div class="line">	&#125;]);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--引入顶级控制器--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"controllers/sportsStore.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--引入自定义过滤器--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"filters/customFilters.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--引入产品列表控制器--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"controllers/productListController.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--引入购物车模块--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"components/cart/cart.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--引入路由模块--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"ngmodules/angular-route.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--引入结账控制器--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"controllers/checkoutController.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">...</div></pre></td></tr></table></figure></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>在本章中，我继续了运动商店应用程序的开发，从Deployd服务器获取产品数据，添加局部视图的支持，以及实现自定义指令，我还设置了URL路由并添加允许用户下单的功能。在下一章，我将完成运动商店应用程序并添加管理系统的支持。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[CSS3制作消息提示框]]></title>
      <url>http://heji.website/2017/02/22/CSS3%E5%88%B6%E4%BD%9C%E6%B6%88%E6%81%AF%E6%8F%90%E7%A4%BA%E6%A1%86/</url>
      <content type="html"><![CDATA[<p>本文主要介绍使用CSS3制作实用消息提示框。</p>
<p>三角提示框，就是下面所示：<br><img src="imgs/1487729518342_2.png" alt=""><br>我们来研究下如何用CSS实现。<br>假定有一个盒子(div)，给定宽高分别为100像素，再给定边框50像素，那么它看起来会是下面这个样子(为了更直观，给了边框四种不同的颜色)：<br><img src="imgs/1487729572015_3.png" alt=""><br><strong>注意：box-sizing默认为content-box，即在宽度和高度之外绘制元素的内边距和边框</strong><br>接下来，把盒子的高度设为0：<br><img src="imgs/1487729733577_4.png" alt=""><br>再把宽度也设为0：<br><img src="imgs/1487729746624_5.png" alt=""><br>这样雏形就已经出来了，由于IE6的bug(高度为0的div会有一定默认的高度，我的电脑上测量结果为19像素)，需要做一些小调整，给div加一个overflow:hidden，IE6就能正确解析了。<br>接下来的工作就是去掉其余的三个边框。以向上箭头为例，假如我想让箭头朝上，那么就需要将左、上、右三条边框的颜色给去掉。一个常规的方法是将这三条边框的颜色设为透明，即transparent属性。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*设置三个值时，第一个值是上边框颜色，第二个值是右左边框颜色，第三个值是下边框颜色*/</span></div><div class="line"><span class="selector-tag">border-color</span><span class="selector-pseudo">:transparent</span> <span class="selector-tag">transparent</span> <span class="selector-id">#056F61</span></div></pre></td></tr></table></figure></p>
<p>设置以后可以看到如下效果：<br><img src="imgs/1487729865921_6.png" alt=""><br>这样CSS制作的三角形就完成了。到这里看起来工作好像差不多可以结束的样子，还需要测试一下浏览器的兼容性，经过测试，主流浏览器都支持，但是打开IE6，结果悲催了，居然是这个样子：<br><img src="imgs/1487729887192_7.png" alt=""><br>排查一下哪个地方出了问题，才发现原来IE6不支持transparent属性，之后再研究了一下，发现如果将其余三条边的属性由solid改为dotted或者dashed就可以了(原理请自行谷歌)：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*border-style:solid*/</span></div><div class="line"><span class="selector-tag">border-style</span><span class="selector-pseudo">:dotted</span> <span class="selector-tag">dotted</span> <span class="selector-tag">solid</span>;</div><div class="line"><span class="selector-tag">border-width</span><span class="selector-pseudo">:50px</span>;</div><div class="line"><span class="selector-tag">border-color</span><span class="selector-pseudo">:transparent</span> <span class="selector-tag">transparent</span> <span class="selector-id">#056f61</span>;</div></pre></td></tr></table></figure></p>
<p>下面附上完整代码：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">			<span class="selector-class">.tips</span>&#123;</div><div class="line">				<span class="attribute">position</span>: relative;</div><div class="line">				<span class="attribute">background-color</span>: <span class="number">#245</span>;</div><div class="line">				<span class="attribute">height</span>: <span class="number">100px</span>;</div><div class="line">				<span class="attribute">width</span>: <span class="number">200px</span>;</div><div class="line">				<span class="attribute">display</span>: inline-block;</div><div class="line">				<span class="attribute">border-radius</span>: <span class="number">10px</span>;</div><div class="line">				<span class="attribute">margin-top</span>: <span class="number">100px</span>;</div><div class="line">			&#125;</div><div class="line">			<span class="selector-class">.tips</span><span class="selector-pseudo">:after</span>&#123;</div><div class="line">				<span class="attribute">position</span>: absolute;</div><div class="line">				<span class="attribute">border-width</span>: <span class="number">20px</span>;</div><div class="line">				<span class="attribute">border-color</span>: transparent transparent <span class="number">#245</span>;</div><div class="line">				<span class="attribute">bottom</span>: <span class="number">100px</span>;</div><div class="line">				<span class="attribute">right</span>: <span class="number">30px</span>;</div><div class="line">				<span class="attribute">content</span>: <span class="string">""</span>;</div><div class="line">				<span class="attribute">height</span>: <span class="number">0</span>;</div><div class="line">				<span class="attribute">width</span>: <span class="number">0</span>;</div><div class="line">				<span class="attribute">border-style</span>:dotted dotted solid;</div><div class="line">			&#125; </div><div class="line">		<span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"tips"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>效果如下所示：<br><img src="imgs/1487732263707_8.png" alt=""></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[第四章、真正的应用程序：运动商店]]></title>
      <url>http://heji.website/2017/02/06/%E7%AC%AC%E5%9B%9B%E7%AB%A0%E3%80%81%E7%9C%9F%E6%AD%A3%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%EF%BC%9A%E8%BF%90%E5%8A%A8%E5%95%86%E5%BA%97/</url>
      <content type="html"><![CDATA[<p>本章开始使用AngularJS开发一个真正的应用程序：运动商店，本章完成产品的展示、分页、分类导航功能，数据使用虚拟数据。</p>
<a id="more"></a>
<h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><h3 id="准备数据"><a href="#准备数据" class="headerlink" title="准备数据"></a>准备数据</h3><p>第一步是创建新的Deployd应用程序，你将需要创建目录来存储被生成的文件，我将目录命名为deployd。<br><strong>创建Deployd应用程序之前，你需要先安装Deployd和MongoDB</strong><br>Deployd安装见第一章。<br>MongoDB安装如下：</p>
<ol>
<li>从官网下载mongoDB.msi，双击安装，添加bin路径到系统环境变量</li>
<li><p>配置mongo服务</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongod.exe --bind_ip 127.0.0.1 --logpath <span class="string">"D:\MongoDB\data\dbConf\mongodb.log"</span> --logappend --dbpath <span class="string">"D:\MongoDB\data\db"</span> --port 5500 --serviceName <span class="string">"sportsstore"</span> --serviceDisplayName <span class="string">"sportsstore"</span> --install</div></pre></td></tr></table></figure>
<p> –logpath 以及 –dbpath  的路径可以自己配置，在运行命令之前先创建这些文件和文件夹</p>
</li>
</ol>
<p>切换到deployd目录，输入一下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dpd create  sportsstore</div></pre></td></tr></table></figure></p>
<p>启动新的服务器，输入以下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#-p 指定服务器端口，-P指定数据库端口号</span></div><div class="line">dpd -p 5550 -P 5500 sportsstore\app.dpd</div></pre></td></tr></table></figure></p>
<p>输入命令<code>dashboard</code>，将会打开dashboard资源配置网页。</p>
<ul>
<li><p>创建数据结构<br>  新建一个Collection命名为<code>/products</code>,添加如下属性：<br>  <table><tr><td>名称</td><td>类型</td><td>是否必须</td></tr><tr><td>name</td><td>string</td><td>是</td></tr><tr><td>description</td><td>string</td><td>是</td></tr><tr><td>category</td><td>string</td><td>是</td></tr><tr><td>price</td><td>string</td><td>是</td></tr></table>当你完成属性的添加，控制面板应该同下图一样。<br>  <img src="imgs/1485181604797_4.png" alt=""><br>  <strong>注意：Deployd增加了id属性，在数据库中这将被用于独一无二的识别对象。deployd会自动将唯一赋给id属性，并且我将依靠这些值在后续章节实现管理功能</strong></p>
</li>
<li><p>添加数据<br>  <img src="imgs/1485181646189_5.png" alt=""></p>
</li>
<li><p>测试数据服务<br>  测试Deployd被正确地配置并工作着，打开浏览器窗口并转到以下URL：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://localhost:5550/products</div></pre></td></tr></table></figure>
<p>  如果顺利，添加的数据将会以JSON格式返回。</p>
</li>
</ul>
<h3 id="准备应用程序"><a href="#准备应用程序" class="headerlink" title="准备应用程序"></a>准备应用程序</h3><ul>
<li>创建目录结构<br>  你可以以你喜欢的任何方法组织构成AngularJS应用程序的文件。以angular-sportsstore为项目根目录，下面是我使用的目录结构：<br>   <img src="imgs/1485261919184_2.png" alt=""></li>
<li><p>构建基本大纲<br> 顶级HTML文件app.html包含结构标签以及引入我将使用的JavaScript库和CSS库，下面是app.html的代码：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>SportsStore<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"angular.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"bootstrap.css"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"bootstrap-theme.css"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">			angular.module(<span class="string">"sportsStore"</span>,[]);</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span>&gt;</span>SPORTS STORE<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">header</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"panel panel-default row"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"col-xs-3"</span>&gt;</span></div><div class="line">				Categories go here</div><div class="line">			<span class="tag">&lt;/<span class="name">nav</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-xs-9"</span>&gt;</span></div><div class="line">				Products go here</div><div class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="显示（伪造的）产品数据"><a href="#显示（伪造的）产品数据" class="headerlink" title="显示（伪造的）产品数据"></a>显示（伪造的）产品数据</h2><p>我将开始添加对显示产品数据的支持。我想一次只专注一个功能区域，所以我会定义伪造的初始本地数据。然后在下一章替换成Deployd服务器来的数据。</p>
<h3 id="创建控制器"><a href="#创建控制器" class="headerlink" title="创建控制器"></a>创建控制器</h3><p>我要创建的控制器将被用于整个应用程序（类似“顶级控制器”），顶级控制器单独一个文件，命名为<code>controllers/sportsStore.js</code>。下面是代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//module方法值传一个参数表示我们尝试找到sportsStore这个模块</span></div><div class="line">angular.module(<span class="string">"sportsStore"</span>)</div><div class="line">.controller(<span class="string">"sportsStoreCtrl"</span>,[<span class="string">"$scope"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>)</span>&#123;</div><div class="line">	$scope.data = &#123;</div><div class="line">		products : [</div><div class="line">			&#123;name:<span class="string">"product1"</span>,description:<span class="string">"A product"</span>,category:<span class="string">"category1"</span>,price:<span class="number">100</span>&#125;,</div><div class="line">			&#123;name:<span class="string">"product2"</span>,description:<span class="string">"A product"</span>,category:<span class="string">"category1"</span>,price:<span class="number">110</span>&#125;,</div><div class="line">			&#123;name:<span class="string">"product3"</span>,description:<span class="string">"A product"</span>,category:<span class="string">"category2"</span>,price:<span class="number">210</span>&#125;,</div><div class="line">			&#123;name:<span class="string">"product4"</span>,description:<span class="string">"A product"</span>,category:<span class="string">"category3"</span>,price:<span class="number">199</span>&#125;</div><div class="line">		]</div><div class="line">	&#125;</div><div class="line">&#125;])</div></pre></td></tr></table></figure></p>
<h3 id="显示产品详情"><a href="#显示产品详情" class="headerlink" title="显示产品详情"></a>显示产品详情</h3><p>为了显示产品详情，需要向html文件添加一些HTML标签。AngularJS让显示数据很容易。下面是修改后的<code>app.html</code>文件<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">ng-app</span>=<span class="string">"sportsStore"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>SportsStore<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"angular.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"bootstrap.css"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"bootstrap-theme.css"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">			angular.module(<span class="string">"sportsStore"</span>,[]);</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!--引入顶级控制器--&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"controllers/sportsStore.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!--使用控制器--&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"sportsStoreCtrl"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span>&gt;</span>运动商店<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">header</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"panel panel-default row"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"col-xs-3"</span>&gt;</span></div><div class="line">				Categories go here</div><div class="line">			<span class="tag">&lt;/<span class="name">nav</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-xs-8"</span>&gt;</span></div><div class="line">				<span class="comment">&lt;!--遍历添加商品--&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span> <span class="attr">ng-repeat</span>=<span class="string">"item in data.products"</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">h3</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">strong</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></div><div class="line">						<span class="comment">&lt;!--使用金额过滤器，将数值转换为金额--&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"pull-right label label-primary"</span>&gt;</span></div><div class="line">							&#123;&#123;item.price | currency&#125;&#125;</div><div class="line">						<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">					<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"lead"</span>&gt;</span>&#123;&#123;item.description &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="显示分类列表"><a href="#显示分类列表" class="headerlink" title="显示分类列表"></a>显示分类列表</h3><ul>
<li><p>创建分类去重过滤器<br>  分类列表不能重复，这意味着我们要对产品的<code>category</code>属性值进行去重。使用AngularJS的自定义过滤器能很方便实现。<br>  现在我创建一个<code>customFilters</code>模块，该模块包含项目所有自定义的过滤器。下面是<code>filters/customFilters.js</code>文件的代码：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">"customFilter"</span>,[])</div><div class="line">.filter(<span class="string">"unique"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">data,propertyName</span>)</span>&#123;</div><div class="line">		<span class="comment">//只对数组每个对象的属性过滤,返回对象属性值的集合</span></div><div class="line">		<span class="keyword">if</span>(angular.isArray(data) &amp;&amp; angular.isString(propertyName))&#123;</div><div class="line">			<span class="keyword">var</span> results = [];</div><div class="line">			<span class="keyword">var</span> keys = &#123;&#125;;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; data.length ; i++)&#123;</div><div class="line">				<span class="keyword">var</span> val = data[i][propertyName];</div><div class="line">				<span class="keyword">if</span>(angular.isUndefined(keys[val]))&#123;</div><div class="line">					keys[val] = <span class="literal">true</span>;</div><div class="line">					results.push(val);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">return</span> result;</div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">			<span class="keyword">return</span> data;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>生成分类导航链接<br>  生成可供用户点击的分类导航链接需要用到上一段创建的unique过滤器，还有一些可用的AngularJS内置功能。下面是<code>app.html</code>文件修改的部分代码：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">		<span class="comment">//依赖customFilter模块</span></div><div class="line">		angular.module(<span class="string">"sportsStore"</span>,[<span class="string">"customFilter"</span>]);</div><div class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--引入顶级控制器--&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"controllers/sportsStore.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--引入自定义过滤器--&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"filters/customFilters.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">...</div><div class="line">    <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"col-xs-3"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">ng-click</span>=<span class="string">"selectCategory()"</span> <span class="attr">class</span>=<span class="string">"btn btn-block btn-default"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!--先对商品按目录进行排序,然后再返回去重后的目录--&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">ng-repeat</span>=<span class="string">"item in data.products | orderBy:'category' | unique:'category'"</span></span></div><div class="line">			<span class="attr">ng-click</span>=<span class="string">"selectCategory(item)"</span> <span class="attr">class</span>=<span class="string">"btn btn-block btn-default btn-lg"</span>&gt;&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">nav</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>选择分类<br>  使用<code>ng-click</code>指令响应元素的点击事件，在本例中，点击导航菜单时触发<code>selectCategory</code>行为，为此，我需要在控制器定义该行为。我不想在顶级<code>sportsStore.js</code>控制器上添加该行为，因为这个控制器是定义应用程序通用行为和数据，作为替代，我会创建新控制器，它仅被用于产品列表和分类视图。下面是<code>controllers/productListController.js</code>文件的内容：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">"sportsStore"</span>)</div><div class="line">.controller(<span class="string">"productListCtrl"</span>,[<span class="string">"$scope"</span>,<span class="string">"$filter"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope,$filter</span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> selectedCategory = <span class="literal">null</span>;</div><div class="line">	$scope.selectCategory = <span class="function"><span class="keyword">function</span>(<span class="params">newCategory</span>)</span>&#123;</div><div class="line">		selectedCategory = newCategory;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//当没有选中产品分类(显示全部)或者产品所在分类被选中时返回true(显示选择的分类)</span></div><div class="line">	$scope.categoryFilterFn = <span class="function"><span class="keyword">function</span>(<span class="params">product</span>)</span>&#123;</div><div class="line">		<span class="keyword">return</span> selectedCategory == <span class="literal">null</span> || product.category == selectedCategory;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">&#125;])</div></pre></td></tr></table></figure>
<p>  在页面中应用控制器,<code>app.html</code>修改的部分代码如下：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">   ...</div><div class="line">   &lt;!--引入自定义过滤器--&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"filters/customFilters.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div><div class="line">&lt;!--引入产品列表控制器--&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"controllers/productListController.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></div><div class="line">   ...</div><div class="line">   &lt;!--使用控制器--&gt;</div><div class="line">   &lt;section class="panel panel-default row" ng-controller="productListCtrl"&gt;</div><div class="line">   ...</div><div class="line">   &lt;!--遍历添加商品,filter过滤器只返回结果为true的数据--&gt;</div><div class="line">&lt;div class="well" ng-repeat="item in data.products | filter:categoryFilterFn"&gt;</div><div class="line">   ...</div></pre></td></tr></table></figure>
</li>
<li><p>高亮选择的分类<br>  对被选分类按钮使用Bootstrap的btn-primary CSS类以实现高亮显示。下面是修改后的<code>productListController.js</code>文件</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">"sportsStore"</span>)</div><div class="line"><span class="comment">//定义激活添加的类名</span></div><div class="line">.constant(<span class="string">"productListActiveClass"</span>,<span class="string">"btn-primary"</span>)</div><div class="line">.controller(<span class="string">"productListCtrl"</span>,[<span class="string">"$scope"</span>,<span class="string">"$filter"</span>,<span class="string">"productListActiveClass"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope,$filter,productListActiveClass</span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> selectedCategory = <span class="literal">null</span>;</div><div class="line">	$scope.selectCategory = <span class="function"><span class="keyword">function</span>(<span class="params">newCategory</span>)</span>&#123;</div><div class="line">		selectedCategory = newCategory;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//当没有选中产品分类(显示全部)或者产品所在分类被选中时返回true(显示选择的分类)</span></div><div class="line">	$scope.categoryFilterFn = <span class="function"><span class="keyword">function</span>(<span class="params">product</span>)</span>&#123;</div><div class="line">		<span class="keyword">return</span> selectedCategory == <span class="literal">null</span> || product.category == selectedCategory;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//若当前类别被选中,添加样式</span></div><div class="line">	$scope.getCategoryClass = <span class="function"><span class="keyword">function</span>(<span class="params">category</span>)</span>&#123;</div><div class="line">		<span class="keyword">return</span> selectedCategory == category ? productListActiveClass : <span class="string">""</span>;</div><div class="line">	&#125;</div><div class="line">&#125;])</div></pre></td></tr></table></figure>
<p>  下面是<code>app.html</code>修改的代码：<br>  <img src="imgs/1486198602123_2.png" alt=""></p>
</li>
<li><p>添加分页</p>
<ol>
<li><p>更新控制器<br> 我更新了<code>productListCtrl</code>控制器来支持分页，下面是更新后的<code>controllers/productListController.js</code>文件</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">"sportsStore"</span>)</div><div class="line"><span class="comment">//定义激活添加的类名</span></div><div class="line">.constant(<span class="string">"productListActiveClass"</span>,<span class="string">"btn-primary"</span>)</div><div class="line"><span class="comment">//分页大小</span></div><div class="line">.constant(<span class="string">"productListPageCount"</span>,<span class="number">3</span>)</div><div class="line">.controller(<span class="string">"productListCtrl"</span>,[<span class="string">"$scope"</span>,<span class="string">"$filter"</span>,<span class="string">"productListActiveClass"</span>,<span class="string">"productListPageCount"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope,$filter,productListActiveClass,productListPageCount</span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> selectedCategory = <span class="literal">null</span>;</div><div class="line">	$scope.selectedPage = <span class="number">1</span>;</div><div class="line">	$scope.pageSize = productListPageCount;</div><div class="line">	</div><div class="line">	$scope.selectCategory = <span class="function"><span class="keyword">function</span>(<span class="params">newCategory</span>)</span>&#123;</div><div class="line">		selectedCategory = newCategory;</div><div class="line">		<span class="comment">//选择新的分类时默认显示第一页</span></div><div class="line">		$scope.selectedPage = <span class="number">1</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//当没有选中产品分类(显示全部)或者产品所在分类被选中时返回true(显示选择的分类)</span></div><div class="line">	$scope.categoryFilterFn = <span class="function"><span class="keyword">function</span>(<span class="params">product</span>)</span>&#123;</div><div class="line">		<span class="keyword">return</span> selectedCategory == <span class="literal">null</span> || product.category == selectedCategory;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//若当前类别被选中,添加样式</span></div><div class="line">	$scope.getCategoryClass = <span class="function"><span class="keyword">function</span>(<span class="params">category</span>)</span>&#123;</div><div class="line">		<span class="keyword">return</span> selectedCategory == category ? productListActiveClass : <span class="string">""</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//选择分页</span></div><div class="line">	$scope.selectPage = <span class="function"><span class="keyword">function</span>(<span class="params">newPage</span>)</span>&#123;</div><div class="line">		$scope.selectedPage = newPage;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//选中页的样式</span></div><div class="line">	$scope.getPageClass = <span class="function"><span class="keyword">function</span>(<span class="params">page</span>)</span>&#123;</div><div class="line">		<span class="keyword">return</span> $scope.selectedPage == page ? productListActiveClass : <span class="string">""</span>;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">&#125;])</div></pre></td></tr></table></figure>
</li>
<li><p>实现过滤器<br> 我创建了两个新过滤器支持分页，我将二者添加到customFilter.js文件。下面是修改后的<code>filters/customFilters.js</code>文件的代码：</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">"customFilter"</span>,[])</div><div class="line">.filter(<span class="string">"unique"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">data,propertyName</span>)</span>&#123;</div><div class="line">    	<span class="comment">//只对数组每个对象的属性过滤,返回对象属性值的集合</span></div><div class="line">		<span class="keyword">if</span>(angular.isArray(data) &amp;&amp; angular.isString(propertyName))&#123;</div><div class="line">			<span class="keyword">var</span> results = [];</div><div class="line">			<span class="keyword">var</span> keys = &#123;&#125;;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; data.length ; i++)&#123;</div><div class="line">				<span class="keyword">var</span> val = data[i][propertyName];</div><div class="line">				<span class="keyword">if</span>(angular.isUndefined(keys[val]))&#123;</div><div class="line">					keys[val] = <span class="literal">true</span>;</div><div class="line">					results.push(val);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">return</span> results;</div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">			<span class="keyword">return</span> data;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;)</div><div class="line">.filter(<span class="string">"range"</span>,[<span class="string">"$filter"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$filter</span>)</span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">data,page,size</span>)</span>&#123;</div><div class="line">		<span class="keyword">if</span>(angular.isArray(data) &amp;&amp; angular.isNumber(page) &amp;&amp; angular.isNumber(size))&#123;</div><div class="line">			<span class="keyword">var</span> start_index = ( page - <span class="number">1</span> ) * size;</div><div class="line">			<span class="keyword">if</span>(data.length &lt; start_index)&#123;</div><div class="line">				<span class="keyword">return</span> [];</div><div class="line">			&#125;<span class="keyword">else</span>&#123;</div><div class="line">				<span class="comment">//返回当前页的数据</span></div><div class="line">				<span class="keyword">return</span> $filter(<span class="string">"limitTo"</span>)(data.splice(start_index),size);</div><div class="line">			&#125;</div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">			<span class="keyword">return</span> data;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;])</div><div class="line">.filter(<span class="string">"pageCount"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">data,size</span>)</span>&#123;</div><div class="line">		<span class="keyword">if</span>(angular.isArray(data))&#123;</div><div class="line">			<span class="keyword">var</span> result = [];</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; <span class="built_in">Math</span>.ceil(data.length/size) ; i++)&#123;</div><div class="line">				result.push(i);</div><div class="line">			&#125;</div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">			<span class="keyword">return</span> data;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
<li><p>更新视图<br> 实现分页的最后一步就是更新视图。下面是修改后的<code>app.html</code>页面：</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html ng-app="sportsStore"&gt;</div><div class="line">	&lt;head&gt;</div><div class="line">		&lt;meta charset="UTF-8"&gt;</div><div class="line">		&lt;title&gt;SportsStore&lt;/title&gt;</div><div class="line">		&lt;script src="angular.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;</div><div class="line">		&lt;link rel="stylesheet" type="text/css" href="bootstrap.css"/&gt;</div><div class="line">		&lt;link rel="stylesheet" type="text/css" href="bootstrap-theme.css"/&gt;</div><div class="line">		&lt;script type="text/javascript"&gt;</div><div class="line">			//依赖customFilter模块</div><div class="line">			angular.module("sportsStore",["customFilter"]);</div><div class="line">		&lt;/script&gt;</div><div class="line">		&lt;!--引入顶级控制器--&gt;</div><div class="line">		&lt;script src="controllers/sportsStore.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;</div><div class="line">		&lt;!--引入自定义过滤器--&gt;</div><div class="line">		&lt;script src="filters/customFilters.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;</div><div class="line">		&lt;!--引入产品列表控制器--&gt;</div><div class="line">		&lt;script src="controllers/productListController.js" type="text/javascript" charset="utf-8"&gt;&lt;/script&gt;</div><div class="line">	&lt;/head&gt;</div><div class="line">	&lt;!--使用控制器--&gt;</div><div class="line">	&lt;body ng-controller="sportsStoreCtrl"&gt;</div><div class="line">		&lt;header class="navbar navbar-inverse"&gt;</div><div class="line">			&lt;a href="#" class="navbar-brand"&gt;运动商店&lt;/a&gt;</div><div class="line">		&lt;/header&gt;</div><div class="line">		&lt;section class="panel panel-default row" ng-controller="productListCtrl"&gt;</div><div class="line">			&lt;nav class="col-xs-3"&gt;</div><div class="line">				&lt;a ng-click="selectCategory()" class="btn btn-block btn-default" </div><div class="line">					ng-class="getCategoryClass()"&gt;Home&lt;/a&gt;</div><div class="line">				&lt;!--先对商品按目录进行排序,然后再返回去重后的目录--&gt;</div><div class="line">				&lt;a ng-repeat="item in data.products | orderBy:'category' | unique:'category'"</div><div class="line">					ng-click="selectCategory(item)" class="btn btn-block btn-default btn-lg" </div><div class="line">					ng-class="getCategoryClass(item)"&gt;&#123;&#123;item&#125;&#125;&lt;/a&gt;</div><div class="line">			&lt;/nav&gt;</div><div class="line">			&lt;div class="col-xs-8"&gt;</div><div class="line">				&lt;!--遍历添加商品--&gt;</div><div class="line">				&lt;div class="well" ng-repeat="item in data.products | filter:categoryFilterFn | range:selectedPage:pageSize"&gt;</div><div class="line">					&lt;h3&gt;</div><div class="line">						&lt;strong&gt;&#123;&#123;item.name&#125;&#125;&lt;/strong&gt;</div><div class="line">						&lt;!--使用金额过滤器，将数值转换为金额--&gt;</div><div class="line">						&lt;span class="pull-right label label-primary"&gt;</div><div class="line">							&#123;&#123;item.price | currency&#125;&#125;</div><div class="line">						&lt;/span&gt;</div><div class="line">					&lt;/h3&gt;</div><div class="line">					&lt;span class="lead"&gt;&#123;&#123;item.description &#125;&#125;&lt;/span&gt;</div><div class="line">				&lt;/div&gt;</div><div class="line">				&lt;div class="pull-right btn-group"&gt;</div><div class="line">					&lt;a ng-repeat="page in data.products | filter:categoryFilterFn | pageCount:pageSize"</div><div class="line">						ng-click="selectPage($index + 1)" class="btn btn-default" ng-class="getPageClass($index + 1)"&gt;</div><div class="line">						&#123;&#123;$index + 1&#125;&#125;</div><div class="line">					&lt;/a&gt;</div><div class="line">				&lt;/div&gt;</div><div class="line">			&lt;/div&gt;</div><div class="line">		&lt;/section&gt;</div><div class="line">	&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[第三章、结合背景理解AngularJS]]></title>
      <url>http://heji.website/2017/02/06/%E7%AC%AC%E4%B8%89%E7%AB%A0%E3%80%81%E7%BB%93%E5%90%88%E8%83%8C%E6%99%AF%E7%90%86%E8%A7%A3AngularJS/</url>
      <content type="html"><![CDATA[<p>并不是所有的应用程序都适合使用AngularJS开发，本章主要介绍AngularJS的适用场景。</p>
<a id="more"></a>
<p>AngularJS不是能够解决任何问题的万能利器，所以了解何时应该使用AngularJS以及何时应该寻找替代品是非常重要的。AngularJS将那些曾经仅对服务器端开发者可用的功能完整地搬到了浏览器端。这意味着使用了AngularJS的HTML文档每次被加载时，AngularJS会有很多事要做——需要编译HTML元素，需要计算数据绑定，需要执行指令等。这些工作都需要时间去执行，所需时长取决于HTML文档及其相关联的JavaScript代码的复杂度，而且关键是浏览器的质量和设备的处理能力。<br>因此，Angular应用优化的目标应该是尽可能地降低这些设置的执行频率，并在其执行时尽可能多地向用户发送应用的更多内容。这意味着需要你仔细考虑所搭建的Web应用程序的类型。广义上讲，存在两种类型的Web应用程序：回合式和单页面。</p>
<h2 id="回合式和单页面应用程序"><a href="#回合式和单页面应用程序" class="headerlink" title="回合式和单页面应用程序"></a>回合式和单页面应用程序</h2><h3 id="回合式模型"><a href="#回合式模型" class="headerlink" title="回合式模型"></a>回合式模型</h3><p>浏览器向服务器请求一个初始的HTML文档。用户交互（例如单击链接或者提交表单）会使得浏览器发送请求并接受一个全新的HTML文档。在这类程序中，浏览器本质上是一个HTML内容的解析引擎，所有的应用程序逻辑和数据都保留在服务器上。<br>回合式应用存在一些严重的不足之处：用户在下一个HTML文档被请求并加载之前必须等待，需要大型服务器端基础设施来处理所有请求，需要很多带宽。</p>
<h3 id="单页面应用"><a href="#单页面应用" class="headerlink" title="单页面应用"></a>单页面应用</h3><p>单页面应用另辟蹊径，一个初始的HTML文档被发送给服务器，但是用户交互所产生的Ajax请求只会请求较小的HTML片段，初始的HTML文档不会被再次加载或者替换，在Ajax请求被异步执行时用户还可以继续与已有的HTML进行交互。(AngularJS的路由加载模块就是明显的例子，页面的切换只是部分HTML代码的变换，页面还是原来的页面)<br>AngularJS以单页面应用程序和复杂的回合式应用程序见长。对于较简单的项目，一般来说jQuery或者类似的替代者会是更好的选择，尽管没什么能阻止你在所有的项目中使用AngularJS。<br><img src="imgs/1484218583460_6.png" alt=""><br>AngularJS与jQuery在Web应用开发上走的是不同的路，jQuery完全是通过显式操作浏览器中的DOM来创建应用。AngularJS采用的方法则是将浏览器吸收为应用开发的基础。</p>
<h2 id="理解MVC模式"><a href="#理解MVC模式" class="headerlink" title="理解MVC模式"></a>理解MVC模式</h2><p>使用MVC模式的关键前提是实现关注点分离，即应用程序中的数据模型与业务和展示逻辑解耦。主要的三个构件是模型、控制器和视图。<br><img src="imgs/1484219382996_8.png" alt="服务器端的MVC"><br>AngularJS是在浏览器中工作的，导致对MVC的形式产生一些影响。<br><img src="imgs/1484219499877_9.png" alt="浏览器端的MVC"></p>
<ul>
<li><p>理解模型<br>  模型（MVC中的M）包含了用户赖以工作的数据。有两种广义上的模型：视图模型，只表示从控制器传往视图的数据；领域模型：包含了业务领域的数据，以及用于创建、存储、和操纵这些数据的各种操作、转换和规则，统称逻辑模型。<br>  模型应该：</p>
<pre><code>* 包含领域数据
* 包含创建、管理和修改领域数据的逻辑
* 提供整洁的API，能够暴露模型数据及之上的操作。
</code></pre><p>  模型不应该：</p>
<pre><code>* 暴露模型数据是如何获取或管理的细节
* 包含根据用户交互对模型进行转换的逻辑（这是控制器的职责）
* 包含将数据显示给用户的逻辑
</code></pre></li>
<li><p>理解控制器<br>  在一个AngularJS应用中，控制器就像结缔组织一样，作为数据模型和视图之间的渠道。控制器会向作用域中添加业务领域逻辑（称为行为），而作用域是模型的子集。<br>  控制器应该：</p>
<pre><code>* 包含初始化作用域所需的逻辑
* 包含视图所需的用于表示作用域中的数据的逻辑行为。
* 包含根据用户交互来更新作用域的逻辑行为
</code></pre><p>  控制器不应当：</p>
<pre><code>* 包含操作DOM的逻辑（那是视图的职责）
* 包含管理数据持久化的逻辑（那是模型的职责）
* 在作用域之外操作数据
</code></pre></li>
<li><p>理解视图数据<br>  领域模型并不是AngularJS应用程序中的唯一数据。控制器可以创建视图数据，以简化视图的定义。视图数据不会被持久化。而且要么是通过综合领域模型数据的几部分而成的，要么是存在于对用户交互的响应中。</p>
</li>
<li><p>理解视图<br>  AngularJS视图是通过HTML元素来定义的，而这些元素是通过数据或者指令来进行增强或者生成的。正是AngularJS指令使得视图变得如此灵活。<br>  视图应当：</p>
<pre><code>* 包含将数据呈现给用户所需的逻辑和标记。
</code></pre><p>  视图不应当：</p>
<pre><code>* 包含复杂逻辑（这最好放到控制器中去）
* 包含创建、存储或者操作领域模型的逻辑
</code></pre></li>
</ul>
<h2 id="理解RESTful服务"><a href="#理解RESTful服务" class="headerlink" title="理解RESTful服务"></a>理解RESTful服务</h2><p>一般情况下，我们并不希望客户端代码直接访问数据存储——这样会在客户端和数据存储之间产生紧耦合，使得单元测试复杂化，也使得在不修改客户端代码的情况下对数据存储的修改变得困难。<br>通过服务器端作为中介来访问数据存储，可以消除紧耦合。客户端的逻辑负责从服务器端存取数据，而无需知道数据在后台是如何存储或访问的细节。<br>有许多种在客户端和服务端之间传递数据的方法。最常见的一种是使用Ajax请求来调用服务器端代码，让服务器发送JSON并使用HTML表单来修改数据。这种方法可以很好地工作，也是RESTful Web服务的基础，利用了HTTP请求的天然特性对数据进行CRUD操作。<br>在一个RESTful服务中，被请求的操作通过HTTP方法和URL的组合进行表示。对于RESTful的Web服务没有标准的URL规范，但是一般想法是让URL是不言自明的，这样能够让URL引用的变得更加明显。例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://myserver.mydomain.com/people/bob</div></pre></td></tr></table></figure></p>
<p>在本例中，明显地看出有一个people的数据集合，引用的具体对象是bob。<br>URL可以识别出我想操作的数据对象，HTTP方法则指定了我想执行的操作。如下表所示：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>获取URL指定的数据对象</td>
</tr>
<tr>
<td>PUT</td>
<td>更新URL指定的数据对象</td>
</tr>
<tr>
<td>POST</td>
<td>创建一个新的对象，通常使用表单数据值作为数据域</td>
</tr>
<tr>
<td>DELETE</td>
<td>删除URL所指定的数据对象</td>
</tr>
</tbody>
</table>
<h2 id="Angular应用的几条规则"><a href="#Angular应用的几条规则" class="headerlink" title="Angular应用的几条规则"></a>Angular应用的几条规则</h2><ul>
<li>视图逻辑应该仅为显示准备数据，并且永远不应该修改模型</li>
<li>控制器永远不应该直接创建、更新或删除模型中的数据</li>
<li>客户端永远都不应该直接访问数据存储。</li>
<li>不要尝试在Angular应用使用jQuery操作DOM，技术的选型应该在最初的时候考虑清楚，否则后患无穷。如果实在需要使用jQuery，建议使用AngularJS封装的jqLite，后面会讲解。</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[第二章、第一个AngularJS应用]]></title>
      <url>http://heji.website/2017/01/10/%E7%AC%AC%E4%BA%8C%E7%AB%A0%E3%80%81%E7%AC%AC%E4%B8%80%E4%B8%AAAngularJS%E5%BA%94%E7%94%A8/</url>
      <content type="html"><![CDATA[<p>本章使用AngularJS特性打造出一个简单的Web应用程序。</p>
<a id="more"></a>
<h2 id="准备项目"><a href="#准备项目" class="headerlink" title="准备项目"></a>准备项目</h2><p><strong>注意：除非特殊说明,否则都是以angularjs目录作为项目根目录</strong><br>在assets目录下新建一个<code>todo.html</code>的HTML文件<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>待办事项<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"../lib/bootstrap-3.3.0/dist/css/bootstrap.css"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"../lib/bootstrap-3.3.0/dist/css/bootstrap-theme.css"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-header"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">h1</span>&gt;</span>To DO List<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-control"</span> /&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"input-group-btn"</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped"</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">thead</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">th</span>&gt;</span>描述<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">th</span>&gt;</span>是否完成<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">thead</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">tbody</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">td</span>&gt;</span>买花<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">td</span>&gt;</span>否<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">td</span>&gt;</span>买鞋子<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">td</span>&gt;</span>否<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">td</span>&gt;</span>工作总结<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">td</span>&gt;</span>是<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">td</span>&gt;</span>打电话给家里<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">td</span>&gt;</span>否<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>在浏览器上访问<code>http://localhost:3000/angularjs/assets/todo.html</code>查看效果，目前没有应用AngularJS。</p>
<h2 id="使用AngularJS"><a href="#使用AngularJS" class="headerlink" title="使用AngularJS"></a>使用AngularJS</h2><h3 id="将AngularJS应用到HTML文件"><a href="#将AngularJS应用到HTML文件" class="headerlink" title="将AngularJS应用到HTML文件"></a>将AngularJS应用到HTML文件</h3><ol>
<li>引入AngularJS文件</li>
<li>创建一个AngularJS模块</li>
<li>对元素应用模块</li>
</ol>
<p>AngularJS应用由一个或多个模块组成，模块是由调用angular.module方法而创建的，该方法接收两个参数，第一个参数是模块名称，第二个参数是依赖的其他模块，当没有依赖其他模块时，传一个空数组。完成模块的定义后，对html或其他元素使用<code>ng-app</code>指令来使用模块，该指令告诉浏览器，指令内的所有元素被AngularJS编译和处理，通常当只使用AngularJS时，在html元素添加<code>ng-app</code>指令，当需要与其他技术混合时，可以在文档的其他元素添加<code>ng-app</code>指令缩小AngularJS应用的边界。</p>
<ul>
<li>创建数据模型<br>  AngularJS支持MVC模式，推荐视图与数据模型、逻辑分离，在该例我们使用JavaScript创建数据模型。</li>
<li>创建控制器<br>  控制器是由angular.module所返回的Module对象上的controller方法创建的。controller方法接收两个参数，第一个是控制器的名称第二个是将会被调用的函数，用于定义控制器功能。惯例一般是对控制器命名为<name>Ctrl，真正的应用程序一般会生成多个控制器，但是本例中仅需要一个，名字取为ToDoCtrl。<br>  控制器函数接收一个<code>$scope</code>的参数，<code>$</code>表示AngularJS提供的内置特性，<code>$scope</code>对象常用于对控制器范围的视图提供数据和功能。控制器定义好之后，在元素上使用<code>ng-controller</code>为元素指定控制器。</name></li>
<li><p>创建视图</p>
<ul>
<li>插入模型值<br>  使用<code></code>绑定数据模型，在该例中，todo即表示model对象，Expression可以是任何有效的JavaScript语句。需要注意的是，你应该仅使用表达式来执行一些简单操作，而不要执行复杂逻辑或对模型进行操作，这应该是控制器该做的事。</li>
<li>使用指令<br>  在清单中，使用了另一个AngularJS内置指令<code>ng-repeat</code>。该指令用于告诉AngularJS从一个集合中的各个对象生成所应用到的元素及其内容。该指令的格式为<code>&lt;name&gt; in &lt;collection&gt;</code></li>
</ul>
</li>
<li><p>最终代码<br>  最终代码如下：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">ng-app</span>=<span class="string">"todoApp"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>待办事项<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"../lib/bootstrap-3.3.0/dist/css/bootstrap.css"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"../lib/bootstrap-3.3.0/dist/css/bootstrap-theme.css"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"todoCtrl"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-header"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;todo.user&#125;&#125;'s To DO List<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"label label-default"</span>&gt;</span>&#123;&#123;todo.items.length&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-control"</span> /&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"input-group-btn"</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped"</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">thead</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">th</span>&gt;</span>描述<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">th</span>&gt;</span>是否完成<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">thead</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">tbody</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-repeat</span>=<span class="string">"item in todo.items"</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;item.action&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;item.done ? "是" : "否"&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../lib/angular-1.2.5/angular.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">			<span class="keyword">var</span> todoApp = angular.module(<span class="string">'todoApp'</span>,[]);</div><div class="line">			<span class="comment">//定义数据模型</span></div><div class="line">			<span class="keyword">var</span> model = &#123;</div><div class="line">				user:<span class="string">"HeJi"</span>,</div><div class="line">				items:[</div><div class="line">					&#123;action:<span class="string">"买花"</span>,done:<span class="literal">false</span>&#125;,</div><div class="line">					&#123;action:<span class="string">"买鞋子"</span>,done:<span class="literal">false</span>&#125;,</div><div class="line">					&#123;action:<span class="string">"工作总结"</span>,done:<span class="literal">true</span>&#125;,</div><div class="line">					&#123;action:<span class="string">"打电话给家里"</span>,done:<span class="literal">false</span>&#125;</div><div class="line">				]</div><div class="line">			&#125;</div><div class="line">			<span class="comment">//定义控制器</span></div><div class="line">			todoApp.controller(<span class="string">'todoCtrl'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>)</span>&#123;</div><div class="line">				$scope.todo = model;</div><div class="line">			&#125;)</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="基本功能之外"><a href="#基本功能之外" class="headerlink" title="基本功能之外"></a>基本功能之外</h2><ul>
<li><p>使用双向数据绑定<br>  上一节使用的绑定被称为单向绑定，其值是从模型中取得的。另外，AngularJS还支持双向数据绑定，模型用于生成元素，元素的变化也能引起模型中的相应变化。为了演示双向数据绑定，我添加一个复选框以便修改数据的done属性。</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">   //...表示还有其他内容,后面都是这样标记</div><div class="line">   ...</div><div class="line">   <span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-repeat</span>=<span class="string">"item in todo.items"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;item.action&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">ng-model</span>=<span class="string">"item.done"</span> /&gt;</span></div><div class="line">		&#123;&#123;item.done ? "是" : "否"&#125;&#125;</div><div class="line">	<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">   ...</div></pre></td></tr></table></figure>
</li>
<li><p>创建和使用控制器行为<br>  控制器在作用域上定义行为。行为是对模型中的数据进行操作的函数，用于实现应用程序中的业务逻辑。为了演示一个简单的行为，我们修改header以显示未完成的待办事项数目。</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">   ...</div><div class="line">   <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"label label-default"</span> <span class="attr">ng-hide</span>=<span class="string">"incompleteCount()==0"</span>&gt;</span>&#123;&#123;incompleteCount()&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">   ...</div><div class="line">   //定义控制器</div><div class="line">todoApp.controller('todoCtrl',function($scope)&#123;</div><div class="line">	$scope.todo = model;</div><div class="line">	//计算未完成待办事项数目</div><div class="line">	$scope.incompleteCount = function()&#123;</div><div class="line">		var count = 0;</div><div class="line">		angular.forEach($scope.todo.items,function(item)&#123;</div><div class="line">			if(!item.done)&#123;</div><div class="line">				count++;</div><div class="line">			&#125;</div><div class="line">		&#125;);</div><div class="line">		return count;</div><div class="line">	&#125;</div><div class="line">&#125;)</div><div class="line">   ...</div></pre></td></tr></table></figure>
<p>  行为是通过在<code>$scope</code>对象上添加函数而定义的。向<code>$scope</code>对象添加的函数所赋予的属性名称，被作为行为名，例如，本例中，<code>incompleteCount</code>就是行为名。另外，我使用了<code>ng-hide指令</code>，当赋值表达式的计算结果为true时，<code>ng-hide</code><br>  指令会隐藏元素及其子元素。</p>
</li>
<li><p>使用依赖于其他行为的行为<br>  因为行为是通过使用JavaScript函数而创建的，所以同一控制器中一个行为可以在其他行为的基础上创建。例如，我创建一个行为，可以根据待办事项列表中的未完成事项数来选择CSS类。</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">   ...</div><div class="line">   <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"label label-default"</span> <span class="attr">ng-class</span>=<span class="string">"warningLevel()"</span> <span class="attr">ng-hide</span>=<span class="string">"incompleteCount()==0"</span>&gt;</span>&#123;&#123;incompleteCount()&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">   ...</div><div class="line">   //根据未完成事项数选择提醒类</div><div class="line">$scope.warningLevel = function()&#123;</div><div class="line">	return $scope.incompleteCount() <span class="tag">&lt; <span class="attr">3</span> ? "<span class="attr">label-success</span>" <span class="attr">:</span> "<span class="attr">label-warning</span>";</span></div><div class="line">&#125;</div><div class="line">   <span class="attr">...</span></div></pre></td></tr></table></figure>
</li>
<li><p>响应用户交互<br>  你已经见到了行为和指令是如何结合在一起创建应用特性的，最强大的组合之一便是将指令和行为用于响应用户交互。<br>例如，我修改todo.html的内容，让用户能够创建新的待办事项。</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">   ...</div><div class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"actionText"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"input-group-btn"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span> <span class="attr">ng-click</span>=<span class="string">"addNewItem(actionText)"</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">   ...</div><div class="line">   //添加待办事项</div><div class="line">$scope.addNewItem = function(actionText)&#123;</div><div class="line">	$scope.todo.items.push(&#123;action:actionText,done:false&#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  这里需要说明的是，我给输入框绑定了一个没有挂靠在<code>$scope</code>对象的属性，AngularJS会动态地帮我们创建这个属性，然后在点击添加按钮的时候，再把这个属性传递到行为中。</p>
</li>
<li><p>对模型数据过滤和排序<br>  在todo.html文件中增加过滤器功能</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">   ...</div><div class="line">   <span class="comment">&lt;!--只遍历don属性为false的数据,根据action属性排序--&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-repeat</span>=<span class="string">"item in todo.items | filter:&#123;done:false&#125; | orderBy:'action'"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;item.action&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">ng-model</span>=<span class="string">"item.done"</span> /&gt;</span></div><div class="line">		&#123;&#123;item.done ? "是" : "否"&#125;&#125;</div><div class="line">	<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">   ...</div></pre></td></tr></table></figure>
<p>  AngularJS还支持自定义过滤器：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">   ...</div><div class="line">   <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">thead</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>描述<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">th</span>&gt;</span>是否完成<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">thead</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">tbody</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-repeat</span>=<span class="string">"item in todo.items | checkedItems:showComplete | orderBy:'action'"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;item.action&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">ng-model</span>=<span class="string">"item.done"</span> /&gt;</span></div><div class="line">				&#123;&#123;item.done ? "是" : "否"&#125;&#125;</div><div class="line">			<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"checkbox-inline"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">ng-model</span>=<span class="string">"showComplete"</span> /&gt;</span>显示所有</div><div class="line">	<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">   ...</div><div class="line">   //自定义过滤器</div><div class="line">todoApp.filter('checkedItems',function()&#123;</div><div class="line">	return function(items,showComplete)&#123;</div><div class="line">		var resultArr = [];</div><div class="line">		angular.forEach(items,function(item)&#123;</div><div class="line">			if(item.done == false || showComplete)&#123;</div><div class="line">				resultArr.push(item);</div><div class="line">			&#125;</div><div class="line">		&#125;)</div><div class="line">		return resultArr;</div><div class="line">	&#125;</div><div class="line">&#125;)</div><div class="line">   ...</div></pre></td></tr></table></figure>
<p>  AngularJS模块对象的filter方法用于创建一个过滤器工厂，该工厂会返回一个函数用于过滤一组数据对象。目前暂时不要在意工厂这部分的细节，只需知道使用filter方法需要传入一个函数，该函数中需要一个能够返回过滤后数据的函数就够了。<br>  实际执行过滤功能的函数有两个参数，第一个参数items由AngularJS提供，表示过滤的集合，第二个参数自己传进来，过滤器参数之间使用<code>:</code>分隔。</p>
</li>
<li><p>通过Ajax获取数据<br>  我要做的最后一项修改是通过一个Ajax请求获取JSON形式的数据作为数据模型。<br>  AngularJS的模型对象有一个run方法，该方法仅在AngularJS执行完初始化设置后运行一次，常用于一次性的任务。故我们可以把Ajax请求放在run函数中，在run函数中可以依赖注入内置对象<code>$http</code>，该对象提供了对底层Ajax请求的访问功能。</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">   ...</div><div class="line">   //定义数据模型</div><div class="line">var model = &#123;</div><div class="line">	"user":"HeJi"</div><div class="line">&#125;;</div><div class="line">todoApp.run(function($http)&#123;</div><div class="line">       //get方法返回一个promise对象，该对象表示将在未来完成的工作</div><div class="line">    $http.get("todo.json").success(function(datas)&#123;</div><div class="line">		model.items = datas;</div><div class="line">	&#125;)</div><div class="line">&#125;);</div><div class="line">   ...</div></pre></td></tr></table></figure>
</li>
<li><p>最终代码如下：<br>  todo.html：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">ng-app</span>=<span class="string">"todoApp"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>待办事项<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"../lib/bootstrap-3.3.0/dist/css/bootstrap.css"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"../lib/bootstrap-3.3.0/dist/css/bootstrap-theme.css"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"todoCtrl"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-header"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;todo.user&#125;&#125;'s To DO List<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"label label-default"</span> <span class="attr">ng-class</span>=<span class="string">"warningLevel()"</span> <span class="attr">ng-hide</span>=<span class="string">"incompleteCount()==0"</span>&gt;</span>&#123;&#123;incompleteCount()&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">ng-model</span>=<span class="string">"actionText"</span>/&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"input-group-btn"</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span> <span class="attr">ng-click</span>=<span class="string">"addNewItem(actionText)"</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped"</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">thead</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">th</span>&gt;</span>描述<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">th</span>&gt;</span>是否完成<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">thead</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">tbody</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-repeat</span>=<span class="string">"item in todo.items | checkedItems:showComplete | orderBy:'action'"</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;item.action&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">						<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">							<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">ng-model</span>=<span class="string">"item.done"</span> /&gt;</span></div><div class="line">							&#123;&#123;item.done ? "是" : "否"&#125;&#125;</div><div class="line">						<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">					<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"checkbox-inline"</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">""</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">ng-model</span>=<span class="string">"showComplete"</span> /&gt;</span>显示所有</div><div class="line">				<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../lib/angular-1.2.5/angular.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">			<span class="keyword">var</span> todoApp = angular.module(<span class="string">'todoApp'</span>,[]);</div><div class="line">			<span class="comment">//定义数据模型</span></div><div class="line">			<span class="keyword">var</span> model = &#123;</div><div class="line">				<span class="string">"user"</span>:<span class="string">"HeJi"</span></div><div class="line">			&#125;;</div><div class="line">			todoApp.run(<span class="function"><span class="keyword">function</span>(<span class="params">$http</span>)</span>&#123;</div><div class="line">				$http.get(<span class="string">"todo.json"</span>).success(<span class="function"><span class="keyword">function</span>(<span class="params">datas</span>)</span>&#123;</div><div class="line">					model.items = datas;</div><div class="line">				&#125;)</div><div class="line">			&#125;)</div><div class="line">			<span class="comment">//定义控制器</span></div><div class="line">			todoApp.controller(<span class="string">'todoCtrl'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>)</span>&#123;</div><div class="line">				$scope.todo = model;</div><div class="line">				<span class="comment">//计算未完成待办事项数目</span></div><div class="line">				$scope.incompleteCount = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">					<span class="keyword">var</span> count = <span class="number">0</span>;</div><div class="line">					angular.forEach($scope.todo.items,<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</div><div class="line">						<span class="keyword">if</span>(!item.done)&#123;</div><div class="line">							count++;</div><div class="line">						&#125;</div><div class="line">					&#125;);</div><div class="line">					<span class="keyword">return</span> count;</div><div class="line">				&#125;</div><div class="line">				<span class="comment">//根据未完成事项数选择提醒类</span></div><div class="line">				$scope.warningLevel = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">					<span class="keyword">return</span> $scope.incompleteCount() &lt; <span class="number">3</span> ? <span class="string">"label-success"</span> : <span class="string">"label-warning"</span>;</div><div class="line">				&#125;</div><div class="line">				<span class="comment">//添加待办事项</span></div><div class="line">				$scope.addNewItem = <span class="function"><span class="keyword">function</span>(<span class="params">actionText</span>)</span>&#123;</div><div class="line">					$scope.todo.items.push(&#123;action:actionText,done:<span class="literal">false</span>&#125;);</div><div class="line">				&#125;</div><div class="line">			&#125;);</div><div class="line">			<span class="comment">//自定义过滤器</span></div><div class="line">			todoApp.filter(<span class="string">'checkedItems'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">				<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">items,showComplete</span>)</span>&#123;</div><div class="line">					<span class="keyword">var</span> resultArr = [];</div><div class="line">					angular.forEach(items,<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</div><div class="line">						<span class="keyword">if</span>(item.done == <span class="literal">false</span> || showComplete)&#123;</div><div class="line">							resultArr.push(item);</div><div class="line">						&#125;</div><div class="line">					&#125;)</div><div class="line">					<span class="keyword">return</span> resultArr;</div><div class="line">				&#125;</div><div class="line">			&#125;)</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  todo.json：</p>
  <figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">	&#123;<span class="attr">"action"</span>:<span class="string">"买花"</span>,<span class="attr">"done"</span>:<span class="literal">false</span>&#125;,</div><div class="line">	&#123;<span class="attr">"action"</span>:<span class="string">"打电话给家里"</span>,<span class="attr">"done"</span>:<span class="literal">false</span>&#125;,</div><div class="line">	&#123;<span class="attr">"action"</span>:<span class="string">"买鞋子"</span>,<span class="attr">"done"</span>:<span class="literal">false</span>&#125;,</div><div class="line">	&#123;<span class="attr">"action"</span>:<span class="string">"工作总结"</span>,<span class="attr">"done"</span>:<span class="literal">true</span>&#125;</div><div class="line">]</div></pre></td></tr></table></figure>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[第一章、搭建开发环境]]></title>
      <url>http://heji.website/2017/01/10/%E7%AC%AC%E4%B8%80%E7%AB%A0%E3%80%81%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/</url>
      <content type="html"><![CDATA[<p>本章主要是学习AngularJS的准备工作，介绍了如何搭建一个简单的AngularJS开发环境。</p>
<a id="more"></a>
<ul>
<li>选择web浏览器<br>  本教程使用Google Chrome浏览器。</li>
<li>选择代码编辑器<br>  可以选择任意代码编辑器，本教程使用HBuilder</li>
<li>安装Node.js<br>  安装之后使用<code>node --version</code>测试是否安装成功。</li>
<li>创建项目目录<br>  在任意位置创建<code>angularjs</code>目录，作为项目运行的根目录。运行<code>npm init</code>填写基本信息初始化项目</li>
<li><p>安装web服务器<br>  一个简单的Web服务器足以用于开发，我使用Node内置的<code>http</code>模块、<code>fs</code>模块以及安装的<code>url</code>模块、<code>path</code>模块建了一个静态文件服务器:<br>  1.安装必须模块</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save-dev url path</div></pre></td></tr></table></figure>
<p>  执行命令之后，<code>package.json</code>文件如下：</p>
  <figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"angularjs"</span>,</div><div class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</div><div class="line">  <span class="attr">"description"</span>: <span class="string">"learn angular"</span>,</div><div class="line">  <span class="attr">"main"</span>: <span class="string">"./server/server.js"</span>,</div><div class="line">  <span class="attr">"scripts"</span>: &#123;</div><div class="line">    <span class="attr">"startServer"</span>: <span class="string">"node server/server.js"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"keywords"</span>: [</div><div class="line">    <span class="string">"angular"</span></div><div class="line">  ],</div><div class="line">  <span class="attr">"author"</span>: <span class="string">"heji"</span>,</div><div class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span>,</div><div class="line">  <span class="attr">"devDependencies"</span>: &#123;</div><div class="line">    <span class="attr">"path"</span>: <span class="string">"^0.12.7"</span>,</div><div class="line">    <span class="attr">"url"</span>: <span class="string">"^0.11.0"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  2.在<code>angular</code>目录下建立一个server目录，作为定义服务器的目录，<code>server.js</code>是定义服务器的核心脚本，<code>mime.js</code>用于设置响应类型，<code>config.js</code>用于配置哪些文件使用缓存，缓存时间长短。<br>  <code>config.js</code>文件：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">exports.Expires = &#123;</div><div class="line">    fileMatch: <span class="regexp">/^(gif|png|jpg|js|css)$/ig</span>,</div><div class="line">    maxAge: <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">365</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>  <code>mime.js</code>文件：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">exports.types = &#123;</div><div class="line">    <span class="string">"css"</span>: <span class="string">"text/css"</span>,</div><div class="line">    <span class="string">"gif"</span>: <span class="string">"image/gif"</span>,</div><div class="line">    <span class="string">"html"</span>: <span class="string">"text/html"</span>,</div><div class="line">    <span class="string">"ico"</span>: <span class="string">"image/x-icon"</span>,</div><div class="line">    <span class="string">"jpeg"</span>: <span class="string">"image/jpeg"</span>,</div><div class="line">    <span class="string">"jpg"</span>: <span class="string">"image/jpeg"</span>,</div><div class="line">    <span class="string">"js"</span>: <span class="string">"text/javascript"</span>,</div><div class="line">    <span class="string">"json"</span>: <span class="string">"application/json"</span>,</div><div class="line">    <span class="string">"pdf"</span>: <span class="string">"application/pdf"</span>,</div><div class="line">    <span class="string">"png"</span>: <span class="string">"image/png"</span>,</div><div class="line">    <span class="string">"svg"</span>: <span class="string">"image/svg+xml"</span>,</div><div class="line">    <span class="string">"swf"</span>: <span class="string">"application/x-shockwave-flash"</span>,</div><div class="line">    <span class="string">"tiff"</span>: <span class="string">"image/tiff"</span>,</div><div class="line">    <span class="string">"txt"</span>: <span class="string">"text/plain"</span>,</div><div class="line">    <span class="string">"wav"</span>: <span class="string">"audio/x-wav"</span>,</div><div class="line">    <span class="string">"wma"</span>: <span class="string">"audio/x-ms-wma"</span>,</div><div class="line">    <span class="string">"wmv"</span>: <span class="string">"video/x-ms-wmv"</span>,</div><div class="line">    <span class="string">"xml"</span>: <span class="string">"text/xml"</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>  <code>server.js</code>文件：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</div><div class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">"url"</span>);</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</div><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</div><div class="line"><span class="keyword">var</span> mime = <span class="built_in">require</span>(<span class="string">"./mime"</span>).types;</div><div class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">"./config"</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> pathname = url.parse(request.url).pathname;</div><div class="line">    <span class="comment">//path.resolve('../')返回根目录的上级目录,因为URL已包含根目录</span></div><div class="line">    <span class="keyword">var</span> realPath = path.resolve(<span class="string">'../'</span>)+pathname;</div><div class="line">    fs.exists(realPath, <span class="function"><span class="keyword">function</span> (<span class="params">exists</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!exists) &#123;</div><div class="line">			<span class="comment">//如果路径不存在,返回404</span></div><div class="line">            response.writeHead(<span class="number">404</span>, &#123;</div><div class="line">                <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span></div><div class="line">            &#125;);</div><div class="line">            response.write(<span class="string">"This request URL "</span> + pathname + <span class="string">" was not found on this server."</span>);</div><div class="line">            response.end();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            fs.readFile(realPath, <span class="string">"binary"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, file</span>) </span>&#123;</div><div class="line">                <span class="keyword">if</span> (err) &#123;</div><div class="line">					<span class="comment">//如果读取文件失败统一返回500</span></div><div class="line">                    response.writeHead(<span class="number">500</span>, &#123;</div><div class="line">                        <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span></div><div class="line">                    &#125;);</div><div class="line">                    response.end(err);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">					<span class="comment">//设置最后修改时间</span></div><div class="line">					fs.stat(realPath, <span class="function"><span class="keyword">function</span> (<span class="params">err, stat</span>) </span>&#123;</div><div class="line">						<span class="keyword">var</span> lastModified = stat.mtime.toUTCString();</div><div class="line">						response.setHeader(<span class="string">"Last-Modified"</span>, lastModified);</div><div class="line">						<span class="keyword">if</span> (request.headers[<span class="string">"If-Modified-Since"</span>] &amp;&amp; lastModified == request.headers[<span class="string">"If-Modified-Since"</span>]) &#123;</div><div class="line">							<span class="comment">//没有修改直接返回</span></div><div class="line">							response.writeHead(<span class="number">304</span>, <span class="string">"Not Modified"</span>);</div><div class="line">							response.end();</div><div class="line">						&#125;<span class="keyword">else</span>&#123;</div><div class="line">							<span class="comment">//根据后缀名设置正确的MIME类型</span></div><div class="line">							<span class="keyword">var</span> ext = path.extname(realPath);</div><div class="line">							ext = ext ? ext.slice(<span class="number">1</span>) : <span class="string">'unknown'</span>;</div><div class="line">							<span class="comment">//判断请求的资源是否需要缓存(在config.js文件中配置)</span></div><div class="line">							<span class="keyword">if</span> (ext.match(config.Expires.fileMatch)) &#123;</div><div class="line">								<span class="keyword">var</span> expires = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">								expires.setTime(expires.getTime() + config.Expires.maxAge * <span class="number">1000</span>);</div><div class="line">								<span class="comment">//设置响应头</span></div><div class="line">								response.setHeader(<span class="string">"Expires"</span>, expires.toUTCString());</div><div class="line">								response.setHeader(<span class="string">"Cache-Control"</span>, <span class="string">"max-age="</span> + config.Expires.maxAge);</div><div class="line">							&#125;</div><div class="line">							<span class="keyword">var</span> contentType = mime[ext] || <span class="string">"text/plain"</span>;</div><div class="line">							response.writeHead(<span class="number">200</span>, &#123;</div><div class="line">								<span class="string">'Content-Type'</span>: contentType</div><div class="line">							&#125;);</div><div class="line">							<span class="comment">//向浏览器输入资源</span></div><div class="line">							response.write(file, <span class="string">"binary"</span>);</div><div class="line">							response.end();</div><div class="line">						&#125;</div><div class="line">					&#125;);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">server.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'server is running at 3000 port!'</span>)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>  3.在<code>angularjs</code>目录下新建<code>assets</code>目录，作为资源目录</p>
</li>
<li><p>安装测试系统<br>  AngularJS最重要的特性之一是对单元测试的支持。在本教程，使用karma test runner 和Jasmine框架。任意目录运行<code>npm install -g karma</code>命令即完成karma的安装，后面将继续介绍如果使用。</p>
</li>
<li><p>获取AngularJS<br>  在<code>https://angularjs.org/</code>网站获取AngularJS，本教程使用的是1.2.5版本。另外，AngularJS还提供了一些附加文件，用于扩展AngularJS核心库的功能，后面章节将使用部分这些文件<br>  <img src="1484010814337_2.png" alt=""></p>
</li>
<li><p>获取Bootstrap<br>  直接到bootstrap中文网下载Bootstrap。这里只是用bootstrap的样式，本教程不会使用bootstrap的Javascript文件的特性。</p>
</li>
<li><p>获取Deployd<br>  Deployd是一款出色的可跨平台的Web API引擎。它建立在Node.js和MongoDB的基础上，以JSON形式（类JSON）存储数据，并且支持使用JavaScript书写服务器端脚本。对于一些测试用的Web应用而言，Deployd可以非常快速的构建服务器端的REST API。使用以下命令安装Deployd：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install -g deployd</div></pre></td></tr></table></figure>
</li>
<li><p>执行一个简单的测试<br>  在<code>assets</code>目录新建一个test.html文件：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!doctype html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">ng-app</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>First Test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"../lib/bootstrap-3.3.0/dist/css/bootstrap.css"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"../lib/bootstrap-3.3.0/dist/css/bootstrap-theme.css"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span>&gt;</span>&#123;&#123;"Angular"&#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span>&gt;</span>Bootstrap<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../lib/angular-1.2.5/angular.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  启动服务器,访问<code>http://localhost:3000/angularjs/assets/test.html</code>即可查看效果</p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[HTML5-Web存储]]></title>
      <url>http://heji.website/2017/01/06/HTML5-Web%E5%AD%98%E5%82%A8/</url>
      <content type="html"><![CDATA[<p>Web存储允许我们在浏览器里保存简单的键/值数据。Web存储与cookie很相似。</p>
<a id="more"></a>
<h3 id="使用本地存储"><a href="#使用本地存储" class="headerlink" title="使用本地存储"></a>使用本地存储</h3><p>我们可以通过全局属性localStorage访问本地存储功能。这个属性返回一个Storage对象。Storage对象被用来保存键/值形式的<strong>字符串对</strong><br><img src="index_files/507ff266-d24f-43fd-9691-000f50d1a5ae.jpg" alt=""><br>Storage对象可用来存储键/值对，其中键和值都是字符串。键必须是唯一的，这就意味着如果我们用Storage对象里已经存在的键调用setItem方法，就会更新它的值。</p>
<ul>
<li>监听存储事件<br>  某个文档对本地存储进行修改时会触发storage事件，我们可以监听其他同源文档上的这个事件来确保我们能跟上最新的变化。<br>  与storage事件同时指派的对象是一个StorageEvent对象。<br>  <img src="index_files/cbde7dfe-831d-4684-a2cb-f2841faed675.jpg" alt=""><br>  <img src="index_files/90269775-bbaa-4d19-9d46-0204761ea6cc.jpg" alt=""><br>  storage事件是通过window对象触发的</li>
</ul>
<h3 id="使用会话存储"><a href="#使用会话存储" class="headerlink" title="使用会话存储"></a>使用会话存储</h3><p>会话存储的工作方式和本地存储基本一致，不同之处在于数据是在各个浏览上下文私有的，会在文档被关闭时移除。我们可以使用全局变量sessionStorage访问会话存储，它返回一个Storage对象。</p>
<h3 id="Cookie、localStorage和sessionStorage对比"><a href="#Cookie、localStorage和sessionStorage对比" class="headerlink" title="Cookie、localStorage和sessionStorage对比"></a>Cookie、localStorage和sessionStorage对比</h3><p><table><tr><td>特性</td><td>Cookie</td><td>localStorage</td><td>sessionStorage</td></tr><tr><td>数据的生命期</td><td>一般由服务器生成，可设置失效时间。如果在浏览器端生成Cookie，默认是关闭浏览器后失效</td><td>除非被清除，否则永久保存</td><td>仅在当前会话下有效，关闭页面或浏览器后被清除</td></tr><tr><td>存放数据大小</td><td>4K左右</td><td colspan="2">一般为5MB</td></tr><tr><td>与服务器端通信</td><td>每次都会携带在HTTP头中，如果使用cookie保存过多数据会带来性能问题</td><td colspan="2">仅在客户端（即浏览器）中保存，不参与和服务器的通信</td></tr><tr><td>易用性</td><td>需要程序员自己封装，源生的Cookie接口不友好</td><td colspan="2">源生接口可以接受，亦可再次封装来对Object和Array有更好的支持</td></tr></table><br><strong>注意：像记住密码等功能，一般在服务器端把用户信息加密存储在cookie，因为cookie的主要用途就是与服务器端的通信</strong></p>
<h3 id="本地存储的综合示例"><a href="#本地存储的综合示例" class="headerlink" title="本地存储的综合示例"></a>本地存储的综合示例</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">            <span class="selector-tag">body</span> &gt; *&#123;</div><div class="line">                <span class="attribute">float</span>: left;</div><div class="line">                <span class="attribute">margin</span>: <span class="number">4px</span> <span class="number">6px</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="selector-tag">table</span>&#123;</div><div class="line">                <span class="attribute">border-collapse</span>: collapse;</div><div class="line">            &#125;</div><div class="line">            <span class="selector-tag">table</span> <span class="selector-tag">td</span>&#123;</div><div class="line">                <span class="attribute">padding</span>: <span class="number">6px</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="selector-tag">p</span>&#123;</div><div class="line">                <span class="attribute">margin</span>: <span class="number">4px</span> <span class="number">0</span>;</div><div class="line">                <span class="attribute">padding</span>: <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"key"</span>&gt;</span>键：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"key"</span>/&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"value"</span>&gt;</span>值：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"value"</span>/&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"btns"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"add"</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"clear"</span>&gt;</span>清除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"msg"</span>&gt;</span>There are <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"count"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span> items!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            displayData();</div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">"btns"</span>).addEventListener(<span class="string">"click"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> id = e.target.getAttribute(<span class="string">"id"</span>);</div><div class="line">                <span class="keyword">switch</span>(id)&#123;</div><div class="line">                    <span class="keyword">case</span> <span class="string">"add"</span>:</div><div class="line">                        <span class="keyword">var</span> key = <span class="built_in">document</span>.getElementById(<span class="string">"key"</span>).value;</div><div class="line">                        <span class="keyword">var</span> val = <span class="built_in">document</span>.getElementById(<span class="string">"value"</span>).value;</div><div class="line">                        localStorage.setItem(key,val);</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    <span class="keyword">case</span> <span class="string">"clear"</span>:</div><div class="line">                        localStorage.clear();</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                displayData();</div><div class="line">            &#125;);</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">displayData</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> tableElem = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"table"</span>)[<span class="number">0</span>];</div><div class="line">                tableElem.innerHTML = <span class="string">""</span>;</div><div class="line">                <span class="keyword">var</span> itemCount = localStorage.length;</div><div class="line">                <span class="built_in">document</span>.getElementById(<span class="string">"count"</span>).innerHTML = itemCount;</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; itemCount ; i++)&#123;</div><div class="line">                    <span class="keyword">var</span> key = localStorage.key(i);</div><div class="line">                    tableElem.innerHTML+=<span class="string">"&lt;tr&gt;&lt;td&gt;"</span>+key+<span class="string">"&lt;/td&gt;&lt;td&gt;"</span>+localStorage.getItem(key)+<span class="string">"&lt;/td&gt;&lt;/tr&gt;"</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[HTML5-使用拖放]]></title>
      <url>http://heji.website/2017/01/06/HTML5-%E4%BD%BF%E7%94%A8%E6%8B%96%E6%94%BE/</url>
      <content type="html"><![CDATA[<p>HTML5添加了对拖放的支持。</p>
<a id="more"></a>
<h3 id="实现简单拖放"><a href="#实现简单拖放" class="headerlink" title="实现简单拖放"></a>实现简单拖放</h3><ul>
<li><p>设置拖放<br>  我们通过draggable属性告诉浏览器文档里的哪些元素可以被拖动。这个属性有三个允许的值：</p>
  <table><tr><td>值</td><td>说明</td></tr><tr><td>true</td><td>此元素能被拖动</td></tr><tr><td>false</td><td>此元素不能被拖动</td></tr><tr><td>auto</td><td>浏览器自主决定某个元素是否能被拖动</td></tr></table>
</li>
<li><p>处理拖动事件<br>  我们通过一系列事件来利用拖放功能。这些事件有的针对被拖动元素，有的针对可能的释放区<br>  <table><tr><td>事件名称</td><td>说明</td></tr><tr><td>dragstart</td><td>在元素开始被拖动时触发</td></tr><tr><td>drag</td><td>在元素被拖动时触发</td></tr><tr><td>dragend</td><td>在拖动操作完成时触发</td></tr></table><br>  下面是简单例子：<br>  <img src="index_files/9a360800-e7bb-4017-8bee-d59d2aea4406.jpg" alt=""></p>
</li>
<li><p>创建释放区<br>  要让某个元素成为释放区，我们需要处理dragenter和dragover事件。它们是针对释放区的其中两个事件。</p>
  <table><tr><td>事件名称</td><td>说明</td></tr><tr><td>dragenter</td><td>当被拖动元素进入释放区所占据的屏幕空间时触发</td></tr><tr><td>dragover</td><td>当被拖动元素在释放区移动时触发</td></tr><tr><td>dragleave</td><td>当被拖动元素没有放下就离开释放区时触发</td></tr><tr><td>drop</td><td>当被拖动元素在释放区放下时触发</td></tr></table>
</li>
<li><p>处理释放事件（简单拖放例子）</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>RunJS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">            <span class="selector-tag">body</span> &gt; *&#123;</div><div class="line">                <span class="attribute">float</span>:left;</div><div class="line">            &#125;</div><div class="line">            <span class="selector-tag">body</span> &gt; <span class="selector-tag">img</span>&#123;</div><div class="line">                <span class="attribute">margin</span>:<span class="number">4px</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="selector-tag">img</span>&#123;</div><div class="line">                <span class="attribute">height</span>:<span class="number">200px</span>;</div><div class="line">                <span class="attribute">width</span>:<span class="number">280px</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="selector-tag">img</span><span class="selector-class">.dragged</span>&#123;</div><div class="line">                <span class="attribute">border</span>:<span class="number">2px</span> solid lightgrey;</div><div class="line">            &#125;</div><div class="line">            <span class="selector-id">#target</span>&#123;</div><div class="line">                <span class="attribute">height</span>:<span class="number">200px</span>;</div><div class="line">                <span class="attribute">width</span>:<span class="number">280px</span>;</div><div class="line">                <span class="attribute">line-height</span>:<span class="number">200px</span>;</div><div class="line">                <span class="attribute">text-align</span>:center;</div><div class="line">                <span class="attribute">border</span>:<span class="number">2px</span> solid <span class="number">#ccc</span>;</div><div class="line">                <span class="attribute">padding</span>:<span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">draggable</span>=<span class="string">"true"</span> <span class="attr">src</span>=<span class="string">"http://sandbox.runjs.cn/uploads/rs/241/haz4fri9/tomato.jpg"</span> <span class="attr">id</span>=<span class="string">"tomato"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">draggable</span>=<span class="string">"true"</span> <span class="attr">src</span>=<span class="string">"http://sandbox.runjs.cn/uploads/rs/241/haz4fri9/orange.jpg"</span> <span class="attr">id</span>=<span class="string">"orange"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">draggable</span>=<span class="string">"true"</span> <span class="attr">src</span>=<span class="string">"http://sandbox.runjs.cn/uploads/rs/241/haz4fri9/strawberry.jpg"</span> <span class="attr">id</span>=<span class="string">"strawberry"</span>/&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"target"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"msg"</span>&gt;</span></div><div class="line">                Drop here!</div><div class="line">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> body = <span class="built_in">document</span>.body;</div><div class="line">            <span class="keyword">var</span> target = <span class="built_in">document</span>.getElementById(<span class="string">"target"</span>);</div><div class="line">            <span class="keyword">var</span> msg = <span class="built_in">document</span>.getElementById(<span class="string">"msg"</span>);</div><div class="line">            <span class="comment">//接收被拖放元素的ID</span></div><div class="line">            <span class="keyword">var</span> draggedId;</div><div class="line">            <span class="comment">//处理拖放事件</span></div><div class="line">            target.ondragcenter = handleDrag;</div><div class="line">            target.ondragover = handleDrag;</div><div class="line">            <span class="comment">//在进入释放区和在释放区移动、释放时要阻止事件的默认行为，否则会发生意料之外的结果</span></div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">handleDrag</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                e.preventDefault();</div><div class="line">            &#125;</div><div class="line">            target.ondrop = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> newElem = <span class="built_in">document</span>.getElementById(draggedId).cloneNode(<span class="literal">false</span>);</div><div class="line">                target.innerHTML = <span class="string">""</span>;</div><div class="line">                target.appendChild(newElem);</div><div class="line">                e.preventDefault();</div><div class="line">            &#125;</div><div class="line">            body.ondragstart = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                draggedId = e.target.id;</div><div class="line">                e.target.classList.add(<span class="string">"dragged"</span>);</div><div class="line">            &#125;</div><div class="line">            body.ondragend = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> elems = <span class="built_in">document</span>.querySelectorAll(<span class="string">".dragged"</span>);</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; elems.length ; i++ )&#123;</div><div class="line">                    elems[i].classList.remove(<span class="string">"dragged"</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  效果请查看：<a href="http://runjs.cn/detail/3oiwealn" target="_blank" rel="external">简单拖放</a></p>
</li>
</ul>
<h3 id="使用DataTransfer对象"><a href="#使用DataTransfer对象" class="headerlink" title="使用DataTransfer对象"></a>使用DataTransfer对象</h3><p>与拖放操作所触发的事件同时派发的对象是DragEvent，它派生于MouseEvent，并增加了额外的属性：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>dataTransfer</td>
<td>返回用于传输数据到释放区的对象</td>
<td>DataTransfer</td>
</tr>
</tbody>
</table>
<p>我们可以用DataTransfer对象从被拖动元素传输任意数据到释放区元素上。DataTransfer定义的属性和方法如下表：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>types</td>
<td>返回数据的格式</td>
<td>字符串数组</td>
</tr>
<tr>
<td>getData（format）</td>
<td>返回指定格式的数据</td>
<td>字符串</td>
</tr>
<tr>
<td>setData(format，data)</td>
<td>设置指定格式的数据</td>
<td>void</td>
</tr>
<tr>
<td>clearData(format)</td>
<td>移除指定格式的数据</td>
<td>void</td>
</tr>
<tr>
<td>files</td>
<td>返回已被拖动文件的列表</td>
<td>FileList</td>
</tr>
</tbody>
</table>
<ul>
<li><p>使用DataTransfer对象从被拖动元素传输数据到释放区<br>  <img src="index_files/49ecc187-0389-4dba-8cd3-30e578ec8841.jpg" alt=""><br>  setData方法第一个参数和getData方法的参数指定数据的格式，它只支持两个值：Text和Url。setData方法第二个参数是我们要传输的数据。使用这种方式最大的好处是支持跨不同类型的浏览器，因为拖放功能是集成在操作系统里的。例如我们可以在Chrome浏览器的文档里拖动一个元素，然后再Firefox浏览器的文档里释放它。</p>
</li>
<li><p>拖放文件<br>  上一节介绍了DataTransfer对象有一个files属性返回拖放的File对象的集合。File API是HTML5新增的功能，File对象定义的属性如下<br>  <table><tr><td>名称</td><td>说明</td><td>返回</td></tr><tr><td>name</td><td>获取文件名</td><td>字符串</td></tr><tr><td>type</td><td>获取文件类型，以MIME类型表示</td><td>字符串</td></tr><tr><td>size</td><td>获取文件大小（以字节计算）</td><td>字符串</td></tr></table><br>  下面是拖放文件的例子：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">            <span class="selector-id">#target</span>&#123;</div><div class="line">                <span class="attribute">height</span>: <span class="number">200px</span>;</div><div class="line">                <span class="attribute">line-height</span>: <span class="number">200px</span>;</div><div class="line">                <span class="attribute">text-align</span>: center;</div><div class="line">                <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#e5e5e5</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="selector-tag">p</span>&#123;</div><div class="line">                <span class="attribute">margin</span>: <span class="number">0</span>;</div><div class="line">                <span class="attribute">padding</span>: <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="selector-id">#fileDetail</span>&#123;</div><div class="line">                <span class="attribute">border-collapse</span>: collapse;</div><div class="line">            &#125;</div><div class="line">            <span class="selector-id">#fileDetail</span> <span class="selector-tag">th</span>,<span class="selector-id">#fileDetail</span> <span class="selector-tag">td</span>&#123;</div><div class="line">                <span class="attribute">padding</span>: <span class="number">4px</span>;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"target"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"msg"</span>&gt;</span>Drop here!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">"fileDetail"</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> target = <span class="built_in">document</span>.getElementById(<span class="string">"target"</span>);</div><div class="line">            target.ondragenter = handleDrag;</div><div class="line">            target.ondragover = handleDrag;</div><div class="line">            target.ondrop = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                <span class="built_in">document</span>.getElementById(<span class="string">"msg"</span>).innerHTML = <span class="string">"File dropped"</span>;</div><div class="line">                <span class="comment">//文件</span></div><div class="line">                <span class="keyword">var</span> fileList = e.dataTransfer.files;</div><div class="line">                <span class="keyword">if</span>(fileList.length &gt; <span class="number">0</span>)&#123;</div><div class="line">                    <span class="keyword">var</span> fileDetail = <span class="built_in">document</span>.getElementById(<span class="string">"fileDetail"</span>);</div><div class="line">                    fileDetail.innerHTML = <span class="string">"&lt;tr&gt;&lt;th&gt;文件名称&lt;/th&gt;&lt;th&gt;文件类型&lt;/th&gt;&lt;th&gt;文件大小&lt;/th&gt;&lt;/tr&gt;"</span>;</div><div class="line">                    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; fileList.length ; i++)&#123;</div><div class="line">                        fileDetail.innerHTML += <span class="string">"&lt;tr&gt;&lt;td&gt;"</span>+fileList[i].name+<span class="string">"&lt;/td&gt;&lt;td&gt;"</span>+fileList[i].type+<span class="string">"&lt;/td&gt;&lt;td&gt;"</span>+fileList[i].size+<span class="string">"&lt;/td&gt;&lt;/tr&gt;"</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                e.preventDefault();</div><div class="line">            &#125;</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">handleDrag</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                e.preventDefault();</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  需要注意的是，我们借助DataTransfer对象以及HTML5的FormData对象就能实现拖拽上传文件了：<br>  <img src="index_files/0c8983c5-8f21-4fcd-938c-6bbbd7e7f2c0.jpg" alt=""></p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[HTML5-地理定位]]></title>
      <url>http://heji.website/2017/01/06/HTML5-%E5%9C%B0%E7%90%86%E5%AE%9A%E4%BD%8D/</url>
      <content type="html"><![CDATA[<p>地理定位API不是HTML5规范的一部分，但经常被归组到HTML5相关的新功能中。</p>
<a id="more"></a>
<h3 id="地理定位"><a href="#地理定位" class="headerlink" title="地理定位"></a>地理定位</h3><ul>
<li>使用地理定位<br>  我们通过全局属性navigator.geolocation访问地理定位功能，它返回一个Geolocation对象，下面是这个对象的方法：  <table><tr><td>getCurrentPosition(callback,errorCallback,options)</td><td>获取当前位置</td><td>void</td></tr><tr><td>watchPosition(callback,errorCallback,options)</td><td>开始监控当前位置</td><td>数值</td></tr><tr><td>clearWatch(id)</td><td>停止监控当前位置</td><td>void</td></tr></table></li>
<li>获取当前位置的getCurrentPosition方法<br>  getCurrentPosition方法获取当前位置，方法接受三个参数，第一个是成功之后的回调函数，该函数获得一个表示当前位置的Position对象；第二个参数是定位错误的回调函数，此函数会获得一个PositionError对象；第三个参数是表示地理定位选项的对象。</li>
<li>Position对象<br>  Position对象只有两个属性：coords属性返回一个Coordinates对象，包含当前位置的坐标；timestamp属性返回获取坐标信息的时间戳，下面是Coordinates对象的相关属性：  <table><tr><td>名称</td><td>说明</td><td>返回</td></tr><tr><td>latitude</td><td>返回由十进制表示的纬度</td><td>数值</td></tr><tr><td>longitude</td><td>返回由十进制表示的经度</td><td>数值</td></tr><tr><td>altitude</td><td>返回用米表示的海拔高度</td><td>数值</td></tr><tr><td>accuracy</td><td>返回用米表示的坐标精度</td><td>数值</td></tr><tr><td>altitudeAccuracy</td><td>返回用米表示的海拔精度</td><td>数值</td></tr><tr><td>heading</td><td>返回用度表示的前进方向</td><td>数值</td></tr><tr><td>speed</td><td>返回用米/秒表示的行进速度</td><td>数值</td></tr></table></li>
<li>PositionError对象<br>  PositionError对象只有两个属性：code属性返回代表错误类型的代码；message返回描述错误的字符串。<br>  <img src="index_files/299dee61-9d17-4060-97eb-4c2f39a52ae1.jpg" alt=""></li>
<li>指定地理定位选项<br>  <img src="index_files/2909d3e9-5724-4d45-a476-5329b8ba18a1.jpg" alt=""></li>
<li><p>地理定位综合例子：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">            <span class="selector-tag">table</span>&#123;</div><div class="line">                <span class="attribute">border-collapse</span>: collapse;</div><div class="line">            &#125;</div><div class="line">            <span class="selector-tag">table</span> <span class="selector-tag">td</span>&#123;</div><div class="line">                <span class="attribute">padding</span>: <span class="number">4px</span>;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>Longitude<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">id</span>=<span class="string">"longitude"</span>&gt;</span>-<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>Latitude<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">id</span>=<span class="string">"latitude"</span>&gt;</span>-<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>Altitude<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">id</span>=<span class="string">"altitude"</span>&gt;</span>-<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>Accuracy<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">id</span>=<span class="string">"accuracy"</span>&gt;</span>-<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>Altitude Accuracy<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">id</span>=<span class="string">"altitudeAccuracy"</span>&gt;</span>-<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>Heading<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">id</span>=<span class="string">"heading"</span>&gt;</span>-<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>Speed<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">id</span>=<span class="string">"speed"</span>&gt;</span>-<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>Time Stamp<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">id</span>=<span class="string">"timestamp"</span>&gt;</span>-<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>Error Code<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">id</span>=<span class="string">"errorcode"</span>&gt;</span>-<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span>&gt;</span>Error Message<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">id</span>=<span class="string">"errormessage"</span>&gt;</span>-<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> options = &#123;</div><div class="line">                enableHighAccuracy:<span class="literal">false</span>,</div><div class="line">                timeout:<span class="number">2000</span>,</div><div class="line">                maximumAge:<span class="number">30000</span></div><div class="line">            &#125;</div><div class="line">            navigator.geolocation.getCurrentPosition(displayPosition,handleError,options);</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">displayPosition</span>(<span class="params">pos</span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> properties = [<span class="string">"longitude"</span>,<span class="string">"latitude"</span>,<span class="string">"altitude"</span>,<span class="string">"accuracy"</span>,<span class="string">"altitudeAccuracy"</span>,<span class="string">"heading"</span>,<span class="string">"speed"</span>];</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; properties.length ; i++)&#123;</div><div class="line">                    <span class="keyword">var</span> value = pos.coords[properties[i]];</div><div class="line">                    <span class="built_in">document</span>.getElementById(properties[i]).innerHTML = value;</div><div class="line">                &#125;</div><div class="line">                <span class="built_in">document</span>.getElementById(<span class="string">"timestamp"</span>).innerHTML = pos.timestamp;</div><div class="line">            &#125;</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">handleError</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                <span class="built_in">document</span>.getElementById(<span class="string">"errorcode"</span>).innerHTML = e.code;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>监控位置<br>  可以用<code>watchPosition</code>方法不断获得关于位置的更新。这个方法所需的参数和<code>getCurrentPosition</code>方法相同，工作方式也一样。它们的区别在于：随着位置发生改变，回调函数会被反复地调用。<br>  如果想要停止监控，可以把<code>navigator.geolocation.watchPosition</code>方法返回的ID值传给<code>clearWatch</code>方法。</p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[创建离线Web应用程序]]></title>
      <url>http://heji.website/2017/01/06/%E5%88%9B%E5%BB%BA%E7%A6%BB%E7%BA%BFWeb%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/</url>
      <content type="html"><![CDATA[<p>离线应用程序缓存功能允许我们指定Web应用程序所需的全部资源，这样浏览器就能在加载HTML文档时把他们都下载下来。通过这种方式，用户即使无法访问网络也能继续使用我们的应用程序。</p>
<a id="more"></a>
<h3 id="离线Web应用程序"><a href="#离线Web应用程序" class="headerlink" title="离线Web应用程序"></a>离线Web应用程序</h3><h4 id="定义清单"><a href="#定义清单" class="headerlink" title="定义清单"></a>定义清单</h4><p>清单（manifest）允许我们列出离线工作所需的全部资源。<br>清单文件是一个简单的文本文件。第一行始终是CACHE MANIFEST，然后我们再列出应用程序所需的资源，每个文本行列一个。<br>清单文件没有固定的命名方案，但是.appcache是最常用的。我把清单文件保存为<code>demo.appcache</code><br>manifest的典型结构:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">CACHE MANIFEST</div><div class="line"># 注释：需要缓存的文件，无论在线与否，均从缓存里读取</div><div class="line">CACHE:</div><div class="line">img/orange.jpg</div><div class="line">img/tomato.jpg</div><div class="line">img/strawberry.jpg</div><div class="line"></div><div class="line"># 注释：不缓存的文件，无论缓存中存在与否，均重新获取</div><div class="line">NETWORK:</div><div class="line">uncached.js</div><div class="line">uncached.css</div><div class="line"></div><div class="line"># 注释：获取不到资源时的备选路径，如访问资源失败，则返回pages/offline.html页面</div><div class="line"># 我们不需要在清单里的CACHE区域添加备用资源，因为浏览器会自动下载备用资源</div><div class="line">FALLBACK:</div><div class="line">*.jpg img/404.jpg</div><div class="line">* pages/offline.html</div></pre></td></tr></table></figure></p>
<h4 id="使用清单"><a href="#使用清单" class="headerlink" title="使用清单"></a>使用清单</h4><p>在文档中添加给html元素添加<code>manifest</code>属性即可使用清单，如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">manifest</span>=<span class="string">"demo.appcache"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"initial-scale=1.0, maximum-scale=1.0, user-scalable=no"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h4 id="监测浏览器状态"><a href="#监测浏览器状态" class="headerlink" title="监测浏览器状态"></a>监测浏览器状态</h4><table>
<thead>
<tr>
<th>用法</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>window.navigator.onLine</td>
<td>如果确定为离线返回false，如果不能确定是否离线，返回true</td>
<td>布尔值</td>
</tr>
</tbody>
</table>
<h4 id="使用离线缓存"><a href="#使用离线缓存" class="headerlink" title="使用离线缓存"></a>使用离线缓存</h4><p>可以通过<code>window.applicationCache</code>属性使用离线缓存。该属性返回一个<code>ApplicationCache</code>对象。<code>ApplicationCache</code>对象的属性或方法有：</p>
<table>
<thead>
<tr>
<th>成员</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>update()</td>
<td>更新缓存文件确保清单里的文件都下载了最新版本</td>
<td>void</td>
</tr>
<tr>
<td>swapCache()</td>
<td>交换当前缓存与较新的缓存</td>
<td>void</td>
</tr>
<tr>
<td>status</td>
<td>返回缓存的状态</td>
<td>数值</td>
</tr>
</tbody>
</table>
<p>status属性值如下：<br><img src="index_files/4b418b8d-7556-43d1-8a66-e4a6e6ab65b1.jpg" alt=""><br>除了这些方法和属性之外，ApplicationCache对象还定义了一组事件，它们在缓存状态改变时触发。<br><img src="index_files/c2711092-01a2-4f85-aade-643a9d394d92.jpg" alt=""><br>我们可以结合这些方法与status属性的值来显式控制离线缓存。</p>
<ul>
<li><p>制作更新<br>  替换缓存清单上指定的缓存文件（不要修改文件名），修改清单文件（清单文件必须改动浏览器才会下载更新，可以加个空格）</p>
</li>
<li><p>获取更新<br>  调用update()方法，获取更新，此时status属性变为UPDATEREADY。此时，浏览器已经下载了修改过的内容，但更新还未被应用到我们正在使用的缓存中。</p>
</li>
<li><p>应用更新<br>  调用swapCache()方法，更新的内容被应用到应用程序的离线缓存中。</p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[HTML5-Canvas入门]]></title>
      <url>http://heji.website/2017/01/03/HTML5-canvas/</url>
      <content type="html"><![CDATA[<p>canvas是HTML5定义的一种可供绘图的元素，我们用JavaScript对它进行配置和操作。它很灵活，相对容易使用，并且提供了足够多的功能来代替flash制作某些类型的富内容。</p>
<a id="more"></a>
<h3 id="开始使用（绘制矩形）"><a href="#开始使用（绘制矩形）" class="headerlink" title="开始使用（绘制矩形）"></a>开始使用（绘制矩形）</h3><p>canvas元素只有height和width两个属性，元素里的内容会在浏览器不支持此元素时作为备用内容显示。当我们使用JavaScript获取该元素时，返回一个HTMLCanvasElement对象，下面是这个对象的成员：</p>
<table>
<thead>
<tr>
<th>成员</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>height</td>
<td>对应于height属性</td>
<td>数值</td>
</tr>
<tr>
<td>width</td>
<td>对应于width属性</td>
<td>数值</td>
</tr>
<tr>
<td>getContext(context)</td>
<td>为画布返回绘图上下文</td>
<td>对象</td>
</tr>
</tbody>
</table>
<p>其中关键的方法是getContext。为了获得二维上下文对象，我们需要给这个方法传递参数2d。一旦得到这个上下文，就可以开始绘图了。下面是例子：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>canvas<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></div><div class="line">            <span class="selector-tag">canvas</span>&#123;</div><div class="line">                <span class="attribute">border</span>:medium double black;</div><div class="line">                <span class="attribute">margin</span>:<span class="number">4px</span>;</div><div class="line">                <span class="attribute">background</span>:<span class="number">#fff</span>;</div><div class="line">             &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span> <span class="attr">width</span>=<span class="string">"600"</span> <span class="attr">height</span>=<span class="string">"300"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>).getContext(<span class="string">"2d"</span>);</div><div class="line">            <span class="keyword">var</span> count = <span class="number">5</span>;</div><div class="line">            <span class="keyword">var</span> offset = <span class="number">10</span>;</div><div class="line">            <span class="keyword">var</span> size = <span class="number">50</span>;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; count ; i++)&#123;</div><div class="line">                ctx.fillRect((offset+size) * i + offset, offset,size,size);</div><div class="line">                ctx.strokeRect((offset+size) * i + offset,<span class="number">2</span> * offset+size,size,size);</div><div class="line">&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>效果查看<a href="http://runjs.cn/detail/emf7ixzw" title="绘制矩形" target="_blank" rel="external">绘制矩形</a><br>绘制矩形的相关方法：</p>
<table>
<thead>
<tr>
<th>成员</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>clearRect(x,y,w,h)</td>
<td>清除指定的矩形</td>
<td>void</td>
</tr>
<tr>
<td>fillRect(x,y,w,h)</td>
<td>绘制一个实心矩形</td>
<td>void</td>
</tr>
<tr>
<td>strokeRect(x,y,w,h)</td>
<td>绘制一个空心矩形</td>
<td>void</td>
</tr>
</tbody>
</table>
<h3 id="设置画布绘制状态"><a href="#设置画布绘制状态" class="headerlink" title="设置画布绘制状态"></a>设置画布绘制状态</h3><p>绘图操作由绘制状态加以配置。后者是一组属性，指定了从线条宽度到填充色的所有参数。当我们绘制一个图形时，就会用到绘制状态的当前设置。下面是一个示例：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span> <span class="attr">width</span>=<span class="string">"600"</span> <span class="attr">height</span>=<span class="string">"400"</span>&gt;</span></div><div class="line">            Your browser doesn't support the <span class="tag">&lt;<span class="name">code</span>&gt;</span>canvas<span class="tag">&lt;/<span class="name">code</span>&gt;</span> element.</div><div class="line">        <span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>).getContext(<span class="string">"2d"</span>);</div><div class="line">            ctx.lineWidth = <span class="number">2</span>;</div><div class="line">            ctx.strokeRect(<span class="number">10</span>,<span class="number">10</span>,<span class="number">50</span>,<span class="number">50</span>);</div><div class="line">            ctx.lineWidth = <span class="number">4</span>;</div><div class="line">            ctx.strokeRect(<span class="number">70</span>,<span class="number">10</span>,<span class="number">50</span>,<span class="number">50</span>);</div><div class="line">            ctx.lineWidth = <span class="number">6</span>;</div><div class="line">            ctx.strokeRect(<span class="number">130</span>,<span class="number">10</span>,<span class="number">50</span>,<span class="number">50</span>);</div><div class="line">            ctx.lineWidth = <span class="number">6</span>;</div><div class="line">            ctx.strokeRect(<span class="number">190</span>,<span class="number">10</span>,<span class="number">50</span>,<span class="number">50</span>);</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>当我使用strokeRect方法时，lineWidth属性的当前值就会用于绘制矩形。下表展示了基本的绘制状态属性，还有一些属性在更高级的功能会用到：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>取值</th>
</tr>
</thead>
<tbody>
<tr>
<td>fillStyle</td>
<td>获取或设置用于实心图形的样式</td>
<td>颜色值（默认black)、渐变对象、pattern对象</td>
</tr>
<tr>
<td>lineJoin</td>
<td>获取或设置线条与图形连接时的样式</td>
<td>round（圆角）、bevel（棱角）、miter（尖角，默认值）</td>
</tr>
<tr>
<td>lineWidth</td>
<td>获取或设置线条的宽度</td>
<td>数值（默认1.0）</td>
</tr>
<tr>
<td>strokeStyle</td>
<td>获取或设置用于线条的样式</td>
<td>颜色值（默认black)、渐变对象、pattern对象</td>
</tr>
</tbody>
</table>
<ul>
<li>设置线条连接样式<br>  lineJoin属性决定了相互连接的线条应该如何绘制，它有三个值：round（圆角）、bevel（棱角）、miter（尖角）。</li>
<li>设置填充和笔触（线条）样式<br>  改变fillStyle属性即改变填充的颜色，改变strokeStyle即改变笔触颜色。请自行尝试</li>
<li><p>使用渐变<br>  除了纯色，我们还可以把填充和笔触样式设置成渐变色。渐变是两种或更多颜色之间的渐进转变。canvas元素支持两类渐变：线性和径向。<br>  <img src="index_files/747b771f-1a98-4e49-a026-33f28a4db686.jpg" alt=""><br>  两个方法都返回一个CanvasGradient对象。<br>  <img src="index_files/14b03ee5-e1e0-4f3c-acd7-67ec76eec353.jpg" alt=""><br>  下面是线性渐变的例子：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>gradient<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span> <span class="attr">width</span>=<span class="string">"500"</span> <span class="attr">height</span>=<span class="string">"140"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  效果请查看：<a href="http://runjs.cn/detail/dewufwgo" title="线性渐变效果" target="_blank" rel="external">线性渐变效果</a><br>  也可以设置渐变在一个小矩形范围内。<br>  <img src="index_files/ab7cd8d7-5182-40ec-a03c-722bd97f2435.jpg" alt=""><br>  效果为<br>  <img src="index_files/d576630a-a6da-48f8-b41f-d5130d3e40e2.jpg" alt=""><br>  下面是径向渐变的例子：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>RunJS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span> <span class="attr">height</span>=<span class="string">"200"</span> <span class="attr">width</span>=<span class="string">"500"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">          <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>).getContext(<span class="string">"2d"</span>);</div><div class="line">          <span class="comment">//第一第二个参数是起点圆的圆心坐标，第三个参数是起点圆的半径。第四第五个参数是终点圆的圆心坐标，第六个参数是终点圆的半径</span></div><div class="line">          <span class="keyword">var</span> grad = ctx.createRadialGradient(<span class="number">250</span>,<span class="number">70</span>,<span class="number">20</span>,<span class="number">200</span>,<span class="number">60</span>,<span class="number">80</span>);</div><div class="line">grad.addColorStop(<span class="number">0</span>,<span class="string">"#f00"</span>);</div><div class="line">grad.addColorStop(<span class="number">0.5</span>,<span class="string">"#fff"</span>);</div><div class="line">grad.addColorStop(<span class="number">1</span>,<span class="string">"#000"</span>);</div><div class="line">ctx.fillStyle = grad;</div><div class="line">ctx.fillRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">500</span>,<span class="number">160</span>);</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  效果请查看<a href="http://runjs.cn/detail/nihv4gh9" target="_blank" rel="external">径向渐变效果</a><br>  一般而言，径向渐变的终点圆要包含起点圆，当我们给这个渐变添加颜色点时，它们会被放置在起点圆边界（该点的值为0）和终点圆边界（该点的值为1）之间的一条线段上。若终点圆没有包含起点圆，结果会很混乱。</p>
</li>
<li>使用图案<br>  除了纯色和渐变之外，我们还可以创建图案（pattern）。具体做法是使用画布上下文对象所定义的createPattern方法。2D绘图上下文定义了对三种图案类型的支持：图形、视频和画布。<br>  要将图像作为图案，需要把一个HTMLImageElement对象作为第一个参数传递给createPattern方法，第二个参数是重复样式。下面是综合例子：  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">hidden</span>=<span class="string">""</span> <span class="attr">src</span>=<span class="string">"http://www.w3school.com.cn/i/lamp.gif"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span> <span class="attr">width</span>=<span class="string">"500"</span> <span class="attr">height</span>=<span class="string">"300"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="comment">//注意,一定要在DOM加载完之后,否则创建pattern会失败</span></div><div class="line">                <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>);</div><div class="line">                <span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</div><div class="line">                ctx.clearRect(<span class="number">0</span>,<span class="number">0</span>,canvas.width,canvas.height);</div><div class="line">                <span class="keyword">var</span> imgElem = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"img"</span>)[<span class="number">0</span>];</div><div class="line">                <span class="keyword">var</span> pattern = ctx.createPattern(imgElem,<span class="string">"repeat"</span>);</div><div class="line">                ctx.fillStyle = pattern;</div><div class="line">                ctx.fillRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">500</span>,<span class="number">300</span>);</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="保存和恢复绘制状态"><a href="#保存和恢复绘制状态" class="headerlink" title="保存和恢复绘制状态"></a>保存和恢复绘制状态</h3><p>可以用下表介绍的方法保存绘制状态，稍后再返回。</p>
<table>
<thead>
<tr>
<th>值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>save()</td>
<td>保存绘制状态属性的值，并把它们推入状态栈</td>
</tr>
<tr>
<td>restore()</td>
<td>取出状态栈的第一组值，用它们来设置绘制状态</td>
</tr>
</tbody>
</table>
<p>绘制状态保存时会被存放在一个后进先出的栈中，意思是我们用save方法最后保存的状态会被restore方法首先进行恢复。</p>
<h3 id="绘制图像"><a href="#绘制图像" class="headerlink" title="绘制图像"></a>绘制图像</h3><p>可以用drawImage方法在画布上绘制图像。这个方法需要三个、五个或者九个参数。第一个参数始终是图像的来源，它可以是代表img、video、或者其他canvas元素的DOM对象。</p>
<ul>
<li><p>使用图片图像：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">            <span class="selector-tag">canvas</span>&#123;</div><div class="line">                <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">hidden</span>=<span class="string">""</span> <span class="attr">src</span>=<span class="string">"http://www.w3school.com.cn/i/lamp.gif"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span> <span class="attr">width</span>=<span class="string">"500"</span> <span class="attr">height</span>=<span class="string">"300"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>).getContext(<span class="string">"2d"</span>);</div><div class="line">                <span class="keyword">var</span> imageElem = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"img"</span>)[<span class="number">0</span>];</div><div class="line">                <span class="comment">//当只有三个参数时,第二三个参数指定图像开始绘制的坐标,绘制的图像大小为原始大小</span></div><div class="line">                ctx.drawImage(imageElem,<span class="number">10</span>,<span class="number">10</span>);</div><div class="line">                <span class="comment">//当只有五个参数时,第二三个参数指定图像开始绘制的坐标,第四五个参数指定绘制图像的大小</span></div><div class="line">                ctx.drawImage(imageElem,<span class="number">50</span>,<span class="number">10</span>,<span class="number">50</span>,<span class="number">50</span>);</div><div class="line">                <span class="comment">//当有九个参数时,请自行谷歌</span></div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>使用视频图像<br>  当图像的来源是video时，这样做其实是对视频的当前帧进行截图。</p>
</li>
<li>使用画布图像  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">            <span class="selector-tag">body</span> &gt; *&#123;</div><div class="line">                <span class="attribute">float</span>: left;</div><div class="line">            &#125;</div><div class="line">            <span class="selector-tag">canvas</span>&#123;</div><div class="line">                <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#e5e5e5</span>;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">"vid"</span> <span class="attr">width</span>=<span class="string">"800"</span> <span class="attr">height</span>=<span class="string">"400"</span> <span class="attr">hidden</span>=<span class="string">""</span> <span class="attr">src</span>=<span class="string">"../img/Clip_1080_5sec_10mbps_h264.mp4"</span>&gt;</span></div><div class="line">            当前浏览器不支持 video直接播放</div><div class="line">        <span class="tag">&lt;/<span class="name">video</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas1"</span> <span class="attr">width</span>=<span class="string">"360"</span> <span class="attr">height</span>=<span class="string">"240"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"pressme"</span>&gt;</span>点击我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas2"</span> <span class="attr">width</span>=<span class="string">"360"</span> <span class="attr">height</span>=<span class="string">"240"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> srcCanvasElem = <span class="built_in">document</span>.getElementById(<span class="string">"canvas1"</span>);</div><div class="line">            <span class="keyword">var</span> srcCtx = srcCanvasElem.getContext(<span class="string">"2d"</span>);</div><div class="line">            <span class="keyword">var</span> targetCanvasElem = <span class="built_in">document</span>.getElementById(<span class="string">"canvas2"</span>).getContext(<span class="string">"2d"</span>);</div><div class="line">            <span class="keyword">var</span> videoElem = <span class="built_in">document</span>.getElementById(<span class="string">"vid"</span>);</div><div class="line">            targetCanvasElem.strokeStyle = <span class="string">"black"</span>;</div><div class="line">            targetCanvasElem.lineWidth = <span class="number">10</span>;</div><div class="line">            <span class="keyword">var</span> width = <span class="number">100</span>;</div><div class="line">            <span class="keyword">var</span> height = <span class="number">10</span>;</div><div class="line">            srcCtx.lineWidth = <span class="number">5</span>;</div><div class="line">            srcCtx.strokeStyle = <span class="string">"red"</span>;</div><div class="line">            setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                srcCtx.drawImage(videoElem,<span class="number">0</span>,<span class="number">0</span>,<span class="number">360</span>,<span class="number">240</span>);</div><div class="line">                srcCtx.strokeRect(<span class="number">180</span>-(width/<span class="number">2</span>),<span class="number">120</span> - (height/<span class="number">2</span>),width,height);</div><div class="line">            &#125;,<span class="number">25</span>);</div><div class="line">            setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                width = (width + <span class="number">1</span>) % <span class="number">200</span>;</div><div class="line">                height = (height + <span class="number">3</span>) % <span class="number">200</span>;</div><div class="line">            &#125;,<span class="number">100</span>)</div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">"pressme"</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                targetCanvasElem.drawImage(srcCanvasElem,<span class="number">0</span>,<span class="number">0</span>,<span class="number">360</span>,<span class="number">240</span>);</div><div class="line">                targetCanvasElem.strokeRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">360</span>,<span class="number">240</span>);</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="用路径绘图（重要）"><a href="#用路径绘图（重要）" class="headerlink" title="用路径绘图（重要）"></a>用路径绘图（重要）</h3><p>之前的示例都依靠绘制矩形实现，矩形是一种有用的图形，但有时我们需要用到的是其他图形。对此，canvas提供了路径绘图。下面是绘制基本路径的可用方法：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>beginPath()</td>
<td>开始一条新路径</td>
<td>void</td>
</tr>
<tr>
<td>closePath()</td>
<td>尝试闭合现有路径（做法是绘制一条线，连接最后那条线的终点与初始坐标）</td>
<td>void</td>
</tr>
<tr>
<td>fill()</td>
<td>填充用子路径描述的图形</td>
<td>void</td>
</tr>
<tr>
<td>isPointInPath(x,y)</td>
<td>如果指定的点在当前路径所描述的图形之内则返回true</td>
<td>布尔值</td>
</tr>
<tr>
<td>lineTo(x,y)</td>
<td>绘制一条到指定坐标的子路径</td>
<td>void</td>
</tr>
<tr>
<td>moveTo(x,y)</td>
<td>移动到指定坐标而不绘制子路径</td>
<td>void</td>
</tr>
<tr>
<td>rect(x,y,w,h)</td>
<td>绘制一个矩形</td>
<td>void</td>
</tr>
<tr>
<td>stroke()</td>
<td>给子路径描述的图形绘制轮廓</td>
<td>void</td>
</tr>
</tbody>
</table>
<p>绘制一条路径的基本顺序如下：</p>
<ol>
<li>调用beginPath方法；</li>
<li>调用moveTo方法移动到起点；</li>
<li>用arc和lineTo等方法绘制子路径；</li>
<li>调用closePath方法（可选）；</li>
<li>调用fill或stroke方法。</li>
</ol>
<p>下面是综合示例：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span> <span class="attr">width</span>=<span class="string">"400"</span> <span class="attr">height</span>=<span class="string">"300"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>).getContext(<span class="string">"2d"</span>);</div><div class="line">            ctx.beginPath();</div><div class="line">            ctx.lineWidth = <span class="number">1</span>;</div><div class="line">            ctx.moveTo(<span class="number">10</span>,<span class="number">10</span>);</div><div class="line">            ctx.lineTo(<span class="number">60</span>,<span class="number">10</span>);</div><div class="line">            ctx.lineTo(<span class="number">60</span>,<span class="number">60</span>);</div><div class="line">            ctx.closePath();</div><div class="line">            ctx.fillStyle = <span class="string">"red"</span>;</div><div class="line">            ctx.fill();</div><div class="line">            </div><div class="line">            ctx.beginPath();</div><div class="line">            ctx.lineWidth = <span class="number">2</span>;</div><div class="line">            ctx.moveTo(<span class="number">70</span>,<span class="number">10</span>);</div><div class="line">            ctx.lineTo(<span class="number">170</span>,<span class="number">10</span>);</div><div class="line">            ctx.lineTo(<span class="number">170</span>,<span class="number">100</span>);</div><div class="line">            ctx.lineTo(<span class="number">150</span>,<span class="number">100</span>);</div><div class="line">            ctx.fillStyle = <span class="string">"red"</span>;</div><div class="line">            ctx.fill();</div><div class="line">            ctx.strokeStyle= <span class="string">"black"</span>;</div><div class="line">            <span class="comment">//若不关闭路径,那么绘制的轮廓不闭合</span></div><div class="line">            ctx.stroke();</div><div class="line">            </div><div class="line">            ctx.lineWidth = <span class="number">30</span>;</div><div class="line">            ctx.beginPath();</div><div class="line">            <span class="comment">//设置线条末端样式,默认是butt</span></div><div class="line">            ctx.lineCap = <span class="string">"butt"</span></div><div class="line">            ctx.moveTo(<span class="number">200</span>,<span class="number">10</span>);</div><div class="line">            ctx.lineTo(<span class="number">200</span>,<span class="number">100</span>);</div><div class="line">            ctx.stroke();</div><div class="line">            </div><div class="line">            ctx.beginPath();</div><div class="line">            <span class="comment">//设置线条末端样式,默认是butt</span></div><div class="line">            ctx.lineCap = <span class="string">"round"</span></div><div class="line">            ctx.moveTo(<span class="number">240</span>,<span class="number">20</span>);</div><div class="line">            ctx.lineTo(<span class="number">240</span>,<span class="number">100</span>);</div><div class="line">            ctx.stroke();</div><div class="line">            </div><div class="line">            ctx.beginPath();</div><div class="line">            <span class="comment">//设置线条末端样式,默认是butt</span></div><div class="line">            ctx.lineCap = <span class="string">"square"</span></div><div class="line">            ctx.moveTo(<span class="number">280</span>,<span class="number">20</span>);</div><div class="line">            ctx.lineTo(<span class="number">280</span>,<span class="number">100</span>);</div><div class="line">            ctx.stroke();</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<ul>
<li>绘制矩形<br>  rect方法会给当前路径添加一条矩形的子路径。如果需要一个单独的矩形，之前介绍的fillRect和strokeRect方法是更合适的选择。  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span> <span class="attr">width</span>=<span class="string">"400"</span> <span class="attr">height</span>=<span class="string">"300"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>).getContext(<span class="string">"2d"</span>);</div><div class="line">            ctx.fillStyle = <span class="string">"red"</span>;</div><div class="line">            ctx.strokeStyle = <span class="string">"black"</span>;</div><div class="line">            ctx.beginPath();</div><div class="line">            ctx.moveTo(<span class="number">10</span>,<span class="number">10</span>);</div><div class="line">            ctx.lineTo(<span class="number">100</span>,<span class="number">10</span>);</div><div class="line">            ctx.lineTo(<span class="number">100</span>,<span class="number">100</span>);</div><div class="line">            ctx.closePath();</div><div class="line">            <span class="comment">//绘制矩形</span></div><div class="line">            ctx.rect(<span class="number">100</span>,<span class="number">10</span>,<span class="number">100</span>,<span class="number">90</span>);</div><div class="line">            ctx.rect(<span class="number">100</span>,<span class="number">100</span>,<span class="number">130</span>,<span class="number">30</span>);</div><div class="line">            <span class="comment">//填充颜色</span></div><div class="line">            ctx.fill();</div><div class="line">            <span class="comment">//绘制轮廓</span></div><div class="line">            ctx.stroke();</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="绘制圆弧"><a href="#绘制圆弧" class="headerlink" title="绘制圆弧"></a>绘制圆弧</h3><p>我们使用arc和arcTo方法在画布上绘制圆弧，不过这两种方法绘制圆弧的方式会有所不同。</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>arc(x,y,rad,startAngle,endAngle,diretion)</td>
<td>(x,y)指定圆弧的圆心坐标，半径为rad，始角度为startAngle，结束角度为endAngle，可选参数direction指定了圆弧方向</td>
<td>void</td>
</tr>
<tr>
<td>arcTo(x1,y1,x2,y2,rad)</td>
<td>绘制一段半径为rad，经过(x1,y1)，直到(x2,y2)的圆弧</td>
<td>void</td>
</tr>
</tbody>
</table>
<ul>
<li><p>使用arcTo方法：<br>  绘制圆弧的一个复杂例子（移动鼠标看到变换）：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span> <span class="attr">width</span>=<span class="string">"500"</span> <span class="attr">height</span>=<span class="string">"140"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> canvasElem = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>);</div><div class="line">            <span class="keyword">var</span> ctx = canvasElem.getContext(<span class="string">"2d"</span>);</div><div class="line">            </div><div class="line">            <span class="keyword">var</span> point1 = [<span class="number">100</span>,<span class="number">10</span>];</div><div class="line">            <span class="keyword">var</span> point2 = [<span class="number">200</span>,<span class="number">10</span>];</div><div class="line">            <span class="keyword">var</span> point3 = [<span class="number">200</span>,<span class="number">110</span>];</div><div class="line">            </div><div class="line">            draw();</div><div class="line">            canvasElem.onmousemove = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                <span class="keyword">if</span>(e.ctrlKey)&#123;</div><div class="line">                    point1 = [e.clientX,e.clientY];</div><div class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(e.shiftKey)&#123;</div><div class="line">                    point2 = [e.clientX,e.clientY];</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    point3 = [e.clientX,e.clientY];</div><div class="line">                &#125;</div><div class="line">                ctx.clearRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">500</span>,<span class="number">140</span>);</div><div class="line">                draw();</div><div class="line">            &#125;</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                ctx.fillStyle = <span class="string">"yellow"</span>;</div><div class="line">                ctx.strokeStyle = <span class="string">"black"</span>;</div><div class="line">                ctx.lineWidth = <span class="number">4</span>;</div><div class="line">                <span class="comment">//绘制圆弧</span></div><div class="line">                ctx.beginPath();</div><div class="line">                ctx.moveTo(point1[<span class="number">0</span>],point1[<span class="number">1</span>]);</div><div class="line">                ctx.arcTo(point2[<span class="number">0</span>],point2[<span class="number">1</span>],point3[<span class="number">0</span>],point3[<span class="number">1</span>],<span class="number">50</span>);</div><div class="line">                ctx.stroke();</div><div class="line">                <span class="comment">//绘制三个点</span></div><div class="line">                drawPoint(point1[<span class="number">0</span>],point1[<span class="number">1</span>]);</div><div class="line">                drawPoint(point2[<span class="number">0</span>],point2[<span class="number">1</span>]);</div><div class="line">                drawPoint(point3[<span class="number">0</span>],point3[<span class="number">1</span>]);</div><div class="line">                <span class="comment">//绘制连接三个点的线</span></div><div class="line">                ctx.beginPath();</div><div class="line">                ctx.moveTo(point1[<span class="number">0</span>],point1[<span class="number">1</span>]);</div><div class="line">                ctx.lineTo(point2[<span class="number">0</span>],point2[<span class="number">1</span>]);</div><div class="line">                ctx.lineTo(point3[<span class="number">0</span>],point3[<span class="number">1</span>]);</div><div class="line">                ctx.stroke();</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//绘制三个点</span></div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">drawPoint</span>(<span class="params">x,y</span>)</span>&#123;</div><div class="line">                ctx.lineWidth = <span class="number">1</span>;</div><div class="line">                ctx.strokeStyle = <span class="string">"red"</span>;</div><div class="line">                ctx.strokeRect(x - <span class="number">2</span>, y - <span class="number">2</span>,<span class="number">4</span>,<span class="number">4</span>);</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  效果请查看<a href="http://runjs.cn/detail/nzicmpmy" target="_blank" rel="external">canvas绘制圆弧</a></p>
</li>
<li><p>使用arc方法<br>  arc方法使用起来略微简单一些。我们用前两个方法参数指定圆的圆心，第三个参数指定圆的半径，第四第五个参数指定起始和结束角度，最后一个参数指定是顺时针还是逆时针。<br>  <img src="index_files/6f623169-16c1-4420-9dbf-e1d56096aa1e.png" alt=""><br>  上图的开始角度为0，结束角度为1.5PI，方向为顺时针。<code>arc(100,75,50,0,1.5*Math.PI,false);</code></p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span> <span class="attr">width</span>=<span class="string">"500"</span> <span class="attr">height</span>=<span class="string">"200"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>).getContext(<span class="string">"2d"</span>);</div><div class="line">            ctx.strokeStyle = <span class="string">"black"</span>;</div><div class="line">            ctx.fillStyle = <span class="string">"steelblue"</span>;</div><div class="line">            ctx.beginPath();</div><div class="line">            <span class="comment">//圆心x,圆心y,半径,开始角度,结束角度,逆时针</span></div><div class="line">            ctx.arc(<span class="number">100</span>,<span class="number">100</span>,<span class="number">60</span>,<span class="number">0</span>,<span class="built_in">Math</span>.PI * <span class="number">2</span>,<span class="literal">true</span>);</div><div class="line">            ctx.fill();</div><div class="line">            ctx.stroke();</div><div class="line">            <span class="comment">//必须重新开始路径,否则会连在一起</span></div><div class="line">            ctx.beginPath();</div><div class="line">            ctx.arc(<span class="number">230</span>,<span class="number">100</span>,<span class="number">60</span>,<span class="built_in">Math</span>.PI * <span class="number">0.5</span>,<span class="built_in">Math</span>.PI ,<span class="literal">true</span>);</div><div class="line">            ctx.closePath();</div><div class="line">            ctx.fill();</div><div class="line">            ctx.stroke();</div><div class="line">            <span class="comment">//绘制不规则图形</span></div><div class="line">            ctx.beginPath();</div><div class="line">            <span class="keyword">var</span> val = <span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; <span class="number">4</span> ; i++)&#123;</div><div class="line">                ctx.arc(<span class="number">370</span>,<span class="number">100</span>,<span class="number">60</span>,val,val+<span class="built_in">Math</span>.PI/<span class="number">4</span>,<span class="literal">false</span>);</div><div class="line">                val+=<span class="built_in">Math</span>.PI/<span class="number">2</span>;</div><div class="line">            &#125;</div><div class="line">            ctx.closePath();</div><div class="line">            ctx.fill();</div><div class="line">            ctx.stroke();</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  效果请查看：<a href="http://runjs.cn/detail/bjlt1baj" target="_blank" rel="external">arc方法绘制圆弧</a></p>
</li>
</ul>
<h3 id="绘制贝塞尔曲线"><a href="#绘制贝塞尔曲线" class="headerlink" title="绘制贝塞尔曲线"></a>绘制贝塞尔曲线</h3><p>canvas支持绘制两种贝塞尔曲线：三次和二次。我们通过选择一个起点和终点，然后添加一个或多个控制点来形成曲线。下面的表格展示了绘制贝塞尔曲线的方法：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>bezierCurveTo(cx1,cy1,cx2,cy2,x,y)</td>
<td>绘制一段贝塞尔曲线到（x,y），控制点为（cx1,cy1）和（cx2,cy2）。</td>
<td>void</td>
</tr>
<tr>
<td>quadraticCurveTo(cx,cy,x,y)</td>
<td>绘制一段二次贝塞尔曲线到点（x,y），控制点为（cx,cy）</td>
<td>void</td>
</tr>
</tbody>
</table>
<p>下面是三次贝塞尔曲线的示例：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span> <span class="attr">width</span>=<span class="string">"500"</span> <span class="attr">height</span>=<span class="string">"300"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> canvasElem = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>);</div><div class="line">            <span class="keyword">var</span> ctx = canvasElem.getContext(<span class="string">"2d"</span>);</div><div class="line">            <span class="comment">//初始点</span></div><div class="line">            <span class="keyword">var</span> startPoint = [<span class="number">50</span>,<span class="number">100</span>];</div><div class="line">            <span class="keyword">var</span> endPoint = [<span class="number">400</span>,<span class="number">100</span>];</div><div class="line">            <span class="keyword">var</span> cp1 = [<span class="number">250</span>,<span class="number">50</span>];</div><div class="line">            <span class="keyword">var</span> cp2 = [<span class="number">350</span>,<span class="number">50</span>];</div><div class="line">            </div><div class="line">            canvasElem.onmousemove = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                <span class="keyword">if</span>(e.shiftKey)&#123;</div><div class="line">                    <span class="comment">//当按下shift键,移动控制点1</span></div><div class="line">                    cp1 = [e.clientX,e.clientY];</div><div class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(e.ctrlKey)&#123;</div><div class="line">                    <span class="comment">//当按下ctrl键,移动控制点2</span></div><div class="line">                    cp2 = [e.clientX,e.clientY];</div><div class="line">                &#125;</div><div class="line">                <span class="comment">//清除画布</span></div><div class="line">                ctx.clearRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">500</span>,<span class="number">300</span>);</div><div class="line">                <span class="comment">//画图</span></div><div class="line">                draw();</div><div class="line">            &#125;</div><div class="line">            draw();</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                ctx.lineWidth = <span class="number">3</span>;</div><div class="line">                ctx.strokeStyle = <span class="string">"black"</span>;</div><div class="line">                ctx.beginPath();</div><div class="line">                ctx.moveTo(startPoint[<span class="number">0</span>],startPoint[<span class="number">1</span>]);</div><div class="line">                ctx.bezierCurveTo(cp1[<span class="number">0</span>],cp1[<span class="number">1</span>],cp2[<span class="number">0</span>],cp2[<span class="number">1</span>],endPoint[<span class="number">0</span>],endPoint[<span class="number">1</span>]);</div><div class="line">                ctx.stroke();</div><div class="line">                <span class="comment">//绘制点</span></div><div class="line">                ctx.lineWidth = <span class="number">1</span>;</div><div class="line">                ctx.strokeStyle = <span class="string">"red"</span>;</div><div class="line">                <span class="keyword">var</span> points = [startPoint,endPoint,cp1,cp2];</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; points.length ; i++)&#123;</div><div class="line">                    drawPoint(points[i]);</div><div class="line">                &#125;</div><div class="line">                <span class="comment">//绘制直线</span></div><div class="line">                drawLine(startPoint,cp1);</div><div class="line">                drawLine(endPoint,cp2);</div><div class="line">            &#125;</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">drawPoint</span>(<span class="params">point</span>)</span>&#123;</div><div class="line">                ctx.beginPath();</div><div class="line">                ctx.strokeRect(point[<span class="number">0</span>]<span class="number">-2</span>,point[<span class="number">1</span>]<span class="number">-2</span>,<span class="number">4</span>,<span class="number">4</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">drawLine</span>(<span class="params">from,to</span>)</span>&#123;</div><div class="line">                ctx.beginPath();</div><div class="line">                ctx.moveTo(<span class="keyword">from</span>[<span class="number">0</span>],<span class="keyword">from</span>[<span class="number">1</span>]);</div><div class="line">                ctx.lineTo(to[<span class="number">0</span>],to[<span class="number">1</span>]);</div><div class="line">                ctx.stroke();</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>效果请查看：<a href="http://runjs.cn/detail/nzjursph" target="_blank" rel="external">三次贝塞尔曲线</a></p>
<h3 id="创建剪辑区域"><a href="#创建剪辑区域" class="headerlink" title="创建剪辑区域"></a>创建剪辑区域</h3><p>一旦定义了一块裁剪区域，就只有区域内的路径才会显示在屏幕上。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span> <span class="attr">width</span>=<span class="string">"500"</span> <span class="attr">height</span>=<span class="string">"300"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>).getContext(<span class="string">"2d"</span>);</div><div class="line">            ctx.fillStyle = <span class="string">"yellow"</span>;</div><div class="line">            ctx.beginPath();</div><div class="line">            ctx.rect(<span class="number">100</span>,<span class="number">20</span>,<span class="number">300</span>,<span class="number">100</span>);</div><div class="line">            ctx.fill();</div><div class="line">            <span class="comment">//裁剪区域</span></div><div class="line">            ctx.clip();</div><div class="line">            <span class="comment">//只在裁剪的区域绘制</span></div><div class="line">            ctx.fillStyle = <span class="string">"red"</span>;</div><div class="line">            ctx.beginPath();</div><div class="line">            ctx.rect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">500</span>,<span class="number">300</span>);</div><div class="line">            ctx.fill();</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="绘制文本"><a href="#绘制文本" class="headerlink" title="绘制文本"></a>绘制文本</h3><p>可以在画布上绘制文本。不过这种功能的支持还很初步。</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>fillText(text,x,y,width)</td>
<td>在位置(x,y)上绘制并填充指定文本。宽度参数是可选的，他设置了文本的宽度上限</td>
<td>void</td>
</tr>
<tr>
<td>strokeText(text,x,y,width)</td>
<td>在位置(x,y)上绘制并描边指定文本。宽度是可选参数</td>
<td>void</td>
</tr>
</tbody>
</table>
<p>我们可以使用三种绘制装态属性来控制文本绘制的方式。</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>font</td>
<td>设置绘制文本时使用的字体</td>
<td>字符串</td>
</tr>
<tr>
<td>textAlign</td>
<td>设置文本的对齐方式</td>
<td>字符串</td>
</tr>
<tr>
<td>textBaseLine</td>
<td>设置文本的基线：top、bottom、middle等</td>
<td>字符串</td>
</tr>
</tbody>
</table>
<p>下面是例子：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="keyword">var</span> ctx = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>).getContext(<span class="string">"2d"</span>);</div><div class="line">        ctx.fillStyle = <span class="string">"steelblue"</span>;</div><div class="line">        ctx.strokeStyle = <span class="string">"lightgrey"</span>;</div><div class="line">        <span class="comment">//必须先设置字体大小再设置字体</span></div><div class="line">        ctx.font = <span class="string">"100px sans-serif"</span>;</div><div class="line">        ctx.textBaseline = <span class="string">"top"</span>;</div><div class="line">        ctx.fillText(<span class="string">"hello"</span>,<span class="number">10</span>,<span class="number">10</span>);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="使用特效和变换"><a href="#使用特效和变换" class="headerlink" title="使用特效和变换"></a>使用特效和变换</h3><ul>
<li>使用阴影<br>  可以用四种绘制状态属性来给我们在画布上绘制的图形和文本添加阴影。<br>  <img src="index_files/2db2ce9b-257c-498c-8c84-cde930d11fc9.jpg" alt=""><br>  下面是例子：<br>  <img src="index_files/8121521f-3350-443f-aa34-3e00d9f90c00.jpg" alt=""></li>
<li>使用透明度<br>  可以用两种方式来给我们绘制的文本和图形设置透明度。第一种使用rgba函数指定一个fillStyle或strokeStyle值，另一种是使用绘制属性globalAlpha。globalAlpha属性的值可以从0（完全透明）到1（完全不透明，这是默认值）。<br>  <img src="index_files/95061caa-c49c-4399-88c2-27552765a893.jpg" alt=""><br>  下面是代码效果：<br>  <img src="index_files/ebe29e5f-da5b-4387-af8a-889b16a73d28.jpg" alt=""></li>
<li>使用合成<br>  可以将透明度与globalCompositeOperation属性结合使用，来控制图形和文本在画布上绘制的方式。</li>
<li>使用变换<br>  我们可以给画布应用变换，它会应用到后续所有的绘图操作上。<br>  <img src="index_files/adf8c417-7d62-47c7-81cf-c0b35abe43e3.jpg" alt=""><br>  <img src="index_files/70331c2f-2d6b-4994-8a24-a674ef0db510.jpg" alt=""><br>  在这个例子里，我填充并描边了一些文本，然后缩放、平移和旋转了画布，这些操作影响了我接下来绘制的空心矩形和实心矩形。<br>  <img src="index_files/80b1643c-4488-4f6e-9e09-26fb2637210d.jpg" alt=""></li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[HTML5多媒体]]></title>
      <url>http://heji.website/2016/12/28/HTML5%E5%A4%9A%E5%AA%92%E4%BD%93/</url>
      <content type="html"><![CDATA[<p>插件是令浏览器崩溃的主要原因之一，特别是flash。幸运的是HTML5支持直接在浏览器中播放音频和视频文件。</p>
<a id="more"></a>
<h3 id="使用video元素"><a href="#使用video元素" class="headerlink" title="使用video元素"></a>使用video元素</h3><p>可以使用video元素在网页里嵌入视频内容。video元素有许多属性，下表列出了它们。</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>autoplay</td>
<td>如果存在，此属性会使浏览器尽可能立刻开始播放视频</td>
</tr>
<tr>
<td>preload</td>
<td>告诉浏览器是否要预先载入视频</td>
</tr>
<tr>
<td>controls</td>
<td>该属性告诉浏览器添加控制面板</td>
</tr>
<tr>
<td>loop</td>
<td>如果此属性存在，浏览器会反复播放视频</td>
</tr>
<tr>
<td>poster</td>
<td>指定在视频数据载入时显示的图片</td>
</tr>
<tr>
<td>height</td>
<td>视频的高度</td>
</tr>
<tr>
<td>width</td>
<td>视频的宽度</td>
</tr>
<tr>
<td>muted</td>
<td>如果此属性存在，视频将静音播放</td>
</tr>
<tr>
<td>src</td>
<td>指定要显示的视频</td>
</tr>
</tbody>
</table>
<ul>
<li>预先加载视频（重要）<br>  preload属性告诉浏览器：当它加载完包含video元素的网页后，是否应该积极地去下载资源。预先加载视频减少了用户播放时的延迟，但如果用户不观看视频会造成网络带宽的浪费。下面是preload属性允许设置的值：<br>  <table><tr><td>none</td><td>用户开始播放之前不会载入视频</td></tr><tr><td>metadata（最有用）</td><td>载入视频的元数据（宽度、高度、第一帧等）</td></tr><tr><td>auto</td><td>让浏览器尽快下载整个视频。</td></tr></table><strong>metadata值向用户提供了漂亮的预览画面，但需要谨慎点，有些浏览器实际上会预先下载整个视频</strong></li>
<li><p>指定视频来源<br>  指定视频来源的最简单的方式是使用src属性，并提供所需视频文件的URL。也可以使用source元素指定多个视频来源。例如：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">controls</span> <span class="attr">width</span>=<span class="string">"360"</span> <span class="attr">height</span>=<span class="string">"240"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">""</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">""</span>/&gt;</span></div><div class="line">	Video cannot be displayed</div><div class="line"><span class="tag">&lt;/<span class="name">video</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  浏览器会沿着列表顺序寻找它能播放的视频文件。当都不支持时，显示video标签内的文本。</p>
</li>
</ul>
<h3 id="使用audio元素"><a href="#使用audio元素" class="headerlink" title="使用audio元素"></a>使用audio元素</h3><p>audio元素允许你在HTML文档里嵌入音频内容。audio元素和video元素有许多共同点。下面以例子说明：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">audio</span> <span class="attr">controls</span> <span class="attr">autolpay</span>&gt;</span></div><div class="line">	    <span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">""</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">""</span>/&gt;</span></div><div class="line">		Audio cannot be displayed</div><div class="line"><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="通过DOM操作嵌入式媒体"><a href="#通过DOM操作嵌入式媒体" class="headerlink" title="通过DOM操作嵌入式媒体"></a>通过DOM操作嵌入式媒体</h3><p>audio和video元素有很大的相似性，所有HTMLMediaElement对象在DOM里为它们统一定义了核心功能。audio元素在DOM里面由HTMLMediaElement对象所代表，这个对象没有定义不同于<br>HTMLMediaElement对象的额外功能。video元素由HTMLVideoElement对象所代表，而它相对于HTMLMediaElement对象定义了一些额外的属性。</p>
<ul>
<li><p>获得媒体信息<br>  <img src="index_files/1a392a83-d4bf-4fca-9a46-2c95ce19b716.jpg" alt=""><br>  HTMLVideoElement对象定义了下表中展示的额外属性<br>  <img src="index_files/d49974d3-c2b2-4cd7-bb17-352743dc8d1e.jpg" alt=""><br>  获取媒体元素的基本信息示例：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">"video"</span> <span class="attr">width</span>=<span class="string">"800"</span> <span class="attr">height</span>=<span class="string">"600"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">"myvideo.mp4"</span> <span class="attr">type</span>=<span class="string">"video/mp4"</span>&gt;</span><span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">"myvideo.ogv"</span> <span class="attr">type</span>=<span class="string">"video/ogg"</span>&gt;</span><span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">"myvideo.webm"</span> <span class="attr">type</span>=<span class="string">"video/webm"</span>&gt;</span><span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">object</span> <span class="attr">width</span>=<span class="string">""</span> <span class="attr">height</span>=<span class="string">""</span> <span class="attr">type</span>=<span class="string">"application/x-shockwave-flash"</span> <span class="attr">data</span>=<span class="string">"myvideo.swf"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"movie"</span> <span class="attr">value</span>=<span class="string">"myvideo.swf"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"flashvars"</span> <span class="attr">value</span>=<span class="string">"autostart=true&amp;amp;file=myvideo.swf"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">object</span>&gt;</span></div><div class="line">		当前浏览器不支持 video直接播放，点击这里下载视频： <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"myvideo.webm"</span>&gt;</span>下载视频<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">video</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span> <span class="attr">id</span>=<span class="string">"info"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>属性<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>值<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">		<span class="keyword">var</span> video = <span class="built_in">document</span>.getElementById(<span class="string">"video"</span>);</div><div class="line">		<span class="keyword">var</span> propertyNames = [<span class="string">"autoplay"</span>,<span class="string">"currentSrc"</span>,<span class="string">"controls"</span>,<span class="string">"loop"</span>,<span class="string">"muted"</span>,<span class="string">"preload"</span>,<span class="string">"src"</span>,<span class="string">"volume"</span>];</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; propertyNames.length ; i++)&#123;</div><div class="line">			<span class="keyword">var</span> trObj = <span class="built_in">document</span>.createElement(<span class="string">"tr"</span>);</div><div class="line">			<span class="keyword">var</span> td1 = <span class="built_in">document</span>.createElement(<span class="string">"td"</span>);</div><div class="line">			<span class="keyword">var</span> td2 = <span class="built_in">document</span>.createElement(<span class="string">"td"</span>);</div><div class="line">			<span class="keyword">var</span> propertyName = <span class="built_in">document</span>.createTextNode(propertyNames[i]);</div><div class="line">			<span class="keyword">var</span> propertyValue = <span class="built_in">document</span>.createTextNode(video[propertyNames[i]]);</div><div class="line">			td1.appendChild(propertyName);</div><div class="line">			td2.appendChild(propertyValue);</div><div class="line">			trObj.appendChild(td1);</div><div class="line">			trObj.appendChild(td2);</div><div class="line">			<span class="built_in">document</span>.getElementById(<span class="string">"info"</span>).appendChild(trObj);</div><div class="line">		&#125;</div><div class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>评估播放能力<br>  canPlayType方法可以用来了解浏览器是否能够播放特定的媒体格式。这个方法会返回空（不能播放）或maybe（或许能播放）或probably（相当有把握播放）。<br>  <img src="index_files/d738d28b-f513-4ea4-935e-e19d6d45c87e.jpg" alt=""><br>  使用这个方法需要注意的是不同浏览器评估自身格式播放能力的方法各不相同。</p>
</li>
<li>控制媒体回放<br>  HTMLMediaElement对象定义了许多成员，它们让你能够控制回放和获得回放信息，这些属性和方法如下：<br>  <img src="index_files/0a9f7559-774f-46d4-8605-b6ca7fdb77cc.jpg" alt=""><br>  脚本控制多媒体暂停/播放：<br>  <img src="index_files/1155e847-4069-4df0-9f64-747beed58072.jpg" alt=""></li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Ajax]]></title>
      <url>http://heji.website/2016/12/28/Ajax/</url>
      <content type="html"><![CDATA[<p>Ajax是现代Web应用程序开发的一项关键工具。它让你能想服务器异步发送和接收数据，然后用JavaScript解析。</p>
<a id="more"></a>
<p>Ajax是异步JavaScript和XML的缩写，这个名称诞生于XML还是数据传输首选格式的时期，但现在基本不用XML传输数据了。<br>Ajax核心规范的名称继承于你用来建立和发起请求的JavaScript对象：XMLHttpRequest。这个规范有两个等级。所有浏览器都实现了第一级（Level1）。它代表了基础级别的功能。第二级别（Level2）扩展了最初的规范，纳入了额外的事件和一些功能来让它更容易与form元素协作，并且支持一些相关的规范（例如CORS）。</p>
<h3 id="Ajax起步"><a href="#Ajax起步" class="headerlink" title="Ajax起步"></a>Ajax起步</h3><p>Ajax的关键在于XMLHttpRequest对象，而理解这个对象的最佳方式就是看个例子。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">button</span>&gt;</span>apples<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">button</span>&gt;</span>bananas<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">button</span>&gt;</span>cherries<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"target"</span>&gt;</span>Press a button<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="xml"></span></div><div class="line">            var buttons = document.getElementsByTagName("button");</div><div class="line">            for(var i = 0 ; i <span class="tag">&lt; <span class="attr">buttons.length</span> ; <span class="attr">i</span>++)&#123;</span></div><div class="line">                <span class="attr">buttons</span>[<span class="attr">i</span>]<span class="attr">.addEventListener</span>('<span class="attr">click</span>',<span class="attr">function</span>(<span class="attr">e</span>)&#123;</div><div class="line">                    //创建<span class="attr">XMLHttpRequest</span>对象</div><div class="line">                    <span class="attr">var</span> <span class="attr">httpRequest</span> = <span class="string">new</span> <span class="attr">XMLHttpRequest</span>();</div><div class="line">                    //给<span class="attr">readystatechange</span>事件设置一个事件处理器，这个事件会在请求过程中被多次触发，向你提供事情的进展情况</div><div class="line">                    <span class="attr">httpRequest.onreadystatechange</span> = <span class="string">handleResponse;</span></div><div class="line">                    //<span class="attr">open</span>指定<span class="attr">HTTP</span>方法和需要请求的<span class="attr">URL</span>，<span class="attr">open</span>(<span class="attr">method</span>,<span class="attr">url</span>,<span class="attr">async</span>,<span class="attr">user</span>,<span class="attr">password</span>);第三个参数指定是否异步,默认<span class="attr">true</span>，最后两个可选参数是应该给服务器的用户名和密码</div><div class="line">                    <span class="attr">httpRequest.open</span>("<span class="attr">GET</span>",<span class="attr">e.target.innerHTML</span>+"<span class="attr">.html</span>");</div><div class="line">                    //发送请求。因没有向服务器发送任何数据，所有没有参数可用</div><div class="line">                    <span class="attr">httpRequest.send</span>();</div><div class="line">                &#125;,<span class="attr">false</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="attr">function</span> <span class="attr">handleResponse</span>(<span class="attr">e</span>)&#123;</div><div class="line">                //<span class="attr">e.target</span>表示当前<span class="attr">XMLHttpRequest</span>对象</div><div class="line">                //读取<span class="attr">XMLHttpRequest</span>对象的<span class="attr">readyState</span>属性来确定当前处理的阶段。</div><div class="line">                <span class="attr">if</span>(<span class="attr">e.target.readyState</span>==<span class="string">XMLHttpRequest.LOADING</span> &amp;&amp; <span class="attr">e.target.status</span>==<span class="string">200)&#123;</span></div><div class="line">                    <span class="attr">document.getElementById</span>("<span class="attr">target</span>")<span class="attr">.innerHTML</span> = <span class="string">e.target.responseText;</span></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<ul>
<li>处理响应<br>  一旦脚本调用了send方法，浏览器会在后台发送请求到服务器。因为请求实在后台处理的，所有Ajax依靠readystatechange事件来通知你这个请求的进展情况。当readystatechange事件被触发后，浏览器会把一个Event对象传递给指定的处理函数。Event对象的target属性会被设定为与此事件关联的XMLHttpRequest。<br>  可以读取<strong>XMLHttpRequest.readyState</strong>属性的值确定当前请求到了哪个阶段。下面是这个属性的值<br>  <table><thead><tr><th>值</th><th>数值</th><th>说明</th></tr></thead><tbody><tr><td>UNSENT</td><td>0</td><td>已创建XMLHttpRequest对象</td></tr><tr><td>OPENED</td><td>1</td><td>已调用open方法</td></tr><tr><td>HEADERS_RECEIVED</td><td>2</td><td>已收到服务器响应的标头</td></tr><tr><td>LOADING</td><td>3</td><td>已收到服务器响应</td></tr><tr><td>DONE</td><td>4</td><td>响应完成或已失败</td></tr></tbody></table><br>  DONE状态并不意味着请求成功，它只代表请求已完成。可以通过status属性获得HTTP状态码，它会返回一个数值（比如200表示成功）。只有结合readyState和status属性的值才能够确定某个请求的结果。<br>  <strong>responseText</strong>属性会返回一个字符串，代表从服务器上取回的数据</li>
<li>主流中的异类：应对Opera<br>  Opera浏览器的XMLHttpRequest标准实现得不太一样。<br>  第一个问题是readystatechange事件不会返回一个Event对象，这意味着要把XMLHttpRequest对象指派给一个全局变量。<br>  第二个问题是Opera没有在XMLHttpRequest对象上定义就绪状态的常量，这意味着<code>XMLHttpRequest.readyState==XMLHttpRequest.DONE</code>要修改为<code>XMLHttpRequest.readyState==4</code></li>
</ul>
<h3 id="使用Ajax事件"><a href="#使用Ajax事件" class="headerlink" title="使用Ajax事件"></a>使用Ajax事件</h3><p>现在，我们来详细地看看XMLHttpRequest对象支持的功能以及如何在你的请求中使用它们。</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>事件类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>abort</td>
<td>在请求被中止时触发</td>
<td>ProgressEvent</td>
</tr>
<tr>
<td>error</td>
<td>在请求失败时触发</td>
<td>ProgressEvent</td>
</tr>
<tr>
<td>load</td>
<td>在请求成功完成时触发</td>
<td>ProgressEvent</td>
</tr>
<tr>
<td>loadend</td>
<td>在请求完成时触发，不管成功还是失败</td>
<td>ProgressEvent</td>
</tr>
<tr>
<td>loadstart</td>
<td>在请求开始时触发</td>
<td>ProgressEvent</td>
</tr>
<tr>
<td>progress</td>
<td>触发以提示请求的进度</td>
<td>ProgressEvent</td>
</tr>
<tr>
<td>readystatechange</td>
<td>在请求生命周期的不同阶段触发</td>
<td>Event</td>
</tr>
<tr>
<td>timeout</td>
<td>如果请求超时时则触发</td>
<td>ProgressEvent</td>
</tr>
</tbody>
</table>
<p>这些事件大多数会在请求的某一个特定点上触发。readystatechange和progress这两个事件是例外，它们可以多次触发以提供进度更新。<br>除了readystatechange（XMLHttpRequest规范Level 1）之外，表中展示的其他事件都定义于XMLHttpRequest规范Level 2。<br>调用这些事件时，浏览器会对readystatechange事件使用常规的Event对象，对其他事件则使用ProgressEvent对象。ProgressEvent对象定义了Event对象的所有成员，并增加了一些成员。</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>返回值</th>
</tr>
</thead>
<tbody>
<tr>
<td>lengthComputable</td>
<td>如果能够计算数据流的总长度则返回true</td>
<td>布尔值</td>
</tr>
<tr>
<td>loaded</td>
<td>返回当前已载入的数据量</td>
<td>数值</td>
</tr>
<tr>
<td>total</td>
<td>返回可用的数据总量</td>
<td>数值</td>
</tr>
</tbody>
</table>
<p>下面是使用这些事件的一个综合例子：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"shortcut icon"</span> <span class="attr">href</span>=<span class="string">"images/favicon.ico"</span> <span class="attr">type</span>=<span class="string">"image/x-icon"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">        <span class="selector-tag">table</span>&#123;</div><div class="line">            <span class="attribute">margin</span>:<span class="number">10px</span>;</div><div class="line">            <span class="attribute">border-collapse</span>: collapse;</div><div class="line">            <span class="attribute">float</span>: left;</div><div class="line">        &#125;</div><div class="line">        <span class="selector-tag">th</span>,<span class="selector-tag">td</span>&#123;</div><div class="line">            <span class="attribute">padding</span>: <span class="number">4px</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="selector-tag">div</span>&#123;</div><div class="line">            <span class="attribute">margin</span>: <span class="number">10px</span>;</div><div class="line">        &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>apples<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>cherries<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>bananas<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"target"</span>&gt;</span></div><div class="line">        加载内容</div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">"events"</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line">        //使用XMLHttpRequest定义的一次性事件</div><div class="line">        var buttons=document.getElementsByTagName("button");</div><div class="line">        for(var i=0;i&lt;buttons.length;i++)&#123;</div><div class="line">            buttons[i].onclick=handleButtonPress;</div><div class="line">        &#125;</div><div class="line">        var httpRequest;</div><div class="line">        function handleButtonPress(e)&#123;</div><div class="line">            clearEventDetails();</div><div class="line">            httpRequest=new XMLHttpRequest();</div><div class="line">            httpRequest.onreadystatechange=handleResponse;</div><div class="line">            httpRequest.onerror=handleError;</div><div class="line">            httpRequest.onload=handleLoad;</div><div class="line">            httpRequest.onloadend=handleLoadEnd;</div><div class="line">            httpRequest.onloadstart=handleLoadStart;</div><div class="line">            httpRequest.onprogress=handleProgress;</div><div class="line">            httpRequest.open("GET", e.target.innerHTML+".html");</div><div class="line">            httpRequest.send();</div><div class="line">        &#125;</div><div class="line">        function handleResponse(e)&#123;</div><div class="line">            displayEventDetails("readystate("+ httpRequest.readyState +")");</div><div class="line">            //处理响应</div><div class="line">            if(httpRequest.readyState==4 &amp;&amp; httpRequest.status==200)&#123;</div><div class="line">                document.getElementById("target").innerHTML= httpRequest.responseText;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        function handleError(e)&#123;displayEventDetails("error",e);&#125;</div><div class="line">        function handleLoad(e)&#123;displayEventDetails("load",e);&#125;</div><div class="line">        function handleLoadEnd(e)&#123;displayEventDetails("loadend",e);&#125;</div><div class="line">        function handleLoadStart(e)&#123;displayEventDetails("loadstart",e);&#125;</div><div class="line">        function handleProgress(e)&#123;displayEventDetails("progress",e);&#125;</div><div class="line">        function clearEventDetails()&#123;</div><div class="line">            document.getElementById("events").innerHTML="&lt;tr&gt;&lt;th&gt;Event&lt;/th&gt;&lt;th&gt;lengthComputable&lt;/th&gt;&lt;th&gt;loaded&lt;/th&gt;&lt;th&gt;total&lt;/th&gt;&lt;/tr&gt;"</div><div class="line">        &#125;</div><div class="line">        function displayEventDetails(eventName,e)&#123;</div><div class="line">            if(e)&#123;</div><div class="line">                document.getElementById("events").innerHTML+="&lt;tr&gt;&lt;td&gt;"+eventName+"&lt;/td&gt;&lt;td&gt;"+ e.lengthComputable+"&lt;/td&gt;&lt;td&gt;"+ e.loaded+"&lt;/td&gt;&lt;td&gt;"+ e.total+"&lt;/td&gt;&lt;/tr&gt;";</div><div class="line">            &#125;else&#123;</div><div class="line">                document.getElementById("events").innerHTML+="&lt;tr&gt;&lt;td&gt;"+eventName+"&lt;/td&gt;&lt;td&gt;NA&lt;/td&gt;&lt;td&gt;NA&lt;/td&gt;&lt;td&gt;NA&lt;/td&gt;&lt;/tr&gt;";</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="处理错误"><a href="#处理错误" class="headerlink" title="处理错误"></a>处理错误</h3><p>使用Ajax时必须留心两类错误。它们之间的区别源于视角不同。<br>第一类错误是从XMLHttpRequest对象的角度看到的问题：某些因素阻止了请求发送到服务器，例如DNS无法解析主机名或者URL无效等。<br>第二类问题是从应用程序的角度看到的问题。它们发生于请求成功发送到服务器，服务器接收请求，进行处理并生成相应，但该响应不是你期望的内容。例如请求的URL不存在等。</p>
<ul>
<li>处理设置错误<br>  使用try…catch语句来围住请求的代码。在catch子句对错误进行处理</li>
<li>处理应用程序错误<br>  这种错误发生于请求成功完成（从XMLHttpRequest对象角度看），但没有返回你想要的数据时，可以根据status属性来确定发生了什么。200表示请求成功完成。  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">if</span>(e.target.status==<span class="number">200</span>)&#123;</div><div class="line">        target.innerHTML = e.target.responseText;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="built_in">console</span>.error(<span class="string">"Status:"</span>+e.target.status+<span class="string">","</span>+e.target.statusText);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="获取和设置标头"><a href="#获取和设置标头" class="headerlink" title="获取和设置标头"></a>获取和设置标头</h3><p>XMLHTTPRequest对象让你可以设置发送给服务器的请求标头（Header）和读取服务器响应里的标头。通常不需要添加或修改Ajax请求里的标头。浏览器知道需要发送什么，服务器也知道如何进行响应。不过，有几种情况是例外。<br>下面是有关标头的方法：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>setRequestHeader(header,value)</td>
<td>用指定值设置标头</td>
<td>void</td>
</tr>
<tr>
<td>getResponseHeader(header)</td>
<td>获取指定标头的值</td>
<td>字符串</td>
</tr>
<tr>
<td>getAllResponseHeaders()</td>
<td>以单个字符串的形式获取所有的标头</td>
<td>字符串</td>
</tr>
</tbody>
</table>
<ul>
<li><p>覆盖请求的HTTP方法<br>  HTTP发送请求的方法除了GET和POST之外，还存在一些其他方法（比如PUT、DELETE）这些方法用来向服务器请求的URL赋予意义，而且这种用法正在呈现上升趋势。例如，如果想删除数据，可以这么写：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    httpRequest.open(<span class="string">"DELETE"</span>,<span class="string">"http://myserver/records/person/1"</span>);</div></pre></td></tr></table></figure>
<p>  此处的关键在于通过HTTP方法表达出你想让服务器做什么，而不是把它用某种方式编码进URL。这是一种被称为RESTful API的趋势的一部分。<br>  以这种方式使用HTTP方法的问题在于：许多主流浏览器只支持GET和POST。而且不少防火墙只允许GET和POST请求通过。有一种惯用的做法可以规避这个限制，就是使用X-HTTP-Method-Override标头来指定想要使用的HTTP方法，但形式上是再发送一个POST请求(两个请求，第一个是OPTIONS请求，第二个是POST请求)。下面是示例代码:</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">handleButtonPress</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> httpRequest = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">        httpRequest.onreadystatechange = handleResponse;</div><div class="line">        httpRequest.open(<span class="string">"GET"</span>,e.target.innerHTML+<span class="string">".html"</span>);</div><div class="line">        <span class="comment">//注意：一定要在open方法之后设置，否则会报错</span></div><div class="line">        httpRequest.setRequestHeader(<span class="string">"X-HTTP-Method-Override"</span>,<span class="string">"DELETE"</span>);</div><div class="line">        httpRequest.send();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>  <strong>注意：覆盖HTTP方法需要服务器端的Web应用程序框架能理解X-HTTP-Method-Override这个惯例，且能理解和支持那些用得较少的HTTP方法。对于Servlet，为支持X-HTTP-Method-Override，需要给响应添加一个标头<code>resp.setHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;X-HTTP-Method-Override&quot;);</code>以及重写<code>doOptions</code>方法</strong></p>
</li>
<li><p>禁用内容缓存<br>  第二个可以添加到Ajax请求上的有用标头是Cache-Control。一些浏览器会缓存通过Ajax请求所获得的内容，导致若请求的内容发生改变时，不能立刻反映到页面上。可以设置Cache-Control标头让浏览器不缓存Ajax请求获取的内容。例如：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">handleButtonPress</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> httpRequest = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">        httpRequest.onreadystatechange = handleResponse;</div><div class="line">        httpRequest.open(<span class="string">"GET"</span>,e.target.innerHTML+<span class="string">".html"</span>);</div><div class="line">        <span class="comment">//注意：一定要在open方法之后设置，否则会报错</span></div><div class="line">        httpRequest.setRequestHeader(<span class="string">"Cache-Control"</span>,<span class="string">"no-cache"</span>);</div><div class="line">        httpRequest.send();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>获取响应标头<br>  可以通过getResponseHeader和getAllResponseHeaders方法来读取服务器响应某个Ajax请求时发送的HTTP标头。大多数情况下，不需要关心标头里有什么，因为它们是浏览器和服务器之间交互事务的组成部分。下面是例子：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">handleResponse</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(httpRequest.readyState == <span class="number">2</span>)&#123;</div><div class="line">           <span class="built_in">console</span>.log(httpRequest.getAllResponseHeaders);</div><div class="line">           <span class="built_in">console</span>.log(httpRequest.getResponseHeader(<span class="string">"Content-Type"</span>));</div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(httpRequest.readyState == <span class="number">4</span> &amp;&amp; httpRequest.status == <span class="number">200</span>)&#123;</div><div class="line">        <span class="comment">//成功完成响应的处理</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>  响应标头在readyState变成HEADERS_RECEIVED(值为2)时就可以使用了。标头是服务器在响应时首先发送回来的消息，因此可以在内容本身就绪前先读取它们。</p>
</li>
</ul>
<h3 id="生成跨源Ajax请求"><a href="#生成跨源Ajax请求" class="headerlink" title="生成跨源Ajax请求"></a>生成跨源Ajax请求</h3><p>默认情况下，浏览器限制脚本在它们所属文档的来源内生成Ajax请求，来源由URL中的协议、主机名和端口号组成。从一个来源到另一个来源的Ajax请求被称为跨源请求。浏览器不支持Ajax请求跨源的目的是降低跨站脚本攻击（Cross-site scripting，简称CSS）的风险。<br>为实现跨源请求，服务器返回浏览器的响应信息添加一个标头（这里以Java的Servlet示例）：<br><figure class="highlight jsp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//允许跨源请求</span></div><div class="line">        resp.setHeader(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"http://127.0.0.1:8030"</span>);</div><div class="line">        <span class="comment">//支持X-HTTP-Method-Override请求头</span></div><div class="line">        resp.setHeader(<span class="string">"Access-Control-Allow-Headers"</span>, <span class="string">"X-HTTP-Method-Override"</span>);</div></pre></td></tr></table></figure></p>
<ul>
<li><p>使用Origin请求标头<br>  作为CORS的一部分，浏览器会给请求添加一个Origin标头以注明当前文档的来源。可以通过它更灵活地设置Access-Control-Allow-Origin的值：</p>
  <figure class="highlight jsp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">    String origin = req.getHeader(<span class="string">"Origin"</span>);</div><div class="line">        <span class="comment">//如果是来源包含127.0.0.1</span></div><div class="line">        <span class="keyword">if</span>(origin.indexOf(<span class="string">"127.0.0.1"</span>)&gt;-<span class="number">1</span>)&#123;</div><div class="line">            <span class="comment">//允许跨源请求</span></div><div class="line">            resp.setHeader(<span class="string">"Access-Control-Allow-Origin"</span>, origin);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//支持X-HTTP-Method-Override请求头</span></div><div class="line">        resp.setHeader(<span class="string">"Access-Control-Allow-Headers"</span>, <span class="string">"X-HTTP-Method-Override"</span>);</div></pre></td></tr></table></figure>
</li>
<li><p>高级CORS功能</p>
</li>
</ul>
<h3 id="中止请求"><a href="#中止请求" class="headerlink" title="中止请求"></a>中止请求</h3><p>XMLHttpRequest对象定义了一个让你可以中止请求的方法。如下表：</p>
<table>
<thead>
<tr>
<th>成员</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>abort()</td>
<td>中断当前请求</td>
<td>void</td>
</tr>
</tbody>
</table>
<p>注意，当调用abort()方法时会触发XMLHttpRequest的onabort事件，可以在onabort事件里进行一些中断请求后的处理。</p>
<h3 id="发送表单数据"><a href="#发送表单数据" class="headerlink" title="发送表单数据"></a>发送表单数据</h3><p>Ajax最常见的一大用途是向服务器发送数据。最典型的情况是从客户端发送表单数据<br><img src="index_files/203b97a6-5332-4cb6-b4ff-e0104fcade3a.jpg" alt=""></p>
<h4 id="表单编码"><a href="#表单编码" class="headerlink" title="表单编码"></a>表单编码</h4><p><code>Content-Type</code>指定向服务器发送的数据格式，等价于表单元素的<code>enctype</code>属性。</p>
<ul>
<li><p><code>application/x-www-form-urlencoded</code>格式编码<br>  <code>application/x-www-form-urlencoded</code>是表单编码的默认格式。但由于不是Ajax编码的默认格式，所以需要手动指定。例如，下面有个表单：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">    <span class="comment">&lt;!--这是默认编码，可省略--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">form</span>  <span class="attr">method</span>=<span class="string">'post'</span> <span class="attr">enctype</span>=<span class="string">'application/x-www-form-urlencoded'</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">'title'</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">'subtitle'</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  提交表单之后，通过控制台可以查看到下面信息：<br>  请求头（这里只给出了<code>Content-Type</code>字段）：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">    POST http://www.example.com HTTP/1.1</div><div class="line">    Content-Type: application/x-www-form-urlencoded</div></pre></td></tr></table></figure>
<p>  请求体：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    title=test&amp;subtitle=%E4%B8%AD%E5%9B%BD</div></pre></td></tr></table></figure>
<p>  这里你看到的<code>%E4%B8%AD%E5%9B%BD</code>即是<code>中国</code>按照base64编码（url通用的编码方式）后的结果。可以在Chrome Console中通过<code>decodeURI(&#39;%E4%B8%AD%E5%9B%BD&#39;)</code>来解码。<br>  由此可见，<code>application/x-www-form-urlencoded</code>编码的格式就是参数使用<code>&amp;</code>符号连接，发送前对字符进行编码，空格会转换成”+”加号。</p>
</li>
<li>multipart编码<br>  multipart编码方式则需要设置<code>enctype</code>为<code>multipart/form-data</code>。当表单需要上传附件时，必须设置该编码。</li>
<li>text/plain编码<br>  除了<code>application/x-www-form-urlencoded</code>和<code>multipart/form-data</code>，HTML的<code>&lt;form&gt;</code>还支持<code>text/plain</code>。这种编码方式需要谨慎使用，Chrome使用与<code>application/x-www-form-urlencoded</code>一样的编码方案，而Firefox又不一样。</li>
</ul>
<h4 id="使用FormData对象发送表单数据"><a href="#使用FormData对象发送表单数据" class="headerlink" title="使用FormData对象发送表单数据"></a>使用FormData对象发送表单数据</h4><p>另一种更简洁的表单数据收集方式是使用一个FormData对象，它是在XMLHttpRequest第二级规范中定义的。</p>
<ul>
<li><p>创建FormData对象<br>  创建FormData对象可以传递一个HTMLFormElement对象，这样表单里的所有元素的值都会被自动收集起来。下面是综合例子：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">id</span>=<span class="string">"myForm"</span>&gt;</span></div><div class="line">            用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">id</span>=<span class="string">"username"</span> /&gt;</span></div><div class="line">            密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"password"</span>  /&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">id</span>=<span class="string">"submitBtn"</span> <span class="attr">value</span>=<span class="string">"提交"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> httpRequest;</div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">"submitBtn"</span>).addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                e.preventDefault();</div><div class="line">                <span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">"myForm"</span>);</div><div class="line">                <span class="comment">//FormData对象默认的编码方式multipart/form-data;</span></div><div class="line">                <span class="keyword">var</span> formData = <span class="keyword">new</span> FormData(form);</div><div class="line">                <span class="comment">//还能添加参数</span></div><div class="line">                formData.append(<span class="string">"参数1"</span>,<span class="string">"谁看见啊"</span>);</div><div class="line">                httpRequest = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">                httpRequest.onreadystatechange = handleResponse;</div><div class="line">                httpRequest.open(<span class="string">'POST'</span>,form.action);</div><div class="line">                httpRequest.send(formData);</div><div class="line">            &#125;);</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">handleResponse</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(httpRequest.readyState);</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>发送JSON数据<br>  Ajax不止用来发送表单数据，几乎可以发送任何东西，运用最多的是JSON数据，下面是综合例子：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">id</span>=<span class="string">"myForm"</span>&gt;</span></div><div class="line">            用户名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">id</span>=<span class="string">"username"</span> /&gt;</span></div><div class="line">            密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"password"</span>  /&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"submitBtn"</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> httpRequest;</div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">"submitBtn"</span>).addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                e.preventDefault();</div><div class="line">                <span class="keyword">var</span> form = <span class="built_in">document</span>.getElementById(<span class="string">"myForm"</span>);</div><div class="line">                <span class="keyword">var</span> inputElements = form.getElementsByTagName(<span class="string">"input"</span>);</div><div class="line">                <span class="keyword">var</span> formData = &#123;&#125;;</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; inputElements.length ; i++)&#123;</div><div class="line">                    formData[inputElements[i].name] = inputElements[i].value;</div><div class="line">                &#125;</div><div class="line">                httpRequest = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">                httpRequest.onreadystatechange = handleResponse;</div><div class="line">                httpRequest.open(<span class="string">'POST'</span>,form.action);</div><div class="line">                httpRequest.setRequestHeader(<span class="string">"Content-Type"</span>,<span class="string">"application/json"</span>);</div><div class="line">                httpRequest.send(<span class="built_in">JSON</span>.stringify(formData));</div><div class="line">            &#125;);</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">handleResponse</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(httpRequest.readyState);</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  <strong>注意：发送JSON数据需要设置Content-Type标头</strong><br>  用JSON对象JSON格式进行相互的转换。JSON对象提供了两个方法，如下表：<br>  <table><thead><tr><th>方法</th><th>说明</th><th>返回</th></tr></thead><tbody><tr><td>parse(str)</td><td>解析用JSON编码的字符串并创建一个JSON对象</td><td>对象</td></tr><tr><td>stringify(object)</td><td>把JSON格式的对象转换为字符串</td><td>字符串</td></tr></tbody></table>在例子中，我使用了stringify方法，然后传递给XMLHttpRequest对象的send方法。</p>
</li>
</ul>
<h3 id="发送文件"><a href="#发送文件" class="headerlink" title="发送文件"></a>发送文件</h3><p>可以使用FormData对象和type属性为file的input元素向服务器发送文件。<br><strong>注意：因为FormData对象是XMLHttpRequest第二级规范中定义的，所以有些老版本的浏览器并不支持，在没有FormData对象的浏览器里使用Ajax上传文件几乎不能实现。但有许多修补和变通的方法可供使用：Flash或者提交表单到隐藏的iframe里，这些方法都有较严重的缺陷，应谨慎使用。</strong><br>使用方法：在form表单添加类型为file的input元素，然后在脚本获取form元素作为参数传进FormData的构造方法，再把FormData对象作为参数传递给XMLHttpRequest的send方法。</p>
<h4 id="追踪文件上传进度"><a href="#追踪文件上传进度" class="headerlink" title="追踪文件上传进度"></a>追踪文件上传进度</h4><p>可以在数据发送到服务器时追踪它的进度。具体做法是使用XMLHTtpRequest对象的upload属性，该属性返回一个可用于监控进度的对象。<br>upload属性返回的XMLHttpRequest对象只定义了注册事件处理器所需的属性：onprogress和onload等。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">   <span class="keyword">var</span> upload = httpRequest.upload;</div><div class="line">   upload.onprogress = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">       <span class="built_in">console</span>.log(e.total,e.loaded);</div><div class="line">   &#125;</div><div class="line">   upload.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">       <span class="built_in">console</span>.log(<span class="string">"上传完成"</span>);</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<h3 id="请求并处理不同内容类型（以JavaServlet为例）"><a href="#请求并处理不同内容类型（以JavaServlet为例）" class="headerlink" title="请求并处理不同内容类型（以JavaServlet为例）"></a>请求并处理不同内容类型（以JavaServlet为例）</h3><ul>
<li><p>返回HTML片段</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//返回html文档</span></div><div class="line">response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</div><div class="line">response.setHeader(<span class="string">"Cache-control"</span>, <span class="string">"no-cache"</span>);</div><div class="line">String res=<span class="string">"&lt;font size='2' color='blue'&gt;"</span>+name+pwd+<span class="string">"&lt;/font&gt;"</span>;</div><div class="line">PrintWriter out = response.getWriter();</div><div class="line">out.println(res);</div><div class="line">out.close();</div></pre></td></tr></table></figure>
<p>  <strong>可以用XMLHttpRequest对象的overrideMimeType方法指定服务器返回数据的MIME类型。该方法必须在<code>send()</code>之前调用。但这种方式较麻烦，在XMLHttpRequest版本升级以后，一般采用指定<code>responseType</code>的方法</strong></p>
</li>
<li><p>接收XML数据<br>  Servlet：</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//返回xml文档</span></div><div class="line">response.setContentType(<span class="string">"text/xml;charset=utf-8"</span>);</div><div class="line">response.setHeader(<span class="string">"Cache-control"</span>, <span class="string">"no-cache"</span>);</div><div class="line">String res=<span class="string">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;"</span>+</div><div class="line">           <span class="string">"&lt;fruitorder total=\"27\"&gt;"</span>+</div><div class="line">		    <span class="string">"&lt;/fruitorder&gt;"</span>;</div><div class="line">PrintWriter out = response.getWriter();</div><div class="line">out.println(res);</div><div class="line">out.close();</div></pre></td></tr></table></figure>
<p>  HTML：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleResponse</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span>(httpRequest.readyState==<span class="number">4</span> &amp;&amp; httpRequest.status==<span class="number">200</span>)&#123;</div><div class="line">	    <span class="comment">//httpRequest.overrideMimeType("application/xml");这句要在send方法之前调用</span></div><div class="line">		<span class="keyword">var</span> xmlDoc = httpRequest.responseXML;</div><div class="line">		<span class="keyword">var</span> total = xmlDoc.getElementsByTagName(<span class="string">"fruitorder"</span>)[<span class="number">0</span>].getAttribute(<span class="string">'total'</span>);</div><div class="line">		<span class="built_in">console</span>.log(total);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>接收JSON数据<br>  Servlet需要设置<code>response.setContentType(&quot;application/json; charset=utf-8&quot;);</code>向页面输出JSON格式的字符串，前端页面需要使用JSON对象的parse方法解析成JSON对象。</p>
</li>
</ul>
<h3 id="response属性和responseType属性"><a href="#response属性和responseType属性" class="headerlink" title="response属性和responseType属性"></a>response属性和responseType属性</h3><p>response和responseType是XMLHttpRequest二级规范定义的属性，使用它们可以指定服务器返回的数据类型，并进行自动转换<br><code>responseType</code>属性用来指定服务器返回数据（<code>xhr.response</code>）的类型。取值如下：<table><tr><td>值</td><td>说明</td></tr><tr></tr><tr><td>‘’(空字符串)</td><td>response属性返回字符串（默认）</td></tr><td>text</td><td>response属性返回字符串</td><tr><td>arraybuffer</td><td>response属性返回ArrayBuffer对象</td></tr><tr><td>blob</td><td>response属性返回Bolb对象</td></tr><tr><td>document</td><td>response属性返回Document对象</td></tr><tr><td>json</td><td>response属性返回JSON对象</td></tr></table><br>text类型适合大多数情况，而且直接处理文本也比较方便，document类型适合返回XML或HTML文档的情况，blob类型适合读取二进制数据，比如图片文件。如果将这个属性设为“json”，支持JSON的浏览器（Firefox&gt;9，chrome&gt;30），就会自动对返回数据调用<code>JSON.parse()</code>方法。下面是例子：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'/path/to/image.png'</span>, <span class="literal">true</span>);</div><div class="line">xhr.responseType = <span class="string">'blob'</span>;</div><div class="line">xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.status == <span class="number">200</span>) &#123;</div><div class="line">    <span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([<span class="keyword">this</span>.response], &#123;type: <span class="string">'image/png'</span>&#125;);</div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line">xhr.send();</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Emmet-让你的代码飞起来]]></title>
      <url>http://heji.website/2016/12/22/Emmet-%E8%AE%A9%E4%BD%A0%E7%9A%84%E4%BB%A3%E7%A0%81%E9%A3%9E%E8%B5%B7%E6%9D%A5/</url>
      <content type="html"><![CDATA[<p>Emmet是一款编辑器插件，必须要基于某个编辑器使用，能快速完成代码的编写。</p>
<a id="more"></a>
<h2 id="语法-使用tab键补全"><a href="#语法-使用tab键补全" class="headerlink" title="语法(使用tab键补全)"></a>语法(使用tab键补全)</h2><ul>
<li><p>后代<code>nav&gt;ul&gt;li</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">    &lt;nav&gt;</div><div class="line">        <span class="xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">    &lt;<span class="regexp">/nav&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>兄弟<code>div+p+bq</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">    &lt;div&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div><div class="line">    &lt;p&gt;<span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></div><div class="line">    &lt;blockquote&gt;<span class="xml"><span class="tag">&lt;/<span class="name">blockquote</span>&gt;</span></span></div></pre></td></tr></table></figure>
</li>
<li><p>上级<code>div+div&gt;p&gt;span+em^bq</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">    &lt;div&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div><div class="line">    &lt;div&gt;</div><div class="line">        <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></div><div class="line">        &lt;blockquote&gt;<span class="xml"><span class="tag">&lt;/<span class="name">blockquote</span>&gt;</span></span></div><div class="line">    &lt;<span class="regexp">/div&gt;</span></div></pre></td></tr></table></figure>
<p>  例二<code>div+div&gt;p&gt;span+em^^bq</code>：</p>
  <figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">    &lt;div&gt;&lt;/div&gt;</div><div class="line">    &lt;div&gt;</div><div class="line">        &lt;p&gt;&lt;span&gt;&lt;/span&gt;&lt;em&gt;&lt;/em&gt;&lt;/p&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">    &lt;blockquote&gt;&lt;/blockquote&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>分组<code>div&gt;(header&gt;ul&gt;li*2&gt;a)+footer&gt;p</code></p>
  <figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">    &lt;div&gt;</div><div class="line">    &lt;header&gt;</div><div class="line">        &lt;ul&gt;</div><div class="line">            &lt;li&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/li&gt;</div><div class="line">            &lt;li&gt;&lt;a href=""&gt;&lt;/a&gt;&lt;/li&gt;</div><div class="line">        &lt;/ul&gt;</div><div class="line">    &lt;/header&gt;</div><div class="line">    &lt;footer&gt;</div><div class="line">        &lt;p&gt;&lt;/p&gt;</div><div class="line">    &lt;/footer&gt;</div><div class="line">    &lt;/div&gt;</div></pre></td></tr></table></figure>
<p>  例二<code>(div&gt;dl&gt;(dt+dd)*3)+footer&gt;p</code>:</p>
  <figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">    &lt;div&gt;</div><div class="line">        &lt;dl&gt;</div><div class="line">            &lt;dt&gt;&lt;/dt&gt;</div><div class="line">            &lt;dd&gt;&lt;/dd&gt;</div><div class="line">            &lt;dt&gt;&lt;/dt&gt;</div><div class="line">            &lt;dd&gt;&lt;/dd&gt;</div><div class="line">            &lt;dt&gt;&lt;/dt&gt;</div><div class="line">            &lt;dd&gt;&lt;/dd&gt;</div><div class="line">        &lt;/dl&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">    &lt;footer&gt;</div><div class="line">        &lt;p&gt;&lt;/p&gt;</div><div class="line">    &lt;/footer&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>乘法<code>ul&gt;li*5</code>:</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">    &lt;ul&gt;</div><div class="line">        <span class="xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></div><div class="line">        &lt;li&gt;<span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></div><div class="line">        &lt;li&gt;<span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></div><div class="line">        &lt;li&gt;<span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></div><div class="line">        &lt;li&gt;<span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></div><div class="line">    &lt;<span class="regexp">/ul&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>自增符号:<br>  例一<code>ul&gt;li.item$*5</code>:</p>
  <figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">    &lt;ul&gt;</div><div class="line">        &lt;li class="item1"&gt;&lt;/li&gt;</div><div class="line">        &lt;li class="item2"&gt;&lt;/li&gt;</div><div class="line">        &lt;li class="item3"&gt;&lt;/li&gt;</div><div class="line">        &lt;li class="item4"&gt;&lt;/li&gt;</div><div class="line">        &lt;li class="item5"&gt;&lt;/li&gt;</div><div class="line">    &lt;/ul&gt;</div><div class="line">    ``` </div><div class="line">    例二 `h$[title=item$]&#123;Header $&#125;*3`:</div><div class="line">    ```javascript</div><div class="line">    &lt;h1 title="item1"&gt;Header 1&lt;/h1&gt;</div><div class="line">    &lt;h2 title="item2"&gt;Header 2&lt;/h2&gt;</div><div class="line">    &lt;h3 title="item3"&gt;Header 3&lt;/h3&gt;</div><div class="line">    ```    例三`ul&gt;li.item$@-*5`(负号表示反向):</div><div class="line">    ```javascript</div><div class="line">    &lt;ul&gt;</div><div class="line">        &lt;li class="item5"&gt;&lt;/li&gt;</div><div class="line">        &lt;li class="item4"&gt;&lt;/li&gt;</div><div class="line">        &lt;li class="item3"&gt;&lt;/li&gt;</div><div class="line">        &lt;li class="item2"&gt;&lt;/li&gt;</div><div class="line">        &lt;li class="item1"&gt;&lt;/li&gt;</div><div class="line">    &lt;/ul&gt;</div></pre></td></tr></table></figure>
<p>  例四<code>ul&gt;li.item$@3*5</code>:</p>
  <figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">    &lt;ul&gt;</div><div class="line">        &lt;li class="item3"&gt;&lt;/li&gt;</div><div class="line">        &lt;li class="item4"&gt;&lt;/li&gt;</div><div class="line">        &lt;li class="item5"&gt;&lt;/li&gt;</div><div class="line">        &lt;li class="item6"&gt;&lt;/li&gt;</div><div class="line">        &lt;li class="item7"&gt;&lt;/li&gt;</div><div class="line">    &lt;/ul&gt;</div><div class="line">    ```* ID和类属性</div><div class="line">    缩写`div#header`</div><div class="line">    ```javascript</div><div class="line">    &lt;div id="header"&gt;&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>  缩写<code>div.title</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"title"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div></pre></td></tr></table></figure>
<p>  缩写<code>form#search.wide</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    &lt;form id=<span class="string">"search"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"wide"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></div></pre></td></tr></table></figure>
<p>  缩写p.class1.class2.class3</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">"class1 class2 class3"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></div></pre></td></tr></table></figure>
</li>
<li><p>自定义属性<br>  缩写<code>p[title=&quot;Hello World&quot;]</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">        &lt;p title=<span class="string">"Hello World"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></div><div class="line">    缩写<span class="string">`td[rowspan=2 colspan=3]`</span></div><div class="line">    <span class="string">``</span><span class="string">`javascript</span></div><div class="line">    &lt;td rowspan="2" colspan="3"&gt;&lt;/td&gt;</div></pre></td></tr></table></figure>
<p>  缩写<code>div[a=&quot;value1&quot; b=&quot;value2&quot;]</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    &lt;div a=<span class="string">"value1"</span> b=<span class="string">"value2"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div></pre></td></tr></table></figure>
</li>
<li><p>文本<br>  缩写<code>a{click me}</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    &lt;a&gt;click me&lt;<span class="regexp">/a&gt;</span></div></pre></td></tr></table></figure>
<p>  缩写<code>p&gt;{Click }+a{here}+{ to continue}</code></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    &lt;p&gt;Click &lt;a&gt;here&lt;<span class="regexp">/a&gt; to continue&lt;/</span>p&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="HTML-使用tab键补全"><a href="#HTML-使用tab键补全" class="headerlink" title="HTML(使用tab键补全)"></a>HTML(使用tab键补全)</h2><p><strong>所有未知的缩写都会转换为标签，例如，foo—-&gt;<foo></foo></strong></p>
<ul>
<li>缩写<code>!</code></li>
<li>缩写<code>a:link</code></li>
<li>缩写<code>link:css</code></li>
<li>缩写<code>meta:vp</code>（响应式标签）</li>
<li>缩写<code>style</code></li>
<li>缩写<code>script:src</code></li>
<li>缩写<code>img</code></li>
<li>缩写<code>iframe</code></li>
<li>缩写<code>form:get</code></li>
<li>缩写<code>form:post</code></li>
<li>缩写<code>input:text</code></li>
<li>缩写<code>input:hidden</code></li>
<li>缩写<code>input:xxx</code></li>
<li>缩写<code>btn</code></li>
</ul>
<h2 id="CSS-使用tab键补全"><a href="#CSS-使用tab键补全" class="headerlink" title="CSS(使用tab键补全)"></a>CSS(使用tab键补全)</h2><ul>
<li><p>单位缩写及多值缩写</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">    <span class="selector-tag">m10</span> → <span class="selector-tag">margin</span>: 10<span class="selector-tag">px</span>;</div><div class="line">    <span class="selector-tag">m10-20</span> → <span class="selector-tag">margin</span>: 10<span class="selector-tag">px</span> 20<span class="selector-tag">px</span>;</div><div class="line">    <span class="selector-tag">m-10--20</span> → <span class="selector-tag">margin</span>: <span class="selector-tag">-10px</span> <span class="selector-tag">-20px</span>;</div><div class="line">    <span class="selector-tag">m0-a</span> → <span class="selector-tag">margin</span>: 0 <span class="selector-tag">auto</span>;</div><div class="line">    <span class="selector-tag">m1</span><span class="selector-class">.5em</span> → <span class="selector-tag">margin</span>: 1<span class="selector-class">.5em</span>;</div><div class="line">    <span class="selector-tag">m1</span><span class="selector-class">.5ex</span> → <span class="selector-tag">margin</span>: 1<span class="selector-class">.5ex</span>;</div><div class="line">    <span class="selector-tag">m10</span>% → <span class="selector-tag">margin</span>: 10%;</div><div class="line">    <span class="selector-tag">m10p30e5x</span> → <span class="selector-tag">margin</span>: 10% 30<span class="selector-tag">em</span> 5<span class="selector-tag">ex</span></div></pre></td></tr></table></figure>
<p>  Tips：</p>
<ol>
<li>一些单位的简便写法：（p → %，e → em，x → ex，r → rem）</li>
<li>以下情况可以省略单位，Emmet会自动为其添加单位：若是整数，则添加px为单位，若是浮点数，则添加em为单位；</li>
<li>类似margin这样属性值可以有多位数值的情况，在填写多位数值时，中间加个连字符“-”作为分隔符，如果附带了单位，则附带单位的那个值后面就不再加连字符，因为Emmet可以将单位识别为分隔符，此处若再添加连字符，则Emmet认为你是要将下一个值设置为负值，例如：m10p-30e-5x → margin: 10% -30em -5ex;</li>
</ol>
</li>
<li><p>颜色值<br>  Emmet支持16进制的颜色值。</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">    <span class="selector-tag">c</span><span class="selector-id">#3</span> → <span class="selector-tag">color</span>: <span class="selector-id">#333</span>;</div><div class="line">    <span class="selector-id">#1</span> → <span class="selector-id">#111111</span></div><div class="line">    <span class="selector-id">#e0</span> → <span class="selector-id">#e0e0e0</span></div><div class="line">    <span class="selector-id">#fc0</span> → <span class="selector-id">#ffcc00</span></div><div class="line">    <span class="selector-tag">bd5</span><span class="selector-id">#0s</span> → <span class="selector-tag">border</span>: 5<span class="selector-tag">px</span> <span class="selector-id">#000</span> <span class="selector-tag">solid</span>;</div></pre></td></tr></table></figure>
</li>
<li><p>需要单位的属性值</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    <span class="selector-tag">lh2px</span>→ <span class="selector-tag">line-height</span><span class="selector-pseudo">:2px</span>;</div></pre></td></tr></table></figure>
</li>
<li><p>添加!important<br>  只要在任何要添加“!important”的CSS缩写代码后面添加“!”后缀就可以啦！</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    <span class="selector-tag">p</span>!+<span class="selector-tag">m10e</span>!</div></pre></td></tr></table></figure>
<p>  生成</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">    <span class="selector-tag">padding</span>: !<span class="selector-tag">important</span>;</div><div class="line">    <span class="selector-tag">margin</span>: 10<span class="selector-tag">em</span> !<span class="selector-tag">important</span>;</div></pre></td></tr></table></figure>
<p>  Tip：<br>  +不仅在HTML中有作用哦，在CSS中，如果要你连续写多个属性值对，也可以用+进行连接。</p>
</li>
<li><p>自动前缀</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    <span class="selector-tag">bdrs</span></div></pre></td></tr></table></figure>
<p>  生成</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">    <span class="selector-tag">-webkit-border-radius</span>: ;</div><div class="line">    <span class="selector-tag">-moz-border-radius</span>: ;</div><div class="line">    <span class="selector-tag">border-radius</span>: ;</div></pre></td></tr></table></figure>
<p>  生成指定的某个前缀</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    <span class="selector-tag">-wm-trf</span></div></pre></td></tr></table></figure>
<p>  生成</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">    <span class="selector-tag">-webkit-transform</span>: ;</div><div class="line">    <span class="selector-tag">-moz-transform</span>: ;</div><div class="line">    <span class="selector-tag">transform</span>: ;</div></pre></td></tr></table></figure>
<p>  各个前缀的缩写如下：</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">    <span class="selector-tag">w</span>: <span class="selector-tag">webkit</span></div><div class="line">    <span class="selector-tag">m</span>: <span class="selector-tag">moz</span></div><div class="line">    <span class="selector-tag">s</span>: <span class="selector-tag">ms</span></div><div class="line">    <span class="selector-tag">o</span>: <span class="selector-tag">o</span></div></pre></td></tr></table></figure>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[HTML-DOM教程]]></title>
      <url>http://heji.website/2016/12/20/HTML-DOM%E6%95%99%E7%A8%8B/</url>
      <content type="html"><![CDATA[<p>DOM是W3C的标准，是与语言无关的通用的用于操作文档的一种技术规范。</p>
<a id="more"></a>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><h3 id="什么是DOM"><a href="#什么是DOM" class="headerlink" title="什么是DOM"></a>什么是DOM</h3><p>DOM是W3C的标准。DOM定义了访问HTML和XML文档的标准：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&quot;W3C 文档对象模型 （DOM） 是中立于平台和语言的接口，它允许程序和脚本动态地访问和更新文档的内容、结构和样式。&quot;</div></pre></td></tr></table></figure></p>
<p>W3C DOM标准被分为3个不同的部分：</p>
<ul>
<li>核心DOM-针对任何结构化文档的标准模型</li>
<li>XMLDOM-针对XML文档的标准模型</li>
<li>HTMLDOM-针对HTML文档的标准模型</li>
</ul>
<p><strong>注：DOM是Document Object Model(文档对象模型)的缩写</strong></p>
<h3 id="理解DOM-Level以及兼容性"><a href="#理解DOM-Level以及兼容性" class="headerlink" title="理解DOM Level以及兼容性"></a>理解DOM Level以及兼容性</h3><h4 id="DOM-Level"><a href="#DOM-Level" class="headerlink" title="DOM Level"></a>DOM Level</h4><p>DOM的标准化不是一蹴而就的，而是一步步地改进完善。DOM Level本质上是DOM标准化过程中的不同版本。分为1级DOM、2级DOM、3级DOM以及“0级”DOM。</p>
<ul>
<li>1级DOM<br>1级DOM在1998年10月份成为W3C的提议，由DOM核心与DOM HTML两个模块组成。DOM核心能映射以XML为基础的文档结构，允许获取和操作文档的任意部分。DOM HTML通过添加HTML专用的对象与函数对DOM核心进行了扩展。</li>
<li>2级DOM<br>鉴于1级DOM仅以映射文档结构为目标，DOM 2级面向更为宽广。通过对原有DOM的扩展，2级DOM通过对象接口增加了对鼠标和用户界面事件（DHTML长期支持鼠标与用户界面事件）、范围、遍历（重复执行DOM文档）和层叠样式表（CSS）的支持。同时也对DOM 1的核心进行了扩展，从而可支持XML命名空间。</li>
<li>3级DOM<br>3级DOM通过引入统一方式载入和保存文档和文档验证方法对DOM进行进一步扩展，DOM3包含一个名为“DOM载入与保存”的新模块，DOM核心扩展后可支持XML1.0的所有内容，包括XML Infoset、 XPath、和XML Base。</li>
<li>“0级”DOM<br>当阅读与DOM有关的材料时，可能会遇到参考0级DOM的情况。需要注意的是并没有标准被称为0级DOM，它仅是DOM历史上一个参考点（0级DOM被认为是在Internet Explorer 4.0 与Netscape Navigator4.0支持的最早的DHTML）。</li>
</ul>
<h4 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h4><p>每一个DOM Level都有描述它的标准和文档，但他们并没有被完整地实现，浏览器只是简单地挑选了其中的有用功能，而且，已经实现的功能之间还存在某种程度的不一致性。<br>有多种方式应对DOM功能的多变性：</p>
<ol>
<li>使用JavaScript库<br>JavaScript库消除了浏览器之间实现方式的差别，优点是其一致性，缺点是只能使用库支持的那些功能。</li>
<li>保守方式<br>只使用你所知的被广泛支持的那些功能。</li>
<li><p>测试DOM功能<br> 第三种方式是测试与某一功能相关的DOM对象属性或方法是否存在。</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">var</span> images;</div><div class="line">    <span class="keyword">if</span>(<span class="built_in">document</span>.querySelectorAll)&#123;</div><div class="line">      images = <span class="built_in">document</span>.querySelectorAll(<span class="string">"#paratext &gt; img"</span>);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">      images = <span class="built_in">document</span>.getElementById(<span class="string">"paratext"</span>).getElementsByTagName(<span class="string">"img"</span>);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p> 缺陷是充斥大量测试代码，且并不总是存在另一种方式能实现某个给定功能的效果。</p>
</li>
</ol>
<p><strong>在这篇文章，我们主要学习的是HTMLDOM，HTML DOM 定义了所有 HTML 元素的<em>对象</em>和<em>属性</em>，以及访问它们的<em>方法</em>。</strong></p>
<h2 id="使用Document对象"><a href="#使用Document对象" class="headerlink" title="使用Document对象"></a>使用Document对象</h2><p>DOM的一个关键组成部分就是Document对象。Document对象是通往DOM功能的入口，它向你提供了当前文档的信息，以及一组可供探索、导航、搜索或操作结构与内容的功能。<br>我们通过变量document访问Document对象，它是浏览器为我们创建的关键对象之一。</p>
<h3 id="使用Document元数据"><a href="#使用Document元数据" class="headerlink" title="使用Document元数据"></a>使用Document元数据</h3><p>Document对象的用途之一是向你提供关于文档的信息。下表介绍了你可以用来获取文档元数据的属性。<br><img src="index_files/2a3d6ac2-be28-4a8c-993d-53638e53871f.jpg" alt=""></p>
<ul>
<li><p>获取文档信息</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="built_in">document</span>.writeln(<span class="string">"&lt;pre&gt;"</span>);</div><div class="line">            <span class="built_in">document</span>.writeln(<span class="string">"characterSet:"</span>+<span class="built_in">document</span>.characterSet); <span class="comment">//只读</span></div><div class="line">            <span class="built_in">document</span>.writeln(<span class="string">"charset:"</span>+<span class="built_in">document</span>.charset); <span class="comment">//读取</span></div><div class="line">            <span class="built_in">document</span>.writeln(<span class="string">"compatMode:"</span>+<span class="built_in">document</span>.compatMode); </div><div class="line">            <span class="built_in">document</span>.writeln(<span class="string">"defaultCharset:"</span>+<span class="built_in">document</span>.defaultCharset);</div><div class="line">            <span class="built_in">document</span>.writeln(<span class="string">"domain:"</span>+<span class="built_in">document</span>.domain);</div><div class="line">            <span class="built_in">document</span>.writeln(<span class="string">"referrer:"</span>+<span class="built_in">document</span>.referrer);</div><div class="line">            <span class="built_in">document</span>.writeln(<span class="string">"lastModified:"</span>+<span class="built_in">document</span>.lastModified);</div><div class="line">            <span class="built_in">document</span>.writeln(<span class="string">"cookie:"</span>+<span class="built_in">document</span>.cookie);</div><div class="line">            <span class="built_in">document</span>.writeln(<span class="string">"&lt;/pre&gt;"</span>);</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  理解怪异模式<br>  compatMode属性告诉你浏览器是如何处理文档内容的。现如今存在着大量的非标准HTML，浏览器则试图显示这类网页，哪怕它们并不遵循HTML规范。一些这样的内容依赖于浏览器的特殊功能，而这些功能来源于浏览器依靠自身特点（而非遵循标准）进行竞争的年代。compatMode属性会返回两个值中的一个。</p>
  <table><thead><tr><th>值</th><th>说明</th></tr><thead><tbody><tr><td> CSS1Compat </td><td>此文档遵循某个有效的HTML规范（不必是HTML5规范）</td></tr><tr><td> BackCompat </td><td>此文档含有非标准功能，已触发怪异模式</td></tr></tbody></thead></thead></table>
</li>
<li><p>使用Location对象<br>  document.location属性返回一个Location对象，这个对象给你提供了细粒度的文档地址信息，也允许你导航到其他文档上。<br>  <img src="index_files/44115d5b-91d5-446a-a0b2-7a4f02d79d20.jpg" alt=""><br>  使用Location对象导航到其他地方</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"bananaBtn"</span>&gt;</span>链接到香蕉<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"testAssign"</span>&gt;</span>assign页面跳转<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"testReplace"</span>&gt;</span>replace页面跳转<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"banana"</span> <span class="attr">style</span>=<span class="string">"position: relative;top: 2000px;"</span>&gt;</span></div><div class="line">        此处应该有香蕉</div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="comment">//等价于&lt;a href="#banana"&gt;链接到香蕉&lt;/a&gt;</span></div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">"bananaBtn"</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="built_in">document</span>.location.hash = <span class="string">"banana"</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">"testAssign"</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="built_in">document</span>.location.assign(<span class="string">"https://www.google.com.hk"</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">"testReplace"</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="comment">//使用replace在浏览历史找不到，无法返回上一个页面</span></div><div class="line">                <span class="built_in">document</span>.location.replace(<span class="string">"https://www.google.com.hk"</span>);</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>读取和写入cookie<br>  cookie属性让你可以读取、添加和更新文档所关联的cookie。当读取cookie属性的值时，会得到与文档相关联的所有cookie。cookie的形式为name=value，如果存在多个cookie，以分号相隔。操作cookie的方法是直接给cookie属性赋值，如果要添加的cookie在现有cookie集合中没有，则添加的cookie新增到现有的cookie集合，否则会更新现有cookie。下面是完整示例：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">    &lt;!DOCTYPE html&gt;</div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"cookieData"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"addCookie"</span>&gt;</span>添加cookie<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"updateCookie"</span>&gt;</span>更新最后一个cookie<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> counter = <span class="number">0</span>;</div><div class="line">            readCookie();</div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">"addCookie"</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                counter++;</div><div class="line">                <span class="built_in">document</span>.cookie = <span class="string">"cookie_"</span>+counter+<span class="string">"=value_"</span>+counter;</div><div class="line">                readCookie();</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">"updateCookie"</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="built_in">document</span>.cookie = <span class="string">"cookie_"</span>+counter+<span class="string">"=update_"</span>+counter;</div><div class="line">                readCookie();</div><div class="line">            &#125;</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">readCookie</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="built_in">document</span>.getElementById(<span class="string">"cookieData"</span>).innerHTML = <span class="built_in">document</span>.cookie;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  虽然添加cookie的默认形式是name=value，但可以额外应用一些数据改变cookie的处理方式<br>  <img src="index_files/ce20ba02-a003-4b34-b9ae-660cd08030e0.jpg" alt=""></p>
</li>
<li>理解就绪状态<br>  document.readyState属性向你提供了加载和解析HTML文档过程中当前处于哪个阶段的信息。了解浏览器加载和处理HTML到了哪个阶段可能会很有用。readyState属性会返回三个不同的值。<br>  <table><thead><tr><th>值</th><th>说明</th></tr><thead><tbody><tr><td> loading </td><td>浏览器正在加载和处理此文档</td></tr><tr><td> interactive </td><td>文档已被解析，但浏览器还在加载其中链接的资源（图像媒体文件等）</td></tr><tr><td> complete </td><td>文档解析完，资源也加载完</td></tr></tbody></thead></thead></table><br>  这个属性和readystatechange事件结合使用时用处最大，该事件会在每次readyState属性的值发生变化时触发。  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">    &lt;!DOCTYPE html&gt;</div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="built_in">document</span>.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="built_in">document</span>.readyState);</div><div class="line">                <span class="keyword">if</span>(<span class="built_in">document</span>.readyState==<span class="string">"interactive"</span>)&#123;</div><div class="line">                    <span class="built_in">document</span>.getElementById(<span class="string">"pressme"</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                        <span class="built_in">document</span>.getElementById(<span class="string">"results"</span>).innerHTML = <span class="string">"Button Pressed"</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"pressme"</span>&gt;</span>Press me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">pre</span> <span class="attr">id</span>=<span class="string">"results"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">pre</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>获取DOM的实现情况<br>document.implementation属性提供了浏览器对DOM功能的实现信息，这个属性返回一个DOMImplementation对象，对象有一个hasFeature方法，这个方法可以用来判断哪些DOM功能已实现。</li>
</ul>
<h3 id="获取HTML元素对象"><a href="#获取HTML元素对象" class="headerlink" title="获取HTML元素对象"></a>获取HTML元素对象</h3><ul>
<li><p>使用属性获取元素对象<br>  Document对象提供了一组属性，它们会返回文档中特定元素或元素类型的对象。<br>  <img src="index_files/c8bf8a8a-63d9-46f3-884a-763dbb18d481.jpg" alt=""><br>  使用namedItem方法<br>  namedItem方法会返回集合里带有指定id或name属性值的项目。例如：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">    <span class="comment">//返回id或name属性值为apple的图片的src。优先返回匹配id属性的元素，如果没有匹配id的元素，则返回第一个匹配name属性的元素，如果还是没有，返回null</span></div><div class="line">    <span class="built_in">document</span>.images.namedItem(<span class="string">"apple"</span>).src;</div></pre></td></tr></table></figure>
</li>
<li><p>搜索元素<br>  Document对象定义了很多方法，可以用他们搜索文档里的元素。</p>
  <table><thead><tr><th> 属性 </th><th>说明</th><th> 返回 </th></tr><thead><tbody><tr><td>getElementById(id)</td><td>返回带有指定id值的元素</td><td> HTMLElement </td></tr><tr><td>getElementsByClassName(class)</td><td>返回带有指定class类的元素</td><td> 数组 </td></tr><tr><td>getElementsByName(name)</td><td> 返回带有指定name值的元素 </td><td> 数组 </td></tr><tr><td>getElementsByTagName(tag)</td><td> 返回指定类型的元素 </td><td> 数组 </td></tr><tr><td>getElementsByName(name)</td><td> 返回带有指定name值的元素 </td><td> 数组 </td></tr><tr><td>querySelector(selector)</td><td> 返回匹配指定CSS选择器的第一个元素 </td><td>HTMLElement</td></tr><tr><td>querySelectorAll(selector)</td><td>返回匹配指定CSS选择器的所有元素</td><td> 数组 </td></tr></tbody></thead></thead></table>
</li>
<li><p>合并进行链式搜索<br>  DOM的一个使用功能是几乎所有的Document对象实现的搜索方法同时也能被HTMLElement对象实现（一个例外），这让你可以合并进行链式搜索。唯一的例外是getElementById方法，只有Document对象才能使用它。例如：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"tblock"</span>).getElementsByTagName(<span class="string">"span"</span>);</div><div class="line">    <span class="comment">//等价于</span></div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"tblock"</span>).querySelectorAll(<span class="string">"span"</span>);</div><div class="line">    <span class="comment">//等价于</span></div><div class="line">    <span class="built_in">document</span>.querySelectorAll(<span class="string">"#tblock &gt; span"</span>);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="在DOM树里导航"><a href="#在DOM树里导航" class="headerlink" title="在DOM树里导航"></a>在DOM树里导航</h3><p>另一种搜索元素的方法是将DOM视为一棵树，然后在它的层级结构里导航。所有的DOM对象都支持一组属性和方法来让我们做到这一点。<br><img src="index_files/1c7d1dc8-2ea0-4e46-8835-2cde3613fc34.jpg" alt=""></p>
<h2 id="使用Window对象"><a href="#使用Window对象" class="headerlink" title="使用Window对象"></a>使用Window对象</h2><h3 id="获取window对象"><a href="#获取window对象" class="headerlink" title="获取window对象"></a>获取window对象</h3><p>可以用两种方式获得window对象。正规的HTML5方式是在Document对象上使用defaultView属性。另一种是使用所有浏览器都支持的全局变量window。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.outerWidth);</div><div class="line"><span class="comment">//等价于</span></div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">document</span>.defaultView.outerHeight);</div></pre></td></tr></table></figure></p>
<h3 id="获取窗口信息"><a href="#获取窗口信息" class="headerlink" title="获取窗口信息"></a>获取窗口信息</h3><p>顾名思义，Window对象的基本功能涉及到当前文档所显示的窗口。下表列出了这些功能的属性和方法。</p>
<p><img src="index_files/d32ac75b-3743-4788-b758-d09d56200b6d.jpg" alt=""><br><img src="index_files/7726888c-bc8a-40f0-9185-c7fe050088e2.jpg" alt=""></p>
<p>screen对象的宽高取决于屏幕大小，与浏览器窗口大小无关，window对象的宽高取决于浏览器窗口的大小。</p>
<h3 id="与窗口进行交互"><a href="#与窗口进行交互" class="headerlink" title="与窗口进行交互"></a>与窗口进行交互</h3><p>Window对象提供了一组方法，可以用它们与包含文档的窗口进行交互。</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>blur()</td>
<td>让窗口失去键盘焦点</td>
<td>void</td>
</tr>
<tr>
<td>close()</td>
<td>关闭窗口</td>
<td>void</td>
</tr>
<tr>
<td>focus()</td>
<td>让窗口获得键盘焦点</td>
<td>void</td>
</tr>
<tr>
<td>print()</td>
<td>提示用户打印页面</td>
<td>void</td>
</tr>
<tr>
<td>scrollBy(x,y)</td>
<td>让文档相对于当前位置进行滚动</td>
<td>void</td>
</tr>
<tr>
<td>scrollTo(x,y)</td>
<td>滚动到指定的位置</td>
<td>void</td>
</tr>
<tr>
<td>stop()</td>
<td>停止加载文档</td>
<td>void</td>
</tr>
</tbody>
</table>
<p>这些方法应该谨慎使用，因为它们会让用户失去对浏览器窗口的控制。</p>
<h3 id="对用户进行提示"><a href="#对用户进行提示" class="headerlink" title="对用户进行提示"></a>对用户进行提示</h3><p>Window对象包含一组方法，能以不同的方式对用户进行提示。<br><img src="index_files/943ed4c3-746d-435b-b55f-1788c5eea0fc.jpg" alt=""></p>
<p>下面是例子：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> confirmd = <span class="built_in">window</span>.confirm(<span class="string">"哈哈哈"</span>);</div><div class="line">            <span class="built_in">console</span>.log(confirmd); <span class="comment">//true or false</span></div><div class="line">            <span class="keyword">var</span> responseText = <span class="built_in">window</span>.prompt(<span class="string">"Enter a word"</span>,<span class="string">"hello"</span>);</div><div class="line">            <span class="built_in">console</span>.log(responseText);  <span class="comment">//hello是默认值</span></div><div class="line">            <span class="comment">//window.showModalDialog("animation.html"); //已不支持</span></div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="获取基本信息"><a href="#获取基本信息" class="headerlink" title="获取基本信息"></a>获取基本信息</h3><p>Window对象让你能访问某些返回基本信息的对象。下表是返回的对象：<br><img src="index_files/bea626a9-00bd-435d-8ae3-980365be7e8a.jpg" alt=""><br>Document对象和Location对象之前已经讲过，下面介绍History对象。</p>
<h3 id="使用浏览器历史"><a href="#使用浏览器历史" class="headerlink" title="使用浏览器历史"></a>使用浏览器历史</h3><p>window.history属性返回一个History对象，你可以用它对浏览器历史进行一些基本的操作。<br><img src="index_files/003ae2a2-7539-4629-b109-234a6c42ee1e.jpg" alt=""></p>
<ul>
<li>在浏览历史中导航<br>back、forward和go这三个方法告诉浏览器该导航到浏览历史中的哪个URL上。back/forward方法的效果和浏览器的后退/前进按钮是一致的。go方法会导航至当前文档的某个浏览历史位置。正值表示浏览器应该在浏览历史中前进，负值则表示后退。</li>
<li><p>在浏览历史里插入条目<br>  History.pushState方法允许我们给浏览器历史添加一个URL，但有一些约束条件。URL的服务器名称和端口号必须与当前文档的相同。例：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    <span class="built_in">window</span>.history.push(<span class="string">""</span>,<span class="string">""</span>,<span class="string">"?#"</span>+event.target.id);</div></pre></td></tr></table></figure>
<p>  当向浏览器历史添加条目时，不需要局限于当前页面，可以指定任何URL，只需要来源和当前文档相同即可。例如：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    <span class="built_in">window</span>.history.push(<span class="string">""</span>,<span class="string">""</span>,<span class="string">"otherpage.html?#"</span>+event.target.id);</div></pre></td></tr></table></figure>
<p>  添加条目之后，导航框显示的是另一个文档的URL，但文档本身没有变化。如果用户导航至别的文档，然后点击后退时，浏览器会自行选择显示原来的文档还是指定的文档（otherpage.html）</p>
</li>
</ul>
<h3 id="使用跨文档消息传递（重要）"><a href="#使用跨文档消息传递（重要）" class="headerlink" title="使用跨文档消息传递（重要）"></a>使用跨文档消息传递（重要）</h3><p>Window对象还为另一种名为“跨文档消息传递”的HTML5新功能提供了入口。通常，不同来源（协议不同或主机不同或端口不同）的脚本是不允许进行通信的。但HTML5通过Window里的方法为这类通信提供了一种规范。</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>postMessage(msg,origin)</td>
<td>给另一个文档发送指定的消息</td>
<td>void</td>
</tr>
</tbody>
</table>
<p>下面是详细例子：</p>
<ul>
<li><p>postMessage.html文档</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"satus"</span>&gt;</span>Ready<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"send"</span>&gt;</span>Send message<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!--不同源文档通信,这里端口号不同,本文档使用8030端口--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">"main"</span> <span class="attr">name</span>=<span class="string">"main"</span> <span class="attr">src</span>=<span class="string">"http://127.0.0.1:8888/otherpage.html"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">"send"</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="comment">//window对象的postMessage方法,第一个参数是数据,第二个参数是origin</span></div><div class="line">                <span class="built_in">window</span>[<span class="string">"main"</span>].postMessage(<span class="string">"I like apples"</span>,<span class="string">"http://127.0.0.1:8888"</span>);</div><div class="line">                <span class="built_in">document</span>.getElementById(<span class="string">"satus"</span>).innerHTML = <span class="string">"Message sent"</span>;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>otherpage.html文档</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">"message"</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="built_in">window</span>.addEventListener(<span class="string">"message"</span>,receiveMessage,<span class="literal">false</span>);</div><div class="line">            <span class="comment">//接收消息</span></div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">receiveMessage</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                <span class="comment">//e.orgin表示消息来源</span></div><div class="line">                <span class="keyword">if</span>(e.origin==<span class="string">"http://127.0.0.1:8030"</span>)&#123;</div><div class="line">                    <span class="comment">//e.data表示接收的数据</span></div><div class="line">                    displayMessage(e.data);</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    displayMessage(<span class="string">"Message discarded!"</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//显示消息</span></div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">displayMessage</span>(<span class="params">msg</span>)</span>&#123;</div><div class="line">                <span class="built_in">document</span>.getElementById(<span class="string">"message"</span>).innerHTML = msg;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p>注意上例中，window[“main”]可以获取到name属性为main的iframe的window对象。此外，Window对象还提供了其他寻找嵌入文档所需的支持，见下表：<br><img src="index_files/e7a361ef-86e9-43c1-b0b8-28e839998c72.jpg" alt=""><br><code>message</code>事件返回的MessageEvent对象的属性：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>data</td>
<td>返回别的脚本发送的消息</td>
<td>对象</td>
</tr>
<tr>
<td>origin</td>
<td>返回发送消息脚本的来源</td>
<td>字符串</td>
</tr>
<tr>
<td>source</td>
<td>返回发送消息脚本所关联的窗口</td>
<td>Window</td>
</tr>
</tbody>
</table>
<h3 id="使用计时器"><a href="#使用计时器" class="headerlink" title="使用计时器"></a>使用计时器</h3><p>Window对象提供了一个有用功能是可以设置一次性和循环的计时器。这些计时器被用于在预设的时间段后执行某个函数。</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>clearInterval(id)</td>
<td>撤销某个时间间隔计时器</td>
<td>void</td>
</tr>
<tr>
<td>clearTimeout(id)</td>
<td>撤销某个超时计时器</td>
<td>void</td>
</tr>
<tr>
<td>setInterval(function,time)</td>
<td>创建一个计时器，每隔time毫秒循环调用指定函数</td>
<td>计时器的id</td>
</tr>
<tr>
<td>setTimeout(function,time)</td>
<td>创建一个计时器，等待time毫秒之后调用指定的函数</td>
<td>计时器的id</td>
</tr>
</tbody>
</table>
<h2 id="使用DOM元素"><a href="#使用DOM元素" class="headerlink" title="使用DOM元素"></a>使用DOM元素</h2><h3 id="使用对象元素"><a href="#使用对象元素" class="headerlink" title="使用对象元素"></a>使用对象元素</h3><p>HTMLElement对象提供了一组属性，你可以用它们来读取和修改被代表元素的数据。<br><img src="index_files/5fbc7630-3d65-4785-9f68-d8873fcbfaaf.jpg" alt=""><br><strong>注意：诸如element.id之类获取元素属性的方法是HTML-DOM的内容，也就是说，这种写法只在HTML文档中能正常使用</strong></p>
<ul>
<li><p>使用类<br>  有两种方式处理某个元素所属的类。第一种方式是使用className属性。它会返回一个字符串形式的类列表。通过改变这个字符串的值，你就能添加或移除类。</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">    <span class="comment">//在原有基础上添加一个newClass的类</span></div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"textBlock"</span>).className += <span class="string">" newClass"</span>;</div></pre></td></tr></table></figure>
<p>  当想要快速给某个元素添加类时，使用className属性很方便，但如果想移除一个类时，用classList属性更方便，它返回一个DOMTokenList对象，这个对象定义了一些有用的属性和方法来管理类列表。<br>  <img src="index_files/5f47e41e-49c4-4f92-b439-8bc2adbf859e.jpg" alt=""></p>
</li>
<li>使用元素属性<br>  HTMLElement对象既有一些属性来对应最重要的HTML全局属性，又支持对单个元素的任意属性进行读取和设置。<br>  <img src="index_files/2bbc15b4-4a5b-41a3-803b-c5323dd4f6b5.jpg" alt=""><ol>
<li>使用以data-开头的自定义属性<br>使用HTMLElement对象的dataset属性返回的是一个由所有data-开头的属性值组成的数组，其索引根据的是名称的自定义部分。如果要获取elem元素的data-fruit属性的值，可以使用<code>elem.dataset[&quot;fruit&quot;]</code></li>
<li>使用所有属性<br>可以通过attributes属性获取一个包含元素所有属性的集合。它会返回一个由Attr对象组成的数组。Attr对象包含name属性和value属性，分别对应属性名和属性值。下面是例子：<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">    &lt;!DOCTYPE html&gt;</div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"text"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> attrs = <span class="built_in">document</span>.getElementById(<span class="string">"text"</span>).attributes;</div><div class="line">            <span class="built_in">console</span>.log(attrs);</div><div class="line">            <span class="built_in">console</span>.log(attrs[<span class="string">"id"</span>].name,attrs[<span class="string">"id"</span>].value);</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
<h3 id="使用Text对象"><a href="#使用Text对象" class="headerlink" title="使用Text对象"></a>使用Text对象</h3><p>元素的文本内容是由Text对象代表的。它在文档模型里表现为元素的子对象。当文本中包含元素时，如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">            测试Text对象及文本中的<span class="tag">&lt;<span class="name">b</span>&gt;</span>元素<span class="tag">&lt;/<span class="name">b</span>&gt;</span>.Text对象</div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> pElement = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"p"</span>)[<span class="number">0</span>];</div><div class="line">            <span class="comment">//3个子节点,包含两个文本节点,一个元素节点</span></div><div class="line">            <span class="built_in">console</span>.log(pElement.childNodes.length);</div><div class="line">            <span class="comment">//打印"测试Text对象及文本中的",注意,包含空格和换行符。</span></div><div class="line">            <span class="built_in">console</span>.log(pElement.firstChild.nodeValue);</div><div class="line">            <span class="comment">//打印".Text对象",注意,包含空格和换行符。</span></div><div class="line">            <span class="built_in">console</span>.log(pElement.lastChild.nodeValue);</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; pElement.childNodes.length ; i++)&#123;</div><div class="line">                <span class="comment">//元素节点的nodeType是1</span></div><div class="line">                <span class="keyword">if</span>(pElement.childNodes[i].nodeType==<span class="number">1</span>)&#123;</div><div class="line">                    <span class="comment">//打印"元素"</span></div><div class="line">                    <span class="built_in">console</span>.log(pElement.childNodes[i].firstChild.nodeValue);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>DOM模型如下图：<br><img src="index_files/04215fe1-e392-4048-89ea-a012c1e88f6d.jpg" alt=""><br>Text对象包含了一些操作对象的方法或属性：<br><img src="index_files/f26d0172-46dc-49d9-afe8-b382e67ff534.jpg" alt=""></p>
<h3 id="修改模型"><a href="#修改模型" class="headerlink" title="修改模型"></a>修改模型</h3><p>在前面的章节中，我们之所以能修改元素的属性和文本，是因为文档自身和DOM之间有着实时的连接。一旦你对DOM做了改动，浏览器就会让文档发生相应的变化。你也可以利用这一点改变DOM的层级结构，因为连接是实时的，你对DOM层级结构的修改会立即反映到浏览器中。<br>下面介绍了可用于修改DOM层级结构的属性和方法：</p>
<table>
<thead>
<tr>
<th>成员</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>appendChild(HTMLElement)</td>
<td>将指定元素添加为当前元素的子元素</td>
<td>添加的HTMLElement</td>
</tr>
<tr>
<td>cloneNode(boolean)</td>
<td>复制一个元素，参数指定是否复制子元素</td>
<td>复制出来的HTMLElement</td>
</tr>
<tr>
<td>innerHTML</td>
<td>获取或设置元素的内容</td>
<td>内容字符串</td>
</tr>
<tr>
<td>insertAdjacentHTML(pos,HTML片段)</td>
<td>相对于元素插入HTML片段</td>
<td>void</td>
</tr>
<tr>
<td>insertBefore(newElem,childElem)</td>
<td>在第二个子元素之前插入第一个元素</td>
<td>被插入的HTMLElement</td>
</tr>
<tr>
<td>isEqualNode(HTMLElement)</td>
<td>判断参数指定的元素是否与当前元素相同</td>
<td>布尔值</td>
</tr>
<tr>
<td>isSameNode(HTMLElement)</td>
<td>判断指定元素是否就是当前元素</td>
<td>布尔值</td>
</tr>
<tr>
<td>outerHTML</td>
<td>获取或设置元素的HTML和内容</td>
<td>元素及其内容字符串</td>
</tr>
<tr>
<td>removeChild(HTMLElement)</td>
<td>从当前元素上移除指定的子元素</td>
<td>返回移除的HTMLElement</td>
</tr>
<tr>
<td>replaceChild(newElem,oldElem)</td>
<td>替换当前元素的某个子元素</td>
<td>返回被替换的HTMLElement</td>
</tr>
</tbody>
</table>
<p>这些属性和方法对所有的元素对象都是适用的，另外，<strong>document对象</strong>定义了两个用于创建新元素的方法：</p>
<table>
<thead>
<tr>
<th>成员</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>createElement(tag)</td>
<td>创建一个属于指定标签类型的HTMLElement对象</td>
<td>HTMLElement</td>
</tr>
<tr>
<td>createTextNode(text)</td>
<td>创建一个带有指定内容的新的Text对象</td>
<td>Text</td>
</tr>
</tbody>
</table>
<ul>
<li><p>创建和删除元素<br>  你需要通过document对象创建新的元素，然后找到一个现存的HTMLElement，通过之前介绍的方法来插入它们。</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">    &lt;!DOCTYPE html&gt;</div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>banana<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>yellow<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>apple<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>red/green<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"add"</span>&gt;</span>add<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"remove"</span>&gt;</span>remove<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> tbody = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"tbody"</span>)[<span class="number">0</span>];</div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">"add"</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> newTr = <span class="built_in">document</span>.createElement(<span class="string">"tr"</span>);</div><div class="line">                newTr.setAttribute(<span class="string">"id"</span>,<span class="string">"newTr"</span>);</div><div class="line">                <span class="comment">//appendChild方法返回的是被插入的元素</span></div><div class="line">                newTr.appendChild(<span class="built_in">document</span>.createElement(<span class="string">"td"</span>))</div><div class="line">                .appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">"orange"</span>));</div><div class="line">                newTr.appendChild(<span class="built_in">document</span>.createElement(<span class="string">"td"</span>))</div><div class="line">                .appendChild(<span class="built_in">document</span>.createTextNode(<span class="string">"orange"</span>));</div><div class="line">                tbody.appendChild(newTr);</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">"remove"</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                tbody.removeChild(<span class="built_in">document</span>.getElementById(<span class="string">"newTr"</span>));</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>复制元素<br>  可以使用cloneNode方法来复制现有元素，cloneNode方法的布尔值参数指定了是否应该同时复制该元素的所有子元素，方法返回复制出来的元素。</p>
</li>
<li><p>移动元素<br>  要把元素从文档的一处移动到另一处，需要做的仅仅是把待移动的元素关联到新的父元素上，而不需要让该元素脱离它的初始位置。例如，把一张表格id为apple的行移动到另一张id为others的表格：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">var</span> elem = <span class="built_in">document</span>.getElementById(<span class="string">"apple"</span>);</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"others"</span>).appendChild(elem);</div></pre></td></tr></table></figure>
</li>
<li><p>比较元素对象<br>  可以通过两种方式比较元素对象。第一种方式是比较他们是否是同一个元素，使用isSameNode方法。另一种方式是使用isEqualNode方法测试元素对象是否相同。如果多个元素具有相同的类型，带有相同的属性，其子元素也相同并且排列顺序一致，那么他们就是相同元素。</p>
</li>
<li>使用HTML片段<br>  innerHTML属性，outerHTML属性和insertAdjacentHTML方法都是便利的语法捷径，它们让你能够使用HTML片段，从而不再需要创建元素和文本对象的详细层级结构。<ol>
<li>innerHTML和outerHTML<br>outerHTML属性返回一个字符串，它包含定义这个元素及其所有子元素的HTML。innerHTML属性只返回子元素的HTML。也可以通过设置outerHTML和innerHTML属性改变文档结构。</li>
<li>使用insertAdjacentHTML插入HTML片段（重要）<br>innerHTML和outerHTML属性对于替换现有的元素而言是很有用的，但是如果想要用HTML片段来插入新元素，就必须使用insertAdjacentHTML方法。方法接受两个参数，第一个参数是片段应该插入到相当当前元素哪个位置，第二个参数是要插入的片段。<br>第一个参数取值如下：<table><thead><tr><th> 值 </th><th>说明</th></tr><thead><tbody><tr><td> afterbegin </td><td>将片段作为当前元素的第一个子元素插入</td></tr><tr><td> afterend </td><td>将片段插入当前元素之后</td></tr><tr><td> beforebegin </td><td> 将片段插入当前元素之前 </td></tr><tr><td> beforeend </td><td> 将片段作为当前元素最后一个子元素插入 </td></tr></tbody></thead></thead></table></li>
</ol>
</li>
<li>向文本块插入元素<br>  修改模型的另一种重要方式是向由Text对象代表的文本块添加元素。下面是一个复杂的例子：  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">    &lt;!DOCTYPE html&gt;</div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"textblock"</span>&gt;</span>There are lots of different kinds of fruits.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"insert"</span>&gt;</span>Insert Element<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="comment">//将一个元素插入文本块</span></div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">"insert"</span>).onclick=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> textBlock = <span class="built_in">document</span>.getElementById(<span class="string">"textblock"</span>);</div><div class="line">                <span class="comment">//返回lots of different kinds of fruits.</span></div><div class="line">                textBlock.firstChild.splitText(<span class="number">10</span>);</div><div class="line">                <span class="comment">//textBlock.childNodes[1]即lots of different kinds of fruits.</span></div><div class="line">                <span class="comment">//textBlock.childNodes[1].splitText(4)返回 of different kinds of fruits.</span></div><div class="line">                <span class="comment">//newText即lots</span></div><div class="line">                <span class="keyword">var</span> newText=textBlock.childNodes[<span class="number">1</span>].splitText(<span class="number">4</span>).previousSibling;</div><div class="line">                <span class="built_in">console</span>.log(textBlock,newText);</div><div class="line">                <span class="comment">//下面这句相当于创建了一个b元素并插入到lots节点之前，然后把lots节点移动到b元素内。</span></div><div class="line">                textBlock.insertBefore(<span class="built_in">document</span>.createElement(<span class="string">"b"</span>),newText).appendChild(newText);</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="为DOM元素设置样式"><a href="#为DOM元素设置样式" class="headerlink" title="为DOM元素设置样式"></a>为DOM元素设置样式</h2><p>这一章，展示如何使用DOM操作文档中的CSS样式，包括显示定义的，也包括浏览器用来实际显示元素的计算样式（computed style)。但不少DOM处理样式规范没被实现，这里只把焦点放在浏览器实际使用的那些上，并非本章所有内容都能在各种主流浏览器上运行。</p>
<h3 id="使用样式表"><a href="#使用样式表" class="headerlink" title="使用样式表"></a>使用样式表</h3><p>可以通过document.styleSheets属性访问文档中可用的CSS样式表，它会返回一组对象集合，这些对象代表了与文档关联的各个样式表。每个样式表（包括使用style元素定义和使用link元素定义的）都由一个CSSStyleSheet对象代表，它提供了一组属性和方法来操作文档里的样式表(部分属性没列举)：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>disabled</td>
<td>获取或设置样式表的禁用状态</td>
<td>void</td>
</tr>
<tr>
<td>href</td>
<td>返回链接样式表的href,如果是style元素，返回null</td>
<td>字符串</td>
</tr>
<tr>
<td>media</td>
<td>返回应用到样式表上的媒介限制集合</td>
<td>MediaList</td>
</tr>
<tr>
<td>ownerNode</td>
<td>返回样式所定义的元素</td>
<td>HTMLElement（style或link）</td>
</tr>
<tr>
<td>title</td>
<td>返回title属性的值</td>
<td>字符串</td>
</tr>
<tr>
<td>type</td>
<td>返回type属性的值</td>
<td>字符串</td>
</tr>
</tbody>
</table>
<ul>
<li>获得样式表的基本信息<br>  使用CSSStyleSheet对象即可获取相应样式表的基本信息</li>
<li>使用媒介限制<br>  当定义样式表时，可以使用media属性来限制样式应用的场合。可以使用CSSStyleSheet.media属性访问这些限制，它会返回一个MediaList对象。下面是MediaList对象的方法和属性。  <table><thead><tr><th> 成员 </th><th>说明</th><th> 返回 </th></tr><thead><tbody><tr><td>appendMedium(medium)</td><td>添加一个新媒介到列表中</td><td>void</td></tr><tr><td>deleteMedium(medium)</td><td>从列表中移除一个媒介</td><td>void</td></tr><tr><td>item(pos)</td><td>返回指定索引的媒介</td><td> 字符串 </td></tr><tr><td> length </td><td>返回媒介的数量</td><td>数值</td></tr><tr><td> mediaText </td><td>返回media属性的文本值</td><td>字符串</td></tr></tbody></thead></thead></table></li>
<li><p>禁用样式表<br>  CSSStyleSheet.disabled属性可用来一次性启用和禁用某个样式表里的所有样式。</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"pressme"</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">     <span class="built_in">document</span>.stylesheet[<span class="number">0</span>].disabled = !<span class="built_in">document</span>.stylesheet[<span class="number">0</span>].disabled;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>CSSRuleList对象的成员<br>  CSSStyleSheet.cssRules属性会返回一个CSSRuleList对象，它允许你访问样式表里的各种样式。下面是CSSRuleList对象的成员：<br>  <table><thead><tr><th> 成员 </th><th>说明</th><th> 返回 </th></tr><thead><tbody><tr><td>item(pos)</td><td>返回指定索引的CSS样式（花括号包裹的即为一个CSSStyleRule）</td><td> CSSStyleRule </td></tr><tr><td> length </td><td>返回样式表里的样式数量</td><td>数值</td></tr></tbody></thead></thead></table><br>  样式表里每一种样式都由一个CSSStyleRule对象代表，下面是CSSStyleRule对象的成员。<br>  <table><thead><tr><th> 成员 </th><th>说明</th><th> 返回 </th></tr><thead><tbody><tr><td> cssText </td><td>获取或设置样式的文本</td><td>字符串</td></tr><tr><td> parentStyleSheet </td><td>获取此样式所属的样式表</td><td> CSSStyleSheet </td></tr><tr><td> selectorText </td><td> 获取或设置样式的选择器文本 </td><td> 字符串 </td></tr><tr><td> style </td><td> 获取一个代表具体样式属性的对象 </td><td> CSSStyleDeclaration </td></tr></tbody></thead></thead></table><br>  下面是综合例子：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">            <span class="selector-id">#test</span>&#123;</div><div class="line">                <span class="attribute">color</span>: black;</div><div class="line">                <span class="attribute">background-color</span>: <span class="number">#ccc</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="selector-id">#test</span> <span class="selector-tag">b</span>&#123;</div><div class="line">                <span class="attribute">color</span>: red;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"test"</span> <span class="attr">style</span>=<span class="string">"font-weight: 400;"</span>&gt;</span></div><div class="line">            哈哈哈哈<span class="tag">&lt;<span class="name">b</span>&gt;</span>嘿嘿<span class="tag">&lt;/<span class="name">b</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> CSSRule1 = <span class="built_in">document</span>.styleSheets[<span class="number">0</span>].cssRules.item(<span class="number">0</span>);</div><div class="line">            <span class="keyword">var</span> CSSRule2 = <span class="built_in">document</span>.styleSheets[<span class="number">0</span>].cssRules.item(<span class="number">1</span>);</div><div class="line">            <span class="comment">//#test &#123; color: black; background-color: rgb(204, 204, 204); &#125;</span></div><div class="line">            <span class="built_in">console</span>.log(CSSRule1.cssText);</div><div class="line">            <span class="comment">//#test b &#123; color: red; &#125;</span></div><div class="line">            <span class="built_in">console</span>.log(CSSRule2.cssText);</div><div class="line">            <span class="comment">//CSSRule1.style返回一个CSSStyleDeclaration对象</span></div><div class="line">            <span class="built_in">console</span>.log(CSSRule1.style.backgroundColor);</div><div class="line">            <span class="keyword">var</span> pObj = <span class="built_in">document</span>.getElementById(<span class="string">"test"</span>);</div><div class="line">            <span class="comment">//HTMLElement.style返回一个CSSStyleDeclaration对象，表示的是用style属性声明的样式</span></div><div class="line">            <span class="built_in">console</span>.log(pObj.style.fontWeight);</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="使用元素样式"><a href="#使用元素样式" class="headerlink" title="使用元素样式"></a>使用元素样式</h3><p>元素的style属性返回一个CSSStyleDeclaration对象，它表示通过元素style属性定义的样式。我们可以通过读取或设置cssText属性来读取或设置元素的样式，但这并不是一个很好的方法，下一节将会学习更健壮的方法。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"textblock"</span> <span class="attr">style</span>=<span class="string">"color:red;font-size:22px;"</span>&gt;</span>哈哈哈哈哈<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="comment">//表示通过元素style属性定义的样式</span></div><div class="line">            <span class="keyword">var</span> styleDeclaration = <span class="built_in">document</span>.getElementById(<span class="string">"textblock"</span>).style;</div><div class="line">            <span class="built_in">console</span>.log(styleDeclaration.cssText);</div><div class="line">            <span class="comment">//这样设置会覆盖原有所有样式</span></div><div class="line">            styleDeclaration.cssText = <span class="string">"color:green;border:1px solid #ccc;"</span>;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="使用CSSStyleDeclaration对象"><a href="#使用CSSStyleDeclaration对象" class="headerlink" title="使用CSSStyleDeclaration对象"></a>使用CSSStyleDeclaration对象</h3><p>你处理的是样式表还是某个元素的style属性并不重要。要通过DOM完全控制CSS，必须使用CSSStyleDeclaration对象。下面是这个重要对象的成员：</p>
<table>
<thead>
<tr>
<th>成员</th>
<th>说明</th>
<th>返回</th>
</tr>
</thead>
<tbody>
<tr>
<td>cssText</td>
<td>获取或设置样式的文本</td>
<td>字符串</td>
</tr>
<tr>
<td>getPropertyCSSValue(name)</td>
<td>获取指定的属性</td>
<td>CSSPrimitiveValue</td>
</tr>
<tr>
<td>getPropertyPriority(name)</td>
<td>获取指定属性的优先级</td>
<td>字符串</td>
</tr>
<tr>
<td>getPropertyValue(name)</td>
<td>获取字符串形式的指定值</td>
<td>字符串</td>
</tr>
<tr>
<td>item(pos)</td>
<td>获取指定位置的项目</td>
<td>字符串</td>
</tr>
<tr>
<td>parentRule</td>
<td>如果存在样式规则就获取它</td>
<td>CSSStyleRule</td>
</tr>
<tr>
<td>removeProperty(name)</td>
<td>移除指定的属性</td>
<td>字符串</td>
</tr>
<tr>
<td>setProperty(name,value,priority)</td>
<td>设置指定属性的值和优先级</td>
<td>void</td>
</tr>
<tr>
<td><code>&lt;style&gt;</code></td>
<td>获取或设置指定CSS属性的便捷属性</td>
<td>字符串</td>
</tr>
</tbody>
</table>
<ul>
<li><p>使用便捷属性</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">    <span class="built_in">document</span>.styleSheets[<span class="number">0</span>].cssRules.item(<span class="number">1</span>).style.color = <span class="string">"#f00"</span>;</div><div class="line">    <span class="built_in">document</span>.styleSheets[<span class="number">0</span>].cssRules.item(<span class="number">1</span>).style.backgroundColor = <span class="string">"#ccc"</span>;</div></pre></td></tr></table></figure>
<p>  color、border等没有连接符的CSS属性对应的便捷属性就是本身。padding-top、background-color等带连接符的CSS属性对应的便捷属性即使用驼峰式命名之后的CSS属性。</p>
</li>
<li><p>使用常规属性<br>  如果明确知道需要处理的CSS属性名称，而且存在相应的便捷属性，那么使用便捷属性是件很简单的事。如果需要以程序方式探索CSS属性或者需要获取/设置某个没有对应便捷属性的CSS属性，那么CSSStyleDeclaration对象的其他成员可能会派上用场。下面是综合例子：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"test"</span> <span class="attr">style</span>=<span class="string">"font-weight: 400;padding: 4px !important;"</span>&gt;</span></div><div class="line">            哈哈哈哈<span class="tag">&lt;<span class="name">b</span>&gt;</span>嘿嘿<span class="tag">&lt;/<span class="name">b</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> pObjCSS = <span class="built_in">document</span>.getElementById(<span class="string">"test"</span>).style;</div><div class="line">            <span class="comment">//使用DOM操作便捷CSS属性</span></div><div class="line">            <span class="built_in">console</span>.log(pObjCSS.fontWeight);</div><div class="line">            <span class="comment">//使用DOM操作常规CSS属性</span></div><div class="line">            <span class="built_in">console</span>.log(pObjCSS.getPropertyValue(<span class="string">"font-weight"</span>));</div><div class="line">            pObjCSS.setProperty(<span class="string">"font-weight"</span>,<span class="string">"bold"</span>);</div><div class="line">            <span class="comment">//使用程序方式探索元素的CSS属性</span></div><div class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; pObjCSS.length ; i++)&#123;</div><div class="line">                <span class="comment">//getPropertyPriority获取相应CSS属性的优先级，返回"!important"或者空字符串</span></div><div class="line">                <span class="built_in">console</span>.log(pObjCSS[i],pObjCSS.getPropertyValue(pObjCSS[i]),pObjCSS.getPropertyPriority(pObjCSS[i]));</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>使用细粒度的CSSDOM对象<br>  使用CSSStyleDeclaration.getPropertyCSSValue方法可以获取CSSPrimitiveValue对象，使用该对象能读取/设置更细粒度的属性，如属性值的单位、属性值的类型等。有兴趣可以自己找资料看。</p>
</li>
</ul>
<h3 id="使用计算样式"><a href="#使用计算样式" class="headerlink" title="使用计算样式"></a>使用计算样式</h3><p>之前我们都把焦点放在样式表或style属性中指定的CSS属性值上，但浏览器会从多个来源汇聚样式以计算出该用哪个值来显示某一元素。浏览器用于显示某个元素的CSS属性值集合被称为计算样式。可以通过document.defaultView.getComputedStyle（targetElem）方法获取某一元素计算样式的 CSSStyleDeclaration对象，这个对象包含了浏览器用来显示元素的所有属性细节。<br><strong>注意：获取到的计算样式都是只读属性，不能修改计算样式</strong><br>下面是例子：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">            <span class="selector-id">#test</span>&#123;</div><div class="line">                <span class="attribute">color</span>: red;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"test"</span> <span class="attr">style</span>=<span class="string">"margin: 2px;padding: 2px;"</span>&gt;</span>测试段落<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> pTag = <span class="built_in">document</span>.getElementById(<span class="string">"test"</span>);</div><div class="line">            <span class="keyword">var</span> styleDeclaration = <span class="built_in">document</span>.defaultView.getComputedStyle(pTag);</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; styleDeclaration.length ; i++)&#123;</div><div class="line">                <span class="comment">//console.log(styleDeclaration[i],styleDeclaration.getPropertyValue(styleDeclaration[i]))</span></div><div class="line">            &#125;</div><div class="line">            <span class="built_in">console</span>.log(styleDeclaration.getPropertyValue(<span class="string">"padding-top"</span>));</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="使用事件"><a href="#使用事件" class="headerlink" title="使用事件"></a>使用事件</h2><h3 id="使用简单事件处理器"><a href="#使用简单事件处理器" class="headerlink" title="使用简单事件处理器"></a>使用简单事件处理器</h3><p>元素为它们支持的事件都定义了一个事件属性。例如onmouseover事件属性对应于全局事件mouseover，后者会在用户把光标移动到元素占据的浏览器屏幕区域上方时触发。（这是一种通用模式：大多数事件都有一个对应的事件属性，其名称定义为<code>on&lt;enentname&gt;</code>）<br><strong>注意：这种简单的事件处理器是DOM 1级规范的内容，这样绑定事件只能绑定一个事件，后面绑定的会把前面绑定的事件覆盖</strong></p>
<ul>
<li><p>实现简单的内联事件处理器</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">onmouseover</span>=<span class="string">"this.style.color = '#f00';this.style.setProperty('border','1px solid #ccc');"</span> <span class="attr">onmouseout</span>=<span class="string">"this.style.removeProperty('color');this.style.removeProperty('border');"</span>&gt;</span> </div><div class="line">            测试简单的事件处理器</div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  内联事件处理器存在两个问题：其一是HTML与JavaScript混在一起，HTML代码难以阅读；其二是如果有多个具有相同行为的p元素，需要重复添加这些语句。</p>
</li>
<li>实现一个简单的事件处理函数<br>  其实就是把内联事件处理器的代码取出来封装在一个函数。</li>
</ul>
<h3 id="使用DOM和事件对象"><a href="#使用DOM和事件对象" class="headerlink" title="使用DOM和事件对象"></a>使用DOM和事件对象</h3><p>为实现事件与HTML代码分离，更优雅地定义事件处理器，需要使用DOM和JavaScript的Event对象。见下例：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>测试段落1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>测试段落2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> pTags = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"p"</span>);</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> pTags)&#123;</div><div class="line">                pTags[i].onmouseover = handleMouseOver;</div><div class="line">                pTags[i].onmouseout = handleMouseOut;</div><div class="line">            &#125;</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">handleMouseOver</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                e.target.style.setProperty(<span class="string">"border"</span>,<span class="string">"1px solid #ccc"</span>);</div><div class="line">                e.target.style.setProperty(<span class="string">"padding"</span>,<span class="string">"2px"</span>);</div><div class="line">                e.target.style.setProperty(<span class="string">"color"</span>,<span class="string">"red"</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">handleMouseOut</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                e.target.style.removeProperty(<span class="string">"border"</span>);</div><div class="line">                e.target.style.removeProperty(<span class="string">"padding"</span>);</div><div class="line">                e.target.style.removeProperty(<span class="string">"color"</span>);</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>事件触发时会有一个Event对象，这个对象提供了所发生的的事件信息。在详细讲解事件对象之前，先演示另一种使用addEventListener方法指定事件处理函数的方式，这是DOM2级定义的规范。例子如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>测试段落1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>测试段落2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"unbind"</span>&gt;</span>解除事件绑定<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> pTags = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"p"</span>);</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt;  pTags.length ; i++)&#123;</div><div class="line">                <span class="comment">//下面这种遍历方式遍历的是对象的属性，对于pTags而言，遍历的就是数组pTags的属性，除了索引外，数组还有length属性，pTags[length]就是2.绑定事件就会出现异常</span></div><div class="line">                <span class="comment">//for(var i in pTags)&#123;</span></div><div class="line">                pTags[i].addEventListener(<span class="string">'mouseover'</span>,handleMouseOver);</div><div class="line">                pTags[i].addEventListener(<span class="string">'mouseout'</span>,handleMouseOut);</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">"unbind"</span>).addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="comment">//解除事件绑定</span></div><div class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt;  pTags.length ; i++)&#123;</div><div class="line">                    pTags[i].removeEventListener(<span class="string">'mouseover'</span>,handleMouseOver);</div><div class="line">                    pTags[i].removeEventListener(<span class="string">'mouseout'</span>,handleMouseOut);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">handleMouseOver</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                e.target.style.setProperty(<span class="string">"border"</span>,<span class="string">"1px solid #ccc"</span>);</div><div class="line">                e.target.style.setProperty(<span class="string">"padding"</span>,<span class="string">"2px"</span>);</div><div class="line">                e.target.style.setProperty(<span class="string">"color"</span>,<span class="string">"red"</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">handleMouseOut</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                e.target.style.removeProperty(<span class="string">"border"</span>);</div><div class="line">                e.target.style.removeProperty(<span class="string">"padding"</span>);</div><div class="line">                e.target.style.removeProperty(<span class="string">"color"</span>);</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>addEventListener方法的优点在于它让你能够访问某些高级事件特性，后面会谈到。<br>下面来介绍Event事件对象：<br><img src="index_files/2969d766-689b-4cc2-9f13-2e8db2c57ae1.jpg" alt=""></p>
<ul>
<li><p>按类型区分事件<br>  event对象的type属性告诉你正在处理的事件是哪种类型的事件，这个值是以字符串的形式提供，比如mouseover。有了探测事件类型的能力，就可以用一个函数处理多个类型的事件，如下例：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>测试段落1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>测试段落2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"unbind"</span>&gt;</span>解除事件绑定<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> pTags = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"p"</span>);</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt;  pTags.length ; i++)&#123;</div><div class="line">                pTags[i].addEventListener(<span class="string">'mouseover'</span>,handleMouseEvent);</div><div class="line">                pTags[i].addEventListener(<span class="string">'mouseout'</span>,handleMouseEvent);</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">document</span>.getElementById(<span class="string">"unbind"</span>).addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="comment">//解除事件绑定</span></div><div class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt;  pTags.length ; i++)&#123;</div><div class="line">                    pTags[i].removeEventListener(<span class="string">'mouseover'</span>,handleMouseEvent);</div><div class="line">                    pTags[i].removeEventListener(<span class="string">'mouseout'</span>,handleMouseEvent);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">handleMouseEvent</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                <span class="keyword">if</span>(e.type==<span class="string">"mouseover"</span>)&#123;</div><div class="line">                    e.target.style.setProperty(<span class="string">"border"</span>,<span class="string">"1px solid #ccc"</span>);</div><div class="line">                    e.target.style.setProperty(<span class="string">"padding"</span>,<span class="string">"2px"</span>);</div><div class="line">                    e.target.style.setProperty(<span class="string">"color"</span>,<span class="string">"red"</span>);</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    e.target.style.removeProperty(<span class="string">"border"</span>);</div><div class="line">                    e.target.style.removeProperty(<span class="string">"padding"</span>);</div><div class="line">                    e.target.style.removeProperty(<span class="string">"color"</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>理解事件流<br>  一个事件的生命周期包括三个阶段：捕捉(capture)、目标（target）和冒泡（bubbling）。</p>
<ol>
<li><p>理解捕捉阶段<br>当某个事件被触发时，浏览器会找出事件涉及的元素（直接触发事件的元素），它被称为该事件的目标。浏览器会找出body元素和目标之间的所有元素并分别检查它们，看看它们是否带有事件处理器且是否要求获得其后代元素触发的事件。浏览器会先触发这些元素上的事件处理器，然后才轮到目标自身的处理器，这个阶段称为捕捉阶段。下面是具体例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"pblock"</span>&gt;</span></div><div class="line">            哈哈哈哈，我又回来了。现在来测试下<span class="tag">&lt;<span class="name">b</span> <span class="attr">id</span>=<span class="string">"btext"</span>&gt;</span>事件捕捉阶段<span class="tag">&lt;/<span class="name">b</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> btext = <span class="built_in">document</span>.getElementById(<span class="string">"btext"</span>);</div><div class="line">            <span class="keyword">var</span> pblock = <span class="built_in">document</span>.getElementById(<span class="string">"pblock"</span>);</div><div class="line">            btext.addEventListener(<span class="string">'mouseover'</span>,handleMouseEvent);</div><div class="line">            btext.addEventListener(<span class="string">'mouseout'</span>,handleMouseEvent);</div><div class="line">            <span class="comment">//第三个参数告诉浏览器我想让p元素在捕捉阶段触发p元素的事件</span></div><div class="line">            pblock.addEventListener(<span class="string">'mouseover'</span>,handleDescendantEvent,<span class="literal">true</span>);</div><div class="line">            pblock.addEventListener(<span class="string">'mouseout'</span>,handleDescendantEvent,<span class="literal">true</span>);</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">handleDescendantEvent</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(e.eventPhase); <span class="comment">//值为1,表示捕获阶段</span></div><div class="line">                <span class="comment">//只处理捕获阶段捕捉到的子元素的事件,不处理本身事件（目标阶段事件）,即鼠标悬停在p元素其他区域时不处理</span></div><div class="line">                <span class="keyword">if</span>(e.type==<span class="string">"mouseover"</span> &amp;&amp; e.eventPhase==Event.CAPTURING_PHASE)&#123;</div><div class="line">                    <span class="comment">//currentTarget表示的是当前被触发事件监听器的元素,target是事件涉及的元素(理解为直接触发事件的元素,该例鼠标悬停在b元素时才触发事件,所依target就表示b元素)</span></div><div class="line">                    e.target.style.border = <span class="string">'1px solid red'</span>;</div><div class="line">                    e.currentTarget.style.border = <span class="string">'1px solid black'</span>;</div><div class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(e.type==<span class="string">"mouseout"</span> &amp;&amp; e.eventPhase==Event.CAPTURING_PHASE)&#123;</div><div class="line">                    e.target.style.removeProperty(<span class="string">"border"</span>);</div><div class="line">                    e.currentTarget.style.removeProperty(<span class="string">"border"</span>);</div><div class="line">                &#125;</div><div class="line">                <span class="comment">//下面这句代码可以阻止事件流向目标元素,且跳过目标和冒泡阶段,即加了下面这句代码后,b元素的mouseover和mouseout事件将不会触发</span></div><div class="line">                <span class="comment">//e.stopPropagation();</span></div><div class="line">            &#125;</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">handleMouseEvent</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(e.eventPhase); <span class="comment">//值为2,表示目标阶段</span></div><div class="line">                <span class="keyword">if</span>(e.type==<span class="string">"mouseover"</span>)&#123;</div><div class="line">                    e.target.style.setProperty(<span class="string">"color"</span>,<span class="string">"red"</span>);</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    e.target.style.removeProperty(<span class="string">"color"</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p> 另，event对象的eventPhase属性会返回表示事件当前阶段的值</p>
<p> <img src="index_files/5536f2e2-c453-4140-848b-d83e72bae4ce.jpg" alt=""></p>
</li>
<li>理解目标阶段<br>目标阶段是三个阶段中最简单的。当捕捉阶段完成后，事件传递到目标，触发绑定在目标上的相应事件，在目标绑定的事件上使用Event.eventPhase获取到的即为表示目标阶段的值。<br><img src="index_files/0db62014-617d-4f64-9a94-a6defc5b3597.jpg" alt=""><br>需要注意的是，如果目标绑定多个事件（使用多个addEventListener绑定多个事件），那么会指定所有的事件处理方法。如果在目标阶段调用event.stopPropagation()，相当于终止了事件流，不再进入冒泡阶段。</li>
<li><p>理解冒泡阶段<br>完成目标阶段之后，浏览器开始转而沿着上级元素链朝body元素前进。在沿途的每个元素上，浏览器都会检查是否存在针对该事件类型但没有启用捕捉的监听器（addEventListener方法第三个参数设置为false，或不设置，默认是false），如果有，则触发元素上该事件。这就是事件冒泡。下面是具体例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"pblock"</span>&gt;</span></div><div class="line">            哈哈哈哈，我又回来了。现在来测试下<span class="tag">&lt;<span class="name">b</span> <span class="attr">id</span>=<span class="string">"btext"</span>&gt;</span>事件捕捉阶段<span class="tag">&lt;/<span class="name">b</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> btext = <span class="built_in">document</span>.getElementById(<span class="string">"btext"</span>);</div><div class="line">            <span class="keyword">var</span> pblock = <span class="built_in">document</span>.getElementById(<span class="string">"pblock"</span>);</div><div class="line">            btext.addEventListener(<span class="string">'mouseover'</span>,handleMouseEvent);</div><div class="line">            btext.addEventListener(<span class="string">'mouseout'</span>,handleMouseEvent);</div><div class="line">            <span class="comment">//省略第三个参数,默认是false,表示冒泡阶段触发事件</span></div><div class="line">            pblock.addEventListener(<span class="string">'mouseover'</span>,handleDescendantEvent);</div><div class="line">            pblock.addEventListener(<span class="string">'mouseout'</span>,handleDescendantEvent);</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">handleDescendantEvent</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(e.eventPhase); <span class="comment">//值为3,表示冒泡阶段</span></div><div class="line">                <span class="comment">//只处理冒泡阶段捕捉到的子元素的事件,不处理本身事件(目标阶段事件),即鼠标悬停在p元素其他区域时不处理</span></div><div class="line">                <span class="keyword">if</span>(e.type==<span class="string">"mouseover"</span> &amp;&amp; e.eventPhase==Event.BUBBLING_PHASE)&#123;</div><div class="line">                    <span class="comment">//currentTarget表示的是当前被触发事件监听器的元素,target是事件涉及的元素(理解为直接触发事件的元素,该例鼠标悬停在b元素时才触发事件,所依target就表示b元素)</span></div><div class="line">                    e.target.style.border = <span class="string">'1px solid red'</span>;</div><div class="line">                    e.currentTarget.style.border = <span class="string">'1px solid black'</span>;</div><div class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(e.type==<span class="string">"mouseout"</span> &amp;&amp; e.eventPhase==Event.BUBBLING_PHASE)&#123;</div><div class="line">                    e.target.style.removeProperty(<span class="string">"border"</span>);</div><div class="line">                    e.currentTarget.style.removeProperty(<span class="string">"border"</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">handleMouseEvent</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(e.eventPhase); <span class="comment">//值为2,表示目标阶段</span></div><div class="line">                <span class="keyword">if</span>(e.type==<span class="string">"mouseover"</span>)&#123;</div><div class="line">                    e.target.style.setProperty(<span class="string">"color"</span>,<span class="string">"red"</span>);</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    e.target.style.removeProperty(<span class="string">"color"</span>);</div><div class="line">                &#125;</div><div class="line">                <span class="comment">//e.stopPropagation();//目标阶段停止事件传播,则不进行冒泡阶段</span></div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p><img src="index_files/01f1aca7-c699-40d5-86a3-78864fc305e0.jpg" alt=""></p>
<p><strong>注意：并非所有事件都支持冒泡，可以用bubbles属性来检查某个事件能否冒泡</strong></p>
</li>
</ol>
</li>
<li><p>使用可撤销事件<br>  有些事件定义了一种默认行为，会在事件被触发时执行。例如，a元素被点击时默认行为是浏览器会载入href属性所指定URL的内容。当某一事件拥有默认行为时，event.cancelable属性就是true。你可以调用<code>event.preventDefault();</code>来阻止默认行为的执行。下面是例子：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.baidu.com"</span>&gt;</span>百度<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">            <span class="keyword">var</span> aLink = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"a"</span>)[<span class="number">0</span>];</div><div class="line">            aLink.addEventListener(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</div><div class="line">                <span class="keyword">if</span>(!confirm(<span class="string">"Do you want to visit "</span>+e.target.href+<span class="string">" ?"</span>))&#123;</div><div class="line">                    <span class="comment">//如果取消,则不访问链接</span></div><div class="line">                    e.preventDefault();</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  <strong>注意：调用preventDefault函数不会阻止事件流经捕获、目标和冒泡阶段</strong></p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[windows平台Nginx的安装和配置]]></title>
      <url>http://heji.website/2016/12/20/window%E5%B9%B3%E5%8F%B0Nginx%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/</url>
      <content type="html"><![CDATA[<p>Nginx是一个轻量级的高性能Http WebServer，以事件驱动方式编写，因此相比Apache而言，Nginx更加稳定，性能更好，而且配置简单，资源占用率低。</p>
<a id="more"></a>
<h2 id="Windows下Nginx基本安装和配置"><a href="#Windows下Nginx基本安装和配置" class="headerlink" title="Windows下Nginx基本安装和配置"></a>Windows下Nginx基本安装和配置</h2><h3 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h3><p>在官网下载<a href="http://nginx.org/download/nginx-1.10.2.zip" target="_blank" rel="external">nginx/Windows-1.10.2</a>解压即可，解压之后把安装目录添加到环境变量。</p>
<h3 id="启动Nginx"><a href="#启动Nginx" class="headerlink" title="启动Nginx"></a>启动Nginx</h3><p>运行命令<code>start nginx</code>启动nginx。默认启用80端口。用过Tomcat的人都希望能在控制台看到启动日志，nginx的日志却不得不查看logs目录下的相应log文件。</p>
<h3 id="停止Nginx"><a href="#停止Nginx" class="headerlink" title="停止Nginx"></a>停止Nginx</h3><p>Ctrl+C没反应。于是关闭控制台窗口。可是再访问<code>http://localhost</code>依然有效。查看进程，发现nginx根本没有被关闭。因此如果想彻底关闭nginx，应该是<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nginx <span class="_">-s</span> stop</div></pre></td></tr></table></figure></p>
<h3 id="访问欢迎html页"><a href="#访问欢迎html页" class="headerlink" title="访问欢迎html页"></a>访问欢迎html页</h3><p>在浏览器中访问<code>http://localhost</code>，可以看到默认的欢迎页。</p>
<h3 id="Ngnix常用配置"><a href="#Ngnix常用配置" class="headerlink" title="Ngnix常用配置"></a>Ngnix常用配置</h3><p>Nginx的所有配置都默认使用<code>conf/nginx.conf</code>文件。<br>常用配置如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">http &#123;</div><div class="line">  server &#123;</div><div class="line">    #1.侦听80端口 </div><div class="line">    listen  80; </div><div class="line">    location / &#123;</div><div class="line">        # 2. 默认主页目录在nginx安装目录的html子目录。</div><div class="line">        root   html;</div><div class="line">        index  index.html index.htm;</div><div class="line">        # 3. 没有索引页时，罗列文件和子目录</div><div class="line">        autoindex on;</div><div class="line">        autoindex_exact_size on;</div><div class="line">        autoindex_localtime on;</div><div class="line">    &#125;</div><div class="line">    # 4.指定虚拟目录</div><div class="line">    location /tshirt &#123;</div><div class="line">    alias D:\programs\Apache2\htdocs\tshirt;</div><div class="line">    index index.html index.htm;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  # 5.虚拟主机www.emb.info配置</div><div class="line">  server &#123;</div><div class="line">    listen          80;</div><div class="line">    server_name     www.emb.info;</div><div class="line">    access_log emb.info/logs/access.log;</div><div class="line">    location / &#123;</div><div class="line">      index index.html;</div><div class="line">      root  emb.info/htdocs;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[浮动元素如何撑开父元素]]></title>
      <url>http://heji.website/2016/12/14/%E6%B5%AE%E5%8A%A8%E5%85%83%E7%B4%A0%E5%A6%82%E4%BD%95%E6%92%91%E5%BC%80%E7%88%B6%E5%85%83%E7%B4%A0/</url>
      <content type="html"><![CDATA[<p>经常遇到这样的问题：子元素的内容超出父元素，引起很多其他的样式问题。出现该问题是因为父元素没有预先设置高度，所以父元素的高度由其包含的子元素高度决定。而子元素设置了浮动，脱离了正常文档流，所以设置了浮动的子元素不计算高度，就会产生父元素高度塌陷现象。<br><a id="more"></a></p>
<h2 id="理解浮动与清除浮动"><a href="#理解浮动与清除浮动" class="headerlink" title="理解浮动与清除浮动"></a>理解浮动与清除浮动</h2><p>浮动实际上就相当于设置元素<code>display:inline-block;</code>且让元素脱离正常文档流.</p>
<h3 id="文字环绕效果的实现"><a href="#文字环绕效果的实现" class="headerlink" title="文字环绕效果的实现"></a>文字环绕效果的实现</h3><p>因为父元素高度塌陷，所以文字会按正常顺序排列，无视浮动图片高度。而图片宽带又还在，所以实现了文字环绕效果。</p>
<h3 id="为何clear属性能清除浮动"><a href="#为何clear属性能清除浮动" class="headerlink" title="为何clear属性能清除浮动"></a>为何clear属性能清除浮动</h3><p>clear 属性规定元素的哪一侧不允许其他浮动元素。当给元素设置浮动时，浮动元素A会产生空白空间，空间长宽等于A的长宽，后面的浮动元素会自动补空缺。当给A元素之后的元素B设置<code>clear:both</code>时，元素B不仅不会去补空缺，而且会把元素A因浮动而产生的空白空间填充为实际空间。实际空间被计算高度，父元素被撑开。</p>
<h3 id="浮动元素撑开父元素的集中方法"><a href="#浮动元素撑开父元素的集中方法" class="headerlink" title="浮动元素撑开父元素的集中方法"></a>浮动元素撑开父元素的集中方法</h3><ul>
<li><p>父元素设置<code>overflow</code>以及<code>zoom</code>，样式如下</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"> </span></div><div class="line">	<span class="comment">/*zoom是设置缩放*/</span></div><div class="line">	<span class="selector-id">#div1</span>&#123;<span class="attribute">border</span>:<span class="number">1px</span> solid red;<span class="attribute">overflow</span>:hidden;<span class="attribute">zoom</span>:<span class="number">1</span>;&#125; </div><div class="line">	<span class="selector-id">#div2</span>,<span class="selector-id">#div3</span>&#123;<span class="attribute">float</span>:right;<span class="attribute">border</span>:<span class="number">1px</span> solid blue;&#125; </div><div class="line">	<span class="tag">&lt;/<span class="name">style</span>&gt;</span> </div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div1"</span>&gt;</span> </div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div2"</span>&gt;</span>two<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div3"</span>&gt;</span>one<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>父元素也设置浮动</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"> </span></div><div class="line">	<span class="selector-id">#div1</span>&#123;<span class="attribute">border</span>:<span class="number">1px</span> solid red;<span class="attribute">float</span>: left;<span class="attribute">width</span>: <span class="number">100%</span>;&#125; </div><div class="line">	<span class="selector-id">#div2</span>,<span class="selector-id">#div3</span>&#123;<span class="attribute">float</span>:right;<span class="attribute">border</span>:<span class="number">1px</span> solid blue;&#125; </div><div class="line">	<span class="tag">&lt;/<span class="name">style</span>&gt;</span> </div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div1"</span>&gt;</span> </div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div2"</span>&gt;</span>two<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div3"</span>&gt;</span>one<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>添加一个子元素，并设置clear样式</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">   <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"> </span></div><div class="line">	<span class="selector-id">#div1</span>&#123;<span class="attribute">border</span>:<span class="number">1px</span> solid red;&#125; </div><div class="line">	<span class="selector-id">#div2</span>,<span class="selector-id">#div3</span>&#123;<span class="attribute">float</span>:right;<span class="attribute">border</span>:<span class="number">1px</span> solid blue;&#125; </div><div class="line">	<span class="tag">&lt;/<span class="name">style</span>&gt;</span> </div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div1"</span>&gt;</span> </div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div2"</span>&gt;</span>two<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div3"</span>&gt;</span>one<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div4"</span> <span class="attr">style</span>=<span class="string">"clear: both;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">   <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[CSS3过渡、动画和变换]]></title>
      <url>http://heji.website/2016/12/13/CSS3%E8%BF%87%E6%B8%A1%E3%80%81%E5%8A%A8%E7%94%BB%E5%92%8C%E5%8F%98%E6%8D%A2/</url>
      <content type="html"><![CDATA[<p>这三个效果都是CSS3中新增的。但因为会消耗计算机的处理能力和分散注意力，所以需要谨慎使用<br><a id="more"></a></p>
<h2 id="过渡、动画和变换"><a href="#过渡、动画和变换" class="headerlink" title="过渡、动画和变换"></a>过渡、动画和变换</h2><h3 id="使用过渡"><a href="#使用过渡" class="headerlink" title="使用过渡"></a>使用过渡</h3><p>过渡效果一般是由浏览器直接改变元素的CSS属性实现的。例如，使用:hover选择器，一旦用户将鼠标悬停在元素之上，浏览器就会应用跟选择器关联的属性。但CSS过渡特性允许我们控制应用新属性值的速度。过渡属性取值及说明如下：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
<th>值</th>
</tr>
</thead>
<tbody>
<tr>
<td>transition-delay</td>
<td>指定过渡开始之前的延迟时间</td>
<td>&lt;时间&gt;</td>
</tr>
<tr>
<td>transition-duration</td>
<td>指定过渡的持续时间</td>
<td>&lt;时间&gt;</td>
</tr>
<tr>
<td>transition-property</td>
<td>指定应用过渡的属性</td>
<td>&lt;字符串&gt;</td>
</tr>
<tr>
<td>transition-timing-function</td>
<td>指定过渡期间计算中间值的方式</td>
<td>ease(默认值)、linear、ease-in、ease-out、ease-in-out</td>
</tr>
<tr>
<td>transition</td>
<td>过渡的简写属性</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>transition简写属性语法：<code>transition:&lt;transition-property&gt;  &lt;transition-property&gt; &lt;transition-duration&gt; &lt;transition-timing-function&gt;  &lt;transition-delay&gt;</code></p>
<p>示例代码：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#banana</span>&#123;</div><div class="line">  <span class="attribute">font-size</span>: large;</div><div class="line">  <span class="attribute">border</span>: medium solid black;</div><div class="line">  <span class="comment">/*创建反向过渡，即鼠标移开时应用，没有指定过渡属性，默认应用所有*/</span></div><div class="line">  <span class="attribute">-webkit-transition-delay</span>:<span class="number">10ms</span>;</div><div class="line">  <span class="attribute">-webkit-transition-duration</span>:<span class="number">500ms</span>;</div><div class="line">  <span class="attribute">outline</span>:none;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#banana</span><span class="selector-pseudo">:hover</span>&#123;</div><div class="line"> <span class="attribute">font-size</span>: x-large;</div><div class="line"> <span class="attribute">border</span>: medium solid white;</div><div class="line"> <span class="attribute">color</span>: white;</div><div class="line"> <span class="attribute">-webkit-transition-delay</span>: <span class="number">100ms</span>;</div><div class="line"> <span class="attribute">-webkit-transition-property</span>: background-color,color,padding,font-size,border;</div><div class="line"> <span class="attribute">-webkit-transition-duration</span>: <span class="number">500ms</span>;</div><div class="line"> <span class="comment">/*等价于,all表示应用所有属性*/</span></div><div class="line"> <span class="attribute">-webkit-transition</span>: all <span class="number">500ms</span> <span class="number">100ms</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>效果请参看<a href="http://sandbox.runjs.cn/show/br1rdo3d" title="Demo" target="_blank" rel="external">Demo</a></p>
<h3 id="使用动画"><a href="#使用动画" class="headerlink" title="使用动画"></a>使用动画</h3><p>CSS动画本质上是增强的过渡。在如何从一种CSS样式过渡到另一种样式的过程中，你具有了更多选择、更多控制，以及更多灵活性。动画属性如下：</p>
<table>
<thead>
<tr>
<th>属性（要加厂商前缀）</th>
<th>说明</th>
<th>值</th>
</tr>
</thead>
<tbody>
<tr>
<td>animation-delay</td>
<td>设置动画开始前的延迟</td>
<td>&lt;时间&gt;</td>
</tr>
<tr>
<td>animation-direction</td>
<td>设置动画循环播放的时候是否反向播放</td>
<td>normal、alternate</td>
</tr>
<tr>
<td>animation-duration</td>
<td>设置动画播放的持续时间</td>
<td>&lt;时间&gt;</td>
</tr>
<tr>
<td>animation-iteration-count</td>
<td>设置动画的播放次数</td>
<td>infinite、&lt;数值&gt;</td>
</tr>
<tr>
<td>animation-name</td>
<td>指定动画名称</td>
<td>none、&lt;字符串&gt;</td>
</tr>
<tr>
<td>animation-play-state</td>
<td>允许动画暂停和重新播放</td>
<td>running、paused</td>
</tr>
<tr>
<td>animation-timing-function</td>
<td>指定如何计算中间动画值</td>
<td>参考过渡的动画函数可选值</td>
</tr>
<tr>
<td>animation</td>
<td>简写属性</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>animation简写属性语法：<code>animation: &lt;animation-name&gt; &lt;animation-duration&gt; &lt;animation-timing-function&gt; &lt;animation-delay&gt; &lt;animation-iteration-count&gt;</code></p>
<p>动画是在两部分定义的，第一部分包含在样式声明中，使用上表列出的属性。第二部分使用@key-frames规则创建，用来定义应用动画的属性。<br>完整示例代码：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>RunJS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">            <span class="selector-tag">button</span>&#123;</div><div class="line">                <span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#ccc</span>;</div><div class="line">                <span class="attribute">cursor</span>:pointer;</div><div class="line">                  <span class="attribute">display</span>:block;</div><div class="line">                  <span class="attribute">margin</span>:auto;</div><div class="line">                  <span class="attribute">position</span>:relative;</div><div class="line">                  <span class="attribute">top</span>:<span class="number">100px</span>;</div><div class="line">                <span class="attribute">font-size</span>:large;</div><div class="line">                <span class="comment">/*初始化动画,移开之后重新应用样式所以会再次执行*/</span></div><div class="line">                <span class="attribute">-webkit-animation-duration</span>: <span class="number">1000ms</span>;</div><div class="line">                <span class="attribute">-webkit-animation-delay</span>:<span class="number">10ms</span>;</div><div class="line">                <span class="comment">/*不允许反向播放*/</span></div><div class="line">                <span class="attribute">-webkit-animation-direction</span>: normal;</div><div class="line">                <span class="comment">/*只播放一次*/</span></div><div class="line">                <span class="attribute">-webkit-animation-iteration-count</span>: <span class="number">1</span>;</div><div class="line">                <span class="attribute">-webkit-animation-timing-function</span>: linear;</div><div class="line">                <span class="comment">/*动画名字*/</span></div><div class="line">                <span class="attribute">-webkit-animation-name</span>: <span class="string">"initAnimation"</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="selector-tag">button</span><span class="selector-pseudo">:hover</span>&#123;</div><div class="line">                <span class="attribute">-webkit-animation-duration</span>:<span class="number">2000ms</span>;</div><div class="line">                <span class="attribute">-webkit-animation-delay</span>:<span class="number">50ms</span>;</div><div class="line">                <span class="comment">/*允许反向播放*/</span></div><div class="line">                <span class="attribute">-webkit-animation-direction</span>:alternate;</div><div class="line">                <span class="comment">/*播放次数,重复两次*/</span></div><div class="line">                <span class="attribute">-webkit-animation-iteration-count</span>: <span class="number">2</span>;</div><div class="line">                <span class="attribute">-webkit-animation-timing-function</span>: linear;</div><div class="line">                <span class="comment">/*动画名字*/</span></div><div class="line">                <span class="attribute">-webkit-animation-name</span>: <span class="string">"myAnimation"</span>;</div><div class="line">            &#125;</div><div class="line">            @<span class="keyword">keyframes</span> myAnimation&#123;</div><div class="line">                  <span class="selector-tag">from</span>&#123;</div><div class="line">                    <span class="attribute">background-color</span>: red;</div><div class="line">                &#125;</div><div class="line">                50% &#123;</div><div class="line">                    <span class="attribute">background-color</span>: yellow;</div><div class="line">                    <span class="attribute">padding</span>: <span class="number">2px</span>;</div><div class="line">                &#125;</div><div class="line">                75% &#123;</div><div class="line">                    <span class="attribute">color</span>:green;</div><div class="line">                    <span class="attribute">padding</span>:<span class="number">4px</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="selector-tag">to</span>&#123;</div><div class="line">                      <span class="attribute">font-size</span>: x-large;</div><div class="line">                    <span class="attribute">padding</span>:<span class="number">8px</span>;</div><div class="line">                    <span class="attribute">color</span>: red;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            @<span class="keyword">keyframes</span> initAnimation&#123;</div><div class="line">                <span class="selector-tag">from</span>&#123;</div><div class="line">                    <span class="attribute">top</span>:<span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">                50%&#123;</div><div class="line">                    <span class="attribute">top</span>:<span class="number">50px</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="selector-tag">to</span>&#123;</div><div class="line">                      <span class="attribute">top</span>:<span class="number">100px</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>Animation!<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>效果请参看<a href="http://sandbox.runjs.cn/show/6vzt80qe" title="CSS3动画demo" target="_blank" rel="external">CSS3动画demo</a></p>
<ul>
<li>为多个元素应用多个关键帧<br><img src="index_files/a40b7ba4-a040-47a6-a9c0-8fa7b5252b78.jpg" alt=""></li>
<li>停止和启动动画<br>animation-play-state属性可以用来停止和启动动画。如果这个属性的值为paused，动画就会停止。如果换成playing，动画就会播放。这里距离如果使用JS改变这个值<br><img src="index_files/bf92483c-3741-4091-9569-e39ea4725eb1.jpg" alt=""></li>
</ul>
<h3 id="应用变换"><a href="#应用变换" class="headerlink" title="应用变换"></a>应用变换</h3><p>我们可以使用CSS变换为元素应用线性变换，也就是说你可以旋转、缩放、倾斜和平移某个元素。变换的属性有：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
<th>值</th>
</tr>
</thead>
<tbody>
<tr>
<td>transform</td>
<td>指定应用的变换功能</td>
<td>取值见后表</td>
</tr>
<tr>
<td>transform-origin</td>
<td>指定变换的起点</td>
<td>取值见后表</td>
</tr>
</tbody>
</table>
<ul>
<li>应用变换<br>我们通过transform属性为元素应用变换。这个属性允许的值是一组预定义的函数<br><img src="index_files/66b232dd-f38a-43d6-a484-64145716c373.jpg" alt=""></li>
<li>指定元素变换的起点<br>transform-origin属性允许我们指定应用变换的起点。默认情况下，使用元素的中心作为起点，也可以选择其他值<br><img src="index_files/53444dde-e7c5-41c6-bd9a-b1968796916c.jpg" alt=""></li>
<li><p>将变换作为动画和过渡处理<br>  我们可以为变换应用动画和过渡，下面是一个综合例子：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>RunJS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="css"></span></div><div class="line">            <span class="selector-tag">span</span>&#123;</div><div class="line">                <span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#000</span>;</div><div class="line">                <span class="attribute">display</span>: inline-block;</div><div class="line">            &#125;</div><div class="line">            <span class="selector-tag">span</span><span class="selector-pseudo">:hover</span>&#123;</div><div class="line">              <span class="comment">/* Rotate div */</span></div><div class="line">                <span class="attribute">transform</span>:<span class="built_in">rotate</span>(9deg);</div><div class="line">                <span class="attribute">-ms-transform</span>:<span class="built_in">rotate</span>(9deg); <span class="comment">/* Internet Explorer */</span></div><div class="line">                <span class="attribute">-moz-transform</span>:<span class="built_in">rotate</span>(9deg); <span class="comment">/* Firefox */</span></div><div class="line">                <span class="attribute">-webkit-transform</span>:<span class="built_in">rotate</span>(9deg); <span class="comment">/* Safari 和 Chrome */</span></div><div class="line">                <span class="attribute">-o-transform</span>:<span class="built_in">rotate</span>(9deg); <span class="comment">/* Opera */</span></div><div class="line">                <span class="attribute">transition</span>: all <span class="number">1s</span> <span class="number">100ms</span>;</div><div class="line">            &#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>transform<span class="tag">&lt;/<span class="name">span</span>&gt;</span>的属性包括：rotate() / skew() / scale() / translate(,) ，分别还有x、y之分，比如：rotatex() 和 rotatey() ，以此类推。</div><div class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  效果请参看<a href="http://sandbox.runjs.cn/show/mx3ifawg" title="CSS3变换demo" target="_blank" rel="external">CSS3变换demo</a></p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[SQLServer常用知识点]]></title>
      <url>http://heji.website/2016/12/13/SQLServer%E7%9F%A5%E8%AF%86%E7%82%B9/</url>
      <content type="html"><![CDATA[<p>SQLServer自带的工具不好用，所以这里主要介绍使用Navicat操作SQLserver以及SQLserver的一些常用知识点。<br><a id="more"></a></p>
<h2 id="使用Navicat新建数据库、用户及权限赋予"><a href="#使用Navicat新建数据库、用户及权限赋予" class="headerlink" title="使用Navicat新建数据库、用户及权限赋予"></a>使用Navicat新建数据库、用户及权限赋予</h2><h3 id="新建数据库"><a href="#新建数据库" class="headerlink" title="新建数据库"></a>新建数据库</h3><ol>
<li>启动Navicat，点击建立SQLserver连接。<br><img src="index_files/b5d39e4e-9191-4a65-b4e2-8dfe83ee93a8.png" alt=""></li>
<li>右键数据库服务器，选择“新建数据库”，输入数据库名，在文件选项卡还能选择数据库存放的位置。点击“确定”即完成数据库的创建<br><img src="index_files/8ac41406-696d-41e5-bf62-bfabead4a46a.png" alt=""></li>
</ol>
<h3 id="新建登录用户"><a href="#新建登录用户" class="headerlink" title="新建登录用户"></a>新建登录用户</h3><ol>
<li>双击新建的数据库，点击“用户”，下拉选择“登录”，点击新建登录。<br><img src="index_files/44b7acd2-600f-42fb-8deb-bc66008146b1.jpg" alt=""></li>
<li>先设置“常规”选项卡<br><img src="index_files/c1f57c95-940b-43a8-94d7-752a8cc7be9f.jpg" alt=""></li>
<li>设置完“常规”选项卡之后，设置用户对应选项卡，勾选刚才新建的数据库。<br><img src="index_files/5afeb88a-9d3d-400b-a31e-275cd465d7b7.png" alt=""></li>
<li>完成“常规”和“用户对应”选项卡的设置之后，点击“保存”即完成登录用户的创建。</li>
</ol>
<h3 id="用户授权"><a href="#用户授权" class="headerlink" title="用户授权"></a>用户授权</h3><ol>
<li>双击打开新建的数据库，点击“用户”，下拉选择“数据库角色”，选择“db_owner”，双击进去。<br><img src="index_files/c8f34637-9d91-43e1-824d-756ecd1ae02d.jpg" alt=""></li>
<li>点击选择我们刚刚新建的用户“U_HJXF”，点击保存即可。</li>
<li>使用新建的用户登录测试。<br><img src="index_files/5e816ac7-145e-4681-9f2f-403becbfb04a.png" alt=""></li>
</ol>
<h2 id="SQLServer常用知识点"><a href="#SQLServer常用知识点" class="headerlink" title="SQLServer常用知识点"></a>SQLServer常用知识点</h2><ul>
<li><p>查看表字段注释</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span></div><div class="line">    A.name <span class="keyword">AS</span> table_name,</div><div class="line">    B.name <span class="keyword">AS</span> column_name,</div><div class="line">    C.VALUE <span class="keyword">AS</span> column_description</div><div class="line"><span class="keyword">FROM</span> sys.tables A        <span class="keyword">INNER</span> <span class="keyword">JOIN</span> sys.columns B <span class="keyword">ON</span> B.object_id = A.object_id</div><div class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> sys.extended_properties C <span class="keyword">ON</span> C.major_id = B.object_id</div><div class="line"><span class="keyword">AND</span> C.minor_id = B.column_id</div><div class="line"><span class="keyword">WHERE</span></div><div class="line">    A.name = <span class="string">'T_XYPJ_XXTB_ZBTB'</span></div></pre></td></tr></table></figure>
</li>
<li><p>数据库的备份与还原</p>
<ul>
<li>备份<br><img src="index_files/ace784a8-5391-4b7a-8a3b-ca0d28d905bd.jpg" alt=""><br><img src="index_files/5df7e65f-b0f4-4ceb-88b5-c54d03df9077.png" alt=""></li>
<li>还原<br><img src="index_files/e226dad2-81c5-45ab-adf2-f6b116fa9b04.jpg" alt=""><br><img src="index_files/28c138bb-565e-467d-9628-0b7834b0e813.png" alt=""></li>
</ul>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[块级元素和内联元素的区别]]></title>
      <url>http://heji.website/2016/12/12/%E5%9D%97%E7%BA%A7%E5%85%83%E7%B4%A0%E5%92%8C%E5%86%85%E8%81%94%E5%85%83%E7%B4%A0/</url>
      <content type="html"><![CDATA[<p>元素是文档结构的基础，在CSS中，每个元素生成了一个包含了元素内容的框（box，也译为“盒子”）。但是不同的元素显示的方式会有所不同，在文档类型定义（DTD）中对不同的元素规定了不同的类型，这也是DTD对文档之所以重要的原因之一。</p>
<a id="more"></a>
<h2 id="替换和不可替换元素"><a href="#替换和不可替换元素" class="headerlink" title="替换和不可替换元素"></a>替换和不可替换元素</h2><p>从元素本身的特点来讲，可以分为替换和不可替换元素。</p>
<h3 id="替换元素"><a href="#替换元素" class="headerlink" title="替换元素"></a>替换元素</h3><p>替换元素就是浏览器根据元素的标签和属性，来决定元素的具体显示内容。<br>例如浏览器会根据<code>&lt;img&gt;</code>标签的src属性的值来读取图片信息并显示出来，而如果查看(X)HTML代码，则看不到图片的实际内容；又例如根据<code>&lt;input&gt;</code>标签的type属性来决定是显示输入框，还是单选按钮等。<br>(X)HTML中的<code>&lt;img&gt;</code>、<code>&lt;input&gt;</code>、<code>&lt;textarea&gt;</code>、<code>&lt;select&gt;</code>、<code>&lt;object&gt;</code>都是替换元素。</p>
<h3 id="不可替换元素"><a href="#不可替换元素" class="headerlink" title="不可替换元素"></a>不可替换元素</h3><p>(X)HTML 的大多数元素是不可替换元素，即其内容直接表现给用户端（例如浏览器）。例如：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">段落内容</div><div class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>段落<code>&lt;p&gt;</code>是一个不可替换元素，文字“段落的内容”全被显示。<br><strong>注意：<code>input</code>、<code>img</code>等替换元素虽然是内联元素，但替换元素一般有内在尺寸，所以可以设定宽高、内外边距。例如你不指定<code>img</code>的width和height时，就按其内在尺寸显示，也就是图片被保存的时候的宽度和高度。</strong></p>
<h2 id="显示元素"><a href="#显示元素" class="headerlink" title="显示元素"></a>显示元素</h2><p>除了可替换元素和不可替换元素的分类方式外，CSS 2.1中元素还有另外的分类方式：块级元素（block-level）和行内元素（inline-level，也译作“内联”元素）。</p>
<h3 id="块级元素"><a href="#块级元素" class="headerlink" title="块级元素"></a>块级元素</h3><p>在视觉上被格式化为块的元素，最明显的特征就是它默认在横向充满其父元素的内容区域，而且在其左右两边没有其他元素，即块级元素默认是独占一行的。<br>典型的块级元素有：<code>&lt;div&gt;</code>、<code>&lt;p&gt;</code>、<code>&lt;h1&gt;</code>到<code>&lt;h6&gt;</code>，等等。<br>通过CSS设定了浮动（float属性，可向左浮动或向右浮动）以及设定显示（display）属性为“block”或“list-item”的元素都是块级元素。<br>但是浮动元素比较特殊，由于浮动，其旁边可能会有其他元素的存在。相当于显示为<code>inline-block</code><br><strong>注意：块级元素能设置宽高、行高、内外边距。</strong></p>
<h3 id="内联元素"><a href="#内联元素" class="headerlink" title="内联元素"></a>内联元素</h3><p>行内元素不形成新内容块，即在其左右可以有其他元素，例如<code>&lt;a&gt;</code>、<code>&lt;span&gt;</code>、<code>&lt;strong&gt;</code>等，都是典型的行内级元素。<br>display属性等于“inline”的元素都是行内元素。几乎所有的可替换元素都是行内元素，例如<code>&lt;img&gt;</code>、<code>&lt;input&gt;</code>等等。<br>不过元素的类型也不是固定的，通过设定CSS 的display属性，可以使行内元素变为块级元素，也可以让块级元素变为行内元素。<br><strong>注意：由于内联非替换元素的宽高由内容决定，所以不能设置宽高，行高，因为行高不变，所以不能设置padding-top/bottom、margin-top/bottom，但可以设置padding-left/right,margin-left/right</strong></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[CSS3弹性盒模型]]></title>
      <url>http://heji.website/2016/12/10/CSS3%E5%BC%B9%E6%80%A7%E7%9B%92%E6%A8%A1%E5%9E%8B/</url>
      <content type="html"><![CDATA[<p>弹性盒模型布局方式是CSS3规范中提出的一种新的布局方案。该布局方案提供了一种更加高效简单的方式来处理容器中的元素布局、对齐、空间分配等操作，即使容器中的元素尺寸未知（或者尺寸大小是动态的）也能工作得很好。目前CSS3提出的此种布局方式也被各大主流浏览器所支持，可以预见Flexbox Layout在未来将会被广泛使用。</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>CSS3新增的<a href="http://www.w3.org/TR/css-flexbox/" target="_blank" rel="external">Flexible Box Layout</a>（弹性盒模型布局方式）是CSS3规范中提出的一种新的布局方案。该布局方案提供了一种更加高效简单的方式来处理容器中的元素布局、对齐、空间分配等操作，即使容器中的元素尺寸未知（或者尺寸大小是动态的）也能工作得很好。目前CSS3提出的此种布局方式也被各大主流浏览器所支持，可以预见Flexbox Layout在未来将会被广泛使用。</p>
<h2 id="初识Flexbox"><a href="#初识Flexbox" class="headerlink" title="初识Flexbox"></a>初识Flexbox</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>在弹性盒模型布局中，需要事先指定一个容器，后续的所有布局操作都是基于此容器来定义的。其核心是<strong>容器会根据布局的需要（动态的）调整其中所包含的子元素（即布局条目）的尺寸、顺序来填充容器的所有可用空间。</strong><br>当容器的尺寸由于屏幕大小（或者浏览器窗口尺寸）发生变化时，其中包含的布局条目也会自动地进行调整。举个例子，当容器尺寸增大时，包含的条目将会自动拉伸以沾满多余的空白空间；当容器尺寸变小时，条目会自动收缩以适应容器的尺寸防止移除容器的范围。<br>额外提一点，Flexbox布局是<strong>不存在内置的布局方向</strong>的。这是什么意思呢？比如传统的布局方案中，块级布局（block）默认是将各个块级元素按照垂直方向自上向下依次堆放；内联布局（inline）默认是将各个内联元素按照水平方向按照从左到右的顺序依次堆放。而弹性盒布局不存在这种默认的布局方向限制，它提供了独立的布局方向属性，开发人员可以根据布局需要自行设置。</p>
<h3 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h3><p>弹性盒模型是一种新的布局方式，它有自己的一套概念，图解如下：<br><img src="http://7xkwt1.com1.z0.glb.clouddn.com/CSS3-Flexbox%E5%B1%9E%E6%80%A7%E4%B8%8E%E5%BC%B9%E6%80%A7%E7%9B%92%E6%A8%A1%E5%9E%8B-001.png" alt=""><br>主要包含以下几个概念：</p>
<ol>
<li><code>flex container</code>，即所谓的<strong>容器</strong>（或者称之为<strong>弹性盒</strong>、<strong>flex容器</strong>）。注意这里说的容器并不是单纯的dom元素所指代的容器，而是特指设置了弹性盒布局的dom元素。</li>
<li><code>flex item</code>，即所谓的<strong>条目</strong>（或者称之为<strong>flex条目</strong>）。这里的条目其实就是容器的子元素。比如<code>ul</code>元素为一个flex容器，那么其内部包含的<code>li</code>元素就是flex条目。大部分时候，不同的弹性盒布局真正产生变化的其实就是条目的布局行为发生了变化。</li>
<li><code>main axis</code>和<code>cross axis</code>，即所谓的<strong>主轴</strong>和<strong>交叉轴</strong>（有的翻译文章也称之为<strong>侧轴</strong>）。这两个属性定义flex布局方向。需要注意的是，虽然图中主轴是水平方向，交叉轴是垂直方向，但是这并不是固定的，开发人员完全自定义主轴和交叉轴的方向。<ol>
<li>在使用flex布局时，一般我们需要首先明确主轴的方向，然后交叉轴的方向也会随之确定下来。因为<strong>交叉轴的方向始终是与主轴的方向是垂直的</strong>。</li>
<li>flex容器中flex条目可以根据布局需要排列成<strong>单行</strong>或者<strong>多行</strong>。</li>
<li>主轴<code>main axis</code>的作用是确定每一行上flex条目的排列方向。</li>
<li>（当flex条目成多行排列时）交叉轴<code>cross axis</code>的作用是确定行与行之间的排列方向。</li>
</ol>
</li>
<li><code>main start</code>和<code>main end</code>，即所谓的<strong>主轴起点</strong>和<strong>主轴终点</strong>。<ol>
<li>明确主轴的方向后（如上所述，不管是主轴还是交叉轴其实只有两种方向，即水平或者垂直），还需要确定他们各自的排列方向。</li>
<li>假如已经明确主轴的方向是水平的，那么其排列方向仍然会有两种可选，一种是<strong>从左到右</strong>的排列方向（flex条目从左到右依次堆放），另一种是<strong>从右到左</strong>排列方向（flex条目从右到左依次堆放）。</li>
<li>主轴起点在左主轴终点在右即为<strong>从左到右</strong>的排列方向。（如上图所示）</li>
<li>主轴起点在右主轴终点在左即为<strong>从右到左</strong>的排列方向。</li>
</ol>
</li>
<li><code>cross start</code>和<code>cross end</code>，即所谓的<strong>交叉轴起点</strong>和<strong>交叉轴终点</strong>。<ol>
<li>跟主轴起点和主轴终点的含义类似，交叉轴起点和交叉轴终点明确了行与行之间的排列顺序。</li>
<li>假如已经明确交叉轴的方向是垂直的，那么其排列方向仍然将会有两种可选，一种是<strong>从上到下</strong>的排列方向（第二行在第一行的下方），另一种是<strong>从下到上</strong>的排列方向（第二行在第一行的上方）。</li>
</ol>
</li>
<li>所以，在flex容器进行布局时，在每一行中会把其中的flex条目从主轴起始位置开始，依次排列到主轴结束位置。当flex容器中存在多行时，会把每一行从交叉轴起始位置开始，依次排列到交叉轴结束位置。</li>
<li><code>main size</code>和<code>cross size</code>，即所谓的<strong>主轴尺寸</strong>和<strong>交叉轴尺寸</strong>。对应dom元素在主轴和交叉轴上的大小。<ol>
<li>如果主轴方向是水平的（那么交叉轴方向肯定是垂直的），此时主轴尺寸即是dom元素（flex容器）的宽度属性，交叉轴尺寸即是dom元素（flex容器）的高度属性。</li>
<li>如果主轴方向是垂直的，那么主轴尺寸和交叉轴尺寸对应的dom元素宽高属性与之前相反。</li>
</ol>
</li>
</ol>
<h3 id="新旧语法"><a href="#新旧语法" class="headerlink" title="新旧语法"></a>新旧语法</h3><p>flex布局先后有两种语法，一种是W3C于2009年发布的旧语法，另一种是W3C最新发布的新语法。<br>旧语法中，所有的flex属性都以<code>box</code>打头，flex设置为<code>display: box</code>。<br>新语法中，所有的flex属性都以<code>flex</code>打头，flex设置为<code>display: flex</code>。<br>关于新旧语法在实际使用时，肯定是推荐使用新语法的，虽然新语法的浏览器支持性不如旧语法，但是毕竟是旧的语法，迟早是要淘汰的，而且新语法的表现也更加一致。</p>
<h2 id="属性详解"><a href="#属性详解" class="headerlink" title="属性详解"></a>属性详解</h2><p><strong>注意</strong>，flex布局中的css样式声明与一般的css声明不同，它会有两个作用对象，分别是<strong>flex容器</strong>和<strong>flex条目</strong>。即，有的flex属性只能作用于flex容器，而有的flex属性只能作用于flex条目。下面我们针对flex布局的各个属性分别作详细说明。</p>
<h3 id="问题引导"><a href="#问题引导" class="headerlink" title="问题引导"></a>问题引导</h3><p>现在有一个无序列表（<code>ul</code>元素），其包含了6个列表项（<code>li</code>元素），如何做可以让列表项（<code>li</code>元素）自适应父容器的尺寸？换句话说，当父容器尺寸足够大时，所有的<code>li</code>元素平铺成一行；当父容器的尺寸减小时，<code>li</code>元素自动换行。<br>大家都能想到的一种常规做法应该就是给<code>li</code>元素设置浮动。不过这里我们将使用flex布局来实现这种布局需求。html和css代码如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"flex-container"</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"flex-item"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"flex-item"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"flex-item"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"flex-item"</span>&gt;</span>4<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"flex-item"</span>&gt;</span>5<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"flex-item"</span>&gt;</span>6<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.flex-container</span> &#123;</div><div class="line"> <span class="attribute">list-style</span>: none;</div><div class="line"> <span class="attribute">display</span>: flex;</div><div class="line"> <span class="attribute">flex-direction</span>: row;</div><div class="line"> <span class="attribute">flex-wrap</span>: wrap;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.flex-item</span> &#123;</div><div class="line"> <span class="attribute">margin</span>: <span class="number">5px</span>;</div><div class="line"> <span class="attribute">width</span>: <span class="number">300px</span>;</div><div class="line"> <span class="attribute">height</span>: <span class="number">300px</span>;</div><div class="line"> <span class="attribute">text-align</span>: center;</div><div class="line"> <span class="attribute">line-height</span>: <span class="number">300px</span>;</div><div class="line"> <span class="attribute">background-color</span>: gold;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在可以自行缩放浏览器的窗口，观察<code>.flex-item</code>块的行为。</p>
<h3 id="display-flex"><a href="#display-flex" class="headerlink" title="display: flex"></a>display: flex</h3><p>在之前说过，要想使用弹性盒布局必须事先指定一个容器，这个容器就是所谓的flex容器。那么如何指定flex容器呢？很简单，将其<code>display</code>属性设置为<code>flex</code>即可。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.flex-container</span>&#123;</div><div class="line">  <span class="attribute">display</span>: flex;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>注意</strong>，如果需要在内联的场景下使用flex布局，则需要设置<code>display: inline-flex</code>。而且以下几种属性设置在弹性盒布局中是不起作用的。</p>
<ol>
<li>浮动元素（<code>float</code>）</li>
<li>清除浮动（<code>clear</code>）</li>
<li>css3多列布局（<code>columns-*</code>）</li>
<li>垂直居中（<code>vertical-align</code>）</li>
<li>首行/首字符选择伪类（<code>::first-line</code>和<code>::first-letter</code>）</li>
</ol>
<h3 id="flex-direction"><a href="#flex-direction" class="headerlink" title="flex-direction"></a>flex-direction</h3><p><code>flex-direction</code>属性的作用是设置<strong>主轴</strong>方向。我们之前有说过，一旦主轴方向确定，那么连带的交叉轴的方向也会确定下来。这样就确定了flex条目基本的排列方式。<br>下面我们来看一下<code>flex-direction</code>的具体用法，如下表:</p>
<table>
<thead>
<tr>
<th>可选值</th>
<th>含义</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>row</td>
<td>横向从左到右排列</td>
<td>即左对齐。此为默认值</td>
</tr>
<tr>
<td>row-reverse</td>
<td>反转横向排列（从右到左排列）</td>
<td>即右对齐</td>
</tr>
<tr>
<td>column</td>
<td>纵向排列（从上到下排列）</td>
<td>即设置主轴方向为垂直方向</td>
</tr>
<tr>
<td>column-reverse</td>
<td>反转纵向排列（从下到上排列）</td>
<td>主轴方向为垂直方向，但是越后面的flex条目反而在上方</td>
</tr>
</tbody>
</table>
<h3 id="flex-wrap"><a href="#flex-wrap" class="headerlink" title="flex-wrap"></a>flex-wrap</h3><p><code>flex-wrap</code>属性用于设置当所有的flex条目的尺寸之和超过flex容器的主轴尺寸时应该采取的行为。<br>下面让我们来看一下<code>flex-wrap</code>的具体用法，如下表：</p>
<table>
<thead>
<tr>
<th>可选值</th>
<th>含义</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>nowrap</td>
<td>容器中的条目只占满容器在主轴方向上的一行，此时可能出现条目互相重叠或超出容器范围的现象</td>
<td>此为默认值</td>
</tr>
<tr>
<td>wrap</td>
<td>当容器中的条目超出主轴方向上的一行时，会把条目排列到下一行。而下一行的位置与交叉轴的方向一致</td>
<td>交叉轴的存在感就是在此</td>
</tr>
<tr>
<td>wrap-reverse</td>
<td>与<code>wrap</code>的含义类似，不同的是下一行的位置与交叉轴的方向相反。</td>
<td>-</td>
</tr>
</tbody>
</table>
<h3 id="flex-flow"><a href="#flex-flow" class="headerlink" title="flex-flow"></a>flex-flow</h3><p>之前说的两个属性<code>flex-direction</code>和<code>flex-wrap</code>，从某种意义上来说就是设置flex布局的主轴和交叉轴。一旦flex布局的主轴和交叉轴确定下来，基本上整个布局中flex条目的排列方式我们就可以自行脑补出来了。<br>而<code>flex-flow</code>属性其实就是<code>flex-direction</code>和<code>flex-wrap</code>的复合属性。所以下面两段代码的效果是一致的。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.flex-container1</span> &#123;</div><div class="line"> <span class="attribute">flex-direction</span>: row;</div><div class="line"> <span class="attribute">flex-wrap</span>: wrap;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.flex-container2</span> &#123;</div><div class="line"> <span class="attribute">flex-flow</span>: row wrap;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="order"><a href="#order" class="headerlink" title="order"></a>order</h3><p>前面说的几个属性其实都是针对flex容器的设置。而<code>order</code>属性是针对flex条目的。它的作用是自定义flex容器中条目的顺序。其用法示例如下:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.flex-item</span><span class="selector-pseudo">:last-child</span> &#123;</div><div class="line"><span class="comment">/*作用是让最后一个flex条目排在最前,order越小越排在前,且可设置为负值*/</span></div><div class="line"> <span class="attribute">order</span>: -<span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="flex条目的弹性设置"><a href="#flex条目的弹性设置" class="headerlink" title="flex条目的弹性设置"></a>flex条目的弹性设置</h3><p>弹性盒模型的真正牛逼的地方在于flex容器中的<strong>flex条目的尺寸是弹性的</strong>。这是啥意思呢？个人觉得它包含下面的几层含义：</p>
<ul>
<li>主轴尺寸不够大时，使用<code>flex-wrap</code>可以让flex条目自动换行。</li>
<li>主轴尺寸不够大时，还可以缩小条目的尺寸防止溢出容器范围。</li>
<li>主轴尺寸足够大时，可以适当扩展条目的尺寸来占用容器的额外空白空间。<br>flex条目尺寸的弹性由3个css属性来确定，分别是<code>flex-basis</code>、<code>flex-grow</code>和<code>flex-shrink</code>。他们的相关说明如下：</li>
</ul>
<h4 id="flex-basis"><a href="#flex-basis" class="headerlink" title="flex-basis"></a>flex-basis</h4><p><code>flex-basis</code>用于设置flex条目的初始尺寸（未进行任何调整之前）。当设置为<code>auto</code>时，则实际使用的值是主轴尺寸属性的值。若主轴尺寸也是<code>auto</code>，那么使用的值由条目内容的尺寸来确定。(默认值是auto)</p>
<h4 id="flex-grow"><a href="#flex-grow" class="headerlink" title="flex-grow"></a>flex-grow</h4><p>当主轴尺寸足够大时，flex条目在容器内一行就全部排列完了，此时容器的空间还有剩余，那么可用<code>flex-grow</code>扩展flex条目。举个例子，一个容器中有3个flex条目，其<code>flex-grow</code>属性分别如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">.flex-item:nth-child(1) &#123;</div><div class="line"> flex-grow: 1;</div><div class="line">&#125;</div><div class="line">.flex-item:nth-child(2) &#123;</div><div class="line"> flex-grow: 2;</div><div class="line">&#125;</div><div class="line">.flex-item:nth-child(3) &#123;</div><div class="line"> flex-grow: 3;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>同时，flex容器的宽度是800px，每个条目的宽度为200px，所以容器还将剩余200px。由于条目都设置了<code>flex-grow</code>属性，那么此三个条目将按比例分配容器的剩余空间。第一个条目将得到200 <em> 1/6 = 33px左右，第二个条目将得到200 </em> 2/6 = 66px，第三个条目将得到200 * 3/6 = 99px左右。</p>
<h4 id="flex-shrink"><a href="#flex-shrink" class="headerlink" title="flex-shrink"></a>flex-shrink</h4><p><code>flex-shrink</code>在使用上类似<code>flex-grow</code>，不过它使用于设置当主轴尺寸不够大时缩小flex条目。同样的，我们来举个例子，一个容器中有3个flex条目，每个felx条目的尺寸为200px，容器的尺寸为500px。很明显此时容器尺寸已经放不下其中三个flex条目了。我们对每个flex条目设置<code>flex-shrink</code>属性<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.flex-item</span><span class="selector-pseudo">:nth-child(1)</span> &#123;</div><div class="line"> <span class="attribute">flex-shrink</span>: <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.flex-item</span><span class="selector-pseudo">:nth-child(2)</span> &#123;</div><div class="line"> <span class="attribute">flex-shrink</span>: <span class="number">2</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.flex-item</span><span class="selector-pseudo">:nth-child(3)</span> &#123;</div><div class="line"> <span class="attribute">flex-shrink</span>: <span class="number">3</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果我们希望flex容器能够刚刚好将三个flex条目放下，我们需要缩小的尺寸为600-500 = 100px。接下来三个条目将根据<code>flex-shrink</code>属性按比例的分摊需要缩小的尺寸，即分别为100 <em> 1/6 = 16.6px，100 </em> 2/6 = 33.3px，100 * 3/6 = 50px。所以三个flex条目最终的尺寸为200 - 16.6 = 183.4px，200 - 33.3 = 166.7px，200 - 50 = 150px。</p>
<h4 id="多行弹性布局注意事项"><a href="#多行弹性布局注意事项" class="headerlink" title="多行弹性布局注意事项"></a>多行弹性布局注意事项</h4><p>我们使用<code>flex-grow</code>和<code>flex-shrink</code>属性对flex条目进行扩展或者缩小时，这些操作其实是以<strong>行</strong>为单位来操作的。因此当有多行弹性布局时，可能会有一些出乎意料的表现。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">.flex-container &#123;</div><div class="line"> width: 999px;</div><div class="line"> flex-direction: row;</div><div class="line"> flex-wrap: wrap;</div><div class="line"> display: flex;</div><div class="line">&#125;</div><div class="line">.flex-item &#123;</div><div class="line"> width: 300px;</div><div class="line"> flex-grow: 1;</div><div class="line"> flex-shrink: 1;</div><div class="line"> flex-basis: auto;</div><div class="line">&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"flex-container"</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"flex-item"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"flex-item"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"flex-item"</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"flex-item"</span>&gt;</span>4<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>容器宽度999px，flex条目300px，允许多行排列。那么第一行会排列三个，第二行会排列一个，因设置了<code>flex-grow: 1</code>，第一行剩余的99px会被评分到三个flex条目，第二行剩余的699px也会被平分到第二行的flex条目，由于第二行只有一个条目，所以第二行的条目的宽度为999px。</p>
<h3 id="flex复合属性"><a href="#flex复合属性" class="headerlink" title="flex复合属性"></a>flex复合属性</h3><p>如你所见，<code>flex</code>是一个复合属性，它的语法如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">flex: none | auto | [flex-grow] | [flex-shrink] | [flex-basis]</div></pre></td></tr></table></figure></p>
<p>其中<code>none</code>的含义为：<code>0 0 auto</code>, 即<code>flex-grow: 0</code>，<code>flex-shrink: 0</code>， <code>flex-basis: auto</code>。<br>其中<code>auto</code>的含义为：<code>1 1 auto</code>, 即<code>flex-grow: 1</code>，<code>flex-shrink: 1</code>， <code>flex-basis: auto</code>。<br>当<code>flex-basis</code>被省略时，其值为<code>0%</code>。</p>
<h3 id="flex条目的对齐"><a href="#flex条目的对齐" class="headerlink" title="flex条目的对齐"></a>flex条目的对齐</h3><p>当flex容器中flex条目的尺寸和排列都确定下来之后，我们还可以设置这些flex条目在容器中的对齐方式。目前有三种对齐方式。</p>
<h4 id="基于margin-auto对齐"><a href="#基于margin-auto对齐" class="headerlink" title="基于margin: auto对齐"></a>基于<code>margin: auto</code>对齐</h4><p>第一种对齐方式是<strong>使用空白边</strong>，即<code>margin: auto</code>。在使用自动空白边时，flex容器中额外的空白空间将会由被声明为<code>auto</code>的空白边占据。这种方式在W3C的官方文档被称之为<em>non-normative</em>，更加像是一种奇淫巧计。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">nav</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">/about</span>&gt;</span>About<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">/projects</span>&gt;</span>Projects<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">/interact</span>&gt;</span>Interact<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"login"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">/login</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"> <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></div><div class="line">ul &#123;</div><div class="line"> list-style: none;</div><div class="line"> display: flex;</div><div class="line">&#125;</div><div class="line">li &#123;</div><div class="line"> min-width: min-content;</div><div class="line">&#125;</div><div class="line">#login &#123;</div><div class="line"> margin-left: auto;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>示例中的<code>#login</code>元素通过简单的<code>margin-left</code>设置，占据所有的剩余空白。</p>
<h4 id="基于主轴对齐"><a href="#基于主轴对齐" class="headerlink" title="基于主轴对齐"></a>基于主轴对齐</h4><p>第二种对齐方式是基于主轴方向上的对齐策略。可以通过<code>justify-content</code>属性来进行设置。借助此属性，我们可以调整flex条目在主轴方向上的对齐策略。<br>我们来看下<code>justify-content</code>属性的基本用法，（<strong>注意</strong>，<code>justify-content</code>用于设置flex容器）</p>
<table>
<thead>
<tr>
<th>可选值</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>flex-start</td>
<td>条目集中于该行的起始位置。第一个条目与其所在行在主轴起始方向上的边界保持对齐，其余的条目按照顺序依次排列。</td>
</tr>
<tr>
<td>flex-end</td>
<td>条目集中于该行的结束方向。最后一个条目与其所在行在主轴结束方向上的边界保持对齐，其余的条目按照顺序依次排列。</td>
</tr>
<tr>
<td>center</td>
<td>条目集中于该行的中央。条目都往该行的中央排列，在主轴起始方向和结束方向上留有同样大小的空白空间。如果空白空间不足，则条目会在两个方向上超出同样的空间。</td>
</tr>
<tr>
<td>space-between</td>
<td>第一个条目与其所在行在主轴起始方向上的边界保持对齐，最后一个条目与其所在行在主轴结束方向上的边界保持对齐。空白空间在条目之间平均分配，使得相邻条目之间的空白尺寸相同。</td>
</tr>
<tr>
<td>space-around</td>
<td>类似于<code>space-between</code>，不同的是第一个条目和最后一个条目与该行的边界之间同样存在空白空间，该空白空间的尺寸是条目之间的空白空间的尺寸的一半。</td>
</tr>
</tbody>
</table>
<h4 id="基于交叉轴对齐"><a href="#基于交叉轴对齐" class="headerlink" title="基于交叉轴对齐"></a>基于交叉轴对齐</h4><p>第三种对齐方式是基于交叉轴方向上的对齐策略。此种方式中，我们有两个属性可以做相关设置，它们分别是<code>align-items</code>和<code>align-self</code>。其中前者是用来设置flex容器的，后者是用来设置flex条目的，这两个属性的作用对象是不同的。在某些场景下，我们可以对flex条目设置<code>align-self</code>来复写flex容器指定的对齐方式。<br>我们来看看<code>align-items</code>的基本用法</p>
<table>
<thead>
<tr>
<th>可选值</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>flex-start</td>
<td>条目与其所在行在交叉轴起始方向上的边界保持对齐。</td>
</tr>
<tr>
<td>flex-end</td>
<td>条目与其所在行在交叉轴结束方向上的边界保持对齐。</td>
</tr>
<tr>
<td>center</td>
<td>条目的空白边盒子（margin box）在交叉轴上居中。如果交叉轴尺寸小于条目的尺寸，则条目会在两个方向上超出相同大小的空间。</td>
</tr>
<tr>
<td>baseline</td>
<td>条目在基准线上保持对齐。在所有条目中，基准线与交叉轴起始方向上的边界距离最大的条目，它与所在行在交叉轴方向上的边界保持对齐。</td>
</tr>
<tr>
<td>stretch</td>
<td>如果条目的交叉轴尺寸的计算值是<code>auto</code>，则其实际使用的值会使得条目在交叉轴方向上尽可能地占满。</td>
</tr>
</tbody>
</table>
<p><code>align-self</code>的属性基本与<code>align-items</code>一致（用法和含义基本都一样）。不过<code>align-self</code>除了<code>align-items</code>属性可选值之外，还可以设置为<code>auto</code>。当设置为<code>auto</code>时，其值是父节点的属性<code>align-items</code>的值,如果该节点没有父节点，则为<code>stretch</code>。</p>
<h3 id="flex行的对齐"><a href="#flex行的对齐" class="headerlink" title="flex行的对齐"></a>flex行的对齐</h3><p>前面说完了flex容器中flex条目的对齐方式。这里我们再来说一下<strong>flex行</strong>的对齐。什么叫flex行？W3C官方文档中提到了一个名词，叫做<a href="http://www.w3.org/TR/css-flexbox/#flex-lines" target="_blank" rel="external"><strong>Flex Lines</strong></a>。<br>那么什么叫Flex Lines呢？说的直白点就是多行flex布局时，主轴方向上的每一行就是Flex Lines。<br><code>align-content</code>属性的作用和<code>justify-content</code>属性很相似，只不过<code>justify-content</code>是用于在主轴方向上对齐行内的flex条目，而<code>align-content</code>是用于设置行与行之间的对齐策略。<br><code>align-content</code>详细的用法如下表:</p>
<table>
<thead>
<tr>
<th>可选值</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>flex-start</td>
<td>行集中于容器的交叉轴起始位置。第一行与容器在交叉轴起始方向上的边界保持对齐，其余行按照顺序依次排列。</td>
</tr>
<tr>
<td>flex-end</td>
<td>行集中于容器的交叉轴结束位置。第一行与容器在交叉轴结束方向上的边界保持对齐，其余行按照顺序依次排列。</td>
</tr>
<tr>
<td>center</td>
<td>行集中于容器的中央。行都往容器的中央排列，在交叉轴起始方向和结束方向上留有同样大小的空白空间。如果空白空间不足，则行会在两个方向上超出同样的空间。</td>
</tr>
<tr>
<td>space-between</td>
<td>行在容器中均匀分布。第一行与容器在交叉轴起始方向上的边界保持对齐，最后一行与容器在交叉轴结束方向上的边界保持对齐。空白空间在行之间平均分配，使得相邻行之间的空白尺寸相同。</td>
</tr>
<tr>
<td>space-around</td>
<td>类似于<code>space-between</code>，不同的是第一行条目和最后一个行目与容器行的边界之间同样存在空白空间，而该空白空间的尺寸是行目之间的空白空间的尺寸的一半。</td>
</tr>
<tr>
<td>stretch</td>
<td>伸展行来占满剩余的空间。多余的空间在行之间平均分配，使得每一行的交叉轴尺寸变大。</td>
</tr>
</tbody>
</table>
<h3 id="浏览器兼容性"><a href="#浏览器兼容性" class="headerlink" title="浏览器兼容性"></a>浏览器兼容性</h3><p>本文的<strong>新旧语法</strong>中曾经提到，弹性盒模型官方有好几个版本的语法，这是因为其规范本身有过多个不同版本，因为浏览器对于该规范的支持也存在一些不一致。大致来说总共有三个不同版本的语法。</p>
<ul>
<li>最新规范：最新版本规范的语法，即<code>display: flex</code>。</li>
<li>中间版本：2011年的非官方规范语法，即<code>display: flexbox</code>。</li>
<li>老规范：2009年的规范的语法，即<code>display: box</code>。<br>浏览器的支持情况如下，</li>
</ul>
<table>
<thead>
<tr>
<th>Chrome</th>
<th>Safari</th>
<th>Firefox</th>
<th>Opera</th>
<th>IE</th>
<th>Android</th>
<th>iOS</th>
</tr>
</thead>
<tbody>
<tr>
<td>21+（新规范）</td>
<td>6.1+（新规范）</td>
<td>22+（新规范）</td>
<td>12.1+（新规范）</td>
<td>11+（新规范）</td>
<td>4.4+（新规范）</td>
<td>7.1+（新规范）</td>
</tr>
<tr>
<td>20-（老规范）</td>
<td>3.1+（老规范）</td>
<td>2-21（老规范）</td>
<td>-</td>
<td>10（中间版本）</td>
<td>2.1+（老规范）</td>
<td>3.2+（老规范）</td>
</tr>
</tbody>
</table>
<p>从上面看来，弹性盒布局模型基本已经被主流的现代浏览器所支持。除了IE系的浏览器拖了后腿之外，基本可以无障碍的使用。不过虽然如此，我们为了兼容性，在实际使用的时候除了规范中定义的属性之外，最好添加不同浏览器内核的私有前缀。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[数据库生成pdm]]></title>
      <url>http://heji.website/2016/09/21/%E4%BD%BF%E7%94%A8powerdesigner%E5%80%92%E8%BD%AC%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
      <content type="html"><![CDATA[<p>如何使用powerdesigner根据数据库生成pdm。</p>
<a id="more"></a>
<p>由于powerdesigner是32位的应用程序，所以需要下载32位的JDK。</p>
<ul>
<li>配置系统变量<br>CLASSPATH = E:\Workspaces\my-jar\mysql-connector-java-5.1.7-bin.jar  （如果需要反转Oracle数据库，这里的值是Oracle驱动包的路径）<br>JAVA_HOME = D:\Java\jdk1.6.0_13\;<br>Path = %Path%;% JAVA_HOME %\bin;  </li>
<li>PowerDesigner配置<br>PowerDesigner Tools –&gt; General Options –&gt; Variables：<br>JAR D:\Java\jdk1.6.0_13\bin\jar.exe<br>JAVA D:\Java\jdk1.6.0_13\bin\java.exe<br>JAVAC D:\Java\jdk1.6.0_13\bin\javac.exe<br>JAVADOC D:\Java\jdk1.6.0_13\bin\javadoc.exe</li>
<li>打开Powerdesigner，文件–&gt;Reverse Engineer –&gt; Database…<br><img src="index_files/6736595f-4701-424b-9b3b-5bb534aa573c.png" alt=""></li>
<li>使用数据源<br><img src="index_files/623e5892-970b-46dc-a8bd-2f7dcd52ed5f.png" alt=""></li>
<li>配置数据库连接<br><img src="index_files/76e72467-d912-45cc-94c0-57a33a208c74.png" alt=""></li>
<li>添加一个数据源并测试连接<br><img src="index_files/ad10bbc3-74da-4786-b156-138d693c7398.png" alt=""><br><img src="index_files/9739f9b8-5e3c-4796-bd6b-9e64f8634dc9.png" alt=""></li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[JS学习笔记]]></title>
      <url>http://heji.website/2016/09/14/Javascript%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      <content type="html"><![CDATA[<p>Javascript入门教程。</p>
<a id="more"></a>
<h1 id="常用技巧-推荐学习工具：javascripting"><a href="#常用技巧-推荐学习工具：javascripting" class="headerlink" title="常用技巧(推荐学习工具：javascripting)"></a>常用技巧(推荐学习工具：javascripting)</h1><hr>
<ul>
<li><strong> 本教程使用chrome的console演示。chrome的console可以按住Ctrl和+加大字体，使用Ctrl+0复原 </strong></li>
<li><p><strong> js中获取iframe的元素或者调用iframe的方法 </strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">     iframeObj.contentWindow.document</div><div class="line">     iframeObj.contentWindow.functionName();</div></pre></td></tr></table></figure>
</li>
<li><p>高级for循环</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">for</span>(<span class="keyword">var</span> index <span class="keyword">in</span> object)</div></pre></td></tr></table></figure>
<p>当用于数组时，index表示数组元素的索引<br>当用于对象时，index表示对象属性的key</p>
</li>
<li>javascript灵活性之一：<br>可以通过传递回调函数避免过度嵌套</li>
<li><p>javascript灵活性之二：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> tasks = [<span class="string">"init"</span>,<span class="string">"start"</span>,<span class="string">"stop"</span>,<span class="string">"destory"</span>];</div><div class="line">     <span class="keyword">for</span>(<span class="keyword">var</span> index <span class="keyword">in</span> tasks)&#123;</div><div class="line">          <span class="comment">//相当于调用init();start();...</span></div><div class="line">          tasks[index]();</div><div class="line">     &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>数组的map方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">     <span class="comment">//Array.map(callback(item,index))返回由数组中每个元素调用回调函数之后的新元素组成的数组。join方法把数组转换为字符串,参数表示分隔符</span></div><div class="line">     <span class="keyword">var</span> body = items.map(<span class="function"><span class="keyword">function</span>(<span class="params">item,i</span>)</span>&#123;</div><div class="line">          <span class="keyword">return</span> i+<span class="string">")"</span>+item;</div><div class="line">     &#125;).join(<span class="string">'\n'</span>);</div></pre></td></tr></table></figure>
</li>
<li><p>substring(start,[end])和slice(start,[end])<br>substring方法所有参数必须为正数，否则返回空<br>slice方法如果参数start为负数，end为空，表示从尾部开始算起。比如’hello’.slice(-2)—&gt;lo<br>如果参数start为负数，end也必须为负数，且要比start大，否则返回空</p>
</li>
<li><p>splice()方法再论（数组是以0作为首元素的下标，splice()方法返回删除的元素）<br>当只有一个参数时，以参数为起始位置删除后面所有元素例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> items = [<span class="string">'Bob'</span>,<span class="string">'Jack'</span>,<span class="string">'Lily'</span>,<span class="string">'Sam'</span>];</div><div class="line">     <span class="keyword">var</span> array = items.splice(<span class="number">2</span>);</div><div class="line">     <span class="built_in">console</span>.log(array);  <span class="comment">//['Lily','Sam']</span></div></pre></td></tr></table></figure>
<p>当有两个参数时例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> items = [<span class="string">'Bob'</span>,<span class="string">'Jack'</span>,<span class="string">'Lily'</span>,<span class="string">'Sam'</span>];</div><div class="line">     <span class="keyword">var</span> array = items.splice(<span class="number">2</span>，<span class="number">1</span>);</div><div class="line">     <span class="built_in">console</span>.log(array);  <span class="comment">//['Lily']</span></div><div class="line">     <span class="built_in">console</span>.log(items); <span class="comment">//['Bob','Jack','Sam']</span></div></pre></td></tr></table></figure>
<p>当有多个参数时：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> items = [<span class="string">'Bob'</span>,<span class="string">'Jack'</span>,<span class="string">'Lily'</span>,<span class="string">'Sam'</span>];</div><div class="line">     <span class="keyword">var</span> array = items.splice(<span class="number">2</span>，<span class="number">1</span>，<span class="string">'Tom'</span>，<span class="string">'Lucy'</span>);</div><div class="line">     <span class="built_in">console</span>.log(array);  <span class="comment">//['Lily']</span></div><div class="line">     <span class="built_in">console</span>.log(items); <span class="comment">//['Bob','Jack','Tom','Lucy','Sam']</span></div></pre></td></tr></table></figure>
</li>
<li><p>JSON.parse(str)和JSON. stringify(jsonObj)<br>JSON.parse(str)用于把字符串转化为JSON对象<br>JSON.stringify(obj)用于把JSON对象转化为字符串</p>
</li>
<li><p>父页面获取iframe子页面的元素<br>JS版本：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">      <span class="keyword">var</span> frameDoc=<span class="built_in">document</span>.getElementById(<span class="string">'iframeId'</span>).contentWindow.document  <span class="comment">//document对象</span></div><div class="line">       <span class="keyword">var</span> frameBody=<span class="built_in">document</span>.getElementById(<span class="string">'iframeId'</span>).contentWindow.document.body   <span class="comment">//body对象</span></div></pre></td></tr></table></figure>
<p>JQ版本</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">     $(<span class="string">"#iframe的ID"</span>).contents().find(<span class="string">"#iframe中的控件ID"</span>).click();<span class="comment">//jquery 方法1 必须在iframe加载完后才有效</span></div></pre></td></tr></table></figure>
</li>
<li><p>在iframe中获取父页面的id元素<br>JS版本</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> obj=<span class="built_in">window</span>.parent.document.getElementById(<span class="string">'objId'</span>)</div></pre></td></tr></table></figure>
<p>JQ版本</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">     $(<span class="string">'#父级窗口的objId'</span>, <span class="built_in">window</span>.parent.document).css(<span class="string">'height'</span>:<span class="string">'height);  // window可省略不写</span></div></pre></td></tr></table></figure>
</li>
<li><p>iframe高度自适应</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">     $(<span class="string">'#iframeId'</span>).load(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;  </div><div class="line">          <span class="keyword">var</span> iframeHeight=$(<span class="keyword">this</span>).contents().height(); </div><div class="line">          $(<span class="keyword">this</span>).height(iframeHeight+<span class="string">'px'</span>);  </div><div class="line">     &#125;);</div></pre></td></tr></table></figure>
</li>
<li><p>JS字符串中的方法传参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> html=<span class="string">"&lt;a onclick='selecthoods(\" "</span>+a + <span class="string">"\"); &gt;AAA&lt;/a&gt;"</span>;</div></pre></td></tr></table></figure>
</li>
<li><p>JS实现模拟安卓端连续点击返回键退出应用的demo</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">     <span class="comment">//监听返回键</span></div><div class="line">                app.initialize(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                    <span class="built_in">document</span>.addEventListener(<span class="string">"backbutton"</span>, shutDown, <span class="literal">false</span>);</div><div class="line">                &#125;);</div><div class="line">                <span class="keyword">var</span> beginDate;          <span class="comment">// 两次点击退出按钮开始时间 </span></div><div class="line">                <span class="keyword">var</span> isToast = <span class="literal">false</span>;    <span class="comment">// 是否弹出弹框 </span></div><div class="line">                <span class="function"><span class="keyword">function</span> <span class="title">shutDown</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                     <span class="keyword">var</span> endDate = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(); <span class="comment">// 两次点击退出按钮结束时间 </span></div><div class="line">                     <span class="comment">// 提示过Toast并且两次点击时间小于2S </span></div><div class="line">                     <span class="keyword">if</span> ( isToast &amp;&amp; endDate - beginDate &lt; <span class="number">2000</span> ) &#123; </div><div class="line">                         beginDate = endDate; </div><div class="line">                         isToast = <span class="literal">false</span>; </div><div class="line">                         powerdata.router.exit(<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;&#125;);</div><div class="line">                     &#125; <span class="keyword">else</span></div><div class="line">                         Toast(<span class="string">'再次点击退出程序'</span>,<span class="number">2000</span>);  </div><div class="line">                &#125;</div><div class="line"> </div><div class="line">                <span class="comment">//自定义弹框 2s消失 </span></div><div class="line">                 <span class="function"><span class="keyword">function</span> <span class="title">Toast</span>(<span class="params">msg,duration</span>)</span>&#123; </div><div class="line">                     isToast = <span class="literal">true</span>; </div><div class="line">                     beginDate = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(); </div><div class="line">                     duration=<span class="built_in">isNaN</span>(duration)?<span class="number">3000</span>:duration; <span class="comment">// duration是不是一个数字     </span></div><div class="line">                     <span class="keyword">var</span> m = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>); </div><div class="line">                     m.innerHTML = msg; </div><div class="line">                     m.style.cssText=<span class="string">"width:60%; min-width:150px; background:#000; opacity:0.5; height:40px; color:#fff; line-height:40px; text-align:center; border-radius:5px; position:fixed; top:80%; left:20%; z-index:999999; font-weight:bold;"</span>; </div><div class="line">                     <span class="built_in">document</span>.body.appendChild(m); </div><div class="line">                     setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </div><div class="line">                         <span class="keyword">var</span> d = <span class="number">0.5</span>; </div><div class="line">                         m.style.webkitTransition = <span class="string">'-webkit-transform '</span> + d + <span class="string">'s ease-in, opacity '</span> + d + <span class="string">'s ease-in'</span>; </div><div class="line">                         m.style.opacity = <span class="string">'0'</span>; </div><div class="line">                         setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">document</span>.body.removeChild(m) &#125;, d * <span class="number">1000</span>); </div><div class="line">                     &#125;, duration); </div><div class="line">                 &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>JS实现动态时间</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">               <span class="comment">//时间</span></div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">getCurDate</span>(<span class="params"></span>)</span>&#123; </div><div class="line">                 <span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>(); </div><div class="line">                 <span class="keyword">var</span> week; </div><div class="line">                 <span class="keyword">switch</span> (d.getDay())&#123; </div><div class="line">                     <span class="keyword">case</span> <span class="number">1</span>: week=<span class="string">"星期一"</span>; <span class="keyword">break</span>; </div><div class="line">                     <span class="keyword">case</span> <span class="number">2</span>: week=<span class="string">"星期二"</span>; <span class="keyword">break</span>; </div><div class="line">                     <span class="keyword">case</span> <span class="number">3</span>: week=<span class="string">"星期三"</span>; <span class="keyword">break</span>; </div><div class="line">                     <span class="keyword">case</span> <span class="number">4</span>: week=<span class="string">"星期四"</span>; <span class="keyword">break</span>; </div><div class="line">                     <span class="keyword">case</span> <span class="number">5</span>: week=<span class="string">"星期五"</span>; <span class="keyword">break</span>; </div><div class="line">                     <span class="keyword">case</span> <span class="number">6</span>: week=<span class="string">"星期六"</span>; <span class="keyword">break</span>; </div><div class="line">                     <span class="keyword">default</span>: week=<span class="string">"星期天"</span>; </div><div class="line">                 &#125; </div><div class="line">                 <span class="keyword">var</span> years = d.getFullYear(); </div><div class="line">                 <span class="keyword">var</span> month = add_zero(d.getMonth()+<span class="number">1</span>); </div><div class="line">                 <span class="keyword">var</span> days = add_zero(d.getDate()); </div><div class="line">                 <span class="keyword">var</span> hours = add_zero(d.getHours()); </div><div class="line">                 <span class="keyword">var</span> minutes = add_zero(d.getMinutes()); </div><div class="line">                 <span class="keyword">var</span> seconds=add_zero(d.getSeconds()); </div><div class="line">                 <span class="keyword">var</span> ndate = years+<span class="string">"年"</span>+month+<span class="string">"月"</span>+days+<span class="string">"日 "</span>+hours+<span class="string">":"</span>+minutes+<span class="string">":"</span>+seconds+<span class="string">" "</span>+week; </div><div class="line">                 $(<span class="string">'.nowTime'</span>).html(ndate)</div><div class="line">            &#125; </div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">add_zero</span>(<span class="params">temp</span>)</span>&#123; </div><div class="line">                 <span class="keyword">if</span>(temp&lt;<span class="number">10</span>) <span class="keyword">return</span> <span class="string">"0"</span>+temp; </div><div class="line">                 <span class="keyword">else</span> <span class="keyword">return</span> temp; </div><div class="line">            &#125;  </div><div class="line">               setInterval(getCurDate,<span class="number">100</span>);</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="JavaScript简介"><a href="#JavaScript简介" class="headerlink" title="JavaScript简介"></a>JavaScript简介</h1><hr>
<ul>
<li>JavaScript历史<br>   在上个世纪的1995年，当时的网景公司正凭借其Navigator浏览器成为Web时代开启时最著名的第一代互联网公司。由于网景公司希望能在静态HTML页面上添加一些动态效果，于是叫Brendan Eich这哥们在两周之内设计出了JavaScript语言。你没看错，这哥们只用了10天时间。为什么起名叫JavaScript？原因是当时Java语言非常红火，所以网景公司希望借Java的名气来推广，但事实上JavaScript除了语法上有点像Java，其他部分基本上没啥关系。</li>
<li>ECMAScript<br>   因为网景开发了JavaScript，一年后微软又模仿JavaScript开发了JScript，为了让JavaScript成为全球标准，几个公司联合ECMA（European Computer Manufacturers Association）组织定制了JavaScript语言的标准，被称为ECMAScript标准。 所以简单说来就是，ECMAScript是一种语言标准，而JavaScript是网景公司对ECMAScript标准的一种实现。<br>   那为什么不直接把JavaScript定为标准呢？因为JavaScript是网景的注册商标。</li>
<li>JavaScript版本<br>  由于JavaScript的标准——ECMAScript在不断发展，最新版ECMAScript 6标准（简称ES6）已经在2015年6月正式发布了，所以，讲到JavaScript的版本，实际上就是说它实现了ECMAScript标准的哪个版本。由于浏览器在发布时就确定了JavaScript的版本，加上很多用户还在使用IE6这种古老的浏览器，这就导致你在写JavaScript的时候，要照顾一下老用户，不能一上来就用最新的ES6标准写，否则，老用户的浏览器是无法运行新版本的JavaScript代码的。</li>
</ul>
<h1 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h1><hr>
<h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><ul>
<li>语法<br>JavaScript的语法和Java语言类似，每个语句以<code>;</code>结束，语句块用<code>{...}</code>。但是，JavaScript并不强制要求在每个语句的结尾加<code>;</code>，浏览器中负责执行JavaScript代码的引擎会自动在每个语句的结尾补上<code>;</code>。</li>
<li><p>注释<br>  以//开头直到行末的字符被视为行注释，注释是给开发人员看到，JavaScript引擎会自动忽略：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">          <span class="comment">// 这是一行注释</span></div><div class="line">          alert(<span class="string">'hello'</span>); <span class="comment">// 这也是注释</span></div></pre></td></tr></table></figure>
<p>  另一种块注释是用/<em>…</em>/把多行字符包裹起来，把一大“块”视为一个注释：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">          <span class="comment">/* 从这里开始是块注释</span></div><div class="line">          仍然是注释</div><div class="line">          仍然是注释</div><div class="line">          注释结束 */</div></pre></td></tr></table></figure>
</li>
<li><p>大小写<br>  请注意，JavaScript严格区分大小写，如果弄错了大小写，程序将报错或者运行不正常。</p>
</li>
</ul>
<h2 id="数据类型和变量"><a href="#数据类型和变量" class="headerlink" title="数据类型和变量"></a>数据类型和变量</h2><ul>
<li><p>Number<br>  JavaScript不区分整数和浮点数，统一用Number表示，以下都是合法的Number类型：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">          <span class="number">123</span>; <span class="comment">// 整数123</span></div><div class="line">          <span class="number">0.456</span>; <span class="comment">// 浮点数0.456</span></div><div class="line">          <span class="number">1.2345e3</span>; <span class="comment">// 科学计数法表示1.2345x1000，等同于1234.5</span></div><div class="line">          <span class="number">-99</span>; <span class="comment">// 负数</span></div><div class="line">          <span class="literal">NaN</span>; <span class="comment">// NaN表示Not a Number，当无法计算结果时用NaN表示</span></div><div class="line">          <span class="literal">Infinity</span>; <span class="comment">// Infinity表示无限大，当数值超过了JavaScript的Number所能表示的最大值时，就表示为Infinity</span></div></pre></td></tr></table></figure>
<p>  Number可以直接做四则运算，规则和数学一致：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">          <span class="number">1</span> + <span class="number">2</span>; <span class="comment">// 3</span></div><div class="line">          (<span class="number">1</span> + <span class="number">2</span>) * <span class="number">5</span> / <span class="number">2</span>; <span class="comment">// 7.5</span></div><div class="line">          <span class="number">2</span> / <span class="number">0</span>; <span class="comment">// Infinity</span></div><div class="line">          <span class="number">0</span> / <span class="number">0</span>; <span class="comment">// NaN</span></div><div class="line">         <span class="comment">// 注意%是求余运算。</span></div><div class="line">          <span class="number">10</span> % <span class="number">3</span>; <span class="comment">// 1</span></div><div class="line">          <span class="number">10.5</span> % <span class="number">3</span>; <span class="comment">// 1.5</span></div></pre></td></tr></table></figure>
</li>
<li><p>字符串<br>  字符串是以单引号’或双引号”括起来的任意文本，比如<code>&#39;abc&#39;</code>，<code>&quot;xyz&quot;</code>等等。请注意，<code>&#39;&#39;</code>或<code>&quot;&quot;</code>本身只是一种表示方式，不是字符串的一部分，因此，字符串<code>&#39;abc&#39;</code>只有<code>a，b，c</code>这3个字符。</p>
</li>
<li><p>布尔值<br>  布尔值和布尔代数的表示完全一致，一个布尔值只有true、false两种值，要么是true，要么是false，可以直接用true、false表示布尔值，也可以通过布尔运算计算出来：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">          <span class="literal">true</span>; <span class="comment">// 这是一个true值</span></div><div class="line">          <span class="literal">false</span>; <span class="comment">// 这是一个false值</span></div><div class="line">          <span class="number">2</span> &gt; <span class="number">1</span>; <span class="comment">// 这是一个true值</span></div><div class="line">          <span class="number">2</span> &gt;= <span class="number">3</span>; <span class="comment">// 这是一个false值</span></div></pre></td></tr></table></figure>
<p>  <code>&amp;&amp;</code>运算是与运算，只有所有都为<code>true</code>，<code>&amp;&amp;</code>运算结果才是<code>true</code>：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">          <span class="literal">true</span> &amp;&amp; <span class="literal">true</span>; <span class="comment">// 这个&amp;&amp;语句计算结果为true</span></div><div class="line">          <span class="literal">true</span> &amp;&amp; <span class="literal">false</span>; <span class="comment">// 这个&amp;&amp;语句计算结果为false</span></div><div class="line">          <span class="literal">false</span> &amp;&amp; <span class="literal">true</span> &amp;&amp; <span class="literal">false</span>; <span class="comment">// 这个&amp;&amp;语句计算结果为false</span></div></pre></td></tr></table></figure>
<p>  <code>||</code>运算是或运算，只要其中有一个为<code>true</code>，<code>||</code>运算结果就是<code>true</code><br>  <code>!</code>运算是非运算，它是一个单目运算符，把<code>true</code>变成<code>false</code>，<code>false</code>变成<code>true</code>：</p>
</li>
<li><p>比较运算符<br>  当我们对Number做比较时，可以通过比较运算符得到一个布尔值：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">          <span class="number">2</span> &gt; <span class="number">5</span>; <span class="comment">// false</span></div><div class="line">          <span class="number">5</span> &gt;= <span class="number">2</span>; <span class="comment">// true</span></div><div class="line">          <span class="number">7</span> == <span class="number">7</span>; <span class="comment">// true</span></div></pre></td></tr></table></figure>
<p>  实际上，JavaScript允许对任意数据类型做比较：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">          <span class="literal">false</span> == <span class="number">0</span>; <span class="comment">// true</span></div><div class="line">          <span class="literal">false</span> === <span class="number">0</span>; <span class="comment">// false</span></div></pre></td></tr></table></figure>
<p>  要特别注意相等运算符==。JavaScript在设计时，有两种比较运算符：<br>  第一种是==比较，它会自动转换数据类型再比较，很多时候，会得到非常诡异的结果；<br>  第二种是===比较，它不会自动转换数据类型，如果数据类型不一致，返回false，如果一致，再比较。<br>  由于JavaScript这个设计缺陷，不要使用==比较，始终坚持使用===比较。<br>  另一个例外是NaN这个特殊的Number与所有其他值都不相等，包括它自己：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">          <span class="literal">NaN</span> === <span class="literal">NaN</span>; <span class="comment">// false</span></div></pre></td></tr></table></figure>
<p>  唯一能判断NaN的方法是通过isNaN()函数：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">          <span class="built_in">isNaN</span>(<span class="literal">NaN</span>); <span class="comment">// true</span></div></pre></td></tr></table></figure>
<p>  最后要注意浮点数的相等比较：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">          <span class="number">1</span> / <span class="number">3</span> === (<span class="number">1</span> - <span class="number">2</span> / <span class="number">3</span>); <span class="comment">// false</span></div></pre></td></tr></table></figure>
<p>  这不是JavaScript的设计缺陷。浮点数在运算过程中会产生误差，因为计算机无法精确表示无限循环小数。要比较两个浮点数是否相等，只能计算它们之差的绝对值，看是否小于某个阈值：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">          <span class="built_in">Math</span>.abs(<span class="number">1</span> / <span class="number">3</span> - (<span class="number">1</span> - <span class="number">2</span> / <span class="number">3</span>)) &lt; <span class="number">0.0000001</span>; <span class="comment">// true</span></div></pre></td></tr></table></figure>
</li>
<li><p>null 和 undefined<br>  null表示一个“空”的值，它和0以及空字符串’’不同，0是一个数值，’’表示长度为0的字符串，而null表示“空”。<br>  JavaScript的设计者希望用null表示一个空的值，而undefined表示值未定义。事实证明，这并没有什么卵用，区分两者的意义不大。大多数情况下，我们都应该用null。undefined仅仅在判断函数参数是否传递的情况下有用。</p>
</li>
<li><p>数组<br>  数组是一组按顺序排列的集合，集合的每个值称为元素。JavaScript的数组可以包括任意数据类型。例如：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">          [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3.14</span>, <span class="string">'Hello'</span>, <span class="literal">null</span>, <span class="literal">true</span>];</div></pre></td></tr></table></figure>
<p>  上述数组包含6个元素。数组用[]表示，元素之间用,分隔。另一种创建数组的方法是通过Array()函数实现：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>); <span class="comment">// 创建了数组[1, 2, 3]</span></div></pre></td></tr></table></figure>
<p>  然而，出于代码的可读性考虑，强烈建议直接使用<code>[]</code>。<br>  数组的元素可以通过索引来访问。请注意，索引的起始值为<code>0</code>：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3.14</span>, <span class="string">'Hello'</span>, <span class="literal">null</span>, <span class="literal">true</span>];</div><div class="line">          arr[<span class="number">0</span>]; <span class="comment">// 返回索引为0的元素，即1</span></div><div class="line">          arr[<span class="number">5</span>]; <span class="comment">// 返回索引为5的元素，即true</span></div><div class="line">          arr[<span class="number">6</span>]; <span class="comment">// 索引超出了范围，返回undefined</span></div></pre></td></tr></table></figure>
</li>
<li><p>对象<br>  JavaScript的对象是一组由键-值组成的无序集合，例如：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> person = &#123;</div><div class="line">               name: <span class="string">'Bob'</span>,</div><div class="line">               age: <span class="number">20</span>,</div><div class="line">               tags: [<span class="string">'js'</span>, <span class="string">'web'</span>, <span class="string">'mobile'</span>],</div><div class="line">               city: <span class="string">'Beijing'</span>,</div><div class="line">               hasCar: <span class="literal">true</span>,</div><div class="line">               zipcode: <span class="literal">null</span></div><div class="line">          &#125;;</div></pre></td></tr></table></figure>
<p>  JavaScript对象的键都是字符串类型，值可以是任意数据类型。上述person对象一共定义了6个键值对，其中每个键又称为对象的属性，例如，person的name属性为’Bob’，zipcode属性为null。<br>  要获取一个对象的属性，我们用对象变量.属性名的方式：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">          person.name; <span class="comment">// 'Bob'</span></div><div class="line">          person.zipcode; <span class="comment">// null</span></div></pre></td></tr></table></figure>
</li>
<li><p>变量<br>  变量在JavaScript中就是用一个变量名表示，变量名是大小写英文、数字、$和_的组合，且不能用数字开头。变量名也不能是JavaScript的关键字，如if、while等。申明一个变量用var语句，比如：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> a; <span class="comment">// 申明了变量a，此时a的值为undefined</span></div><div class="line">          <span class="keyword">var</span> $b = <span class="number">1</span>; <span class="comment">// 申明了变量$b，同时给$b赋值，此时$b的值为1</span></div><div class="line">          <span class="keyword">var</span> s_007 = <span class="string">'007'</span>; <span class="comment">// s_007是一个字符串</span></div><div class="line">          <span class="keyword">var</span> Answer = <span class="literal">true</span>; <span class="comment">// Answer是一个布尔值true</span></div><div class="line">          <span class="keyword">var</span> t = <span class="literal">null</span>; <span class="comment">// t的值是null</span></div></pre></td></tr></table></figure>
<p>  变量名也可以用中文，但是，请不要给自己找麻烦。<br>  在JavaScript中，使用等号<code>=</code>对变量进行赋值。可以把任意数据类型赋值给变量，同一个变量可以反复赋值，而且可以是不同类型的变量，但是要注意只能用<code>var</code>申明一次，例如：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> a = <span class="number">123</span>; <span class="comment">// a的值是整数123</span></div><div class="line">          a = <span class="string">'ABC'</span>; <span class="comment">// a变为字符串</span></div></pre></td></tr></table></figure>
<p>  这种变量本身类型不固定的语言称之为动态语言，与之对应的是静态语言。静态语言在定义变量时必须指定变量类型，如果赋值的时候类型不匹配，就会报错，例如java。<br>  和静态语言相比，动态语言更灵活，就是这个原因。</p>
</li>
<li><p>strict模式<br>  JavaScript在设计之初，为了方便初学者学习，并不强制要求用var申明变量。这个设计错误带来了严重的后果：如果一个变量没有通过var申明就被使用，那么该变量就自动被申明为全局变量：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">          i = <span class="number">10</span>; <span class="comment">// i现在是全局变量</span></div></pre></td></tr></table></figure>
<p>  在同一个页面的不同的JavaScript文件中，如果都不用<code>var</code>申明，恰好都使用了变量<code>i</code>，将造成变量<code>i</code>互相影响，产生难以调试的错误结果。<br>  使用var申明的变量则不是全局变量，它的范围被限制在该变量被申明的函数体内（函数的概念将稍后讲解），同名变量在不同的函数体内互不冲突。<br>   为了修补JavaScript这一严重设计缺陷，ECMA在后续规范中推出了strict模式，在strict模式下运行的JavaScript代码，强制通过var申明变量，未使用var申明变量就使用的，将导致运行错误。<br>   启用strict模式的方法是在JavaScript代码的第一行写上：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">          <span class="string">'use strict'</span>;</div><div class="line">          <span class="comment">// 如果浏览器支持strict模式，</span></div><div class="line">          <span class="comment">// 下面的代码将报ReferenceError错误:</span></div><div class="line">          abc = <span class="string">'Hello, world'</span>;</div><div class="line">          alert(abc);</div></pre></td></tr></table></figure>
<p>  这是一个字符串，不支持strict模式的浏览器会把它当做一个字符串语句执行，支持strict模式的浏览器将开启strict模式运行JavaScript。<br>  运行代码，如果浏览器报错，请修复后再运行。如果浏览器不报错，说明你的浏览器太古老了，需要尽快升级。<br>  不用var申明的变量会被视为全局变量，为了避免这一缺陷，所有的JavaScript代码都应该使用strict模式。我们在后面编写的JavaScript代码将全部采用strict模式。</p>
</li>
</ul>
<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><p>Javascript的字符串就是用<code>&#39;&#39;</code>或<code>&quot;&quot;</code>括起来的字符表示。<br>如果<code>&#39;</code>本身也是一个字符，那就可以用<code>&quot;&quot;</code>括起来，比如<code>&quot;I&#39;m OK&quot;</code>包含的字符是<code>I</code>，<code>&#39;</code>，<code>m</code>，空格，<code>O</code>，<code>K</code>这6个字符。<br>如果字符串内部既包含<code>&#39;</code>又包含<code>&quot;</code>怎么办？可以用转义字符<code>\</code>来标识，比如：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> str = <span class="string">'I\'m \"OK\"!'</span>;</div></pre></td></tr></table></figure></p>
<p>转义字符<code>\</code>可以转义很多字符，比如<code>\n</code>表示换行，<code>\t</code>表示制表符，字符<code>\</code>本身也要转义，所以<code>\\</code>表示的字符就是<code>\</code>。<br><b style="color:red;">由于多行字符串用<code>\n</code>写起来比较费事，所以最新的ES6标准新增了一种多行字符串的表示方法：</b></p>
<ul>
<li><p>字符串常见操作<br>  1、获取长度</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> s = <span class="string">'Hello, world!'</span>;</div><div class="line">          s.length; <span class="comment">// 13</span></div></pre></td></tr></table></figure>
<p>  2、获取指定位置的字符</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> s = <span class="string">'Hello, world!'</span>;</div><div class="line">          s[<span class="number">0</span>]; <span class="comment">// 'H'</span></div><div class="line">          s[<span class="number">6</span>]; <span class="comment">// ' '</span></div><div class="line">          s[<span class="number">7</span>]; <span class="comment">// 'w'</span></div><div class="line">          s[<span class="number">12</span>]; <span class="comment">// '!'</span></div><div class="line">          s[<span class="number">13</span>]; <span class="comment">// undefined 超出范围的索引不会报错，但一律返回undefined</span></div></pre></td></tr></table></figure>
<p>  3、需要特别注意的是，字符串是不可变的，如果对字符串的某个索引赋值，不会有任何错误，但是，也没有任何效果：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> s = <span class="string">'Test'</span>;</div><div class="line">          s[<span class="number">0</span>] = <span class="string">'X'</span>;</div><div class="line">          alert(s); <span class="comment">// s仍然为'Test'</span></div></pre></td></tr></table></figure>
<p>  JavaScript为字符串提供了一些常用方法，注意，调用这些方法本身不会改变原有字符串的内容，而是返回一个新字符串：<br>  4、toUpperCase</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> s = <span class="string">'Hello'</span>;</div><div class="line">         <span class="comment">// toUpperCase()把一个字符串全部变为大写</span></div><div class="line">          s.toUpperCase(); <span class="comment">// 返回'HELLO'</span></div></pre></td></tr></table></figure>
<p>  5、indexOf</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> s = <span class="string">'hello, world'</span>;</div><div class="line">          s.indexOf(<span class="string">'world'</span>); <span class="comment">// 返回7</span></div><div class="line">          s.indexOf(<span class="string">'World'</span>); <span class="comment">// 没有找到指定的子串，返回-1</span></div></pre></td></tr></table></figure>
<p>  6、substring</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> s = <span class="string">'hello, world'</span></div><div class="line">         <span class="comment">// substring()返回指定索引区间的子串</span></div><div class="line">          s.substring(<span class="number">0</span>, <span class="number">5</span>); <span class="comment">// 从索引0开始到5（不包括5），返回'hello'</span></div><div class="line">          s.substring(<span class="number">7</span>); <span class="comment">// 从索引7开始到结束，返回'world'</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><ul>
<li><p>基本知识<br>JavaScript的Array可以包含任意数据类型，并通过索引来访问每个元素。<br>要取得Array的长度，直接访问length属性：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3.14</span>, <span class="string">'Hello'</span>, <span class="literal">null</span>, <span class="literal">true</span>];</div><div class="line">          arr.length; <span class="comment">// 6</span></div></pre></td></tr></table></figure>
<p>  <b style="color:red;">请注意，直接给Array的length赋一个新的值会导致Array大小的变化：</b></p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</div><div class="line">          arr.length; <span class="comment">// 3</span></div><div class="line">          arr.length = <span class="number">6</span>;</div><div class="line">          arr; <span class="comment">// arr变为[1, 2, 3, undefined, undefined, undefined]</span></div><div class="line">          arr.length = <span class="number">2</span>;</div><div class="line">          arr; <span class="comment">// arr变为[1, 2]</span></div></pre></td></tr></table></figure>
<p>  Array可以通过索引把对应的元素修改为新的值，因此，对Array的索引进行赋值会直接修改这个Array：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> arr = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>];</div><div class="line">          arr[<span class="number">1</span>] = <span class="number">99</span>;</div><div class="line">          arr; <span class="comment">// arr现在变为['A', 99, 'C']</span></div></pre></td></tr></table></figure>
<p>  <b style="color:red">请注意，如果通过索引赋值时，索引超过了范围，同样会引起Array大小的变化：</b></p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</div><div class="line">          arr[<span class="number">5</span>] = <span class="string">'x'</span>;</div><div class="line">          arr; <span class="comment">// arr变为[1, 2, 3, undefined, undefined, 'x']</span></div></pre></td></tr></table></figure>
<p>  大多数其他编程语言不允许直接改变数组的大小，越界访问索引会报错。然而，JavaScript的Array却不会有任何错误。在编写代码时，不建议直接修改Array的大小，访问索引时要确保索引不会越界。</p>
</li>
<li><p>常用方法</p>
<ul>
<li><p>indexOf<br>与String类似，Array也可以通过indexOf()来搜索一个指定的元素的位置：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">               <span class="keyword">var</span> arr = [<span class="number">10</span>, <span class="number">20</span>, <span class="string">'30'</span>, <span class="string">'xyz'</span>];</div><div class="line">               arr.indexOf(<span class="number">10</span>); <span class="comment">// 元素10的索引为0</span></div><div class="line">               arr.indexOf(<span class="number">20</span>); <span class="comment">// 元素20的索引为1</span></div><div class="line">               arr.indexOf(<span class="number">30</span>); <span class="comment">// 元素30没有找到，返回-1</span></div><div class="line">               arr.indexOf(<span class="string">'30'</span>); <span class="comment">// 元素'30'的索引为2</span></div></pre></td></tr></table></figure>
</li>
<li><p>slice (不会改变原数组)<br>slice()就是对应String的substring()版本，它截取Array的部分元素，然后返回一个新的Array：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">               <span class="keyword">var</span> arr = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>, <span class="string">'G'</span>];</div><div class="line">               arr.slice(<span class="number">0</span>, <span class="number">3</span>); <span class="comment">// 从索引0开始，到索引3结束，但不包括索引3: ['A', 'B', 'C']</span></div><div class="line">               arr.slice(<span class="number">3</span>); <span class="comment">// 从索引3开始到结束: ['D', 'E', 'F', 'G']</span></div></pre></td></tr></table></figure>
<p>如果不给slice()传递任何参数，它就会从头到尾截取所有元素。利用这一点，我们可以很容易地复制一个Array：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">               <span class="keyword">var</span> arr = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>, <span class="string">'G'</span>];</div><div class="line">               <span class="keyword">var</span> aCopy = arr.slice();</div><div class="line">               aCopy; <span class="comment">// ['A', 'B', 'C', 'D', 'E', 'F', 'G']</span></div><div class="line">               aCopy === arr; <span class="comment">// false</span></div></pre></td></tr></table></figure>
</li>
<li><p>push和pop(改变原数组)<br>push()向Array的末尾添加若干元素，pop()则把Array的最后一个元素删除掉：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">               <span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>];</div><div class="line">               arr.push(<span class="string">'A'</span>, <span class="string">'B'</span>); <span class="comment">// 返回Array新的长度: 4</span></div><div class="line">               arr; <span class="comment">// [1, 2, 'A', 'B']</span></div><div class="line">               arr.pop(); <span class="comment">// pop()返回'B'</span></div><div class="line">               arr; <span class="comment">// [1, 2, 'A']</span></div><div class="line">               arr.pop(); arr.pop(); arr.pop(); <span class="comment">// 连续pop 3次</span></div><div class="line">               arr; <span class="comment">// []</span></div><div class="line">               arr.pop(); <span class="comment">// 空数组继续pop不会报错，而是返回undefined</span></div><div class="line">               arr; <span class="comment">// []</span></div></pre></td></tr></table></figure>
</li>
<li><p>unshift和shift(改变原数组)<br>如果要往Array的头部添加若干元素，使用unshift()方法，shift()方法则把Array的第一个元素删掉：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">               <span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>];</div><div class="line">               arr.unshift(<span class="string">'A'</span>, <span class="string">'B'</span>); <span class="comment">// 返回Array新的长度: 4</span></div><div class="line">               arr; <span class="comment">// ['A', 'B', 1, 2]</span></div><div class="line">               arr.shift(); <span class="comment">// 'A'</span></div><div class="line">               arr; <span class="comment">// ['B', 1, 2]</span></div><div class="line">               arr.shift(); arr.shift(); arr.shift(); <span class="comment">// 连续shift 3次</span></div><div class="line">               arr; <span class="comment">// []</span></div><div class="line">               arr.shift(); <span class="comment">// 空数组继续shift不会报错，而是返回undefined</span></div><div class="line">               arr; <span class="comment">// []</span></div></pre></td></tr></table></figure>
</li>
<li><p>sort(改变原数组)<br>sort()可以对当前Array进行排序，它会直接修改当前Array的元素位置，直接调用时，按照默认顺序排序：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">               <span class="keyword">var</span> arr = [<span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'A'</span>];</div><div class="line">               arr.sort();</div><div class="line">               arr; <span class="comment">// ['A', 'B', 'C']</span></div></pre></td></tr></table></figure>
<p>能否按照我们自己指定的顺序排序呢？完全可以，我们将在后面的函数中讲到。</p>
</li>
<li><p>reverse(改变原数组)<br>reverse()把整个Array的元素给掉个个，也就是反转：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">               <span class="keyword">var</span> arr = [<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>];</div><div class="line">               arr.reverse();</div><div class="line">               arr; <span class="comment">// ['three', 'two', 'one']</span></div></pre></td></tr></table></figure>
</li>
<li><p>splice(改变原数组)<br>splice()方法是修改Array的“万能方法”，它可以从指定的索引开始删除若干元素，然后再从该位置添加若干元素：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">               <span class="keyword">var</span> arr = [<span class="string">'Microsoft'</span>, <span class="string">'Apple'</span>, <span class="string">'Yahoo'</span>, <span class="string">'AOL'</span>, <span class="string">'Excite'</span>, <span class="string">'Oracle'</span>];</div><div class="line">               <span class="comment">// 从索引2开始删除3个元素,然后再添加两个元素:</span></div><div class="line">               arr.splice(<span class="number">2</span>, <span class="number">3</span>, <span class="string">'Google'</span>, <span class="string">'Facebook'</span>); <span class="comment">// 返回删除的元素 ['Yahoo', 'AOL', 'Excite']</span></div><div class="line">               arr; <span class="comment">// ['Microsoft', 'Apple', 'Google', 'Facebook', 'Oracle']</span></div><div class="line">               <span class="comment">// 只删除,不添加:</span></div><div class="line">               arr.splice(<span class="number">2</span>, <span class="number">2</span>); <span class="comment">// ['Google', 'Facebook']</span></div><div class="line">               arr; <span class="comment">// ['Microsoft', 'Apple', 'Oracle']</span></div><div class="line">               <span class="comment">// 只添加,不删除:</span></div><div class="line">               arr.splice(<span class="number">2</span>, <span class="number">0</span>, <span class="string">'Google'</span>, <span class="string">'Facebook'</span>); <span class="comment">// 返回[],因为没有删除任何元素</span></div><div class="line">               arr; <span class="comment">// ['Microsoft', 'Apple', 'Google', 'Facebook', 'Oracle']</span></div></pre></td></tr></table></figure>
</li>
<li><p>concat(改变原数组)<br>concat()方法把当前的Array和另一个Array连接起来，并返回一个新的Array：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">               <span class="keyword">var</span> arr = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>];</div><div class="line">               <span class="keyword">var</span> added = arr.concat([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</div><div class="line">               added; <span class="comment">// ['A', 'B', 'C', 1, 2, 3]</span></div><div class="line">               arr; <span class="comment">// ['A', 'B', 'C']</span></div></pre></td></tr></table></figure>
<p>请注意，concat()方法并没有修改当前Array，而是返回了一个新的Array。<br>实际上，concat()方法可以接收任意个元素和Array，并且自动把Array拆开，然后全部添加到新的Array里：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">               <span class="keyword">var</span> arr = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>];</div><div class="line">               arr.concat(<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>]); <span class="comment">// ['A', 'B', 'C', 1, 2, 3, 4]</span></div></pre></td></tr></table></figure>
</li>
<li><p>join(不会改变原数组)<br>join()方法是一个非常实用的方法，它把当前Array的每个元素都用指定的字符串连接起来，然后返回连接后的字符串：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">               <span class="keyword">var</span> arr = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</div><div class="line">               arr.join(<span class="string">'-'</span>); <span class="comment">// 'A-B-C-1-2-3'</span></div></pre></td></tr></table></figure>
<p>如果Array的元素不是字符串，将自动转换为字符串后再连接。</p>
</li>
<li>多维数组</li>
</ul>
</li>
</ul>
<h2 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h2><ul>
<li><p>基础知识<br>  JavaScript的对象是一种无序的集合数据类型，它由若干键值对组成。<br>JavaScript的对象用于描述现实世界中的某个对象。例如，为了描述“小明”这个淘气的小朋友，我们可以用若干键值对来描述他：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> xiaoming = &#123;</div><div class="line">               name: <span class="string">'小明'</span>,</div><div class="line">               birth: <span class="number">1990</span>,</div><div class="line">               school: <span class="string">'No.1 Middle School'</span>,</div><div class="line">               height: <span class="number">1.70</span>,</div><div class="line">               weight: <span class="number">65</span>,</div><div class="line">               score: <span class="literal">null</span></div><div class="line">          &#125;;</div></pre></td></tr></table></figure>
<p>  JavaScript用一个{…}表示一个对象，键值对以xxx: xxx形式申明，用,隔开。注意，最后一个键值对不需要在末尾加,，如果加了，有的浏览器（如低版本的IE）将报错。<br>访问属性是通过.操作符完成的，但这要求属性名必须是一个有效的变量名。如果属性名包含特殊字符，就必须用’’括起来：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> xiaohong = &#123;</div><div class="line">               name: <span class="string">'小红'</span>,</div><div class="line">               <span class="string">'middle-school'</span>: <span class="string">'No.1 Middle School'</span></div><div class="line">          &#125;;</div></pre></td></tr></table></figure>
<p>  xiaohong的属性名middle-school不是一个有效的变量，就需要用’’括起来。访问这个属性也无法使用.操作符，必须用[‘xxx’]来访问：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">          xiaohong[<span class="string">'middle-school'</span>]; <span class="comment">// 'No.1 Middle School'</span></div><div class="line">          xiaohong[<span class="string">'name'</span>]; <span class="comment">// '小红'</span></div><div class="line">          xiaohong.name; <span class="comment">// '小红'(推荐写法)</span></div></pre></td></tr></table></figure>
<p>  如果访问一个不存在的属性会返回什么呢？JavaScript规定，访问不存在的属性不报错，而是返回undefined：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> xiaoming = &#123;</div><div class="line">               name: <span class="string">'小明'</span></div><div class="line">          &#125;;</div><div class="line">          xiaoming.age; <span class="comment">// undefined</span></div></pre></td></tr></table></figure>
</li>
<li><p>对象属性的增删改查<br>  由于JavaScript的对象是动态类型，你可以自由地给一个对象添加或删除属性：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> xiaoming = &#123;</div><div class="line">               name: <span class="string">'小明'</span></div><div class="line">          &#125;;</div><div class="line">          xiaoming.age; <span class="comment">// undefined</span></div><div class="line">          xiaoming.age = <span class="number">18</span>; <span class="comment">// 新增一个age属性</span></div><div class="line">          xiaoming.age; <span class="comment">// 18</span></div><div class="line">          <span class="keyword">delete</span> xiaoming.age; <span class="comment">// 删除age属性</span></div><div class="line">          xiaoming.age; <span class="comment">// undefined</span></div><div class="line">          <span class="keyword">delete</span> xiaoming[<span class="string">'name'</span>]; <span class="comment">// 删除name属性</span></div><div class="line">          xiaoming.name; <span class="comment">// undefined</span></div><div class="line">          <span class="keyword">delete</span> xiaoming.school; <span class="comment">// 删除一个不存在的school属性也不会报错</span></div></pre></td></tr></table></figure>
<p>  如果我们要检测xiaoming是否拥有某一属性，可以用in操作符：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> xiaoming = &#123;</div><div class="line">               name: <span class="string">'小明'</span>,</div><div class="line">               birth: <span class="number">1990</span>,</div><div class="line">               school: <span class="string">'No.1 Middle School'</span>,</div><div class="line">               height: <span class="number">1.70</span>,</div><div class="line">               weight: <span class="number">65</span>,</div><div class="line">               score: <span class="literal">null</span></div><div class="line">          &#125;;</div><div class="line">          <span class="string">'name'</span> <span class="keyword">in</span> xiaoming; <span class="comment">// true</span></div><div class="line">          <span class="string">'grade'</span> <span class="keyword">in</span> xiaoming; <span class="comment">// false</span></div></pre></td></tr></table></figure>
<p>  不过要小心，如果in判断一个属性存在，这个属性不一定是xiaoming的，它可能是xiaoming继承得到的：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">         <span class="comment">// 因为toString定义在object对象中，而所有对象最终都会在原型链上指向object，所以xiaoming也拥有toString属性。</span></div><div class="line">          <span class="string">'toString'</span> <span class="keyword">in</span> xiaoming; <span class="comment">// true</span></div></pre></td></tr></table></figure>
<p>  要判断一个属性是否是xiaoming自身拥有的，而不是继承得到的，可以用hasOwnProperty()方法：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> xiaoming = &#123;</div><div class="line">               name: <span class="string">'小明'</span></div><div class="line">          &#125;;</div><div class="line">          xiaoming.hasOwnProperty(<span class="string">'name'</span>); <span class="comment">// true</span></div><div class="line">          xiaoming.hasOwnProperty(<span class="string">'toString'</span>); <span class="comment">// false</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h2><p>JavaScript使用<code>if () { ... } else { ... }</code>来进行条件判断。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> age = <span class="number">20</span>;</div><div class="line">          <span class="keyword">if</span> (age &gt;= <span class="number">18</span>) &#123; <span class="comment">// 如果age &gt;= 18为true，则执行if语句块</span></div><div class="line">               alert(<span class="string">'adult'</span>);</div><div class="line">          &#125; <span class="keyword">else</span> &#123; <span class="comment">// 否则执行else语句块</span></div><div class="line">               alert(<span class="string">'teenager'</span>);</div><div class="line">          &#125;</div></pre></td></tr></table></figure></p>
<p>其中else语句是可选的。如果语句块只包含一条语句，那么可以省略<code>{}</code>（最好不要这样做，容易引发错误）：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> age = <span class="number">20</span>;</div><div class="line">          <span class="keyword">if</span> (age &gt;= <span class="number">18</span>)</div><div class="line">               alert(<span class="string">'adult'</span>);</div><div class="line">          <span class="keyword">else</span></div><div class="line">               alert(<span class="string">'teenager'</span>);</div></pre></td></tr></table></figure></p>
<p>如果还要更细致地判断条件，可以使用多个<code>if...else...</code>的组合：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> age = <span class="number">3</span>;</div><div class="line">          <span class="keyword">if</span> (age &gt;= <span class="number">18</span>) &#123;</div><div class="line">               alert(<span class="string">'adult'</span>);</div><div class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (age &gt;= <span class="number">6</span>) &#123;</div><div class="line">               alert(<span class="string">'teenager'</span>);</div><div class="line">          &#125; <span class="keyword">else</span> &#123;</div><div class="line">               alert(<span class="string">'kid'</span>);</div><div class="line">          &#125;</div></pre></td></tr></table></figure></p>
<p>如果if的条件判断语句结果不是true或false怎么办？例如：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> s = <span class="string">'123'</span>;</div><div class="line">          <span class="keyword">if</span> (s.length) &#123; <span class="comment">// 条件计算结果为3</span></div><div class="line">               <span class="comment">// JavaScript把null、undefined、0、NaN和空字符串''视为false，其他值一概视为true，因此上述代码条件判断的结果是true。</span></div><div class="line">          &#125;</div></pre></td></tr></table></figure></p>
<h2 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h2><p>JavaScript的循环有两种，一种是for循环，通过初始条件、结束条件和递增条件来循环执行语句块：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> x = <span class="number">0</span>;</div><div class="line">     <span class="keyword">var</span> i;</div><div class="line">     <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;=<span class="number">10000</span>; i++) &#123;</div><div class="line">          x = x + i;</div><div class="line">     &#125;</div><div class="line">     x; <span class="comment">// 50005000</span></div></pre></td></tr></table></figure></p>
<p>for循环的3个条件都是可以省略的，如果没有退出循环的判断条件，就必须使用break语句退出循环，否则就是死循环：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> x = <span class="number">0</span>;</div><div class="line">     <span class="keyword">for</span> (;;) &#123; <span class="comment">// 将无限循环下去</span></div><div class="line">          <span class="keyword">if</span> (x &gt; <span class="number">100</span>) &#123;</div><div class="line">              <span class="keyword">break</span>; <span class="comment">// 通过if判断来退出循环</span></div><div class="line">          &#125;</div><div class="line">          x ++;</div><div class="line">     &#125;</div></pre></td></tr></table></figure></p>
<p><code>for ... in</code>循环</p>
<p>for循环的一个变体是for … in循环，它可以把一个对象的所有属性依次循环出来：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> o = &#123;</div><div class="line">          name: <span class="string">'Jack'</span>,</div><div class="line">          age: <span class="number">20</span>,</div><div class="line">          city: <span class="string">'Beijing'</span></div><div class="line">     &#125;;</div><div class="line">     <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> o) &#123;</div><div class="line">          alert(key); <span class="comment">// 'name', 'age', 'city'</span></div><div class="line">     &#125;</div></pre></td></tr></table></figure>
<p>要过滤掉对象继承的属性，用hasOwnProperty()来实现：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> o = &#123;</div><div class="line">          name: <span class="string">'Jack'</span>,</div><div class="line">          age: <span class="number">20</span>,</div><div class="line">          city: <span class="string">'Beijing'</span></div><div class="line">     &#125;;</div><div class="line">     <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> o) &#123;</div><div class="line">          <span class="keyword">if</span> (o.hasOwnProperty(key)) &#123;</div><div class="line">              alert(key); <span class="comment">// 'name', 'age', 'city'</span></div><div class="line">          &#125;</div><div class="line">     &#125;</div></pre></td></tr></table></figure></p>
<p>while循环(比较简单，这里不介绍)</p>
<h2 id="Map和Set（ES6规范引入）"><a href="#Map和Set（ES6规范引入）" class="headerlink" title="Map和Set（ES6规范引入）"></a>Map和Set（ES6规范引入）</h2><p>JavaScript的默认对象表示方式{}可以视为其他语言中的Map或Dictionary的数据结构，即一组键值对。但是JavaScript的对象有个小问题，就是键必须是字符串。但实际上Number或者其他数据类型作为键也是非常合理的。为了解决这个问题，最新的ES6规范引入了新的数据类型Map。要测试你的浏览器是否支持ES6规范，请执行以下代码，如果浏览器报ReferenceError错误，那么你需要换一个支持ES6的浏览器：</p>
<ul>
<li><p>Map<br>  Map是一组键值对的结构，具有极快的查找速度。<br>  用JavaScript写一个Map如下：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> m = <span class="keyword">new</span> <span class="built_in">Map</span>([[<span class="string">'Michael'</span>, <span class="number">95</span>], [<span class="string">'Bob'</span>, <span class="number">75</span>], [<span class="string">'Tracy'</span>, <span class="number">85</span>]]);</div><div class="line">          m.get(<span class="string">'Michael'</span>); <span class="comment">// 95</span></div></pre></td></tr></table></figure>
<p>  初始化Map需要一个二维数组，或者直接初始化一个空Map。Map具有以下方法：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> m = <span class="keyword">new</span> <span class="built_in">Map</span>(); <span class="comment">// 空Map</span></div><div class="line">          m.set(<span class="string">'Adam'</span>, <span class="number">67</span>); <span class="comment">// 添加新的key-value</span></div><div class="line">          m.set(<span class="string">'Bob'</span>, <span class="number">59</span>);</div><div class="line">          m.has(<span class="string">'Adam'</span>); <span class="comment">// 是否存在key 'Adam': true</span></div><div class="line">          m.get(<span class="string">'Adam'</span>); <span class="comment">// 67</span></div><div class="line">          m.delete(<span class="string">'Adam'</span>); <span class="comment">// 删除key 'Adam'</span></div><div class="line">          m.get(<span class="string">'Adam'</span>); <span class="comment">// undefined</span></div></pre></td></tr></table></figure>
<p>  由于一个key只能对应一个value，所以，多次对一个key放入value，后面的值会把前面的值冲掉：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> m = <span class="keyword">new</span> <span class="built_in">Map</span>();</div><div class="line">          m.set(<span class="string">'Adam'</span>, <span class="number">67</span>);</div><div class="line">          m.set(<span class="string">'Adam'</span>, <span class="number">88</span>);</div><div class="line">          m.get(<span class="string">'Adam'</span>); <span class="comment">// 88</span></div></pre></td></tr></table></figure>
</li>
<li><p>Set<br>  <code>Set</code>和<code>Map</code>类似，也是一组key的集合，但不存储value。由于key不能重复，所以，在Set中，没有重复的key。<br>要创建一个Set，需要提供一个Array作为输入，或者直接创建一个空Set：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> s1 = <span class="keyword">new</span> <span class="built_in">Set</span>(); <span class="comment">// 空Set</span></div><div class="line">          <span class="keyword">var</span> s2 = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// 含1, 2, 3</span></div></pre></td></tr></table></figure>
<p>  重复元素在Set中自动被过滤：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="string">'3'</span>]);</div><div class="line">          s; <span class="comment">// Set &#123;1, 2, 3, "3"&#125;</span></div></pre></td></tr></table></figure>
<p>  通过add(key)方法可以添加元素到Set中，可以重复添加，但不会有效果：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">          &gt;&gt;&gt; s.add(<span class="number">4</span>)</div><div class="line">          &gt;&gt;&gt; s</div><div class="line">          &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</div><div class="line">          &gt;&gt;&gt; s.add(<span class="number">4</span>)</div><div class="line">          &gt;&gt;&gt; s</div><div class="line">          &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</div></pre></td></tr></table></figure>
<p>  通过delete(key)方法可以删除元素：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</div><div class="line">          s; <span class="comment">// Set &#123;1, 2, 3&#125;</span></div><div class="line">          s.delete(<span class="number">3</span>);</div><div class="line">          s; <span class="comment">// Set &#123;1, 2&#125;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="iterable"><a href="#iterable" class="headerlink" title="iterable"></a>iterable</h2><p>遍历Array可以采用下标循环，遍历Map和Set就无法使用下标。为了统一集合类型，ES6标准引入了新的iterable类型，Array、Map和Set都属于iterable类型。 具有iterable类型的集合可以通过新的<code>for ... of</code>循环来遍历。<br><b style="color:red;"><code>for ... of</code>循环是ES6引入的新的语法</b>，请测试你的浏览器是否支持：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">     <span class="string">'use strict'</span>;</div><div class="line">     <span class="keyword">var</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</div><div class="line">     <span class="keyword">for</span> (<span class="keyword">var</span> x <span class="keyword">of</span> a) &#123;</div><div class="line">     &#125;</div><div class="line">     alert(<span class="string">'你的浏览器支持for ... of'</span>);</div></pre></td></tr></table></figure></p>
<p>用for … of循环遍历集合，用法如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> a = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>];</div><div class="line">     <span class="keyword">var</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>]);</div><div class="line">     <span class="keyword">var</span> m = <span class="keyword">new</span> <span class="built_in">Map</span>([[<span class="number">1</span>, <span class="string">'x'</span>], [<span class="number">2</span>, <span class="string">'y'</span>], [<span class="number">3</span>, <span class="string">'z'</span>]]);</div><div class="line">     <span class="keyword">for</span> (<span class="keyword">var</span> x <span class="keyword">of</span> a) &#123; <span class="comment">// 遍历Array</span></div><div class="line">          alert(x);</div><div class="line">     &#125;</div><div class="line">     <span class="keyword">for</span> (<span class="keyword">var</span> x <span class="keyword">of</span> s) &#123; <span class="comment">// 遍历Set</span></div><div class="line">          alert(x);</div><div class="line">     &#125;</div><div class="line">     <span class="keyword">for</span> (<span class="keyword">var</span> x <span class="keyword">of</span> m) &#123; <span class="comment">// 遍历Map</span></div><div class="line">          alert(x[<span class="number">0</span>] + <span class="string">'='</span> + x[<span class="number">1</span>]);<span class="comment">//1=x，2=y，3=z</span></div><div class="line">     &#125;</div></pre></td></tr></table></figure></p>
<p>你可能会有疑问，<code>for ... of</code>循环和<code>for ... in</code>循环有何区别？<br><code>for ... in</code>循环由于历史遗留问题，它遍历的实际上是对象的属性名称。一个Array数组实际上也是一个对象，它的每个元素的索引被视为一个属性。当我们手动给Array对象添加了额外的属性后，<code>for ... in</code>循环将带来意想不到的意外效果：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> a = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>];</div><div class="line">     a.name = <span class="string">'Hello'</span>;</div><div class="line">     <span class="keyword">for</span> (<span class="keyword">var</span> x <span class="keyword">in</span> a) &#123;</div><div class="line">          alert(x); <span class="comment">// '0', '1', '2', 'name'，x是属性的名称，对于数组来说，它每个元素的索引被视为属性名称</span></div><div class="line">     &#125;</div></pre></td></tr></table></figure></p>
<p><code>for ... in</code>循环将把name包括在内，但Array的length属性却不包括在内。<code>for ... of</code>循环则完全修复了这些问题，它只循环集合本身的元素：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> a = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>];</div><div class="line">     a.name = <span class="string">'Hello'</span>;</div><div class="line">     <span class="keyword">for</span> (<span class="keyword">var</span> x <span class="keyword">of</span> a) &#123;</div><div class="line">         <span class="comment">//只循环集合本身的元素</span></div><div class="line"></div><div class="line">          alert(x); <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span></div><div class="line">     &#125;</div></pre></td></tr></table></figure>
<p>然而，更好的方式是直接使用<code>iterable</code>内置的<code>forEach</code>方法，它接收一个函数，每次迭代就自动回调该函数。以<code>Array</code>为例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> a = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>];</div><div class="line">     a.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">element, index, array</span>) </span>&#123;</div><div class="line">          <span class="comment">// element: 指向当前元素的值</span></div><div class="line">          <span class="comment">// index: 指向当前索引</span></div><div class="line">          <span class="comment">// array: 指向Array对象本身</span></div><div class="line">          alert(element);</div><div class="line">     &#125;);</div></pre></td></tr></table></figure>
<p><b style="color:red;">注意，forEach()方法是ES5.1标准引入的，你需要测试浏览器是否支持。</b><br>Set与Array类似，但Set没有索引，因此回调函数的前两个参数都是元素本身：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>]);</div><div class="line">     s.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">element, sameElement, set</span>) </span>&#123;</div><div class="line">          alert(element);</div><div class="line">     &#125;);</div></pre></td></tr></table></figure></p>
<p>Map的回调函数参数依次为value、key和map本身：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> m = <span class="keyword">new</span> <span class="built_in">Map</span>([[<span class="number">1</span>, <span class="string">'x'</span>], [<span class="number">2</span>, <span class="string">'y'</span>], [<span class="number">3</span>, <span class="string">'z'</span>]]);</div><div class="line">     m.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">value, key, map</span>) </span>&#123;</div><div class="line">          alert(value);</div><div class="line">     &#125;);</div></pre></td></tr></table></figure></p>
<p>如果对某些参数不感兴趣，由于JavaScript的函数调用不要求参数必须一致，因此可以忽略它们。例如，只需要获得Array的element：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> a = [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>];</div><div class="line">     a.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">element</span>) </span>&#123;</div><div class="line">          alert(element);</div><div class="line">     &#125;);</div></pre></td></tr></table></figure></p>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><hr>
<h2 id="函数的定义和调用"><a href="#函数的定义和调用" class="headerlink" title="函数的定义和调用"></a>函数的定义和调用</h2><ul>
<li><p>定义函数<br>   在JavaScript中，定义函数的方式如下：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">abs</span>(<span class="params">x</span>) </span>&#123;</div><div class="line">               <span class="keyword">if</span> (x &gt;= <span class="number">0</span>) &#123;</div><div class="line">                   <span class="keyword">return</span> x;</div><div class="line">               &#125; <span class="keyword">else</span> &#123;</div><div class="line">                   <span class="keyword">return</span> -x;</div><div class="line">               &#125;</div><div class="line">          &#125;</div></pre></td></tr></table></figure>
<p>   上述<code>abs()</code>函数的定义如下：</p>
<ul>
<li><code>function</code>指出这是一个函数定义；</li>
<li><code>abs</code>是函数的名称；</li>
<li><code>(x)</code>括号内列出函数的参数，多个参数以<code>,</code>分隔；</li>
<li><p><code>{ ... }</code>之间的代码是函数体，可以包含若干语句，甚至可以没有任何语句。<br>请注意，函数体内部的语句在执行时，一旦执行到return时，函数就执行完毕，并将结果返回。因此，函数内部通过条件判断和循环可以实现非常复杂的逻辑。 如果没有return语句，函数执行完毕后也会返回结果，只是结果为undefined。<br>第二种定义函数的方式如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> abs = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</div><div class="line">               <span class="keyword">if</span> (x &gt;= <span class="number">0</span>) &#123;</div><div class="line">                   <span class="keyword">return</span> x;</div><div class="line">               &#125; <span class="keyword">else</span> &#123;</div><div class="line">                   <span class="keyword">return</span> -x;</div><div class="line">               &#125;</div><div class="line">          &#125;;</div></pre></td></tr></table></figure>
<p>在这种方式下，<code>function (x) { ... }</code>是一个匿名函数，它没有函数名。但是，这个匿名函数赋值给了变量<code>abs</code>，所以，通过变量<code>abs</code>就可以调用该函数。<br><b style="color:red;">上述两种定义完全等价，注意第二种方式按照完整语法需要在函数体末尾加一个;，表示赋值语句结束。</b></p>
</li>
</ul>
</li>
<li><p>调用函数<br>  调用函数时，按顺序传入参数即可：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">          abs(<span class="number">10</span>); <span class="comment">// 返回10</span></div><div class="line">          abs(<span class="number">-9</span>); <span class="comment">// 返回9</span></div></pre></td></tr></table></figure>
<p>  由于JavaScript允许传入任意个参数而不影响调用，因此传入的参数比定义的参数多也没有问题，虽然函数内部并不需要这些参数：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">          abs(<span class="number">10</span>, <span class="string">'blablabla'</span>); <span class="comment">// 返回10</span></div><div class="line">          abs(<span class="number">-9</span>, <span class="string">'haha'</span>, <span class="string">'hehe'</span>, <span class="literal">null</span>); <span class="comment">// 返回9</span></div></pre></td></tr></table></figure>
<p>  传入的参数比定义的少也没有问题：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">          abs(); <span class="comment">// 返回NaN</span></div></pre></td></tr></table></figure>
<p>  此时<code>abs(x)</code>函数的参数<code>x</code>将收到<code>undefined</code>，计算结果为<code>NaN</code>。<br>  要避免收到<code>undefined</code>，可以对参数进行检查：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">abs</span>(<span class="params">x</span>) </span>&#123;</div><div class="line">               <span class="keyword">if</span> (<span class="keyword">typeof</span> x !== <span class="string">'number'</span>) &#123;</div><div class="line">                   <span class="keyword">throw</span> <span class="string">'Not a number'</span>;</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">if</span> (x &gt;= <span class="number">0</span>) &#123;</div><div class="line">                   <span class="keyword">return</span> x;</div><div class="line">               &#125; <span class="keyword">else</span> &#123;</div><div class="line">                   <span class="keyword">return</span> -x;</div><div class="line">               &#125;</div><div class="line">          &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>arguments<br>  JavaScript还有一个免费赠送的关键字arguments，它只在函数内部起作用，并且永远指向当前函数的调用者传入的所有参数。arguments类似Array但它不是一个Array：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">x</span>) </span>&#123;</div><div class="line">               alert(x); <span class="comment">// 10</span></div><div class="line">               <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="built_in">arguments</span>.length; i++) &#123;</div><div class="line">                   alert(<span class="built_in">arguments</span>[i]); <span class="comment">// 10, 20, 30</span></div><div class="line">               &#125;</div><div class="line">          &#125;</div><div class="line">          foo(<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>);</div></pre></td></tr></table></figure>
<p>  利用arguments，你可以获得调用者传入的所有参数。也就是说，即使函数不定义任何参数，还是可以拿到参数的值：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">abs</span>(<span class="params"></span>) </span>&#123;</div><div class="line">               <span class="keyword">if</span> (<span class="built_in">arguments</span>.length === <span class="number">0</span>) &#123;</div><div class="line">                   <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">var</span> x = <span class="built_in">arguments</span>[<span class="number">0</span>];</div><div class="line">               <span class="keyword">return</span> x &gt;= <span class="number">0</span> ? x : -x;</div><div class="line">          &#125;</div><div class="line">          abs(); <span class="comment">// 0</span></div><div class="line">          abs(<span class="number">10</span>); <span class="comment">// 10</span></div><div class="line">          abs(<span class="number">-9</span>); <span class="comment">// 9</span></div></pre></td></tr></table></figure>
<p>  <b style="color:red;">利用arguments参数实现可选参数的函数：</b></p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">          <span class="comment">// foo(a[, b], c)</span></div><div class="line">          <span class="comment">// 接收2~3个参数，b是可选参数，如果只传2个参数，b默认为null：</span></div><div class="line">         <span class="comment">// 要把中间的参数b变为“可选”参数，就只能通过arguments判断，然后重新调整参数并赋值。</span></div><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a, b, c</span>) </span>&#123;</div><div class="line">               <span class="keyword">if</span> (<span class="built_in">arguments</span>.length === <span class="number">2</span>) &#123;</div><div class="line">                   <span class="comment">// 实际拿到的参数是a和b，c为undefined</span></div><div class="line">                   c = b; <span class="comment">// 把b赋给c</span></div><div class="line">                   b = <span class="literal">null</span>; <span class="comment">// b变为默认值</span></div><div class="line">               &#125;</div><div class="line">               <span class="comment">// ...</span></div><div class="line">          &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>rest参数（<b style="color:red;">ES6引入</b>）<br>  ES6标准引入了rest参数，可以获取除已定义的其他传入参数组成的数组：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a, b, ...rest</span>) </span>&#123;</div><div class="line">               <span class="built_in">console</span>.log(<span class="string">'a = '</span> + a);</div><div class="line">               <span class="built_in">console</span>.log(<span class="string">'b = '</span> + b);</div><div class="line">               <span class="built_in">console</span>.log(rest);</div><div class="line">          &#125;  </div><div class="line">          foo(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</div><div class="line">          <span class="comment">// 结果:</span></div><div class="line">          <span class="comment">// a = 1</span></div><div class="line">          <span class="comment">// b = 2</span></div><div class="line">          <span class="comment">// Array [ 3, 4, 5 ]</span></div><div class="line">          foo(<span class="number">1</span>);</div><div class="line">          <span class="comment">// 结果:</span></div><div class="line">          <span class="comment">// a = 1</span></div><div class="line">          <span class="comment">// b = undefined</span></div><div class="line">          <span class="comment">// Array []</span></div></pre></td></tr></table></figure>
<p>  用<code>rest</code>参数编写一个<code>sum()</code>函数，接收任意个参数并返回它们的和：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">...rest</span>) </span>&#123;</div><div class="line">             <span class="keyword">var</span> sum = <span class="number">0</span>;</div><div class="line">             <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">of</span> rest) &#123;</div><div class="line">               sum += i;     </div><div class="line">             &#125;</div><div class="line">             <span class="keyword">return</span> sum;</div><div class="line">          &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>小心你的return语句<br> 前面我们讲到了JavaScript引擎有一个在行末自动添加分号的机制，这可能让你栽到return语句的一个大坑：</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">               <span class="keyword">return</span> &#123; name: <span class="string">'foo'</span> &#125;;</div><div class="line">          &#125;</div><div class="line">          foo(); <span class="comment">// &#123; name: 'foo' &#125;</span></div></pre></td></tr></table></figure>
<p> 如果把return语句拆成两行：</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">               <span class="keyword">return</span>         <span class="regexp">/ /</span> 自动添加了分号，相当于<span class="keyword">return</span> <span class="literal">undefined</span>;</div><div class="line">                   &#123; name: <span class="string">'foo'</span> &#125;;   <span class="comment">// 这行语句已经没法执行到了</span></div><div class="line">          &#125;</div><div class="line">          foo(); <span class="comment">// undefined</span></div></pre></td></tr></table></figure>
<p> 所以正确的多行写法是：</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">               <span class="keyword">return</span> &#123; <span class="comment">// 这里不会自动加分号，因为&#123;表示语句尚未结束</span></div><div class="line">                   name: <span class="string">'foo'</span></div><div class="line">               &#125;;</div><div class="line">          &#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="变量作用域"><a href="#变量作用域" class="headerlink" title="变量作用域"></a>变量作用域</h2><ul>
<li>基础知识<br>在JavaScript中，用var申明的变量实际上是有作用域的。<br>1、如果一个变量在函数体内部申明，则该变量的作用域为整个函数体，在函数体外不可引用该变量：<br>2、如果两个不同的函数各自申明了同一个变量，那么该变量只在各自的函数体内起作用。换句话说，不同函数内部的同名变量互相独立，互不影响：<br>3、由于JavaScript的函数可以嵌套，此时，内部函数可以访问外部函数定义的变量，反过来则不行：<br>4、JavaScript的函数在查找变量时从自身函数定义开始，从“内”向“外”查找。如果内部函数定义了与外部函数重名的变量，则内部函数的变量将“屏蔽”外部函数的变量。</li>
<li><p>变量提升<br>   JavaScript的函数定义有个特点，它会先扫描整个函数体的语句，把所有申明的变量“提升”到函数顶部：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">          <span class="string">'use strict'</span>;</div><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">               <span class="keyword">var</span> x = <span class="string">'Hello, '</span> + y;</div><div class="line">               a lert(x);</div><div class="line">               <span class="keyword">var</span> y = <span class="string">'Bob'</span>;</div><div class="line">          &#125;</div><div class="line">          foo();</div></pre></td></tr></table></figure>
<p>   虽然是strict模式，但语句var x = ‘Hello, ‘ + y;并不报错，原因是变量y在稍后申明了。但是alert显示Hello, undefined，说明变量y的值为undefined。这正是因为JavaScript引擎自动提升了变量y的声明，但不会提升变量y的赋值。<br>对于上述foo()函数，JavaScript引擎看到的代码相当于：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">               <span class="keyword">var</span> y; <span class="comment">// 提升变量y的申明</span></div><div class="line">               <span class="keyword">var</span> x = <span class="string">'Hello, '</span> + y;</div><div class="line">               alert(x);</div><div class="line">               y = <span class="string">'Bob'</span>;</div><div class="line">          &#125;</div></pre></td></tr></table></figure>
<p>   由于JavaScript的这一怪异的“特性”，我们在函数内部定义变量时，请严格遵守“在函数内部首先申明所有变量”这一规则。最常见的做法是用一个var申明函数内部用到的所有变量：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">               <span class="comment">//JS引擎在认为可以加分号的地方自动加分号，这里不会自动加分号</span></div><div class="line">               <span class="keyword">var</span></div><div class="line">                   x = <span class="number">1</span>, <span class="comment">// x初始化为1</span></div><div class="line">                   y = x + <span class="number">1</span>, <span class="comment">// y初始化为2</span></div><div class="line">                   z, i; <span class="comment">// z和i为undefined</span></div><div class="line">               <span class="comment">// 其他语句:</span></div><div class="line">               f or (i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;      </div><div class="line">               &#125;</div><div class="line">          &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>全局作用域<br>   不在任何函数内定义的变量就具有全局作用域。实际上，JavaScript默认有一个全局对象window，全局作用域的变量实际上被绑定到window的一个属性：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">          <span class="string">'use strict'</span>;  </div><div class="line">          <span class="keyword">var</span> course = <span class="string">'Learn JavaScript'</span>;</div><div class="line">          alert(course); <span class="comment">// 'Learn JavaScript'</span></div><div class="line">          alert(<span class="built_in">window</span>.course); <span class="comment">// 'Learn JavaScript'</span></div></pre></td></tr></table></figure>
<p>   因此，直接访问全局变量course和访问window.course是完全一样的。同理，全局定义的函数也可以通过<code>window.functionName()</code>方式调用。<br>进一步大胆地猜测，我们每次直接调用的alert()函数其实也是window的一个变量：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">          <span class="string">'use strict'</span>;  </div><div class="line">          <span class="built_in">window</span>.alert(<span class="string">'调用window.alert()'</span>);</div><div class="line">          <span class="comment">// 把alert保存到另一个变量:</span></div><div class="line">          <span class="keyword">var</span> old_alert = <span class="built_in">window</span>.alert;</div><div class="line">          <span class="comment">// 给alert赋一个新函数:</span></div><div class="line">          <span class="built_in">window</span>.alert = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</div><div class="line">          alert(<span class="string">'无法用alert()显示了!'</span>);</div><div class="line">          <span class="comment">// 恢复alert:</span></div><div class="line">          <span class="built_in">window</span>.alert = old_alert;</div><div class="line">          alert(<span class="string">'又可以用alert()了!'</span>);</div></pre></td></tr></table></figure>
<p>   这说明JavaScript实际上只有一个全局作用域。任何变量（函数也视为变量），如果没有在当前函数作用域中找到，就会继续往上查找，最后如果在全局作用域中也没有找到，则报ReferenceError错误。</p>
</li>
<li><p>名字空间<br>   全局变量会绑定到window上，不同的JavaScript文件如果使用了相同的全局变量，或者定义了相同名字的顶层函数，都会造成命名冲突，并且很难被发现。 减少冲突的一个方法是把自己的所有变量和函数全部绑定到一个全局变量中。例如：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">          <span class="comment">// 唯一的全局变量MYAPP:</span></div><div class="line">          <span class="keyword">var</span> MYAPP = &#123;&#125;;  </div><div class="line">          <span class="comment">// 其他变量:</span></div><div class="line">          MYAPP.name = <span class="string">'myapp'</span>;</div><div class="line">          MYAPP.version = <span class="number">1.0</span>;</div><div class="line">          <span class="comment">// 其他函数:</span></div><div class="line">          MYAPP.foo = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">               <span class="keyword">return</span> <span class="string">'foo'</span>;</div><div class="line">          &#125;;</div></pre></td></tr></table></figure>
<p>   把自己的代码全部放入唯一的名字空间MYAPP中，会大大减少全局变量冲突的可能。 许多著名的JavaScript库都是这么干的：jQuery，YUI，underscore等等。</p>
</li>
<li><p>局部作用域<br>   由于JavaScript的变量作用域实际上是函数内部，我们在for循环等语句块中是无法定义具有局部作用域的变量的：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">          <span class="string">'use strict'</span>;</div><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">               <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</div><div class="line">                   <span class="comment">//</span></div><div class="line">               &#125;</div><div class="line">               i += <span class="number">100</span>; <span class="comment">// 仍然可以引用变量i</span></div><div class="line">          &#125;</div></pre></td></tr></table></figure>
<p>   为了解决块级作用域，<b style="color:red;">ES6引入了新的关键字let</b>，用let替代var可以申明一个块级作用域的变量：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">          <span class="string">'use strict'</span>;  </div><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">               <span class="keyword">var</span> sum = <span class="number">0</span>;</div><div class="line">               <span class="keyword">for</span> (<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</div><div class="line">                   sum += i;</div><div class="line">               &#125;</div><div class="line">               i += <span class="number">1</span>; <span class="comment">// SyntaxError</span></div><div class="line">          &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>常量<br>  由于var和let申明的是变量，如果要申明一个常量，在ES6之前是不行的，我们通常用全部大写的变量来表示“这是一个常量，不要修改它的值”：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> PI = <span class="number">3.14</span>;</div></pre></td></tr></table></figure>
<p>  <b style="color:red;">ES6标准引入了新的关键字const来定义常量</b>，const与let都具有块级作用域：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">          <span class="string">'use strict'</span>;</div><div class="line">          <span class="keyword">const</span> PI = <span class="number">3.14</span>;</div><div class="line">          PI = <span class="number">3</span>; <span class="comment">// 某些浏览器不报错，但是无效果！</span></div><div class="line">          PI; <span class="comment">// 3.14</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><ul>
<li><p>方法与<code>this</code><br>  在一个对象中绑定函数，称为这个对象的方法。<br>  如果我们给xiaoming绑定一个函数，就可以做更多的事情。比如，写个age()方法，返回xiaoming的年龄：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> xiaoming = &#123;</div><div class="line">               name: <span class="string">'小明'</span>,</div><div class="line">               birth: <span class="number">1990</span>,</div><div class="line">               age: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                   <span class="keyword">var</span> y = <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear();</div><div class="line">                   <span class="keyword">return</span> y - <span class="keyword">this</span>.birth;</div><div class="line">               &#125;</div><div class="line">          &#125;;</div><div class="line">          xiaoming.age; <span class="comment">// function xiaoming.age()，this指向xiaoming这个对象，即指向函数所属对象，即指向函数的调用者</span></div><div class="line">          xiaoming.age(); <span class="comment">// 今年调用是25,明年调用就变成26了</span></div></pre></td></tr></table></figure>
<p>  在一个方法内部，this是一个特殊变量，它始终指向当前对象，也就是xiaoming这个变量。所以，this.birth可以拿到xiaoming的birth属性。<br>  让我们拆开写：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">getAge</span>(<span class="params"></span>) </span>&#123;</div><div class="line">               <span class="keyword">var</span> y = <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear();</div><div class="line">               <span class="keyword">return</span> y - <span class="keyword">this</span>.birth;</div><div class="line">          &#125;</div><div class="line">          <span class="keyword">var</span> xiaoming = &#123;</div><div class="line">                name: <span class="string">'小明'</span>,</div><div class="line">               birth: <span class="number">1990</span>,</div><div class="line">               age: getAge</div><div class="line">          &#125;;  </div><div class="line">          xiaoming.age(); <span class="comment">// 25, 正常结果</span></div><div class="line">          getAge(); <span class="comment">// NaN</span></div></pre></td></tr></table></figure>
<p>  单独调用函数getAge()怎么返回了<code>NaN</code>？上面说了，<code>this</code>即指向函数的调用者，<code>getAge()</code>等价于<code>window.getAge()</code>，所以当调 用<code>getAge()</code>方法时，<code>this</code>指向window对象。<br>  由于这是一个巨大的设计错误，要想纠正可没那么简单。ECMA决定，在strict模式下让函数的this指向undefined，因此，在strict模式下，你会得到一个错误：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">          <span class="string">'use strict'</span>;  </div><div class="line">          <span class="keyword">var</span> xiaoming = &#123;</div><div class="line">               name: <span class="string">'小明'</span>,</div><div class="line">               birth: <span class="number">1990</span>,</div><div class="line">               age: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                   <span class="keyword">var</span> y = <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear();</div><div class="line">                   <span class="keyword">return</span> y - <span class="keyword">this</span>.birth;</div><div class="line">               &#125;</div><div class="line">          &#125;;</div><div class="line">          <span class="keyword">var</span> fn = xiaoming.age;</div><div class="line">          fn(); <span class="comment">// Uncaught TypeError: Cannot read property 'birth' of undefined</span></div></pre></td></tr></table></figure>
<p>  有些时候，喜欢重构的你把方法重构了一下：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">          <span class="string">'use strict'</span>;</div><div class="line">          <span class="keyword">var</span> xiaoming = &#123;</div><div class="line">               name: <span class="string">'小明'</span>,</div><div class="line">               birth: <span class="number">1990</span>,</div><div class="line">               age: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                   <span class="function"><span class="keyword">function</span> <span class="title">getAgeFromBirth</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                       <span class="keyword">var</span> y = <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear();</div><div class="line">                       <span class="keyword">return</span> y - <span class="keyword">this</span>.birth;</div><div class="line">                   &#125;</div><div class="line">                   <span class="keyword">return</span> getAgeFromBirth();</div><div class="line">               &#125;</div><div class="line">          &#125;;  </div><div class="line">          xiaoming.age(); <span class="comment">// Uncaught TypeError: Cannot read property 'birth' of undefined</span></div></pre></td></tr></table></figure>
<p>  结果又报错了！原因是this指针只在age方法的函数内指向xiaoming，在函数内部定义的函数，this又指向undefined了！（在非strict模式下，它重新指向全局对象window！）<br>  修复的方法，我们用一个that变量首先捕获this：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">          <span class="string">'use strict'</span>;  </div><div class="line">          <span class="keyword">var</span> xiaoming = &#123;</div><div class="line">               name: <span class="string">'小明'</span>,</div><div class="line">               birth: <span class="number">1990</span>,</div><div class="line">               age: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                   <span class="keyword">var</span> that = <span class="keyword">this</span>; <span class="comment">// 在方法内部一开始就捕获this</span></div><div class="line">                   <span class="function"><span class="keyword">function</span> <span class="title">getAgeFromBirth</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                       <span class="keyword">var</span> y = <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear();</div><div class="line">                       <span class="keyword">return</span> y - that.birth; <span class="comment">// 用that而不是this</span></div><div class="line">                   &#125;</div><div class="line">                   <span class="keyword">return</span> getAgeFromBirth();</div><div class="line">               &#125;</div><div class="line">          &#125;;</div><div class="line">          xiaoming.age(); <span class="comment">// 25</span></div></pre></td></tr></table></figure>
</li>
<li><p>apply<br>  虽然在一个独立的函数调用中，根据是否是strict模式，this指向undefined或window，不过，我们还是可以控制this的指向的！<br>  要指定函数的this指向哪个对象，可以用函数本身的apply方法，它接收两个参数，第一个参数就是需要绑定的this变量，第二个参数是Array，表示函数本身的参数。<br>  用<code>apply</code>修复<code>getAge()</code>调用：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">getAge</span>(<span class="params"></span>) </span>&#123;</div><div class="line">               <span class="keyword">var</span> y = <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear();</div><div class="line">               <span class="keyword">return</span> y - <span class="keyword">this</span>.birth;</div><div class="line">          &#125;</div><div class="line">          <span class="keyword">var</span> xiaoming = &#123;</div><div class="line">               name: <span class="string">'小明'</span>,</div><div class="line">               birth: <span class="number">1990</span>,</div><div class="line">               age: getAge</div><div class="line">          &#125;;  </div><div class="line">          xiaoming.age(); <span class="comment">// 25</span></div><div class="line">          getAge.apply(xiaoming, []); <span class="comment">// 25, this指向xiaoming, 参数为空</span></div></pre></td></tr></table></figure>
<p>  另一个与<code>apply()</code>类似的方法是<code>call()</code>，唯一区别是：</p>
<ul>
<li><code>apply()</code>把参数打包成<code>Array</code>再传入；</li>
<li><p><code>call()</code>把参数按顺序传入。<br>比如调用<code>Math.max(3, 5, 4)</code>，分别用<code>apply()</code>和<code>call()</code>实现如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">          <span class="built_in">Math</span>.max.apply(<span class="literal">null</span>, [<span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>]); <span class="comment">// 5</span></div><div class="line">          <span class="built_in">Math</span>.max.call(<span class="literal">null</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>); <span class="comment">// 5</span></div></pre></td></tr></table></figure>
<p>对普通函数调用，我们通常把<code>this</code>绑定为<code>null</code>。</p>
</li>
</ul>
</li>
<li>装饰器<br>  利用<code>apply()</code>，我们还可以动态改变函数的行为。<br>  JavaScript的所有对象都是动态的，即使内置的函数，我们也可以重新指向新的函数。<br>  现在假定我们想统计一下代码一共调用了多少次<code>parseInt()</code>，可以把所有的调用都找出来，然后手动加上<code>count += 1</code>，不过这样做太傻了。最佳方案是用我们自己的函数替换掉默认的<code>parseInt()</code>：  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> count = <span class="number">0</span>;</div><div class="line">          <span class="keyword">var</span> oldParseInt = <span class="built_in">parseInt</span>; <span class="comment">// 保存原函数</span></div><div class="line">          <span class="built_in">window</span>.parseInt = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">               count += <span class="number">1</span>;</div><div class="line">               <span class="keyword">return</span> oldParseInt.apply(<span class="literal">null</span>, <span class="built_in">arguments</span>); <span class="comment">// 调用原函数</span></div><div class="line">          &#125;;</div><div class="line">          <span class="comment">// 测试:</span></div><div class="line">          <span class="built_in">parseInt</span>(<span class="string">'10'</span>);</div><div class="line">          <span class="built_in">parseInt</span>(<span class="string">'20'</span>);</div><div class="line">          <span class="built_in">parseInt</span>(<span class="string">'30'</span>);</div><div class="line">          count; <span class="comment">// 3</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h2><p>JavaScript的函数其实都指向某个变量。既然变量可以指向函数，函数的参数能接收变量，那么一个函数就可以接收另一个函数作为参数，这种函数就称之为高阶函数。<br>一个最简单的高阶函数：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">     <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y, f</span>) </span>&#123;</div><div class="line">          <span class="keyword">return</span> f(x) + f(y);</div><div class="line">     &#125;</div></pre></td></tr></table></figure></p>
<p>当我们调用<code>add(-5, 6, Math.abs)</code>时，参数<code>x</code>，<code>y</code>和<code>f</code>分别接收<code>-5</code>，<code>6</code>和函数<code>Math.abs</code>，根据函数定义，我们可以推导计算过程为：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">     x = <span class="number">-5</span>;</div><div class="line">     y = <span class="number">6</span>;</div><div class="line">     f = <span class="built_in">Math</span>.abs;</div><div class="line">     f(x) + f(y) ==&gt; <span class="built_in">Math</span>.abs(<span class="number">-5</span>) + <span class="built_in">Math</span>.abs(<span class="number">6</span>) ==&gt; <span class="number">11</span>;</div><div class="line">     <span class="keyword">return</span> <span class="number">11</span>;</div></pre></td></tr></table></figure></p>
<h3 id="map-reduce"><a href="#map-reduce" class="headerlink" title="map/reduce"></a>map/reduce</h3><ul>
<li><p>map<br>  举例说明，比如我们有一个函数f(x)=x2，要把这个函数作用在一个数组[1, 2, 3, 4, 5, 6, 7, 8, 9]上，就可以用map实现如下：<br>  由于<code>map()</code>方法定义在JavaScript的<code>Array</code>中，我们调用<code>Array</code>的<code>map()</code>方法，传入我们自己的函数，就得到了一个新的<code>Array</code>作为结果：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">pow</span>(<span class="params">x</span>) </span>&#123;</div><div class="line">               <span class="keyword">return</span> x * x;</div><div class="line">          &#125;</div><div class="line">          <span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>];</div><div class="line">          arr.map(pow); <span class="comment">// [1, 4, 9, 16, 25, 36, 49, 64, 81]</span></div></pre></td></tr></table></figure>
<p>  <code>map()</code>传入的参数是<code>pow</code>，即函数对象本身。<br>  map()作为高阶函数，事实上它把运算规则抽象了，因此，我们不但可以计算简单的f(x)=x2，还可以计算任意复杂的函数，比如，把Array的所有数字转为字符串：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>];</div><div class="line">          arr.map(<span class="built_in">String</span>); <span class="comment">// ['1', '2', '3', '4', '5', '6', '7', '8', '9']</span></div></pre></td></tr></table></figure>
</li>
<li><p>reduce<br>  Array的reduce()把一个函数作用在这个Array的[x1, x2, x3…]上，这个函数必须接收两个参数，reduce()把结果继续和序列的下一个元素做累积计算，其效果就是：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">          [x1, x2, x3, x4].reduce(f) = f(f(f(x1, x2), x3), x4);</div></pre></td></tr></table></figure>
<p>  比方说对一个Array求和，就可以用reduce实现：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>];</div><div class="line">         <span class="keyword">var</span> sum =  arr.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</div><div class="line">               <span class="keyword">return</span> x + y;</div><div class="line">          &#125;); <span class="comment">// 25</span></div><div class="line">         <span class="keyword">return</span> sum;</div></pre></td></tr></table></figure>
<p>  要把[1, 3, 5, 7, 9]变换成整数13579，reduce()也能派上用场：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>];</div><div class="line">          arr.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</div><div class="line">               <span class="keyword">return</span> x * <span class="number">10</span> + y;</div><div class="line">          &#125;); <span class="comment">// 13579</span></div></pre></td></tr></table></figure>
<p>  <b>请把用户输入的不规范的英文名字，变为首字母大写，其他小写的规范名字。输入：[‘adam’, ‘LISA’, ‘barT’]，输出：[‘Adam’, ‘Lisa’, ‘Bart’]。</b></p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">          <span class="string">'use strict'</span>;</div><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">normalize</span>(<span class="params">arr</span>) </span>&#123;</div><div class="line">               <span class="keyword">return</span> arr.map(<span class="function"><span class="keyword">function</span> (<span class="params">s</span>)</span>&#123;</div><div class="line">                   <span class="keyword">return</span>  s.slice(<span class="number">0</span>,<span class="number">1</span>).toUpperCase() + s.slice(<span class="number">1</span>).toLowerCase();</div><div class="line">               &#125;);</div><div class="line">          &#125;</div><div class="line">            <span class="comment">// 测试:</span></div><div class="line">          <span class="keyword">if</span> (normalize([<span class="string">'adam'</span>, <span class="string">'LISA'</span>, <span class="string">'barT'</span>]).toString() === [<span class="string">'Adam'</span>, <span class="string">'Lisa'</span>, <span class="string">'Bart'</span>].toString()) &#123;</div><div class="line">               alert(<span class="string">'测试通过!'</span>);</div><div class="line">          &#125; <span class="keyword">else</span> &#123;</div><div class="line">               alert(<span class="string">'测试失败!'</span>);</div><div class="line">          &#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h3><p><code>filter</code>也是一个常用的操作，它用于把<code>Array</code>的某些元素过滤掉，然后返回剩下的元素。 和<code>map()</code>类似，<code>Array</code>的<code>filter()</code>也接收一个函数。和<code>map()</code>不同的是，<code>filter()</code>把传入的函数依次作用于每个元素，然后根据返回值是<code>true</code>还是<code>false</code>决定保留还是丢弃该元素。<br>例如，在一个Array中，删掉偶数，只保留奇数，可以这么写：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">15</span>];</div><div class="line">     <span class="keyword">var</span> r = arr.filter(<span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</div><div class="line">          <span class="keyword">return</span> x % <span class="number">2</span> !== <span class="number">0</span>;</div><div class="line">     &#125;);</div><div class="line">     r; <span class="comment">// [1, 5, 9, 15]</span></div></pre></td></tr></table></figure></p>
<p>把一个<code>Array</code>中的空字符串删掉，可以这么写：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> arr = [<span class="string">'A'</span>, <span class="string">''</span>, <span class="string">'B'</span>, <span class="literal">null</span>, <span class="literal">undefined</span>, <span class="string">'C'</span>, <span class="string">'  '</span>];</div><div class="line">     <span class="keyword">var</span> r = arr.filter(<span class="function"><span class="keyword">function</span> (<span class="params">s</span>) </span>&#123;</div><div class="line">          <span class="keyword">return</span> s &amp;&amp; s.trim(); <span class="comment">// 注意：IE9以下的版本没有trim()方法</span></div><div class="line">     &#125;);</div><div class="line">     r; <span class="comment">// ['A', 'B', 'C']</span></div></pre></td></tr></table></figure></p>
<p><b>练习：请尝试用filter()筛选出素数：</b><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">     <span class="string">'use strict'</span>;</div><div class="line">     <span class="function"><span class="keyword">function</span> <span class="title">get_primes</span>(<span class="params">arr</span>) </span>&#123;  </div><div class="line">          <span class="keyword">return</span> arr.filter(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;</div><div class="line">             <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">2</span> ; i &lt; x ; i++)&#123;</div><div class="line">                 <span class="keyword">if</span>(x % i === <span class="number">0</span>)&#123;</div><div class="line">                      <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">                 &#125;</div><div class="line">             &#125;</div><div class="line">             <span class="keyword">return</span> x === <span class="number">1</span> ? <span class="literal">false</span> : <span class="literal">true</span>;</div><div class="line">          &#125;);</div><div class="line">     &#125;</div><div class="line">     <span class="comment">// 测试:</span></div><div class="line">     <span class="keyword">var</span></div><div class="line">          x,</div><div class="line">          r,</div><div class="line">          arr = [];</div><div class="line">     <span class="keyword">for</span> (x = <span class="number">1</span>; x &lt; <span class="number">100</span>; x++) &#123;</div><div class="line">          arr.push(x);</div><div class="line">     &#125;</div><div class="line">     r = get_primes(arr);</div><div class="line">     <span class="keyword">if</span> (r.toString() === [<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">23</span>, <span class="number">29</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">41</span>, <span class="number">43</span>, <span class="number">47</span>, <span class="number">53</span>, <span class="number">59</span>, <span class="number">61</span>, <span class="number">67</span>, <span class="number">71</span>, <span class="number">73</span>, <span class="number">79</span>, <span class="number">83</span>, <span class="number">89</span>, <span class="number">97</span>].toString()) &#123;</div><div class="line">          alert(<span class="string">'测试通过!'</span>);</div><div class="line">     &#125; <span class="keyword">else</span> &#123;</div><div class="line">          alert(<span class="string">'测试失败: '</span> + r.toString());</div><div class="line">     &#125;</div></pre></td></tr></table></figure></p>
<h3 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h3><p>排序也是在程序中经常用到的算法。无论使用冒泡排序还是快速排序，排序的核心是比较两个元素的大小。如果是数字，我们可以直接比较，但如果是字符串或者两个对象呢？直接比较数学上的大小是没有意义的，因此，比较的过程必须通过函数抽象出来。通常规定，对于两个元素x和y，如果认为x &lt; y，则返回-1，如果认为x == y，则返回0，如果认为x &gt; y，则返回1，这样，排序算法就不用关心具体的比较过程，而是根据比较结果直接排序。<br>JavaScript的<code>Array</code>的<code>sort()</code>方法就是用于排序的，但是排序结果可能让你大吃一惊：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">     <span class="comment">// 看上去正常的结果:</span></div><div class="line">     [<span class="string">'Google'</span>, <span class="string">'Apple'</span>, <span class="string">'Microsoft'</span>].sort(); <span class="comment">// ['Apple', 'Google', 'Microsoft'];</span></div><div class="line">     <span class="comment">// apple排在了最后:</span></div><div class="line">     [<span class="string">'Google'</span>, <span class="string">'apple'</span>, <span class="string">'Microsoft'</span>].sort(); <span class="comment">// ['Google', 'Microsoft", 'apple']  </span></div><div class="line">     <span class="comment">// 无法理解的结果:</span></div><div class="line">     [<span class="number">10</span>, <span class="number">20</span>, <span class="number">1</span>, <span class="number">2</span>].sort(); <span class="comment">// [1, 10, 2, 20]</span></div></pre></td></tr></table></figure></p>
<p>第二个排序把apple排在了最后，是因为字符串根据ASCII码进行排序，而小写字母a的ASCII码在大写字母之后。<br>第三个排序因为<code>Array</code>的<code>sort()</code>方法默认把所有元素先转换为String再排序，结果<code>&#39;10&#39;</code>排在了<code>&#39;2&#39;</code>的前面，因为字符<code>&#39;1&#39;</code>比字符<code>&#39;2&#39;</code>的ASCII码小。<br>如果不知道sort()方法的默认排序规则，直接对数字排序，绝对栽进坑里！幸运的是，sort()方法也是一个高阶函数，它还可以接收一个比较函数来实现自定义的排序。<br>要按数字大小排序，我们可以这么写：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> arr = [<span class="number">10</span>, <span class="number">20</span>, <span class="number">1</span>, <span class="number">2</span>];</div><div class="line">     arr.sort(<span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</div><div class="line">          <span class="keyword">if</span> (x &lt; y) &#123;</div><div class="line">              <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">          &#125;</div><div class="line">          <span class="keyword">if</span> (x &gt; y) &#123;</div><div class="line">              <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">          &#125;</div><div class="line">          <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">     &#125;); <span class="comment">// [1, 2, 10, 20]</span></div></pre></td></tr></table></figure></p>
<p>默认情况下，对字符串排序，是按照ASCII的大小比较的，现在，我们提出排序应该忽略大小写，按照字母序排序。要实现这个算法，不必对现有代码大加改动，只要我们能定义出忽略大小写的比较算法就可以：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> arr = [<span class="string">'Google'</span>, <span class="string">'apple'</span>, <span class="string">'Microsoft'</span>];</div><div class="line">     arr.sort(<span class="function"><span class="keyword">function</span> (<span class="params">s1, s2</span>) </span>&#123;</div><div class="line">          x1 = s1.toUpperCase();</div><div class="line">          x2 = s2.toUpperCase();</div><div class="line">          <span class="keyword">if</span> (x1 &lt; x2) &#123;</div><div class="line">              <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">          &#125;</div><div class="line">          <span class="keyword">if</span> (x1 &gt; x2) &#123;</div><div class="line">              <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">          &#125;</div><div class="line">          <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">     &#125;); <span class="comment">// ['apple', 'Google', 'Microsoft']</span></div></pre></td></tr></table></figure></p>
<p>最后友情提示，sort()方法会直接对Array进行修改，它返回的结果仍是当前Array：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> a1 = [<span class="string">'B'</span>, <span class="string">'A'</span>, <span class="string">'C'</span>];</div><div class="line">     <span class="keyword">var</span> a2 = a1.sort();</div><div class="line">     a1; <span class="comment">// ['A', 'B', 'C']</span></div><div class="line">     a2; <span class="comment">// ['A', 'B', 'C']</span></div><div class="line">     a1 === a2; <span class="comment">// true, a1和a2是同一对象</span></div></pre></td></tr></table></figure></p>
<h2 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h2><ul>
<li><p>函数作为返回值<br>  高阶函数除了可以接受函数作为参数外，还可以把函数作为结果值返回。我们来实现一个对<code>Array</code>的求和，不返回求和的结果，而是返回求和的函数！</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">lazy_sum</span>(<span class="params">arr</span>) </span>&#123;</div><div class="line">               <span class="keyword">var</span> sum = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                   <span class="keyword">return</span> arr.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</div><div class="line">                       <span class="keyword">return</span> x + y;</div><div class="line">                   &#125;);</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">return</span> sum;</div><div class="line">          &#125;</div></pre></td></tr></table></figure>
<p>  当我们调用<code>lazy_sum()</code>时，返回的并不是求和结果，而是求和函数：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> f = lazy_sum([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]); <span class="comment">// function sum()</span></div></pre></td></tr></table></figure>
<p>  调用函数<code>f</code>时，才真正计算求和的结果：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">          f(); <span class="comment">// 15</span></div></pre></td></tr></table></figure>
<p>  在这个例子中，我们在函数<code>lazy_sum</code>中又定义了函数<code>sum</code>，并且，内部函数<code>sum</code>可以引用外部函数<code>lazy_sum</code>的参数和局部变量，当<code>lazy_sum</code>返回函数<code>sum</code>时，相关参数和变量都保存在返回的函数中，这种称为“闭包（Closure）”的程序结构拥有极大的威力。<br>  请再注意一点，当我们调用<code>lazy_sum()</code>时，每次调用都会返回一个新的函数，即使传入相同的参数：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> f1 = lazy_sum([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</div><div class="line">          <span class="keyword">var</span> f2 = lazy_sum([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]);</div><div class="line">          f1 === f2; <span class="comment">// false</span></div></pre></td></tr></table></figure>
<p>  <code>f1()</code>和<code>f2()</code>的调用结果互不影响。</p>
</li>
<li><p>闭包<br>  注意到返回的函数在其定义内部引用了局部变量arr，所以，当一个函数返回了一个函数后，其内部的局部变量还被新函数引用，所以，闭包用起来简单，实现起来可不容易。<br>另一个需要注意的问题是，返回的函数并没有立刻执行，而是直到调用了f()才执行。我们来看一个例子：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">count</span>(<span class="params"></span>) </span>&#123;</div><div class="line">               <span class="keyword">var</span> arr = [];</div><div class="line">               <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">1</span>; i&lt;=<span class="number">3</span>; i++) &#123;</div><div class="line">                    <span class="comment">// 每次循环，都创建了一个新的函数，然后，把创建的3个函数都添加到一个Array中返回了。</span></div><div class="line">                   arr.push(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                       <span class="keyword">return</span> i * i;</div><div class="line">                   &#125;);</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">return</span> arr;</div><div class="line">          &#125;  </div><div class="line">          <span class="keyword">var</span> results = count();</div><div class="line">          <span class="keyword">var</span> f1 = results[<span class="number">0</span>];</div><div class="line">          <span class="keyword">var</span> f2 = results[<span class="number">1</span>];</div><div class="line">          <span class="keyword">var</span> f3 = results[<span class="number">2</span>];</div><div class="line">          <span class="comment">//原因就在于返回的函数引用了变量i，但它并非立刻执行。等到3个函数都返回时，它们所引用的变量i已经变成了4，因此最终结果为16。</span></div><div class="line">          f1(); <span class="comment">// 16</span></div><div class="line">          f2(); <span class="comment">// 16</span></div><div class="line">          f3(); <span class="comment">// 16</span></div></pre></td></tr></table></figure>
<p>  <b>返回闭包时牢记的一点就是：返回函数不要引用任何循环变量，或者后续会发生变化的变量。</b><br>如果一定要引用循环变量怎么办？方法是再创建一个函数，用该函数的参数绑定循环变量当前的值，无论该循环变量后续如何更改，已绑定到函数参数的值不变：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">count</span>(<span class="params"></span>) </span>&#123;</div><div class="line">               <span class="keyword">var</span> arr = [];</div><div class="line">               <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">1</span>; i&lt;=<span class="number">3</span>; i++) &#123;</div><div class="line">                   arr.push((<span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</div><div class="line">                       <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                           <span class="keyword">return</span> n * n;</div><div class="line">                       &#125;</div><div class="line">                   &#125;)(i));</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">return</span> arr;</div><div class="line">          &#125;</div><div class="line">          <span class="keyword">var</span> results = count();</div><div class="line">          <span class="keyword">var</span> f1 = results[<span class="number">0</span>];</div><div class="line">          <span class="keyword">var</span> f2 = results[<span class="number">1</span>];</div><div class="line">          <span class="keyword">var</span> f3 = results[<span class="number">2</span>];  </div><div class="line">          f1(); <span class="comment">// 1</span></div><div class="line">          f2(); <span class="comment">// 4</span></div><div class="line">          f3(); <span class="comment">// 9</span></div></pre></td></tr></table></figure>
<p>  注意这里用了一个“创建一个匿名函数并立刻执行”的语法：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">          (<span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</div><div class="line">               <span class="keyword">return</span> x * x;</div><div class="line">          &#125;)(<span class="number">3</span>); <span class="comment">// 9</span></div></pre></td></tr></table></figure>
<p>  理论上讲，创建一个匿名函数并立刻执行可以这么写：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x * x &#125; (<span class="number">3</span>);</div></pre></td></tr></table></figure>
<p>  但是由于JavaScript语法解析的问题，会报SyntaxError错误，因此需要用括号把整个函数定义括起来：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">          (<span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> x * x &#125;) (<span class="number">3</span>);</div></pre></td></tr></table></figure>
<p>  闭包的实际运用:<br>  在面向对象的程序设计语言里，比如Java和C++，要在对象内部封装一个私有变量，可以用<code>private</code>修饰一个成员变量。在没有<code>class</code>机制，只有函数的语言里，借助闭包，同样可以封装一个私有变量。我们用JavaScript创建一个计数器：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">          <span class="string">'use strict'</span>;  </div><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">create_counter</span>(<span class="params">initial</span>) </span>&#123;</div><div class="line">               <span class="keyword">var</span> x = initial || <span class="number">0</span>;</div><div class="line">               <span class="keyword">return</span> &#123;</div><div class="line">                   inc: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                       x += <span class="number">1</span>;</div><div class="line">                       <span class="keyword">return</span> x;</div><div class="line">                   &#125;</div><div class="line">               &#125;</div><div class="line">          &#125;</div></pre></td></tr></table></figure>
<p>  它用起来像这样：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> c1 = create_counter();</div><div class="line">          c1.inc(); <span class="comment">// 1</span></div><div class="line">          c1.inc(); <span class="comment">// 2</span></div><div class="line">          c1.inc(); <span class="comment">// 3</span></div><div class="line">          <span class="keyword">var</span> c2 = create_counter(<span class="number">10</span>);</div><div class="line">          c2.inc(); <span class="comment">// 11</span></div><div class="line">          c2.inc(); <span class="comment">// 12</span></div><div class="line">          c2.inc(); <span class="comment">// 13</span></div></pre></td></tr></table></figure>
<p>  在返回的对象中，实现了一个闭包，该闭包携带了局部变量x，并且，从外部代码根本无法访问到变量x。换句话说，闭包就是携带状态的函数，并且它的状态可以完全对外隐藏起来。<br>闭包还可以把多参数的函数变成单参数的函数。例如，要计算xy可以用<code>Math.pow(x, y)</code>函数，不过考虑到经常计算x2或x3，我们可以利用闭包创建新的函数<code>pow2</code>和<code>pow3</code>：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">make_pow</span>(<span class="params">n</span>) </span>&#123;</div><div class="line">               <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</div><div class="line">                   <span class="keyword">return</span> <span class="built_in">Math</span>.pow(x, n);</div><div class="line">               &#125;</div><div class="line">          &#125;</div><div class="line">          <span class="comment">// 创建两个新函数:</span></div><div class="line">          <span class="keyword">var</span> pow2 = make_pow(<span class="number">2</span>);</div><div class="line">          <span class="keyword">var</span> pow3 = make_pow(<span class="number">3</span>);  </div><div class="line">          pow2(<span class="number">5</span>); <span class="comment">// 25</span></div><div class="line">          pow3(<span class="number">7</span>); <span class="comment">// 343</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="箭头函数-ES6新增"><a href="#箭头函数-ES6新增" class="headerlink" title="箭头函数(ES6新增)"></a>箭头函数(ES6新增)</h2><p>ES6标准新增了一种新的函数：Arrow Function（箭头函数）。<br>为什么叫Arrow Function？因为它的定义用的就是一个箭头：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    x =&gt; x * x</div></pre></td></tr></table></figure></p>
<p>上面的箭头函数相当于：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">     <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</div><div class="line">          <span class="keyword">return</span> x * x;</div><div class="line">     &#125;</div></pre></td></tr></table></figure></p>
<p>在继续学习箭头函数之前，请测试你的浏览器是否支持ES6的Arrow Function：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">    <span class="string">'use strict'</span>;</div><div class="line">    <span class="keyword">var</span> fn = x =&gt; x * x;</div><div class="line">    alert(<span class="string">'你的浏览器支持ES6的Arrow Function!'</span>);</div></pre></td></tr></table></figure></p>
<p>箭头函数相当于匿名函数，并且简化了函数定义。箭头函数有两种格式，一种像上面的，只包含一个表达式，连<code>{ ... }</code>和<code>return</code>都省略掉了。还有一种可以包含多条语句，这时候就不能省略<code>{ ... }</code>和<code>return</code>：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">     x =&gt; &#123;</div><div class="line">          <span class="keyword">if</span> (x &gt; <span class="number">0</span>) &#123;</div><div class="line">              <span class="keyword">return</span> x * x;</div><div class="line">          &#125;</div><div class="line">          <span class="keyword">else</span> &#123;</div><div class="line">              <span class="keyword">return</span> - x * x;</div><div class="line">          &#125;</div><div class="line">     &#125;</div></pre></td></tr></table></figure></p>
<p>如果参数不是一个，就需要用括号()括起来：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">     <span class="comment">// 两个参数:</span></div><div class="line">     (x, y) =&gt; x * x + y * y</div><div class="line">    <span class="comment">//上例相当于</span></div><div class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">x,y</span>)</span>&#123;</div><div class="line">         <span class="keyword">return</span> x * x + y * y;</div><div class="line">     &#125;  </div><div class="line">     <span class="comment">// 无参数:</span></div><div class="line">     () =&gt; <span class="number">3.14</span></div><div class="line">    <span class="comment">//上例相当于</span></div><div class="line">    <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</div><div class="line">         <span class="keyword">return</span> <span class="number">3.14</span>;</div><div class="line">     &#125;  </div><div class="line">     <span class="comment">// 可变参数:</span></div><div class="line">     (x, y, ...rest) =&gt; &#123;</div><div class="line">          <span class="keyword">var</span> i, sum = x + y;</div><div class="line">          <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;rest.length; i++) &#123;</div><div class="line">              sum += rest[i];</div><div class="line">          &#125;</div><div class="line">          <span class="keyword">return</span> sum;</div><div class="line">     &#125;</div></pre></td></tr></table></figure></p>
<p>如果要返回一个对象，就要注意，如果是单表达式，这么写的话会报错：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">     <span class="comment">// SyntaxError:</span></div><div class="line">     x =&gt; &#123; foo: x &#125;</div></pre></td></tr></table></figure></p>
<p>因为和函数体的<code>{ ... }</code>有语法冲突，所以要改为：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">     <span class="comment">// ok:</span></div><div class="line">     x =&gt; (&#123; foo: x &#125;)</div></pre></td></tr></table></figure></p>
<ul>
<li><p>this<br>   箭头函数看上去是匿名函数的一种简写，但实际上，箭头函数和匿名函数有个明显的区别：箭头函数内部的this是词法作用域，由上下文确定。 回顾前面的例子，由于JavaScript函数对this绑定的错误处理，下面的例子无法得到预期结果：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> obj = &#123;</div><div class="line">               birth: <span class="number">1990</span>,</div><div class="line">               getAge: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                   <span class="keyword">var</span> b = <span class="keyword">this</span>.birth; <span class="comment">// 1990</span></div><div class="line">                   <span class="keyword">var</span> fn = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                       <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear() - <span class="keyword">this</span>.birth; <span class="comment">// this指向window或undefined</span></div><div class="line">                   &#125;;</div><div class="line">                   <span class="keyword">return</span> fn();</div><div class="line">               &#125;</div><div class="line">          &#125;;</div></pre></td></tr></table></figure>
<p>  现在，箭头函数完全修复了<code>this</code>的指向，<code>this</code>总是指向词法作用域，也就是外层调用者<code>obj</code>：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> obj = &#123;</div><div class="line">               birth: <span class="number">1990</span>,</div><div class="line">               getAge: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                   <span class="keyword">var</span> b = <span class="keyword">this</span>.birth; <span class="comment">// 1990</span></div><div class="line">                   <span class="keyword">var</span> fn = () =&gt; <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear() - <span class="keyword">this</span>.birth; <span class="comment">// this指向obj对象</span></div><div class="line">                   <span class="keyword">return</span> fn();</div><div class="line">               &#125;</div><div class="line">          &#125;;</div><div class="line">          obj.getAge(); <span class="comment">// 25</span></div></pre></td></tr></table></figure>
<p>  如果使用箭头函数，以前的那种hack写法：<code>var that = this;</code> 就不再需要了。<br>  由于this在箭头函数中已经按照词法作用域绑定了，所以，用call()或者apply()调用箭头函数时，无法对this进行绑定，即传入的第一个参数被忽略：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> obj = &#123;</div><div class="line">               birth: <span class="number">1990</span>,</div><div class="line">               getAge: <span class="function"><span class="keyword">function</span> (<span class="params">year</span>) </span>&#123;</div><div class="line">                   <span class="keyword">var</span> b = <span class="keyword">this</span>.birth; <span class="comment">// 1990</span></div><div class="line">                   <span class="keyword">var</span> fn = (y) =&gt; y - <span class="keyword">this</span>.birth; <span class="comment">// this.birth仍是1990</span></div><div class="line">                   <span class="keyword">return</span> fn.call(&#123;birth:<span class="number">2000</span>&#125;, year); <span class="comment">//第一个参数被忽略</span></div><div class="line">               &#125;</div><div class="line">          &#125;;</div><div class="line">          obj.getAge(<span class="number">2015</span>); <span class="comment">// 25</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="标准对象"><a href="#标准对象" class="headerlink" title="标准对象"></a>标准对象</h1><hr>
<p>在JavaScript的世界里，一切都是对象。<br>但是某些对象还是和其他对象不太一样。为了区分对象的类型，我们用typeof操作符获取对象的类型，它总是返回一个字符串：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">typeof</span> <span class="number">123</span>; <span class="comment">// 'number'</span></div><div class="line">     <span class="keyword">typeof</span> <span class="literal">NaN</span>; <span class="comment">// 'number'</span></div><div class="line">     <span class="keyword">typeof</span> <span class="string">'str'</span>; <span class="comment">// 'string'</span></div><div class="line">     <span class="keyword">typeof</span> <span class="literal">true</span>; <span class="comment">// 'boolean'</span></div><div class="line">     <span class="keyword">typeof</span> <span class="literal">undefined</span>; <span class="comment">// 'undefined'</span></div><div class="line">     <span class="keyword">typeof</span> <span class="built_in">Math</span>.abs; <span class="comment">// 'function'</span></div><div class="line">     <span class="keyword">typeof</span> <span class="literal">null</span>; <span class="comment">// 'object'</span></div><div class="line">     <span class="keyword">typeof</span> []; <span class="comment">// 'object'</span></div><div class="line">     <span class="keyword">typeof</span> &#123;&#125;; <span class="comment">// 'object'</span></div></pre></td></tr></table></figure></p>
<p>可见，<code>number</code>、<code>string</code>、<code>boolean</code>、<code>function</code>和<code>undefined</code>有别于其他类型。特别注意<code>null</code>的类型是<code>object</code>，<code>Array</code>的类型也是<code>object</code>，如果我们用<code>typeof</code>将无法区分出<code>null</code>、<code>Array</code>和通常意义上的object——<code>{}</code>。</p>
<h2 id="包装对象"><a href="#包装对象" class="headerlink" title="包装对象"></a>包装对象</h2><p><code>number</code>、<code>boolean</code>和<code>string</code>都有包装对象。没错，在JavaScript中，字符串也区分<code>string</code>类型和它的包装类型。包装对象用<code>new</code>创建：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> n = <span class="keyword">new</span> <span class="built_in">Number</span>(<span class="number">123</span>); <span class="comment">// 123,生成了新的包装类型</span></div><div class="line">          <span class="keyword">var</span> b = <span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">true</span>); <span class="comment">// true,生成了新的包装类型</span></div><div class="line">          <span class="keyword">var</span> s = <span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">'str'</span>); <span class="comment">// 'str',生成了新的包装类型</span></div></pre></td></tr></table></figure></p>
<p>虽然包装对象看上去和原来的值一模一样，显示出来也是一模一样，但他们的类型已经变为object了！所以，包装对象和原始值用===比较会返回false：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">typeof</span> <span class="keyword">new</span> <span class="built_in">Number</span>(<span class="number">123</span>); <span class="comment">// 'object'</span></div><div class="line">          <span class="keyword">new</span> <span class="built_in">Number</span>(<span class="number">123</span>) === <span class="number">123</span>; <span class="comment">// false</span></div><div class="line">          <span class="keyword">typeof</span> <span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">true</span>); <span class="comment">// 'object'</span></div><div class="line">          <span class="keyword">new</span> <span class="built_in">Boolean</span>(<span class="literal">true</span>) === <span class="literal">true</span>; <span class="comment">// false  </span></div><div class="line">          <span class="keyword">typeof</span> <span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">'str'</span>); <span class="comment">// 'object'</span></div><div class="line">          <span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">'str'</span>) === <span class="string">'str'</span>; <span class="comment">// false</span></div></pre></td></tr></table></figure></p>
<p>所以闲的蛋疼也不要使用包装对象！尤其是针对string类型！！！<br>如果没有写<code>new</code>关键字，那么<code>Number()</code>、<code>Boolean()</code>和<code>String()</code>被当做普通函数，把任何类型的数据转换为<code>number</code>、<code>boolean</code>和<code>string</code>类型（注意不是其包装类型）。<br>总结一下，有这么几条规则需要遵守：</p>
<ul>
<li>不要使用<code>new Number()</code>、<code>new Boolean()</code>、<code>new String()</code>创建包装对象；</li>
<li>用<code>parseInt()</code>或<code>parseFloat()</code>来转换任意类型到<code>number</code>；</li>
<li>用<code>String()</code>来转换任意类型到<code>string</code>，或者直接调用某个对象的<code>toString()</code>方法；</li>
<li>通常不必把任意类型转换为<code>boolean</code>再判断，因为可以直接写<code>if (myVar) {...}</code>；</li>
<li><code>typeof</code>操作符可以判断出<code>number</code>、<code>boolean</code>、<code>string</code>、<code>function</code>和<code>undefined</code>；</li>
<li>判断<code>Array</code>要使用<code>Array.isArray(arr)</code>；</li>
<li>判断<code>null</code>请使用<code>myVar === null</code>；</li>
<li>判断某个全局变量是否存在用<code>typeof window.myVar === &#39;undefined&#39;</code>；</li>
<li>函数内部判断某个变量是否存在用<code>typeof myVar === &#39;undefined&#39;</code>。</li>
</ul>
<h2 id="Date对象"><a href="#Date对象" class="headerlink" title="Date对象"></a>Date对象</h2><p>在JavaScript中，Date对象用来表示日期和时间。<br>要获取系统当前时间，用：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">          now; <span class="comment">// Wed Jun 24 2015 19:49:22 GMT+0800 (CST)</span></div><div class="line">          now.getFullYear(); <span class="comment">// 2015, 年份</span></div><div class="line">          now.getMonth(); <span class="comment">// 5, 月份，注意月份范围是0~11，5表示六月</span></div><div class="line">          now.getDate(); <span class="comment">// 24, 表示24号</span></div><div class="line">          now.getDay(); <span class="comment">// 3, 表示星期三</span></div><div class="line">          now.getHours(); <span class="comment">// 19, 24小时制</span></div><div class="line">          now.getMinutes(); <span class="comment">// 49, 分钟</span></div><div class="line">          now.getSeconds(); <span class="comment">// 22, 秒</span></div><div class="line">          now.getMilliseconds(); <span class="comment">// 875, 毫秒数</span></div><div class="line">          now.getTime(); <span class="comment">// 1435146562875, 以number形式表示的时间戳</span></div></pre></td></tr></table></figure></p>
<h2 id="RegExp：正则表达式"><a href="#RegExp：正则表达式" class="headerlink" title="RegExp：正则表达式"></a>RegExp：正则表达式</h2><ul>
<li><p>基本用法</p>
<ul>
<li>在正则表达式中，如果直接给出字符，就是精确匹配。用<code>\d</code>可以匹配一个数字，<code>\w</code>可以匹配一个字母或数字，所以：<code>&#39;00\d&#39;</code>可以匹配<code>&#39;007&#39;</code>，但无法匹配<code>&#39;00A&#39;</code>；<code>&#39;\d\d\d&#39;</code>可以匹配<code>&#39;010&#39;</code></li>
<li><code>.</code>可以匹配任意字符，所以：<code>&#39;js.&#39;</code>可以匹配<code>&#39;jsp&#39;</code>、<code>&#39;jss&#39;</code>、<code>&#39;js!&#39;</code>等等。</li>
<li>要匹配变长的字符，在正则表达式中，用<code>*</code>表示任意个字符（包括0个），用<code>+</code>表示至少一个字符，用<code>?</code>表示0个或1个字符，用<code>{n}</code>表示n个字符，用<code>{n,m}</code>表示n-m个字符：<br> 来看一个复杂的例子：<code>\d{3}\s+\d{3,8}</code>。<br> 1、<code>\d{3}</code>表示匹配3个数字，例如<code>&#39;010&#39;</code>；<br> 2、<code>\s</code>可以匹配一个空格（也包括Tab等空白符），所以<code>\s+</code>表示至少有一个空格，例如匹配<code>&#39; &#39;</code>，<code>&#39;\t\t&#39;</code>等；<br> 3、<code>\d{3,8}</code>表示3-8个数字，例如<code>&#39;1234567&#39;</code>。<br> 综合起来，上面的正则表达式可以匹配以任意个空格隔开的带区号的电话号码。<br> 如果要匹配<code>&#39;010-12345&#39;</code>这样的号码呢？由于<code>&#39;-&#39;</code>是特殊字符，在正则表达式中，要用<code>&#39;\&#39;</code>转义，所以，上面的正则是<code>\d{3}\-\d{3,8}</code>。</li>
<li>要做更精确地匹配，可以用<code>[]</code>表示范围，比如：<br> 1、<code>[0-9a-zA-Z\_]</code>可以匹配一个数字、字母或者下划线；<br> 2、<code>[0-9a-zA-Z\_]+</code>可以匹配至少由一个数字、字母或者下划线组成的字符串，比如<code>&#39;a100&#39;</code>，<code>&#39;0_Z&#39;</code>，<code>&#39;js2015&#39;</code>等等；<br> 3、<code>[a-zA-Z\_\$][0-9a-zA-Z\_\$]*</code>可以匹配由字母或下划线、$开头，后接任意个由一个数字、字母或者下划线、$组成的字符串，也就是JavaScript允许的变量名；<br> 4、<code>[a-zA-Z\_\$][0-9a-zA-Z\_\$]{0, 19}</code>更精确地限制了变量的长度是1-20个字符（前面1个字符+后面最多19个字符）。</li>
<li><code>A|B</code>可以匹配A或B，所以<code>[J|j]ava[S|s]cript</code>可以匹配<code>&#39;JavaScript&#39;</code>、<code>&#39;Javascript&#39;</code>、<code>&#39;javaScript&#39;</code>或者<code>&#39;javascript&#39;</code></li>
<li><code>^</code>表示行的开头，<code>^\d</code>表示必须以数字开头。</li>
<li><code>$</code>表示行的结束，<code>\d$</code>表示必须以数字结束。</li>
</ul>
</li>
<li><p>在JS中使用正则表达式</p>
<ul>
<li><p>定义与使用<br>第一种方式是直接通过<code>/正则表达式/</code>写出来，第二种方式是通过<code>new RegExp(&#39;正则表达式&#39;)</code>创建一个RegExp对象。</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> re1 = <span class="regexp">/ABC\-001/</span>;</div><div class="line">          <span class="keyword">var</span> re2 = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'ABC\\-001'</span>);</div></pre></td></tr></table></figure>
<p>简单使用：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> re = <span class="regexp">/^\d&#123;3&#125;\-\d&#123;3,8&#125;$/</span>;</div><div class="line">          re.test(<span class="string">'010-12345'</span>); <span class="comment">// true</span></div><div class="line">          re.test(<span class="string">'010-1234x'</span>); <span class="comment">// false</span></div><div class="line">          re.test(<span class="string">'010 12345'</span>); <span class="comment">// false</span></div></pre></td></tr></table></figure>
</li>
<li><p>切分字符串</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">          <span class="string">'a b   c'</span>.split(<span class="string">' '</span>); <span class="comment">// ['a', 'b', '', '', 'c']</span></div><div class="line">          <span class="string">'a b   c'</span>.split(<span class="regexp">/\s+/</span>); <span class="comment">// ['a', 'b', 'c']   /\s+/表示一个或多个空格</span></div><div class="line">          <span class="string">'a,b, c  d'</span>.split(<span class="regexp">/[\s\,]+/</span>); <span class="comment">// ['a', 'b', 'c', 'd']  /[\s\,]+/表示一个或多个空格或者逗号</span></div><div class="line">          <span class="string">'a,b;; c  d'</span>.split(<span class="regexp">/[\s\,\;]+/</span>); <span class="comment">// ['a', 'b', 'c', 'd']</span></div></pre></td></tr></table></figure>
</li>
<li><p>分组<br> 除了简单地判断是否匹配之外，正则表达式还有提取子串的强大功能。用<code>()</code>表示的就是要提取的分组（Group）。比如：<br> <code>^(\d{3})-(\d{3,8})$</code>分别定义了两个组，可以直接从匹配的字符串中提取出区号和本地号码：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">            <span class="keyword">var</span> re = <span class="regexp">/^(\d&#123;3&#125;)-(\d&#123;3,8&#125;)$/</span>;</div><div class="line">            re.exec(<span class="string">'010-12345'</span>); <span class="comment">// ['010-12345', '010', '12345']</span></div><div class="line">            re.exec(<span class="string">'010 12345'</span>); <span class="comment">// null</span></div></pre></td></tr></table></figure>
<p> 如果正则表达式中定义了组，就可以在<code>RegExp</code>对象上用<code>exec()</code>方法提取出子串来。<br> <code>exec()</code>方法在匹配成功后，会返回一个<code>Array</code>，第一个元素是正则表达式匹配到的整个字符串，后面的字符串表示匹配成功的子串。<code>exec()</code>方法在匹配失败时返回<code>null</code>。<br> 提取子串非常有用。来看一个更凶残的例子：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">            <span class="keyword">var</span> re = <span class="regexp">/^(0[0-9]|1[0-9]|2[0-3]|[0-9])\:(0[0-9]|1[0-9]|2[0-9]|3[0-9]|4[0-9]|5[0-9]|[0-9])\:(0[0-9]|1[0-9]|2[0-9]|3[0-9]|4[0-9]|5[0-9]|[0-9])$/</span>;</div><div class="line">            re.exec(<span class="string">'19:05:30'</span>); <span class="comment">// ['19:05:30', '19', '05', '30']</span></div></pre></td></tr></table></figure>
</li>
<li><p>贪婪匹配<br>需要特别指出的是，正则匹配默认是贪婪匹配，也就是匹配尽可能多的字符。举例如下，匹配出数字后面的0：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">        <span class="keyword">var</span> re = <span class="regexp">/^(\d+)(0*)$/</span>;</div><div class="line">        re.exec(<span class="string">'102300'</span>); <span class="comment">// ['102300', '102300', '']</span></div></pre></td></tr></table></figure>
<p>由于<code>\d+</code>采用贪婪匹配，直接把后面的<code>0</code>全部匹配了，结果<code>0*</code>只能匹配空字符串了。<br>必须让<code>\d+</code>采用非贪婪匹配（也就是尽可能少匹配），才能把后面的<code>0</code>匹配出来，加个<code>?</code>就可以让<code>\d+</code>采用非贪婪匹配：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">        <span class="keyword">var</span> re = <span class="regexp">/^(\d+?)(0*)$/</span>;</div><div class="line">        re.exec(<span class="string">'102300'</span>); <span class="comment">// ['102300', '1023', '00']</span></div></pre></td></tr></table></figure>
</li>
<li><p>全局搜索<br>JavaScript的正则表达式还有几个特殊的标志，最常用的是<code>g</code>，表示全局匹配<br>全局匹配可以多次执行<code>exec()</code>方法来搜索一个匹配的字符串。当我们指定<code>g</code>标志后，每次运行<code>exec()</code>，正则表达式本身会更新<code>lastIndex</code>属性，表示上次匹配到的最后索引：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">        <span class="keyword">var</span> s = <span class="string">'JavaScript, VBScript, JScript and ECMAScript'</span>;</div><div class="line">        <span class="keyword">var</span> re=<span class="regexp">/[a-zA-Z]+Script/g</span>;</div><div class="line">        <span class="comment">// 使用全局匹配:</span></div><div class="line">        re.exec(s); <span class="comment">// ['JavaScript']</span></div><div class="line">        re.lastIndex; <span class="comment">// 10 </span></div><div class="line">        re.exec(s); <span class="comment">// ['VBScript']</span></div><div class="line">        re.lastIndex; <span class="comment">// 20</span></div><div class="line">        re.exec(s); <span class="comment">// ['JScript']</span></div><div class="line">        re.lastIndex; <span class="comment">// 29 </span></div><div class="line">        re.exec(s); <span class="comment">// ['ECMAScript']</span></div><div class="line">        re.lastIndex; <span class="comment">// 44 </span></div><div class="line">        re.exec(s); <span class="comment">// null，直到结束仍没有匹配到</span></div></pre></td></tr></table></figure>
<p>正则表达式还可以指定i标志，表示忽略大小写，m标志，表示执行多行匹配。</p>
</li>
</ul>
</li>
</ul>
<h2 id="JSON对象"><a href="#JSON对象" class="headerlink" title="JSON对象"></a>JSON对象</h2><ul>
<li><p>序列化</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">            <span class="keyword">var</span> xiaoming = &#123;                name: <span class="string">'小明'</span>,</div><div class="line">               age: <span class="number">14</span>,</div><div class="line">                 gender: <span class="literal">true</span>,</div><div class="line">                 height: <span class="number">1.65</span>,</div><div class="line">                 grade: <span class="literal">null</span>,</div><div class="line">                <span class="string">'middle-school'</span>: <span class="string">'\"W3C\" Middle School'</span>,</div><div class="line">                 skills: [<span class="string">'JavaScript'</span>, <span class="string">'Java'</span>, <span class="string">'Python'</span>, <span class="string">'Lisp'</span>]</div><div class="line">             &#125;; </div><div class="line">            <span class="built_in">JSON</span>.stringify(xiaoming); <span class="comment">// '&#123;"name":"小明","age":14,"gender":true,"height":1.65,"grade":null,"middle-school":"\"W3C\" Middle School","skills":["JavaScript","Java","Python","Lisp"]&#125;'</span></div></pre></td></tr></table></figure>
<p>要输出得好看一些，可以加上参数，按缩进输出：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">            <span class="built_in">JSON</span>.stringify(xiaoming, <span class="literal">null</span>, <span class="string">'  '</span>);</div></pre></td></tr></table></figure>
<p>第二个参数用于控制如何筛选对象的键值，如果我们只想输出指定的属性，可以传入Array：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">            <span class="built_in">JSON</span>.stringify(xiaoming, [<span class="string">'name'</span>, <span class="string">'skills'</span>], <span class="string">'  '</span>);</div></pre></td></tr></table></figure>
<p>还可以传入一个函数，这样对象的每个键值对都会被函数先处理：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">             <span class="function"><span class="keyword">function</span> <span class="title">convert</span>(<span class="params">key, value</span>) </span>&#123;</div><div class="line">                    <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">'string'</span>) &#123;</div><div class="line">                        <span class="keyword">return</span> value.toUpperCase();</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">return</span> value;</div><div class="line">               &#125;</div><div class="line">               <span class="built_in">JSON</span>.stringify(xiaoming, convert, <span class="string">'  '</span>);</div></pre></td></tr></table></figure>
</li>
<li><p>反序列化<br>拿到一个JSON格式的字符串，我们直接用JSON.parse()把它变成一个JavaScript对象：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">               <span class="built_in">JSON</span>.parse(<span class="string">'[1,2,3,true]'</span>); <span class="comment">// [1, 2, 3, true]</span></div><div class="line">               <span class="built_in">JSON</span>.parse(<span class="string">'&#123;"name":"小明","age":14&#125;'</span>); <span class="comment">// Object &#123;name: '小明', age: 14&#125;</span></div><div class="line">               <span class="built_in">JSON</span>.parse(<span class="string">'true'</span>); <span class="comment">// true</span></div><div class="line">               <span class="built_in">JSON</span>.parse(<span class="string">'123.45'</span>); <span class="comment">// 123.45</span></div></pre></td></tr></table></figure>
<p>还可以接收一个函数，用来转换解析出的属性：</p>
   <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">               <span class="built_in">JSON</span>.parse(<span class="string">'&#123;"name":"小明","age":14&#125;'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>) </span>&#123;</div><div class="line">                    <span class="comment">// 把number * 2:</span></div><div class="line">                    <span class="keyword">if</span> (key === <span class="string">'name'</span>) &#123;</div><div class="line">                        <span class="keyword">return</span> value + <span class="string">'同学'</span>;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">return</span> value;</div><div class="line">               &#125;); <span class="comment">// Object &#123;name: '小明同学', age: 14&#125;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="面向对象编程"><a href="#面向对象编程" class="headerlink" title="面向对象编程"></a>面向对象编程</h1><hr>
<p>JavaScript不区分类和实例的概念，而是通过原型（prototype）来实现面向对象编程。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">     <span class="keyword">var</span> Student = &#123;</div><div class="line">          name: <span class="string">'Robot'</span>,</div><div class="line">          height: <span class="number">1.2</span>,</div><div class="line">          run: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">              <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">' is running...'</span>);</div><div class="line">          &#125;</div><div class="line">     &#125;;  </div><div class="line">     <span class="keyword">var</span> xiaoming = &#123;</div><div class="line">          name: <span class="string">'小明'</span></div><div class="line">     &#125;;  </div><div class="line">     xiaoming.__proto__ = Student;</div></pre></td></tr></table></figure></p>
<p>注意最后一行代码把<code>xiaoming</code>的原型指向了对象<code>Student</code>，看上去<code>xiaoming</code>仿佛是从<code>Student</code>继承下来的：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">     xiaoming.name; <span class="comment">// '小明'</span></div><div class="line">     xiaoming.run(); <span class="comment">// 小明 is running...</span></div></pre></td></tr></table></figure></p>
<p><code>xiaoming</code>有自己的<code>name</code>属性，但并没有定义<code>run()</code>方法。不过，由于小明是从<code>Student</code>继承而来，只要<code>Student</code>有<code>run()</code>方法，<code>xiaoming</code>也可以调用：<br><b style="color:red;">请注意</b>，上述代码仅用于演示目的。在编写JavaScript代码时，不要直接用<code>obj.__proto__</code>去改变一个对象的原型，并且，低版本的IE也无法使用<code>__proto__</code>。<code>Object.create()</code>方法可以传入一个原型对象，并创建一个基于该原型的新对象，但是新对象什么属性都没有，因此，我们可以编写一个函数来创建<code>xiaoming</code>：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">     <span class="comment">// 原型对象:</span></div><div class="line">     <span class="keyword">var</span> Student = &#123;</div><div class="line">          name: <span class="string">'Robot'</span>,</div><div class="line">          height: <span class="number">1.2</span>,</div><div class="line">          run: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">              <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">' is running...'</span>);</div><div class="line">          &#125;</div><div class="line">     &#125;;  </div><div class="line">     <span class="function"><span class="keyword">function</span> <span class="title">createStudent</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">          <span class="comment">// 基于Student原型创建一个新对象:</span></div><div class="line">          <span class="keyword">var</span> s = <span class="built_in">Object</span>.create(Student);</div><div class="line">          <span class="comment">// 初始化新对象:</span></div><div class="line">          s.name = name;</div><div class="line">          <span class="keyword">return</span> s;</div><div class="line">     &#125;  </div><div class="line">     <span class="keyword">var</span> xiaoming = createStudent(<span class="string">'小明'</span>);</div><div class="line">     xiaoming.run(); <span class="comment">// 小明 is running...</span></div><div class="line">     xiaoming.__proto__ === Student; <span class="comment">// true</span></div></pre></td></tr></table></figure></p>
<p>这是创建原型继承的一种方法，JavaScript还有其他方法来创建对象，我们在后面会一一讲到。</p>
<h2 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h2><p>JavaScript对每个创建的对象都会设置一个原型，指向它的原型对象。<br>当我们用<code>obj.xxx</code>访问一个对象的属性时，JavaScript引擎先在当前对象上查找该属性，如果没有找到，就到其原型对象上找，如果还没有找到，就一直上溯到<code>Object.prototype</code>对象，最后，如果还没有找到，就只能返回<code>undefined</code>。<br>例如，创建一个Array对象：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    <span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</div></pre></td></tr></table></figure></p>
<p>其原型链是：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    arr ----&gt; <span class="built_in">Array</span>.prototype ----&gt; <span class="built_in">Object</span>.prototype ----&gt; <span class="literal">null</span></div></pre></td></tr></table></figure></p>
<p><code>Array.prototype</code>定义了<code>indexOf()</code>、<code>shift()</code>等方法，因此你可以在所有的<code>Array</code>对象上直接调用这些方法。<br>当我们创建一个函数时：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">     <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">          <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">     &#125;</div></pre></td></tr></table></figure></p>
<p>函数也是一个对象，它的原型链是：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    foo ----&gt; <span class="built_in">Function</span>.prototype ----&gt; <span class="built_in">Object</span>.prototype ----&gt; <span class="literal">null</span></div></pre></td></tr></table></figure></p>
<p>由于<code>Function.prototype</code>定义了<code>apply()</code>等方法，因此，所有函数都可以调用<code>apply()</code>方法。<br>很容易想到，如果原型链很长，那么访问一个对象的属性就会因为花更多的时间查找而变得更慢，因此要注意不要把原型链搞得太长。</p>
<ul>
<li><p>构造函数<br>除了直接用<code>{ ... }</code>创建一个对象外，JavaScript还可以用一种构造函数的方法来创建对象。它的用法是，先定义一个构造函数：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">       <span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">            <span class="keyword">this</span>.name = name;</div><div class="line">            <span class="keyword">this</span>.hello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                alert(<span class="string">'Hello, '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</div><div class="line">            &#125;</div><div class="line">       &#125;</div></pre></td></tr></table></figure>
<p> 在JavaScript中，可以用关键字new来调用这个函数，并返回一个对象：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">          <span class="keyword">var</span> xiaoming = <span class="keyword">new</span> Student(<span class="string">'小明'</span>);</div><div class="line">          xiaoming.name; <span class="comment">// '小明'</span></div><div class="line">          xiaoming.hello(); <span class="comment">// Hello, 小明!</span></div></pre></td></tr></table></figure>
<p><b style="color:red;">注意</b>，如果不写<code>new</code>，这就是一个普通函数，它返回<code>undefined</code>。但是，如果写了<code>new</code>，它就变成了一个构造函数，它绑定的<code>this</code>指向新创建的对象，并默认返回<code>this</code>，也就是说，不需要在最后写<code>return this;</code>。<br>新创建的<code>xiaoming</code>的原型链是：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">          xiaoming ----&gt; Student.prototype ----&gt; <span class="built_in">Object</span>.prototype ----&gt; <span class="literal">null</span></div></pre></td></tr></table></figure>
<p>也就是说，<code>xiaoming</code>的原型指向函数<code>Student</code>的原型。如果你又创建了<code>xiaohong</code>、<code>xiaojun</code>，那么这些对象的原型与<code>xiaoming</code>是一样的。<br>用<code>new Student()</code>创建的对象还从原型上获得了一个<code>constructor</code>属性，它指向函数<code>Student</code>本身。<br><b style="color:red;">总结：</b>函数<code>Student</code>恰好有个属性<code>prototype</code>指向<code>xiaoming</code>、<code>xiaohong</code>的原型对象，而且这个原型对象自己还有个属性<code>constructor</code>，指向<code>Student</code>函数本身。但是<code>xiaoming</code>、<code>xiaohong</code>这些对象可没有<code>prototype</code>这个属性，不过可以用<code>__proto__</code>这个非标准用法来查看。另外，要让创建的对象共享一个<code>hello</code>函数，根据对象的属性查找原则，我们只要把<code>hello</code>函数移动到<code>xiaoming</code>、<code>xiaohong</code>这些对象共同的原型上就可以了，也就是<code>Student.prototype</code>：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">               <span class="keyword">this</span>.name = name;</div><div class="line">           &#125;  </div><div class="line">          Student.prototype.hello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">               alert(<span class="string">'Hello, '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</div><div class="line">          &#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>忘记写<code>new</code>怎么办<br>在strict模式下，<code>this.name = name</code>将报错，因为<code>this</code>绑定为<code>undefined</code>，在非strict模式下，<code>this.name = name</code>不报错，因为<code>this</code>绑定为<code>window</code>，于是无意间创建了全局变量<code>name</code>，并且返回<code>undefined</code>，这个结果更糟糕。 所以，调用构造函数千万不要忘记写<code>new</code>。为了区分普通函数和构造函数，按照约定，构造函数首字母应当大写，而普通函数首字母应当小写，这样，一些语法检查工具如jslint将可以帮你检测到漏写的<code>new</code>。<br>最后，我们还可以编写一个<code>createStudent()</code>函数，在内部封装所有的<code>new</code>操作。一个常用的编程模式像这样：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">props</span>) </span>&#123;</div><div class="line">               <span class="keyword">this</span>.name = props.name || <span class="string">'匿名'</span>; <span class="comment">// 默认值为'匿名'</span></div><div class="line">               <span class="keyword">this</span>.grade = props.grade || <span class="number">1</span>; <span class="comment">// 默认值为1</span></div><div class="line">          &#125;  </div><div class="line">          Student.prototype.hello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">               alert(<span class="string">'Hello, '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</div><div class="line">          &#125;;  </div><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">createStudent</span>(<span class="params">props</span>) </span>&#123;</div><div class="line">               <span class="keyword">return</span> <span class="keyword">new</span> Student(props || &#123;&#125;)</div><div class="line">          &#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="原型继承"><a href="#原型继承" class="headerlink" title="原型继承"></a>原型继承</h2><p>JavaScript的原型继承实现方式就是：</p>
<ul>
<li>定义新的构造函数，并在内部用<code>call()</code>调用希望“继承”的构造函数，并绑定<code>this</code>；</li>
<li>借助中间函数<code>F</code>实现原型链继承，最好通过封装的<code>inherits</code>函数完成；</li>
<li>继续在新的构造函数的原型上定义新方法。<br>示例，创建一个子类<code>PrimaryStudent</code>继承自<code>Student</code>类: <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">props</span>) </span>&#123;</div><div class="line">               <span class="keyword">this</span>.name = props.name || <span class="string">'Unnamed'</span>;</div><div class="line">          &#125;</div><div class="line">          Student.prototype.hello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">               alert(<span class="string">'Hello, '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</div><div class="line">          &#125;  </div><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">PrimaryStudent</span>(<span class="params">props</span>) </span>&#123;</div><div class="line">              <span class="comment">//调用Student类的构造函数,此时Student的this表示当前对象。</span></div><div class="line"></div><div class="line">              Student.call(<span class="keyword">this</span>, props);</div><div class="line">              <span class="keyword">this</span>.grade = props.grade || <span class="number">1</span>;</div><div class="line">          &#125;  </div><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">inherits</span>(<span class="params">Child, Parent</span>) </span>&#123;</div><div class="line">               <span class="keyword">var</span> F = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">               F.prototype = Parent.prototype;</div><div class="line">               Child.prototype = <span class="keyword">new</span> F();</div><div class="line">               Child.prototype.constructor = Child;</div><div class="line">          &#125;</div><div class="line">          <span class="comment">// 实现原型继承链:</span></div><div class="line">          inherits(PrimaryStudent, Student);</div><div class="line">          <span class="comment">// 绑定其他方法到PrimaryStudent原型:</span></div><div class="line">          PrimaryStudent.prototype.getGrade = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">               <span class="keyword">return</span> <span class="keyword">this</span>.grade;</div><div class="line">          &#125;;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="class继承-ES6引入"><a href="#class继承-ES6引入" class="headerlink" title="class继承(ES6引入)"></a>class继承(ES6引入)</h2><p>新的关键字class从ES6开始正式被引入到JavaScript中。class的目的就是让定义类更简单。</p>
<ul>
<li><p>函数定义<br>用函数实现Student的方法：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">          <span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">                <span class="keyword">this</span>.name = name;</div><div class="line">          &#125;</div><div class="line">          Student.prototype.hello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                alert(<span class="string">'Hello, '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</div><div class="line">           &#125;</div></pre></td></tr></table></figure>
<p>如果用新的class关键字来编写<code>Student</code>，可以这样写：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">          <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</div><div class="line">               <span class="keyword">constructor</span>(name) &#123;</div><div class="line">                   <span class="keyword">this</span>.name = name;</div><div class="line">               &#125;</div><div class="line">               hello() &#123;</div><div class="line">                   alert(<span class="string">'Hello, '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</div><div class="line">               &#125;</div><div class="line">          &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>class继承<br>用class定义对象的另一个巨大的好处是继承更方便了。想一想我们从Student派生一个PrimaryStudent需要编写的代码量。现在，原型继承的中间对象，原型对象的构造函数等等都不需要考虑了，直接通过extends来实现：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">          <span class="class"><span class="keyword">class</span> <span class="title">PrimaryStudent</span> <span class="keyword">extends</span> <span class="title">Student</span> </span>&#123;</div><div class="line">               <span class="keyword">constructor</span>(name, grade) &#123;</div><div class="line">                   <span class="keyword">super</span>(name); <span class="comment">// 记得用super调用父类的构造方法!</span></div><div class="line">                   <span class="keyword">this</span>.grade = grade;</div><div class="line">               &#125;</div><div class="line">               myGrade() &#123;</div><div class="line">                   alert(<span class="string">'I am at grade '</span> + <span class="keyword">this</span>.grade);</div><div class="line">               &#125;</div><div class="line">          &#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="浏览器"><a href="#浏览器" class="headerlink" title="浏览器"></a>浏览器</h1><hr>
<p>目前主流的浏览器分这么几种：</p>
<ul>
<li>IE 6~11：国内用得最多的IE浏览器，历来对W3C标准支持差。从IE10开始支持ES6标准；</li>
<li>Chrome：Google出品的基于Webkit内核浏览器，内置了非常强悍的JavaScript引擎——V8。由于Chrome一经安装就时刻保持自升级，所以不用管它的版本，最新版早就支持ES6了；</li>
<li>Safari：Apple的Mac系统自带的基于Webkit内核的浏览器，从OS X 10.7 Lion自带的6.1版本开始支持ES6，目前最新的OS X 10.11 El Caption自带的Safari版本是9.x，早已支持ES6；</li>
<li>Firefox：Mozilla自己研制的Gecko内核和JavaScript引擎OdinMonkey。早期的Firefox按版本发布，后来终于聪明地学习Chrome的做法进行自升级，时刻保持最新；</li>
<li>移动设备上目前iOS和Android两大阵营分别主要使用Apple的Safari和Google的Chrome，由于两者都是Webkit核心，结果HTML5首先在手机上全面普及（桌面绝对是Microsoft拖了后腿），对JavaScript的标准支持也很好，最新版本均支持ES6。</li>
</ul>
<h2 id="浏览器对象"><a href="#浏览器对象" class="headerlink" title="浏览器对象"></a>浏览器对象</h2><p>JavaScript可以获取浏览器提供的很多对象，并进行操作。</p>
<ul>
<li>window<br><code>window</code>对象不但充当全局作用域，而且表示浏览器窗口。<br><code>window</code>对象有<code>innerWidth</code>和<code>innerHeight</code>属性，可以获取浏览器窗口的内部宽度和高度。内部宽高是指除去菜单栏、工具栏、边框等占位元素后，用于显示网页的净宽高。对应的，还有一个<code>outerWidth</code>和<code>outerHeight</code>属性，可以获取浏览器窗口的整个宽高。</li>
<li>navigator<br>navigator对象表示浏览器的信息，最常用的属性包括：<ul>
<li>navigator.appName：浏览器名称；</li>
<li>navigator.appVersion：浏览器版本；</li>
<li>navigator.language：浏览器设置的语言；</li>
<li>navigator.platform：操作系统类型；</li>
<li>navigator.userAgent：浏览器设定的User-Agent字符串。</li>
</ul>
</li>
<li>screen<br>   <code>screen</code>对象表示屏幕的信息，常用的属性有：<ul>
<li>screen.width：屏幕宽度，以像素为单位；</li>
<li>screen.height：屏幕高度，以像素为单位；</li>
<li>screen.colorDepth：返回颜色位数，如8、16、24。</li>
</ul>
</li>
<li><p>location<br>  <code>location</code>对象表示当前页面的URL信息。<br>  可以用<code>location.href</code>获取完整URL。要获得URL各个部分的值，可以这么写：</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">          location.protocol; <span class="comment">// 'http'</span></div><div class="line">          location.host; <span class="comment">// 'www.example.com'</span></div><div class="line">          location.port; <span class="comment">// '8080'</span></div><div class="line">          location.pathname; <span class="comment">// '/path/index.html'</span></div><div class="line">          location.search; <span class="comment">// '?a=1&amp;b=2'</span></div><div class="line">          location.hash; <span class="comment">// 'TOP'</span></div></pre></td></tr></table></figure>
<p> 要加载一个新页面，可以调用<code>location.assign()</code>。如果要重新加载当前页面，调用location.reload()方法非常方便。</p>
</li>
<li><p>document<br>  <code>document</code>对象表示当前页面。由于HTML在浏览器中以DOM形式表示为树形结构，<code>document</code>对象就是整个DOM树的根节点。<br>  document的title属性是从HTML文档中的<title>xxx</title>读取的，但是可以动态改变<br>  要查找DOM树的某个节点，需要从document对象开始查找。最常用的查找是根据ID和Tag Name。<br>  <code>document</code>对象还有一个<code>cookie</code>属性，可以获取当前页面的Cookie。<br>  Cookie是由服务器发送的key-value标示符。因为HTTP协议是无状态的，但是服务器要区分到底是哪个用户发过来的请求，就可以用Cookie来区分。当一个用户成功登录后，服务器发送一个Cookie给浏览器，例如<code>user=ABC123XYZ(加密的字符串)</code>…，此后，浏览器访问该网站时，会在请求头附上这个Cookie，服务器根据Cookie即可区分出用户。<br>  JavaScript可以通过<code>document.cookie</code>读取到当前页面的Cookie：</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">          <span class="built_in">document</span>.cookie; <span class="comment">// 'v=123; remember=true; prefer=zh'</span></div></pre></td></tr></table></figure>
<p>  由于JavaScript能读取到页面的Cookie，而用户的登录信息通常也存在Cookie中，这就造成了巨大的安全隐患，这是因为在HTML页面中引入第三方的JavaScript代码是允许的：</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">          <span class="comment">&lt;!-- 当前页面在wwwexample.com --&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">               <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">                   <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://www.foo.com/jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">               <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">              ...</div><div class="line">          <span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>  如果引入的第三方的JavaScript中存在恶意代码，则<code>www.foo.com</code>网站将直接获取到<code>www.example.com</code>网站的用户登录信息。<br>  为了解决这个问题，服务器在设置Cookie时可以使用httpOnly，设定了httpOnly的Cookie将不能被JavaScript读取。这个行为由浏览器实现，主流浏览器均支持httpOnly选项，IE从IE6 SP1开始支持。</p>
</li>
<li>history<br>  <code>history</code>对象保存了浏览器的历史记录，JavaScript可以调用<code>history</code>对象的<code>back()</code>或<code>forward ()</code>，相当于用户点击了浏览器的“后退”或“前进”按钮。但，任何情况，你都不应该使用history这个对象了。</li>
</ul>
<h2 id="操作DOM"><a href="#操作DOM" class="headerlink" title="操作DOM"></a>操作DOM</h2><p>DOM是一个树形结构。操作一个DOM节点实际上就是这么几个操作：</p>
<ul>
<li>更新：更新该DOM节点的内容，相当于更新了该DOM节点表示的HTML的内容；</li>
<li>遍历：遍历该DOM节点下的子节点，以便进行进一步操作；</li>
<li>添加：在该DOM节点下新增一个子节点，相当于动态增加了一个HTML节点；</li>
<li>删除：将该节点从HTML中删除，相当于删掉了该DOM节点的内容以及它包含的所有子节点。</li>
</ul>
<p>由于ID在HTML文档中是唯一的，所以<code>document.getElementById()</code>可以直接定位唯一的一个DOM节点。<code>document.getElementsByTagName()</code>和<code>document.getElementsByClassName()</code>总是返回一组DOM节点。要精确地选择DOM，可以先定位父节点，再从父节点开始选择，以缩小范围。<br>例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">// 返回ID为&apos;test&apos;的节点：</div><div class="line">var test = document.getElementById(&apos;test&apos;);</div><div class="line"></div><div class="line">// 先定位ID为&apos;test-table&apos;的节点，再返回其内部所有tr节点：</div><div class="line">var trs = document.getElementById(&apos;test-table&apos;).getElementsByTagName(&apos;tr&apos;);</div><div class="line"></div><div class="line">// 先定位ID为&apos;test-div&apos;的节点，再返回其内部所有class包含red的节点：</div><div class="line">var reds = document.getElementById(&apos;test-div&apos;).getElementsByClassName(&apos;red&apos;);</div><div class="line"></div><div class="line">// 获取节点test下的所有直属子节点:</div><div class="line">var cs = test.children;</div><div class="line"></div><div class="line">// 获取节点test下第一个、最后一个子节点：</div><div class="line">var first = test.firstElementChild;</div><div class="line">var last = test.lastElementChild;</div></pre></td></tr></table></figure></p>
<p>第二种方法是使用<code>querySelector()</code>和<code>querySelectorAll()</code>，需要了解selector语法，然后使用条件来获取节点，更加方便：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 通过querySelector获取ID为q1的节点：</div><div class="line">var q1 = document.querySelector(&apos;#q1&apos;);</div><div class="line"></div><div class="line">// 通过querySelectorAll获取q1节点内的符合条件的所有节点：</div><div class="line">var ps = q1.querySelectorAll(&apos;div.highlighted &gt; p&apos;);</div></pre></td></tr></table></figure></p>
<p>注意：低版本的IE&lt;8不支持<code>querySelector</code>和<code>querySelectorAll</code>。IE8仅有限支持。</p>
<h3 id="创建元素"><a href="#创建元素" class="headerlink" title="创建元素"></a>创建元素</h3><ul>
<li><p>创建元素：<code>document.createElement()</code><br>  使用<code>document.createElement()</code>可以创建新元素。这个方法只接受一个参数，即要创建元素的标签名。这个标签名在<code>HTML</code>文档中不区分大小写，在<code>XHTML</code>中区分大小写。<br>  此时，新元素尚未被添加到文档树中，因此设置各种特性均不会影响浏览器的显示。要添加到文档树，可用<code>appendChild()、insertBefore()、replaceChild()</code>。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var div = document.createElement(&quot;div&quot;);</div><div class="line">div.id = &quot;myDiv&quot;;</div><div class="line">div.className = &quot;div1&quot;;</div><div class="line">document.body.appendChild(div);</div></pre></td></tr></table></figure>
<p>  在<code>IE</code>中可以为<code>createElement()</code>方法传入完整的元素标签和属性。(只在<code>IE</code>中兼容)</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var div = document.createElement(&quot;&lt;div id=\&quot;mydiv\&quot; class=\&quot;div1\&quot;&gt;&lt;/div&gt;&quot;);</div><div class="line">不能再标签里加其他元素节点或者文本节点，如下的方式和上面的得出的节点一样</div><div class="line">var div = document.createElement(&quot;&lt;div id=\&quot;mydiv\&quot; class=\&quot;div1\&quot;&gt;12212&lt;/div&gt;&quot;);</div></pre></td></tr></table></figure>
</li>
<li><p>创建文本节点 ：<code>document.createTextNode</code><br>使用<code>document.createTextNode()</code>来创建文本节点，这个方法接受一个参数：要插入节点的文本。与设置已有文本节点的值一样，作为参数的文本将按照<code>HTML</code>或<code>XML</code>的格式进行编码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">document.createTextNode(&quot;121212&quot;);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="节点关系"><a href="#节点关系" class="headerlink" title="节点关系"></a>节点关系</h3><p>（<code>IE9</code>以前不将换行和空格看做文本节点，其他浏览器会）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;div id=&quot;div1&quot;&gt;</div><div class="line">    &lt;div id=&quot;div2&quot;&gt;2&lt;/div&gt;</div><div class="line">    &lt;div id=&quot;div3&quot;&gt;3&lt;/div&gt;</div><div class="line">    &lt;div id=&quot;div4&quot;&gt;4&lt;/div&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure></p>
<ul>
<li><code>parentNode</code>是指定节点的父节点.</li>
<li><p><code>childNodes</code> 返回包含指定节点的子节点的集合，该集合为即时更新的集合（<code>live collection</code>）。<br>即时更新就是对节点元素的任意修改都会立即反映到结果里。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">    var child2 = document.getElementById(&quot;div2&quot;);</div><div class="line">    var parent = child2.parentNode;</div><div class="line">    var allChilds = parent.childNodes;</div><div class="line">    console.log(allChilds.length) // IE下是3，其他浏览器是7</div><div class="line"></div><div class="line">    var nodeAdd = document.createElement(&quot;div&quot;);</div><div class="line">    var textAdd = document.createTextNode(&quot;这是添加的文本节点&quot;);</div><div class="line">    nodeAdd.appendChild(textAdd);</div><div class="line">    parent.appendChild(nodeAdd);</div><div class="line">    console.log(allChilds.length);// IE下是4，其他浏览器是8</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
</li>
<li><p><code>nextSibling</code>返回某节点的下一个兄弟节点，<code>previousSibling</code>返回某节点的上一个兄弟节点，没有的话返回<code>null</code>。<br><strong>注意：</strong>可能因为元素换行的原因返回的是<code>text</code>节点。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">    var child3 = document.getElementById(&quot;div3&quot;);</div><div class="line">    var next = child3.nextSibling;</div><div class="line">    var previous = child3.previousSibling;</div><div class="line">    console.log(next); // IE下返回div4，其他返回text</div><div class="line">    console.log(previous)  // IE下返回div2，其他返回text</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
</li>
<li><p><code>firstChild</code>返回<code>node</code>的子节点中的第一个节点的引用，没有返回<code>null</code></p>
</li>
<li><p><code>lastChild</code>返回<code>node</code>的子节点中的最后一个节点的引用，没有返回<code>null</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">    	var child3 = document.getElementById(&quot;div3&quot;);</div><div class="line">    	var parent = child3.parentNode;</div><div class="line">    	var first = parent.firstChild; // IE是div2，其他是text</div><div class="line">    	var last = parent.lastChild; // IE是div4，其他是text</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure>
<p>  <strong>注意：</strong>childNodes返回指定元素的子元素集合，包括HTML节点，所有属性，文本节点。可以通过nodeType来判断是哪种类型的节点，只有当nodeType==1时才是元素节点，2是属性节点，3是文本节点。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//获取第一个子元素</div><div class="line">function getFirst(elem)&#123;</div><div class="line">   		for(var i=0,e;e=elem.childNodes[i++];)&#123;</div><div class="line">        	if(e.nodeType==1)</div><div class="line">            	return e;</div><div class="line">    	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="节点元素关系"><a href="#节点元素关系" class="headerlink" title="节点元素关系"></a>节点元素关系</h3><p>以下方法只算元素，不算文本节点。<br>以下三个方法用法和节点关系完全一样，只是这三个方法只看元素节点，不管因为空格、换行造成的文本节点或者手动加上去的文本节点。</p>
<ul>
<li><code>children</code>： 返回所有元素子节点（<code>IE5+、ff3.5、opera3、chrome</code>，但在<code>IE8</code>及以下会将注释节点看成一个元素节点）<br>以下两个<code>IE9+</code>才支持</li>
<li><code>nextElementSibling</code>：返回元素的下一个兄弟元素节点</li>
<li><code>previousElementSibling</code>: 返回元素的上一个兄弟元素节点</li>
</ul>
<h3 id="节点操作"><a href="#节点操作" class="headerlink" title="节点操作"></a>节点操作</h3><ul>
<li><p><code>appendChild()</code>用于向<code>childNodes</code>列表的末尾添加一个节点，并且返回这个新增的节点。<br>如果传入到<code>appendChild()</code>里的节点已经是文档的一部分了，那结果就是将节点从原来的位置转移到新位置，任何一个节点不能同时出现在文档中的多个位置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var returnNode = someNode.appendChild(someNode.firstChild); // 返回第一个节点</div><div class="line">    console.log(returnNode === someNode.firstChild); // false</div><div class="line">    console.log(returnNode === someNode.lastChild); // true</div></pre></td></tr></table></figure>
</li>
<li><p><code>insetBefore()</code>可以将节点插入到某个特定的位置。这个方法接受两个参数：要插入的节点和作为参照的节点。<br>插入节点后，被插入的节点变成参照节点的前一个同胞节点，同时被方法返回。 如果参照节点是<code>null</code>，则与</p>
</li>
<li><p><code>appendChild()</code>执行相同的操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"> // 插入后成为最后一个子节点</div><div class="line">    var returnNode = someNode.insetBefore(newNode, null);</div><div class="line">    console.log(returnNode === someNode.lastChild); // true</div><div class="line"></div><div class="line">    // 插入后成为第一个子节点</div><div class="line">    var returnNode = someNode.insetBefore(newNode, someNode.firstChild);</div><div class="line">    console.log(returnNode === newNode); // true</div><div class="line">    console.log(returnNode === someNode.firstChild); // true</div><div class="line"></div><div class="line">    // 插入到最后一个子节点的前面</div><div class="line">    var returnNode = someNode.insetBefore(newNode, someNode.lastChild);</div><div class="line">    console.log(returnNode === someNode.childNodes[someNode.childnodes.length - 2]) // true</div></pre></td></tr></table></figure>
</li>
<li><p><code>replaceChild()</code>接受两个参数：要插入的节点和要被替换的节点。被替换的节点将由这个方法返回并从文档中被移除，同时由要插入的节点占据其位置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 替换第一个子节点</div><div class="line">    var returnNode = someNode.replaceChild(newNode, someNode.firstChild);</div></pre></td></tr></table></figure>
</li>
<li><p><code>removeChild()</code>该方法移除节点，接受一个参数，即要移除的节点，同时该方法返回被移除的节点。只能是一个节点，不能是一组节点。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"> // 移除第一个子节点</div><div class="line">    var returnNode = someNode.removeChild(someNode.firstChild);</div></pre></td></tr></table></figure>
</li>
<li><p><code>cloneNode(deep)</code>返回调用该方法的节点的一个副本。参数表示是否采用深度克隆,如果为<code>true</code>,则该节点的所有后代节点也都会被克隆,如果为<code>false</code>,则只克隆该节点本身，文本或者换行、空格这些不会复制，因为他们都是一个<code>textNode</code>。<br><code>deep</code>是一个可选参数. 如果省略的话, <code>deep</code>参数的默认值为<code>true</code>,也就是说,深度克隆是默认的.如果想使用浅克隆, 你需要将该参数指定为<code>false</code>。<br>克隆一个元素节点会拷贝它所有的属性以及属性值,当然也就包括了属性上绑定的事件(比如<code>onclick=&quot;alert(1)&quot;</code>),但不会拷贝那些使用<code>addEventListener()</code>方法或者<code>node.onclick = fn</code>这种用<code>JavaScript</code>动态绑定的事件。</p>
</li>
</ul>
<h3 id="元素选择"><a href="#元素选择" class="headerlink" title="元素选择"></a>元素选择</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;div id=&quot;div1&quot;&gt;</div><div class="line">        &lt;p id=&quot;div2&quot; class=&quot;one&quot; name=&quot;nameone&quot;&gt;2&lt;/p&gt;</div><div class="line">        &lt;div id=&quot;div3&quot;&gt;3&lt;/div&gt;</div><div class="line">        &lt;div id=&quot;div4&quot; name=&quot;div2&quot;&gt;4&lt;/div&gt;</div><div class="line">    &lt;/div&gt;</div></pre></td></tr></table></figure>
<ul>
<li><code>DOMObject.querySelector</code>返回节点子树内与之相匹配的第一个<code>Element</code>节点。如果没有匹配的节点，则返回<code>null</code>。</li>
<li><p><code>DOMObject.querySelectorAll</code>返回一个包含节点子树内所有与之相匹配的<code>Element</code>节点列表，如果没有相匹配的，则返回一个空节点列表<br>  <strong>注意：</strong>由 <code>querySelector()</code>、<code>querySelectorAll()</code>返回的节点列表不是动态实时的（非<code>live Collection</code>）。这和其他<code>DOM</code>查询方法返回动态实时节点列表不一样。<br>  选择器方法接受一个或多个用逗号分隔的选择器来确定需要被返回的元素。例如，要选择文档中所有<code>CSS</code>的类(<code>class</code>)是<code>warning</code>或者<code>note</code>的段落(<code>p</code>)元素,可以这样写：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var special = document.querySelectorAll( &quot;p.warning, p.note&quot; );</div></pre></td></tr></table></figure>
<p>  也可以通过ID来查询，例如：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var el = document.querySelector( &quot;#main, #basic, #exclamation&quot; );</div></pre></td></tr></table></figure>
<p>  执行上面的代码后，<code>el</code>就包含了文档中元素的<code>ID</code>是<code>main</code>，<code>basic</code>或<code>exclamation</code>的所有元素中的第一个元素。</p>
</li>
<li><code>document.getElementById()</code>也是<strong>非</strong>live collection<br><strong>注意：</strong>getElementById方法只有document对象才有</li>
<li><p><code>DOMObject.getElementsByTagName()</code> 方法返回一个实时的包含具有给出标签名的元素们的<code>HTMLCollection</code>。指定的元素的子树会被搜索，包括元素自己。返回的 <code>list</code> 是实时的（<code>live collection</code>），意味着它会随着<code>DOM</code>树的变化自动更新。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var live = document.getElementsByTagName(&quot;p&quot;);</div><div class="line">    console.log(live[0].innerHTML);</div><div class="line">    document.getElementById(&quot;div1&quot;).removeChild(document.getElementById(&quot;div2&quot;));</div><div class="line">    console.log(live[0].innerHTML);</div><div class="line">    // 第一个输出2，第二个报错，因为无法引用到p标签</div></pre></td></tr></table></figure>
</li>
<li><p><code>document.getElementsByName()</code>该方法返回一个实时的<code>nodelist collection</code>，包含文档中所有<code>name</code>属性匹配的标签。这是一个<strong>live collection</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">    var live = document.getElementsByName(&quot;div2&quot;);</div><div class="line">    console.log(live[0].innerHTML);</div><div class="line">    document.getElementById(&quot;div1&quot;).removeChild(document.getElementById(&quot;div2&quot;));</div><div class="line">    console.log(live[0].innerHTML);</div><div class="line">    // chrome下：全部输出4</div><div class="line">    // IE下： 第一个输出2，第二个报错。</div></pre></td></tr></table></figure>
</li>
<li><p><code>DOMObject.getElementsByClassName()</code>该方法返回一个即时更新的（<code>live</code>） <code>HTMLCollection</code>，包含了所有拥有指定 <code>class</code> 的子元素。当在 <code>document</code> 对象上调用此方法时，会检索整个文档，包括根元素。(<code>IE9</code>以下不支持)<br>要匹配多个<code>class</code>，则<code>className</code>用空格分开。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">getElementsByClassName(&quot;class1 class2&quot;);</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="属性操作"><a href="#属性操作" class="headerlink" title="属性操作"></a>属性操作</h3><ul>
<li><p><code>DOMObject.setAttribute()</code>添加一个新属性（<code>attribute</code>）到元素上，或改变元素上已经存在的属性的值。<br>如果指定的属性已经存在，则其值变为传递的值。如果不存在，则创建指定的属性。也可指定为<code>null</code>。如果设置为<code>null</code>，最好使用<code>removeAttribute()</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var div2 = document.getElementById(&quot;div2&quot;);</div><div class="line">    div2.setAttribute(&quot;class&quot;, &quot;new_class&quot;);</div><div class="line">    div2.setAttribute(&quot;id&quot;, &quot;new_id&quot;);</div></pre></td></tr></table></figure>
</li>
<li><p><code>DOMObject.removeAttribute()</code>该方法用于移除元素的属性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"> var div2 = document.getElementById(&quot;div2&quot;);</div><div class="line">    div2.removeAttribute(&quot;class&quot;);</div></pre></td></tr></table></figure>
</li>
<li><p><code>DOMObject.getAttribute()</code>该方法返回元素上指定属性（<code>attribute</code>）的值。如果指定的属性不存在，则返回 <code>null</code> 或 <code>&quot;&quot;</code> （空字符串）（<code>IE5+</code>都返回<code>null</code>）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var div2 = document.getElementById(&quot;div2&quot;);</div><div class="line">    var attr = div2.getAttribute(&quot;class&quot;);</div><div class="line">    console.log(attr);</div></pre></td></tr></table></figure>
</li>
<li><p><code>DOMObject.hasAttribute()</code>返回一个布尔值，指示该元素是否包含有指定的属性（<code>attribute</code>）。</p>
</li>
<li><p>自定义属性<code>data-*</code><br>  <code>html5</code>里有一个<code>data-*</code>去设置获取元素的自定义属性值。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;div id=&quot;div1&quot; data-aa=&quot;11&quot;&gt;</div></pre></td></tr></table></figure>
<p>  利用<code>div1.dataset</code>可以获得一个<code>DOMStringMap</code>，包含了元素的所有<code>data-*</code>。使用<code>div1.dataset.aa</code>就可以获取<code>11</code>的值。同样，通过设置<code>div1.dataset.bb = &quot;22&quot;</code>就可以设置一个自定义属性值。在不兼容的浏览器里，就使用<code>getAttribute</code>和<code>setAttribute</code></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">	  var div1 = document.getElementById(&quot;div1&quot;);</div><div class="line">	    var a = null;</div><div class="line">	    if (div1.dataset) &#123;</div><div class="line">	        a = div1.dataset.aa;</div><div class="line">	        div1.dataset.bb = &quot;222&quot;;</div><div class="line">	    &#125; else &#123;</div><div class="line">	        a = div1.getAttribute(&quot;data-aa&quot;);</div><div class="line">	        div1.setAttribute(&quot;data-bb&quot;, &quot;2222&quot;);</div><div class="line">	    &#125;</div><div class="line">	    console.log(a);</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="操作文件"><a href="#操作文件" class="headerlink" title="操作文件"></a>操作文件</h2><p>在HTML表单中，可以上传文件的唯一控件就是<code>&lt;input type=&quot;file&quot;&gt;</code>。<br><em>注意</em>：当一个表单包含<code>&lt;input type=&quot;file&quot;&gt;</code>时，表单的<code>enctype</code>必须指定为<code>multipart/form-data</code>，<code>method</code>必须指定为<code>post</code>，浏览器才能正确编码并以<code>multipart/form-data</code>格式发送表单的数据。<br>通常，上传的文件都由后台服务器处理，JavaScript可以在提交表单时对文件扩展名做检查，以便防止用户上传无效格式的文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">var f = document.getElementById(&apos;test-file-upload&apos;);</div><div class="line">var filename = f.value; // &apos;C:\fakepath\test.png&apos;</div><div class="line">if (!filename || !(filename.endsWith(&apos;.jpg&apos;) || filename.endsWith(&apos;.png&apos;) || filename.endsWith(&apos;.gif&apos;))) &#123;</div><div class="line">    alert(&apos;Can only upload image file.&apos;);</div><div class="line">    return false;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li><p>FileAPI<br>  HTML5的File API提供了<code>File</code>和<code>FileReader</code>两个主要对象，可以获得文件信息并读取文件。<br>  下面的例子演示了如何读取用户选取的图片文件，并在一个<code>&lt;div&gt;</code>中预览图像：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">var</div><div class="line">    fileInput = document.getElementById(&apos;test-image-file&apos;),</div><div class="line">    info = document.getElementById(&apos;test-file-info&apos;),</div><div class="line">    preview = document.getElementById(&apos;test-image-preview&apos;);</div><div class="line">// 监听change事件:</div><div class="line">fileInput.addEventListener(&apos;change&apos;, function () &#123;</div><div class="line">    // 清除背景图片:</div><div class="line">    preview.style.backgroundImage = &apos;&apos;;</div><div class="line">    // 检查文件是否选择:</div><div class="line">    if (!fileInput.value) &#123;</div><div class="line">        info.innerHTML = &apos;没有选择文件&apos;;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    // 获取File引用:</div><div class="line">    var file = fileInput.files[0];</div><div class="line">    // 获取File信息:</div><div class="line">    info.innerHTML = &apos;文件: &apos; + file.name + &apos;&lt;br&gt;&apos; +</div><div class="line">                     &apos;大小: &apos; + file.size + &apos;&lt;br&gt;&apos; +</div><div class="line">                     &apos;修改: &apos; + file.lastModifiedDate;</div><div class="line">    if (file.type !== &apos;image/jpeg&apos; &amp;&amp; file.type !== &apos;image/png&apos; &amp;&amp; file.type !== &apos;image/gif&apos;) &#123;</div><div class="line">        alert(&apos;不是有效的图片文件!&apos;);</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    // 读取文件:</div><div class="line">    var reader = new FileReader();</div><div class="line">    reader.onload = function(e) &#123;</div><div class="line">        var</div><div class="line">            data = e.target.result; // &apos;data:image/jpeg;base64,/9j/4AAQSk...(base64编码)...&apos;            </div><div class="line">        preview.style.backgroundImage = &apos;url(&apos; + data + &apos;)&apos;;</div><div class="line">    &#125;;</div><div class="line">    // 以DataURL的形式读取文件:</div><div class="line">    reader.readAsDataURL(file);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>  上面的代码演示了如何通过HTML5的File API读取文件内容。以DataURL的形式读取到的文件是一个字符串，类似于<code>data:image/jpeg;base64,/9j/4AAQSk...(base64编码)...</code>，常用于设置图像。如果需要服务器端处理，把字符串<code>base64,</code>后面的字符发送给服务器并用Base64解码就可以得到原始文件的二进制内容。</p>
</li>
</ul>
<h2 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h2><p>在现代浏览器上写AJAX主要依靠<code>XMLHttpRequest</code>对象，对于低版本的IE，需要换一个<code>ActiveXObject</code>对象，下面的写法能兼容主流浏览器：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">function success(text) &#123;</div><div class="line">    var textarea = document.getElementById(&apos;test-ie-response-text&apos;);</div><div class="line">    textarea.value = text;</div><div class="line">&#125;</div><div class="line"></div><div class="line">function fail(code) &#123;</div><div class="line">    var textarea = document.getElementById(&apos;test-ie-response-text&apos;);</div><div class="line">    textarea.value = &apos;Error code: &apos; + code;</div><div class="line">&#125;</div><div class="line"></div><div class="line">var request;</div><div class="line">if (window.XMLHttpRequest) &#123;</div><div class="line">    request = new XMLHttpRequest();</div><div class="line">&#125; else &#123;</div><div class="line">    request = new ActiveXObject(&apos;Microsoft.XMLHTTP&apos;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">request.onreadystatechange = function () &#123; // 状态发生变化时，函数被回调</div><div class="line">    if (request.readyState === 4) &#123; // 成功完成</div><div class="line">        // 判断响应结果:</div><div class="line">        if (request.status === 200) &#123;</div><div class="line">            // 成功，通过responseText拿到响应的文本:</div><div class="line">            return success(request.responseText);</div><div class="line">        &#125; else &#123;</div><div class="line">            // 失败，根据响应码判断失败原因:</div><div class="line">            return fail(request.status);</div><div class="line">        &#125;</div><div class="line">    &#125; else &#123;</div><div class="line">        // HTTP请求还在继续...</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 发送请求:</div><div class="line">request.open(&apos;GET&apos;, &apos;/api/categories&apos;);</div><div class="line">request.send();</div><div class="line"></div><div class="line">alert(&apos;请求已发送，请等待响应...&apos;);</div></pre></td></tr></table></figure></p>
<p><code>XMLHttpRequest</code>对象的<code>open()</code>方法有3个参数，第一个参数指定是<code>GET</code>还是<code>POST</code>，第二个参数指定URL地址，第三个参数指定是否使用异步，默认是<code>true</code>，所以不用写。<br><em>注意</em>，千万不要把第三个参数指定为<code>false</code>，否则浏览器将停止响应，直到AJAX请求完成。如果这个请求耗时10秒，那么10秒内你会发现浏览器处于“假死”状态。<br>最后调用<code>send()</code>方法才真正发送请求。<code>GET</code>请求不需要参数，<code>POST</code>请求需要把body部分以字符串或者<code>FormData</code>对象传进去。</p>
<ul>
<li><p>安全限制(JSONP)<br>  上面代码的URL使用的是相对路径。如果你把它改为<code>&#39;http://www.sina.com.cn/&#39;</code>，再运行，肯定报错。在Chrome的控制台里，还可以看到错误信息。<br>  这是因为浏览器的同源策略导致的。默认情况下，JavaScript在发送AJAX请求时，URL的域名必须和当前页面完全一致。<br>  JS 解决跨域问题的方法–JSONP：<br>  实现原理：凡是拥有”src”这个属性的标签都拥有跨域的能力，比如<code>&lt;script&gt;</code>、<code>&lt;img&gt;</code>、<code>&lt;iframe&gt;</code>，可以在script标签内请求服务器，服务器返回函数调用的字符串（数据作为函数的参数），客户端就会把这段字符串作为JS代码执行，由此客户端就能获取服务器端的数据。<br>  示例代码：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">    // 得到航班信息查询结果后的回调函数</div><div class="line">    var flightHandler = function(data)&#123;</div><div class="line">        alert(&apos;你查询的航班结果是：票价 &apos; + data.price + &apos; 元，&apos; + &apos;余票 &apos; + data.tickets + &apos; 张。&apos;);</div><div class="line">    &#125;; // 提供jsonp服务的url地址（不管是什么类型的地址，最终生成的返回值都是一段javascript代码）</div><div class="line">    var url = &quot;http://flightQuery.com/jsonp/flightResult.aspx?code=CA1998&amp;callback=flightHandler&quot;; // 创建script标签，设置其属性</div><div class="line">    var script = document.createElement(&apos;script&apos;);</div><div class="line">    script.setAttribute(&apos;src&apos;, url); // 把script标签加入head，此时调用开始</div><div class="line"> document.getElementsByTagName(&apos;head&apos;)[0].appendChild(script); </div><div class="line"> &lt;/script&gt;</div></pre></td></tr></table></figure>
<p>   我们看到调用的url中传递了一个code参数，告诉服务器我要查的是CA1998次航班的信息，而callback参数则告诉服务器，我的本地回调函数叫做flightHandler，所以请把查询结果传入这个函数中进行调用。这个叫做flightResult.aspx的页面生成了一段这样的代码提供给jsonp.html（服务端的实现这里就不演示了，与你选用的语言无关，说到底就是拼接字符串）：</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">flightHandler(&#123; &quot;code&quot;: &quot;CA1998&quot;, &quot;price&quot;: 1780, &quot;tickets&quot;: 5 &#125;);</div></pre></td></tr></table></figure>
<p>  然后页面就会把返回的字符串作为JS代码执行。<br>  <strong>注意：ajax和jsonp其实本质上是不同的东西。ajax的核心是通过XmlHttpRequest获取非本页内容，而jsonp的核心则是动态添加<code>&lt;script&gt;</code>标签来调用服务器提供的js脚本。</strong></p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[CSS hack解决浏览器兼容性问题]]></title>
      <url>http://heji.website/2016/08/22/%E5%B8%B8%E7%94%A8CSS%20hack/</url>
      <content type="html"><![CDATA[<p>由于不同的浏览器，甚至同一浏览器的不同版本对CSS的解析认识不一样，导致生成的页面效果不一致，写出针对不同浏览器CSS code就称为CSS hack。</p>
<a id="more"></a>
<h2 id="CSS内部hack"><a href="#CSS内部hack" class="headerlink" title="CSS内部hack"></a>CSS内部hack</h2><hr>
<p>在CSS3中常见一些这样的写法<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">/*Mozilla内核浏览器：firefox3.5+*/</div><div class="line"> -moz-transform: rotate | scale | skew | translate ;</div><div class="line">/*Webkit内核浏览器：Safari and Chrome*/</div><div class="line"> -webkit-transform: rotate | scale | skew | translate ;</div><div class="line">/*Opera*/</div><div class="line"> -o-transform: rotate | scale | skew | translate ;</div><div class="line">/*IE9*/</div><div class="line"> -ms-transform: rotate | scale | skew | translate ;</div><div class="line">/*W3C标准*/</div><div class="line"> transform: rotate | scale | skew | translate ;</div></pre></td></tr></table></figure></p>
<p>因为CSS3目前标准还没有统一，各个浏览器都有自己的表现方式，甚至有的实现，有的未实现，在前面加一些前缀以表示支持某个特定浏览器，这也是CSS 内部hack的基本原理，向上面这些简单易懂，但是真正的CSS hack 远远不止于此，因为有不死的IE6及其各种奇葩的兄弟版本。<br>CSS 内部hack 语法是这样的：<code>selector{&lt;hack&gt;?property:value&lt;hack&gt;?;}</code> ，上面代码所示的是在属性名称之前的hack。</p>
<ul>
<li><p>例1：属性前面加个“*”这样的写法只会对IE6、7生效，其它版本IE及现代浏览器会忽略这条指令（没有特殊说明，本文所有hack都是指在声明了DOCTYPE的文档的效果）</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">*<span class="selector-tag">background-color</span><span class="selector-pseudo">:green</span>; <span class="comment">/*仅IE6、7下有效*/</span></div></pre></td></tr></table></figure>
</li>
<li><p>例2：在属性值后面加上<code>\9</code>，在IE下都支持；在属性值后面加上<code>\0</code>，IE8、9、10支持；在属性值后加上<code>\9\0</code>，IE9、10支持</p>
  <figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">background-color</span><span class="selector-pseudo">:green</span>\9;</div></pre></td></tr></table></figure>
<p>  CSS 内部hack一览<br>  <img src="index_files/a176bb84-e699-40a6-87fe-91ca5126a8d7.png" alt=""></p>
</li>
</ul>
<h2 id="选择器hack"><a href="#选择器hack" class="headerlink" title="选择器hack"></a>选择器hack</h2><hr>
<p>选择器hanck主要是针对IE浏览器，其实并不怎么常用，语法是这样的：<code>&lt;hack&gt; selector{ sRules }</code><br><img src="index_files/645de664-4e6b-47a8-9250-e22fb60f8214.png" alt=""><br>针对IE9的hack可以这么写<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-pseudo">:root</span> <span class="selector-class">.test</span> &#123; <span class="attribute">background-color</span>:green;&#125;</div></pre></td></tr></table></figure></p>
<h2 id="CSS条件注释-常用"><a href="#CSS条件注释-常用" class="headerlink" title="CSS条件注释(常用)"></a>CSS条件注释(常用)</h2><hr>
<p>HTML头部引用就比较特殊了，类似于程序语句，只能使用在HTML文件里，而不能在CSS文件中使用，并且只有在IE浏览器下才能执行，这个代码在非IE浏览下非单不是执行该条件下的定义，而是当做注释视而不见。<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;!– 默认先调用css.css样式表 –&gt;</div><div class="line">&lt;link rel="stylesheet" type="text/css" href="css.css" /&gt;</div><div class="line">&lt;!–[if IE 7]&gt;</div><div class="line">&lt;!– 如果IE浏览器版是7,调用ie7.css样式表 –&gt;</div><div class="line">&lt;link rel="stylesheet" type="text/css" href="ie7.css" /&gt;</div><div class="line">&lt;![endif]–&gt;</div><div class="line">&lt;!–[if lte IE 6]&gt;</div><div class="line">&lt;!– 如果IE浏览器版本小于等于6,调用ie.css样式表 –&gt;</div><div class="line">&lt;link rel="stylesheet" type="text/css" href="ie.css" /&gt;</div><div class="line">&lt;![endif]–&gt;</div></pre></td></tr></table></figure></p>
<p>lte：就是Less than or equal to的简写，也就是小于或等于的意思。<br>lt ：就是Less than的简写，也就是小于的意思。<br>gte：就是Greater than or equal to的简写，也就是大于或等于的意思。<br>gt ：就是Greater than的简写，也就是大于的意思。<br>! ：就是不等于的意思，跟<a href="http://js8.in/category/front-end/javascript-front-end-2" target="_blank" rel="external">javascript</a>里的不等于判断符相同。</p>
<h2 id="书写顺序"><a href="#书写顺序" class="headerlink" title="书写顺序"></a>书写顺序</h2><hr>
<p>看个例子：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">_<span class="selector-tag">background-color</span><span class="selector-pseudo">:red</span>;</div><div class="line"><span class="selector-tag">background-color</span><span class="selector-pseudo">:green</span>;</div></pre></td></tr></table></figure></p>
<p>如果希望DIV在IE6上是红色，其它是绿色，上面的写法可不可以呢？试一下发现所有浏览器上都是绿色，因为在IE6解析的时候，第一句能够识别，背景设为红色，但是第二句所有浏览器都识别，IE6也不例外，背景颜色又被设为绿色，所以得反过来写<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">background-color</span><span class="selector-pseudo">:green</span>;</div><div class="line">_<span class="selector-tag">background-color</span><span class="selector-pseudo">:red</span>;</div></pre></td></tr></table></figure></p>
<p>总结出的规律就是：先一般，再特殊。有兴趣的同学可以试试试试下面CSS，看看和你想的效果是否一样：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">background-color</span><span class="selector-pseudo">:blue</span>; <span class="comment">/*所有浏览器*/</span></div><div class="line"><span class="selector-tag">background-color</span><span class="selector-pseudo">:red</span>\9;<span class="comment">/*所有的ie*/</span> </div><div class="line"><span class="selector-tag">background-color</span><span class="selector-pseudo">:yellow</span>\0; <span class="comment">/* ie8+*/</span> </div><div class="line">+<span class="selector-tag">background-color</span><span class="selector-pseudo">:pink</span>; <span class="comment">/*+ ie7*/</span></div></pre></td></tr></table></figure></p>
<p><strong>Ps:CSS hack的写法在迫不得已的情况下才考虑使用</strong></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Oracle常用知识点]]></title>
      <url>http://heji.website/2016/08/19/Oracle%E7%9F%A5%E8%AF%86%E7%82%B9/</url>
      <content type="html"><![CDATA[<p>oracle常用易忘知识点<br><a id="more"></a></p>
<h2 id="使用sqlplus连接远程数据库"><a href="#使用sqlplus连接远程数据库" class="headerlink" title="使用sqlplus连接远程数据库"></a>使用sqlplus连接远程数据库</h2><hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sqlplus U_HJYJ_ZJ/U_HJYJ_ZJ@192.168.40.40:1521/hjyj</div></pre></td></tr></table></figure>
<h2 id="使用PL-SQL-Developer连接数据库"><a href="#使用PL-SQL-Developer连接数据库" class="headerlink" title="使用PL/SQL Developer连接数据库"></a>使用PL/SQL Developer连接数据库</h2><hr>
<p>1、安装Oracle<br>2、解压PL/SQL Developer中文绿化版<br>3、解压32位Oracle客户端(即instantclient_11_2)，覆盖PL/SQL Developer中的同名文件夹。然后在instantclient_11_2下创建NETWORK/ADMIN/。拷贝tnsnames.ora到该路径下<br>4、启动plsqlDev 。首选项–&gt;选择OCI库为PL/SQL Developer中客户端的OCI库–&gt;重启plsqlDev<br><strong>tnsnames.ora</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">LocalName =</div><div class="line">  (DESCRIPTION =</div><div class="line">    (ADDRESS_LIST =</div><div class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = 127.0.0.1)(PORT = 1521))</div><div class="line">    )</div><div class="line">    (CONNECT_DATA =</div><div class="line">      (SERVICE_NAME = orcl)</div><div class="line">    )</div><div class="line">  )</div><div class="line">#LOCALNAME: 本地名称</div><div class="line">#ADDRESS: 服务器地址</div><div class="line">#PROTOCOL: 使用协议</div><div class="line">#HOST: IP地址</div><div class="line">#PORT: 监听端口</div><div class="line">#SERVICE_NAME: 数据库服务名称</div></pre></td></tr></table></figure></p>
<p><b style="color:red;">PL/SQL Developer乱码问题：设置一个名为NLS_LANG的系统环境变量，设置其值为“SIMPLIFIED CHINESE_CHINA.ZHS16GBK”，然后重新启动 pl/sql developer</b></p>
<h2 id="为字段添加注释"><a href="#为字段添加注释" class="headerlink" title="为字段添加注释"></a>为字段添加注释</h2><hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> T_HJYJ_YJCZ_JJXX  <span class="keyword">ADD</span> (SSZYRS <span class="built_in">NUMBER</span>(<span class="number">16</span>),JJSS <span class="built_in">NUMBER</span>(<span class="number">16</span>),STGN <span class="keyword">NVARCHAR2</span>(<span class="number">200</span>),GJZDBHWZ <span class="keyword">NVARCHAR2</span>(<span class="number">200</span>));</div><div class="line">//添加注释</div><div class="line">COMMENT ON COLUMN T_HJYJ_YJCZ_JJXX.SSZYRS IS  '疏散转移人数';</div><div class="line">COMMENT ON COLUMN T_HJYJ_YJCZ_JJXX.JJSS IS  '经济损失';</div><div class="line">COMMENT ON COLUMN T_HJYJ_YJCZ_JJXX.STGN IS  '生态功能';</div><div class="line">COMMENT ON COLUMN T_HJYJ_YJCZ_JJXX.GJZDBHWZ IS  '国家重点保护物种';</div></pre></td></tr></table></figure>
<h2 id="从dmp导入数据库"><a href="#从dmp导入数据库" class="headerlink" title="从dmp导入数据库"></a>从dmp导入数据库</h2><hr>
<p>1、删除原有用户及其下所有表<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">drop</span> <span class="keyword">user</span> user_name <span class="keyword">cascade</span>;</div></pre></td></tr></table></figure></p>
<p>2、按照要导入的数据库创建用户及表空间<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLESPACE</span> TBS_HJYJ_ZJ <span class="keyword">DATAFILE</span> <span class="string">'U_HJYJ_ZJ'</span> <span class="keyword">SIZE</span> <span class="number">500</span>m <span class="keyword">AUTOEXTEND</span> <span class="keyword">ON</span>;</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> U_HJYJ_ZJ <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> U_HJYJ_ZJ <span class="keyword">DEFAULT</span> <span class="keyword">TABLESPACE</span> TBS_HJYJ_ZJ;</div><div class="line"><span class="keyword">GRANT</span> DBA <span class="keyword">TO</span> U_HJYJ_ZJ</div></pre></td></tr></table></figure></p>
<p>3、在命令提示符输入imp 用户名/密码@ip:端口号/orcl  full=y file=F:\U_HJYJ_ZJ.dmp ignore=y</p>
<h2 id="导出数据库到dmp文件"><a href="#导出数据库到dmp文件" class="headerlink" title="导出数据库到dmp文件"></a>导出数据库到dmp文件</h2><hr>
<p>exp 用户名/密码@192.168.40.40:1521/hjyj [owner=用户名] file=f:\U_HJYJ_ZJ.dmp [full=y]<br><strong>注意:如果想要连空表也导出,需要执行sql:</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="string">'alter table '</span> || TABLE_NAME || <span class="string">' allocate extent;'</span> <span class="keyword">FROM</span> USER_TABLES <span class="keyword">WHERE</span> NUM_ROWS = <span class="number">0</span></div></pre></td></tr></table></figure></p>
<h2 id="union和union-all"><a href="#union和union-all" class="headerlink" title="union和union all"></a>union和union all</h2><hr>
<p>UNION 指令的目的是将两个 SQL 语句的结果合并起来,可以查看你要的查询结果，例如union和union all的区别<br>union all效率更高，但是不会自动去除重复数据。union效率相对较低，但是能去除重复数据</p>
<h2 id="oracle创建视图"><a href="#oracle创建视图" class="headerlink" title="oracle创建视图"></a>oracle创建视图</h2><hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">or</span> <span class="keyword">replace</span> <span class="keyword">view</span> dept_sum_vw <span class="keyword">as</span> <span class="keyword">select</span> d.dname <span class="keyword">name</span>,<span class="keyword">min</span>(e.sal) minsal,<span class="keyword">max</span>(e.sal) maxsal,<span class="keyword">avg</span>(e.sal) avgsal <span class="keyword">from</span> emp e,dept d <span class="keyword">where</span> e.deptno = d.deptno <span class="keyword">group</span> <span class="keyword">by</span> d.dname</div></pre></td></tr></table></figure>
<h2 id="添加、删除、修改字段"><a href="#添加、删除、修改字段" class="headerlink" title="添加、删除、修改字段"></a>添加、删除、修改字段</h2><hr>
<p>添加字段的语法：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tablename <span class="keyword">add</span> (<span class="keyword">column</span> datatype [<span class="keyword">default</span> <span class="keyword">value</span>][<span class="literal">null</span>/<span class="keyword">not</span> <span class="literal">null</span>],….);</div></pre></td></tr></table></figure></p>
<p>修改字段的语法：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tablename <span class="keyword">modify</span> (<span class="keyword">column</span> datatype [<span class="keyword">default</span> <span class="keyword">value</span>][<span class="literal">null</span>/<span class="keyword">not</span> <span class="literal">null</span>],….);</div></pre></td></tr></table></figure></p>
<p>删除字段的语法：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tablename <span class="keyword">drop</span> (<span class="keyword">column</span>);</div></pre></td></tr></table></figure></p>
<p>添加、修改、删除多列的话，用逗号隔开。</p>
<h2 id="从Excel导入数据到oracle"><a href="#从Excel导入数据到oracle" class="headerlink" title="从Excel导入数据到oracle"></a>从Excel导入数据到oracle</h2><hr>
<h3 id="CSV格式文件导入"><a href="#CSV格式文件导入" class="headerlink" title="CSV格式文件导入"></a>CSV格式文件导入</h3><ul>
<li>创建sql*loader控制文件**.ctl<br><img src="index_files/clipboard.png" alt=""></li>
<li>在命令行输入命令<br><img src="index_files/2cb67420-47b9-4578-8d44-495c3fa45fb8.png" alt=""><br>system/manager改为对应的用户名/密码</li>
</ul>
<h3 id="Excel格式导入"><a href="#Excel格式导入" class="headerlink" title="Excel格式导入"></a>Excel格式导入</h3><ul>
<li>工具–&gt;ODBC导入器</li>
<li>选择Excel文件<br><img src="index_files/fcf88952-2961-4d28-bd4b-be1b20eb3a90.png" alt=""></li>
<li>选择要导入的表<br><img src="index_files/bd92eca3-3c62-4acf-9836-93ddf1ebd08c.png" alt=""></li>
<li>导入</li>
</ul>
<h2 id="oracle函数"><a href="#oracle函数" class="headerlink" title="oracle函数"></a>oracle函数</h2><hr>
<h3 id="decode函数"><a href="#decode函数" class="headerlink" title="decode函数"></a>decode函数</h3><p>语法：<code>decode(条件,值1,返回值1,值2,返回值2,...值n,返回值n,缺省值)</code> 例如：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">decode</span>(SEX,<span class="string">'女'</span>,<span class="number">1</span>,<span class="string">'男'</span>,<span class="number">0</span>） sex  <span class="keyword">from</span> T_PERSON</div></pre></td></tr></table></figure></p>
<h3 id="case-when函数"><a href="#case-when函数" class="headerlink" title="case when函数"></a>case when函数</h3><p>语法：<code>CASE WHEN 条件 THEN 操作 WHEN 条件2 THEN 操作2 ELSE 操作3 END</code>，例如：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span>   grade, <span class="keyword">COUNT</span> (<span class="keyword">CASE</span> <span class="keyword">WHEN</span> sex =<span class="number">1</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="literal">NULL</span> <span class="keyword">END</span>) 男生数,</div><div class="line">                <span class="keyword">COUNT</span> (<span class="keyword">CASE</span> <span class="keyword">WHEN</span> sex =<span class="number">2</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="literal">NULL</span> <span class="keyword">END</span>) 女生数</div><div class="line">                <span class="keyword">FROM</span> students GROUPBY grade;</div></pre></td></tr></table></figure></p>
<h3 id="replace函数"><a href="#replace函数" class="headerlink" title="replace函数"></a>replace函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">UPDATE</span>  T_ADMIN_RMS_CD t <span class="keyword">SET</span> BZ = <span class="keyword">REPLACE</span>((<span class="keyword">SELECT</span> BZ <span class="keyword">FROM</span> T_ADMIN_RMS_CD <span class="keyword">WHERE</span> SSXT = <span class="string">'2013101017042563d7662ffd17471eb2fdb8956d7bed48'</span>),<span class="string">'10.33.106.51:8010'</span>,<span class="string">'服务器ip:端口号'</span>) <span class="keyword">WHERE</span> SSXT = <span class="string">'2013101017042563d7662ffd17471eb2fdb8956d7bed48'</span></div></pre></td></tr></table></figure>
<h3 id="substring函数"><a href="#substring函数" class="headerlink" title="substring函数"></a>substring函数</h3><p>语法：<code>substring(string,pos,len)</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">UPDATE</span> T_HJYJ_FXY_JBXX a <span class="keyword">SET</span> a.SHENG = (<span class="keyword">SELECT</span> <span class="keyword">SUBSTR</span>(SHENG,<span class="number">0</span>,<span class="number">2</span>) <span class="keyword">FROM</span> T_HJYJ_FXY_JBXX b <span class="keyword">WHERE</span> b.XH = a.XH)</div></pre></td></tr></table></figure></p>
<h3 id="截取字符串"><a href="#截取字符串" class="headerlink" title="截取字符串"></a>截取字符串</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">UPDATE</span> T_HJYJ_JC_WRYJBXX JBXX <span class="keyword">SET</span> JBXX.LATITUDE = (</div><div class="line">       <span class="keyword">SELECT</span> JDD+JDF/<span class="number">60</span>+JDM/<span class="number">3600</span> <span class="keyword">FROM</span> (</div><div class="line">              <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> (</div><div class="line">                <span class="keyword">SELECT</span> INNER_ENT_ID, </div><div class="line">                       <span class="keyword">SUBSTR</span>(LATITUDE, <span class="number">0</span>, <span class="keyword">INSTR</span>(LATITUDE, <span class="string">'.'</span>, <span class="number">1</span>, <span class="number">1</span>) - <span class="number">1</span>) <span class="keyword">AS</span> JDD,</div><div class="line">                       <span class="keyword">SUBSTR</span>(LATITUDE,</div><div class="line">                               <span class="keyword">INSTR</span>(LATITUDE, <span class="string">'.'</span>, <span class="number">1</span>, <span class="number">1</span>) + <span class="number">1</span>,</div><div class="line">                               <span class="keyword">INSTR</span>(LATITUDE, <span class="string">'.'</span>, <span class="number">1</span>, <span class="number">2</span>) - <span class="keyword">INSTR</span>(LATITUDE, <span class="string">'.'</span>, <span class="number">1</span>, <span class="number">1</span>) - <span class="number">1</span>) <span class="keyword">AS</span> JDF,</div><div class="line">                       <span class="keyword">SUBSTR</span>(LATITUDE,</div><div class="line">                               <span class="keyword">INSTR</span>(LATITUDE, <span class="string">'.'</span>, <span class="number">1</span>, <span class="number">2</span>) + <span class="number">1</span>,</div><div class="line">                               <span class="keyword">LENGTH</span>(LATITUDE) - <span class="number">1</span>)  <span class="keyword">AS</span> JDM,</div><div class="line">                       LATITUDE</div><div class="line">                  <span class="keyword">FROM</span> T_HJYJ_JC_WRYJBXX </div><div class="line">                  ) TMP  <span class="keyword">WHERE</span> TMP.JDD <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">AND</span> TMP.JDF <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">AND</span> TMP.JDM <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></div><div class="line">       ) <span class="keyword">WHERE</span> INNER_ENT_ID = JBXX.INNER_ENT_ID</div><div class="line">)</div></pre></td></tr></table></figure>
<h2 id="进行查询并更新操作"><a href="#进行查询并更新操作" class="headerlink" title="进行查询并更新操作"></a>进行查询并更新操作</h2><hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> T_ADMIN_RMS_YH <span class="keyword">WHERE</span> YHID = <span class="string">'nbsshy'</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span></div></pre></td></tr></table></figure>
<h2 id="查询用户表空间"><a href="#查询用户表空间" class="headerlink" title="查询用户表空间"></a>查询用户表空间</h2><hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> username,default_tablespace <span class="keyword">from</span> user_users;</div></pre></td></tr></table></figure>
<h2 id="向一张表导入另一张表的部分数据"><a href="#向一张表导入另一张表的部分数据" class="headerlink" title="向一张表导入另一张表的部分数据"></a>向一张表导入另一张表的部分数据</h2><hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> T_HJYJ_FXY_FXYML_BAK(XH,FXYXH,FXYMC,NF,CZBM,FLAG,SFYX,ITEM1,ITEM2,ITEM3,ITEM4,ITEM5,BZ,ORGID,CJR,CJSJ,XGR,XGSJ,JDJCSJ,SHENG,SHI,QX,CZR,CZSJ,CZ) <span class="keyword">select</span> t.*,<span class="string">'hj'</span> <span class="keyword">AS</span> CZR,<span class="keyword">SYSDATE</span> <span class="keyword">AS</span> CZSJ,<span class="string">'sz'</span> <span class="keyword">AS</span> CZ <span class="keyword">from</span> T_HJYJ_FXY_FXYML t <span class="keyword">WHERE</span> XH = <span class="string">'1'</span></div></pre></td></tr></table></figure>
<h2 id="查询数据表中重复的数据-以DMNR字段判断是否重复"><a href="#查询数据表中重复的数据-以DMNR字段判断是否重复" class="headerlink" title="查询数据表中重复的数据(以DMNR字段判断是否重复)"></a>查询数据表中重复的数据(以DMNR字段判断是否重复)</h2><hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> GGDMZ.DMNR,<span class="keyword">COUNT</span>(<span class="number">1</span>) <span class="keyword">FROM</span> T_COMN_GGDMZ GGDMZ <span class="keyword">WHERE</span> GGDMZ.DMJBH = <span class="string">'HJKQHFQ'</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> GGDMZ.DMNR <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(<span class="number">1</span>)&gt;<span class="number">1</span></div></pre></td></tr></table></figure>
<h2 id="oracle中修改类型为clob"><a href="#oracle中修改类型为clob" class="headerlink" title="oracle中修改类型为clob"></a>oracle中修改类型为clob</h2><hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> T_COMN_VIEW <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> STNR;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> T_COMN_VIEW <span class="keyword">ADD</span>  STNR <span class="keyword">CLOB</span>;COMMENT ON COLUMN  T_COMN_VIEW.STNR IS '视图内容'</div></pre></td></tr></table></figure>
<h2 id="sqlplus需要执行commit命令才能提交事务。"><a href="#sqlplus需要执行commit命令才能提交事务。" class="headerlink" title="sqlplus需要执行commit命令才能提交事务。"></a>sqlplus需要执行commit命令才能提交事务。</h2><hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">delete</span> <span class="keyword">from</span> T_COMN_XZQHDM;</div><div class="line"><span class="keyword">commit</span>;</div></pre></td></tr></table></figure>
<h2 id="ORACLE导出空表需要先执行的语句"><a href="#ORACLE导出空表需要先执行的语句" class="headerlink" title="ORACLE导出空表需要先执行的语句"></a>ORACLE导出空表需要先执行的语句</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="string">'alter table '</span> || TABLE_NAME || <span class="string">' allocate extent;'</span> <span class="keyword">FROM</span> USER_TABLES <span class="keyword">WHERE</span> NUM_ROWS = <span class="number">0</span></div></pre></td></tr></table></figure>
<h2 id="Oracle关于连接数的问题"><a href="#Oracle关于连接数的问题" class="headerlink" title="Oracle关于连接数的问题"></a>Oracle关于连接数的问题</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> v$process <span class="comment">--当前的数据库连接数</span></div><div class="line"><span class="keyword">select</span> <span class="keyword">value</span> <span class="keyword">from</span> v$parameter <span class="keyword">where</span> <span class="keyword">name</span> =<span class="string">'processes'</span><span class="comment">--数据库允许的最大连接数</span></div><div class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> processes = <span class="number">300</span> <span class="keyword">scope</span> = <span class="keyword">spfile</span>;<span class="comment">--修改最大连接数:</span></div></pre></td></tr></table></figure>
<h2 id="高速泵导入导出"><a href="#高速泵导入导出" class="headerlink" title="高速泵导入导出"></a>高速泵导入导出</h2><hr>
<ul>
<li>高速导入导出(<code>E:\Database\XZCF</code>目录是DMP文件存放位置/导出位置)<br><code>create or replace directory exp_dir as &#39;E:\Database\XZCF&#39;;--PL/SQL中执行</code></li>
<li>授权目录相关用户<br><code>grant read,write on directory exp_dir to public;--PL/SQL中执行</code></li>
<li>查询地址<br><code>select * from dba_directories;</code></li>
<li>执行导出(在CMD中执行)<br><code>expdp U_WSYS/U_WSYS@TEST directory=exp_dir dumpfile=WRJPGZ20140703.DMP logfile=WRJPGZ_20140703.log;</code></li>
<li>执行导入(在CMD中执行)<br><code>impdp U_WSYS/U_WSYS@ORCL directory=exp_dir dumpfile=U_WSYSS.DMP logfile=U_WSYSS.log;</code></li>
</ul>
<h2 id="oracle时间查询相关"><a href="#oracle时间查询相关" class="headerlink" title="oracle时间查询相关"></a>oracle时间查询相关</h2><hr>
<p>当前月份所有日期<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> TRUNC(<span class="keyword">SYSDATE</span>, <span class="string">'MM'</span>) + <span class="keyword">ROWNUM</span> - <span class="number">1</span> <span class="keyword">AS</span> MONTHDAY <span class="keyword">FROM</span> DUAL</div><div class="line">     <span class="keyword">CONNECT</span> <span class="keyword">BY</span> <span class="keyword">ROWNUM</span> &lt;= TO_NUMBER(TO_CHAR(<span class="keyword">LAST_DAY</span>(<span class="keyword">SYSDATE</span>), <span class="string">'dd'</span>))</div></pre></td></tr></table></figure></p>
<p>查询上季度所有月份<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> TO_CHAR(ADD_MONTHS(ADD_MONTHS(TRUNC(<span class="keyword">SYSDATE</span>, <span class="string">'YYYY'</span>),A * <span class="number">3</span>),-<span class="keyword">ROWNUM</span>),<span class="string">'YYYYMM'</span>)  LAST_Q  </div><div class="line">    <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> TO_CHAR(<span class="keyword">SYSDATE</span>,<span class="string">'Q'</span>)<span class="number">-1</span> A <span class="keyword">FROM</span> DUAL)  </div><div class="line">    <span class="keyword">CONNECT</span> <span class="keyword">BY</span> <span class="keyword">ROWNUM</span> &lt;= <span class="number">3</span>  </div><div class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span>;</div></pre></td></tr></table></figure></p>
<p>查询当前季度所有月份<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> TO_CHAR(ADD_MONTHS(ADD_MONTHS(TRUNC(<span class="keyword">SYSDATE</span>, <span class="string">'YYYY'</span>),A * <span class="number">3</span>),-<span class="keyword">ROWNUM</span>),<span class="string">'YYYYMM'</span>)  LAST_Q  </div><div class="line">    <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> TO_CHAR(<span class="keyword">SYSDATE</span>,<span class="string">'Q'</span>) A <span class="keyword">FROM</span> DUAL)  </div><div class="line">    <span class="keyword">CONNECT</span> <span class="keyword">BY</span> <span class="keyword">ROWNUM</span> &lt;= <span class="number">3</span>  </div><div class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span>;</div></pre></td></tr></table></figure></p>
<p>构造一年12个月<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> to_char(<span class="keyword">to_date</span>(<span class="string">'201106'</span>,<span class="string">'yyyymm'</span>),<span class="string">'yyyy'</span>) || <span class="keyword">LPAD</span>(<span class="keyword">LEVEL</span>,<span class="number">2</span>,<span class="number">0</span>)</div><div class="line"><span class="keyword">FROM</span> dual</div><div class="line"><span class="keyword">CONNECT</span> <span class="keyword">BY</span> <span class="keyword">LEVEL</span>&lt;<span class="number">13</span></div></pre></td></tr></table></figure></p>
<h2 id="Oracle根据汉字返回拼音的包"><a href="#Oracle根据汉字返回拼音的包" class="headerlink" title="Oracle根据汉字返回拼音的包"></a>Oracle根据汉字返回拼音的包</h2><hr>
<p><strong>由于篇幅过大，这里不贴代码。</strong></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[使用Hexo搭建博客]]></title>
      <url>http://heji.website/2016/08/17/%E4%BD%BF%E7%94%A8Hexo%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/</url>
      <content type="html"><![CDATA[<p>Hexo 是一个快速、简洁且高效的博客框架。Hexo 使用 Markdown（或其他渲染引擎）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。</p>
<a id="more"></a>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul>
<li>安装<a href="http://nodejs.org/" title="NodeJS" target="_blank" rel="external">NodeJS</a></li>
<li>安装<a href="https://git-scm.com/" title="Git" target="_blank" rel="external">Git</a></li>
<li>安装Hexo<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">     <span class="variable">$npm</span> install -g hexo-cli</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="新建博客"><a href="#新建博客" class="headerlink" title="新建博客"></a>新建博客</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">hexo init myB<span class="built_in">log</span></div><div class="line"><span class="built_in">cd</span> myB<span class="built_in">log</span></div><div class="line">npm install</div><div class="line">hexo g <span class="comment"># 或者hexo generate</span></div><div class="line">hexo s <span class="comment"># 或者hexo server，可以在http://localhost:4000/ 查看</span></div></pre></td></tr></table></figure>
<p>这里有必要提下Hexo常用的几个命令：<br><code>hexo generate (hexo g)</code> 生成静态文件，会在当前目录下生成一个新的叫做public的文件夹<br><code>hexo server (hexo s)</code> 启动本地web服务，用于博客的预览<br><code>hexo deploy (hexo d)</code>部署播客到远端（比如github, heroku等平台）<br><code>hexo new &quot;postName&quot;</code>#新建文章<br>现在我们打开<code>http://localhost:4000/</code> 已经可以看到一篇内置的blog了。</p>
<h2 id="主题设置"><a href="#主题设置" class="headerlink" title="主题设置"></a>主题设置</h2><p>这里以主题yilia为例进行说明(以下命令在博客目录执行)。</p>
<ul>
<li>安装主题  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">    $ hexo clean</div><div class="line">    $ git <span class="built_in">clone</span> https://github.com/litten/hexo-theme-yilia.git themes/yilia</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>启用主题<br>修改Hexo目录下的_config.yml配置文件中的theme属性，将其设置为yilia。</p>
</li>
<li><p>更新主题</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">    $ cd themes/yilia</div><div class="line">    $ git pull</div><div class="line">    $ hexo g # 生成</div><div class="line">    $ hexo s # 启动本地web服务器</div></pre></td></tr></table></figure>
<p>  现在打开<code>http://localhost:4000/</code> ，会看到我们已经应用了一个新的主题。</p>
</li>
</ul>
<h2 id="部署博客到Github-Pages"><a href="#部署博客到Github-Pages" class="headerlink" title="部署博客到Github Pages"></a>部署博客到Github Pages</h2><p><a href="https://pages.github.com/" title="Github Pages" target="_blank" rel="external">Github Pages</a>本用于介绍托管在GitHub的项目，不过，由于他的空间免费稳定，用来做搭建一个博客再好不过了。<br>每个帐号只能有一个仓库来存放个人主页，而且仓库的名字必须是username/username.github.io，这是特殊的命名约定。你可以通过<code>http://username.github.io</code> 来访问你的个人主页。<br><strong>注意：个人主页的网站内容是在master分支下的。</strong></p>
<h3 id="创建自己的Github-Pages"><a href="#创建自己的Github-Pages" class="headerlink" title="创建自己的Github Pages"></a>创建自己的Github Pages</h3><ul>
<li>创建github仓库，注意命名</li>
<li>在settings开启github pages</li>
<li>现在可以通过<code>http://username.github.io</code>访问github主页</li>
</ul>
<h3 id="部署Hexo到Github-Pages"><a href="#部署Hexo到Github-Pages" class="headerlink" title="部署Hexo到Github Pages"></a>部署Hexo到Github Pages</h3><p>这一步恐怕是最关键的一步了，让我们把在本地web环境下预览到的博客部署到github上，然后就可以直接通过<code>http://heji1993.github.io/</code>访问了。不过很多教程文章对这个步骤语焉不详，这里着重说下。<br>首先需要明白所谓部署到github的原理。<br>1、之前步骤中在Github上创建的那个特别的repo（heji1993.github.io）一个最大的特点就是其master中的html静态文件，可以通过链接<code>http://heji1993.github.io</code>来直接访问。<br>2、Hexo -g 会生成一个静态网站（第一次会生成一个public目录），这个静态文件可以直接访问。<br>3、需要将hexo生成的静态网站，提交(git commit)到github上。<br><strong>注意：部署到github需要配置SSH key，请参考github学习笔记</strong></p>
<ul>
<li><p><strong>使用hexo deploy部署</strong><br>  hexo deploy可以部署到很多平台，具体可以参考<a href="https://hexo.io/docs/deployment.html" title="部署指南" target="_blank" rel="external">这个链接</a>. 如果部署到github，需要在配置文件_config.xml中作如下修改：</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">    deploy:</div><div class="line">      type: git</div><div class="line">      repo: git@github.com:heji1993/heji1993.github.io.git</div><div class="line">      branch: master</div></pre></td></tr></table></figure>
<p>  然后在命令行中执行</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">        hexo d</div></pre></td></tr></table></figure>
<p>  即可完成部署。</p>
<p>  注意需要提前安装一个扩展：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">        npm install hexo-deployer-git --save</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><strong>使用git命令行部署</strong><br>  克隆github仓库</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">        $ <span class="built_in">cd</span> e:/myB<span class="built_in">log</span></div><div class="line">        $ git <span class="built_in">clone</span> https://github.com/heji1993/heji1993.github.io.git .deploy/heji1993.github.io</div></pre></td></tr></table></figure>
<p>  创建一个deploy脚本文件</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">        hexo generate</div><div class="line">        cp -R public/* .deploy/heji1993.github.io</div><div class="line">        <span class="built_in">cd</span> .deploy/heji1993.github.io</div><div class="line">        git add .</div><div class="line">        git commit -m “update”</div><div class="line">        git push origin master</div></pre></td></tr></table></figure>
<p>  需要部署的时候，执行这段脚本就可以了（比如可以将其保存为deploy.sh）。执行过程中可能需要让你输入Github账户的用户名及密码，按照提示操作即可。</p>
</li>
</ul>
<h2 id="新建文章"><a href="#新建文章" class="headerlink" title="新建文章"></a>新建文章</h2><p>新建markdown文件，放在<code>source\_posts</code>目录下，当执行<code>hexo g</code>命令时，会生成public目录并把markdown文件转换为HTML文件放入其中用于发布站点。markdown文件头需要包含以下信息：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">title: Gulp</div><div class="line">categories: Web前端</div><div class="line">tags: [Gulp,自动化]</div><div class="line">---</div></pre></td></tr></table></figure></p>
<h2 id="NexT主题的使用"><a href="#NexT主题的使用" class="headerlink" title="NexT主题的使用"></a>NexT主题的使用</h2><p><strong>在 Hexo 中有两份主要的配置文件，其名称都是<code>_config.yml</code>。 其中，一份位于站点根目录下，主要包含 Hexo 本身的配置；另一份位于主题目录下，这份配置由主题作者提供，主要用于配置主题相关的选项。为了描述方便，在以下说明中，将前者称为 站点配置文件， 后者称为 主题配置文件。</strong></p>
<ul>
<li><p>下载主题</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">    $ <span class="built_in">cd</span> your-hexo-site</div><div class="line">    $ git <span class="built_in">clone</span> https://github.com/iissnan/hexo-theme-next themes/next</div></pre></td></tr></table></figure>
</li>
<li><p>启用主题、验证主题<br>  与所有 Hexo 主题启用的模式一样。 当 克隆/下载 完成后，打开<code>_config.xml</code>， 找到 <code>theme</code> 字段，并将其值更改为 <code>next</code>。</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">        theme: next</div></pre></td></tr></table></figure>
<p>  运行以下命令：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">        hexo clean </div><div class="line">        hexo g</div><div class="line">        hexo d</div></pre></td></tr></table></figure>
<p>  打开博客首页查看效果</p>
</li>
</ul>
<h3 id="自定义设置-修改主题配置文件"><a href="#自定义设置-修改主题配置文件" class="headerlink" title="自定义设置(修改主题配置文件)"></a>自定义设置(修改主题配置文件)</h3><ul>
<li>选择 Scheme（不同的外观）</li>
<li><p>设置语言<br>编辑 站点配置文件， 将 <code>language</code> 设置成你所需要的语言。建议明确设置你所需要的语言，例如选用简体中文，配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">      language: zh-Hans</div></pre></td></tr></table></figure>
</li>
<li><p>设置菜单<br>1、设置菜单内容</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">          menu:</div><div class="line">                home: /</div><div class="line">                archives: /archives</div><div class="line">                #about: /about</div><div class="line">                #categories: /categories</div><div class="line">                tags: /tags</div><div class="line">                #commonweal: /404.html</div></pre></td></tr></table></figure>
<p>2、以简体中文为例，若你需要添加一个菜单项，比如 something。那么就需要修改简体中文对应的翻译文件 <code>languages/zh-Hans.yml</code>，在 menu 字段下添加一项：</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">          menu:</div><div class="line">              home: 首页</div><div class="line">              archives: 归档</div><div class="line">              categories: 分类</div><div class="line">              tags: 标签</div><div class="line">              about: 关于</div><div class="line">              search: 搜索</div><div class="line">              commonweal: 公益404</div><div class="line">              something: 有料</div></pre></td></tr></table></figure>
<p>3、设定菜单项的图标，对应的字段是 menu_icons。 此设定格式是 item name: icon name，其中 item name 与上一步所配置的菜单名字对应，icon name 是 Font Awesome 图标的 名字。而 enable 可用于控制是否显示图标，你可以设置成 false 来去掉图标。</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">          menu_icons:</div><div class="line">              enable: true</div><div class="line">              # Icon Mapping.</div><div class="line">              home: home</div><div class="line">              about: user</div><div class="line">              categories: th</div><div class="line">              tags: tags</div><div class="line">              archives: archive</div><div class="line">              commonweal: heartbeat</div></pre></td></tr></table></figure>
</li>
<li><p>设置RSS<br>  NexT 中 RSS 有三个设置选项，满足特定的使用场景。 更改 <code>主题配置文件</code>，设定 rss 字段的值：</p>
<ul>
<li><code>false</code>：禁用RSS，不在页面上显示RSS连接</li>
<li>留空：使用hexo生成的Feed标签。你需要先安装<a href="https://github.com/hexojs/hexo-generator-feed" title="hexo-generator-feed " target="_blank" rel="external">hexo-generator-feed </a>插件</li>
<li>具体的链接地址：适用于已经烧制过 Feed 的情形。</li>
</ul>
</li>
<li><p>添加<code>标签</code>页面<br>  1、在终端窗口下，定位到 Hexo 站点目录下。使用 hexo new page 新建一个页面，命名为 tags ：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">        $ <span class="built_in">cd</span> your-hexo-site</div><div class="line">        $ hexo new page tags</div></pre></td></tr></table></figure>
<p>  2、编辑刚新建的页面，将页面的类型设置为 tags ，主题将自动为这个页面显示标签云。页面内容如下：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">        title: 标签</div><div class="line">        date: 2014-12-22 12:39:04</div><div class="line">        <span class="built_in">type</span>: <span class="string">"tags"</span></div><div class="line">        ---</div></pre></td></tr></table></figure>
<p>  3、在菜单中添加链接。编辑 <code>主题配置文件</code> ， 添加 tags 到 menu 中，如下:</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">        menu:</div><div class="line">          home: /</div><div class="line">          archives: /archives</div><div class="line">          tags: /tags</div></pre></td></tr></table></figure>
</li>
<li><p>添加<code>分类</code>页面<br>  1、在终端窗口下，定位到 Hexo 站点目录下。使用 hexo new page 新建一个页面，命名为 categories ：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">        $ <span class="built_in">cd</span> your-hexo-site</div><div class="line">        $ hexo new page categories</div></pre></td></tr></table></figure>
<p>  2、编辑刚新建的页面，将页面的类型设置为 categories ，主题将自动为这个页面显示分类。页面内容如下：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">        title: 标签</div><div class="line">        date: 2014-12-22 12:39:04</div><div class="line">        <span class="built_in">type</span>: <span class="string">"categories"</span></div><div class="line">        ---</div></pre></td></tr></table></figure>
<p>  3、在菜单中添加链接。编辑 <code>主题配置文件</code> ， 添加 categories 到 menu 中，如下:</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">        menu:</div><div class="line">          home: /</div><div class="line">          archives: /archives</div><div class="line">          categories : /categories</div></pre></td></tr></table></figure>
</li>
<li><p>设置代码高亮</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">        # Code Highlight theme</div><div class="line">        # Available value: normal | night | night eighties | night blue | night bright</div><div class="line">        # https://github.com/chriskempson/tomorrow-theme</div><div class="line">        highlight_theme: normal</div></pre></td></tr></table></figure>
</li>
<li><p>设置侧栏<br>默认情况下，侧栏仅在文章页面（拥有目录列表）时才显示，并放置于右侧位置。 可以通过修改 主题配置文件 中的 sidebar 字段来控制侧栏的行为。侧栏的设置包括两个部分，其一是侧栏的位置， 其二是侧栏显示的时机。<br>  1、设置侧栏的位置，修改 <code>sidebar.position</code>的值，支持的选项有：</p>
<ul>
<li>left：靠左放置</li>
<li><p>right：靠右放置  </p>
<p>2、设置侧栏显示时机，修改 <code>sidebar.display</code>的值</p>
</li>
</ul>
</li>
<li>设置头像<br>编辑 站点配置文件， 新增字段<code>avatar</code>， 值设置成头像的链接地址。其中，头像的链接地址可以是：</li>
</ul>
<h2 id="集成第三方服务"><a href="#集成第三方服务" class="headerlink" title="集成第三方服务"></a>集成第三方服务</h2><ul>
<li>多说评论<br>  使用多说前需要先在 多说 创建一个站点。具体步骤如下：<br>  1、登录后在首页选择 “我要安装”。<br>  2、创建站点，填写站点相关信息。 多说域名 这一栏填写的即是你的 <code>duoshuo_shortname</code><br>  3、创建站点完成后在 站点配置文件 中新增 <code>duoshuo_shortname</code> 字段，值设置成上一步中的值。</li>
<li>百度统计<br>  1、登录 <a href="http://tongji.baidu.com/ 百度统计" target="_blank" rel="external">百度统计</a>， 定位到站点的代码获取页面<br>  2、复制 <code>hm.js?</code> 后面那串统计脚本 id<br>  3、编辑 站点配置文件， 新增字段 <code>baidu_analytics</code> 字段，值设置成你的百度统计脚本 id</li>
<li><p>Local Search<br>  1、安装 <code>hexo-generator-search</code>，在站点的根目录下执行以下命令：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">        $ npm install hexo-generator-search --save</div></pre></td></tr></table></figure>
<p>  2、编辑 站点配置文件，新增以下内容到任意位置：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">        search:</div><div class="line">          path: search.xml</div><div class="line">          field: post</div></pre></td></tr></table></figure>
</li>
<li><p>打赏功能<br>  Next主题最新版默认集成打赏功能，在站点配置文件开启即可</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">        # Donate 文章末尾显示打赏按钮</div><div class="line">        reward_comment: 生活不止眼前的苟且，还有远方的诗和田野</div><div class="line">        wechatpay: /images/weixin.png</div><div class="line">        alipay: /images/zhifubao.jpg</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Hexo-Seo优化之为你的首页添加关键字"><a href="#Hexo-Seo优化之为你的首页添加关键字" class="headerlink" title="Hexo Seo优化之为你的首页添加关键字"></a>Hexo Seo优化之为你的首页添加关键字</h2><h3 id="现状"><a href="#现状" class="headerlink" title="现状"></a>现状</h3><ul>
<li>首页head标签中没有keywords关键字</li>
<li>博客文章页面的关键字直有文章相关的关键字，没有网站的关键字</li>
</ul>
<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><ul>
<li><p>配置关键字<br>  为了引用和修改方便，在博客根目录下 _config.yml 添加 keywords，并添加网站的关键字 如下：</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    keywords:  何机的博客,何机,博客,blog,IT,技术</div></pre></td></tr></table></figure>
</li>
<li><p>添加关键字<br>  打开<code>${theme}\layout\_partial\header.ejs</code>,将</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">    &lt;%  <span class="keyword">if</span>  (page.keywords)&#123; %&gt;<span class="xml"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"keywords"</span> <span class="attr">content</span>=<span class="string">"&lt;%= page.keywords %&gt;"</span>&gt;</span><span class="tag">&lt;<span class="name">%</span>  &#125; %&gt;</span></span></div></pre></td></tr></table></figure>
<p>  修改为</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">    &lt;%  <span class="keyword">if</span>  (page.keywords)&#123; %&gt;&lt;meta name="keywords" content="&lt;%= page.keywords %&gt;, &lt;%= config.keywords %&gt;"&gt;&lt;%  &#125; %&gt;</div><div class="line">    &lt;%  if  (!page.keywords)&#123; %&gt;&lt;meta name="keywords" content="&lt;%= config.keywords %&gt;"&gt;&lt;%  &#125; %&gt;</div></pre></td></tr></table></figure>
<p>  第一行代码是在文章页面也添加博客的关键字；第二行是在首页添加关键字。</p>
</li>
</ul>
<h3 id="重新部署验证"><a href="#重新部署验证" class="headerlink" title="重新部署验证"></a>重新部署验证</h3>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Gulp教程]]></title>
      <url>http://heji.website/2016/08/15/Gulp%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/</url>
      <content type="html"><![CDATA[<p>基于文件流的构建系统。</p>
<a id="more"></a>
<h2 id="为什么使用Gulp"><a href="#为什么使用Gulp" class="headerlink" title="为什么使用Gulp"></a>为什么使用Gulp</h2><hr>
<p>Gulp基于Node.js的前端构建工具，通过Gulp的插件可以实现前端代码的编译（sass、less）、压缩、测试；图片的压缩；浏览器自动刷新，还有许多强大的插件可以在这里查找。比起Grunt不仅配置简单而且更容易阅读和维护</p>
<h2 id="建立Web项目"><a href="#建立Web项目" class="headerlink" title="建立Web项目"></a>建立Web项目</h2><hr>
<p>使用一下命令建立项目，会自动生成一个package.json文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$mkdir</span> projectName</div><div class="line"><span class="variable">$cd</span> projectName</div><div class="line"><span class="variable">$npm</span> init</div></pre></td></tr></table></figure></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><hr>
<ul>
<li><p>首先我们要全局安装一遍：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install gulp -g</div></pre></td></tr></table></figure>
</li>
<li><p>接着我们要进去到项目的根目录再安装一遍（确保你根目录存在package.json文件）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install gulp --save-dev</div></pre></td></tr></table></figure>
</li>
</ul>
<p>—save-dev这个属性会将条目保存到你package.json的devDependencies里面</p>
<h2 id="安装gulp插件"><a href="#安装gulp插件" class="headerlink" title="安装gulp插件"></a>安装gulp插件</h2><hr>
<p>我们将要使用Gulp插件来完成我们以下任务：</p>
<ul>
<li>sass的编译(<a href="https://github.com/sindresorhus/gulp-ruby-sass" target="_blank" rel="external">gulp-ruby-sass</a>)</li>
<li>自动添加CSS前缀(<a href="http://github.com/Metrime/gulp-autoprefixer" target="_blank" rel="external">gulp-autoprefixer</a>)</li>
<li>压缩CSS(<a href="http://github.com/jonathanepollack/gulp-minify-css" target="_blank" rel="external">gulp-minify-css</a>)</li>
<li>js代码校验(<a href="http://github.com/spenceralger/gulp-jshint" target="_blank" rel="external">gulp-jshint</a>)</li>
<li>合并js文件(<a href="http://github.com/wearefractal/gulp-concat" target="_blank" rel="external">gulp-concat</a>)</li>
<li>压缩js代码(<a href="http://github.com/terinjokes/gulp-uglify" target="_blank" rel="external">gulp-uglify</a>)</li>
<li>压缩图片(<a href="http://github.com/sindresorhus/gulp-imagemin" target="_blank" rel="external">gulp-imagemin</a>)</li>
<li>自动刷新页面(<a href="http://github.com/vohof/gulp-livereload" target="_blank" rel="external">gulp-livereload</a>)</li>
<li>图片缓存，只有图片替换了才压缩(<a href="http://github.com/jgable/gulp-cache" target="_blank" rel="external">gulp-cache</a>)</li>
<li>更改提醒(<a href="http://github.com/mikaelbr/gulp-notify" target="_blank" rel="external">gulp-notify</a>)</li>
<li>清除文件(<a href="http://www.npmjs.org/package/del" target="_blank" rel="external">del</a>)</li>
</ul>
<p>安装这些插件需要运行如下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install gulp-ruby-sass gulp-autoprefixer gulp-minify-css gulp-jshint gulp-concat gulp-uglify gulp-imagemin gulp-notify gulp-rename gulp-livereload gulp-cache del --save-dev</div></pre></td></tr></table></figure></p>
<h2 id="加载插件"><a href="#加载插件" class="headerlink" title="加载插件"></a>加载插件</h2><hr>
<p>我们要在项目的根目录创建一个gulpfile.js文件，然后再里面加载插件:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>),</div><div class="line">    sass = <span class="built_in">require</span>(<span class="string">'gulp-ruby-sass'</span>),</div><div class="line">    autoprefixer = <span class="built_in">require</span>(<span class="string">'gulp-autoprefixer'</span>),</div><div class="line">    minifycss = <span class="built_in">require</span>(<span class="string">'gulp-minify-css'</span>),</div><div class="line">    jshint = <span class="built_in">require</span>(<span class="string">'gulp-jshint'</span>),</div><div class="line">    uglify = <span class="built_in">require</span>(<span class="string">'gulp-uglify'</span>),</div><div class="line">    imagemin = <span class="built_in">require</span>(<span class="string">'gulp-imagemin'</span>),</div><div class="line">    rename = <span class="built_in">require</span>(<span class="string">'gulp-rename'</span>),</div><div class="line">    concat = <span class="built_in">require</span>(<span class="string">'gulp-concat'</span>),</div><div class="line">    notify = <span class="built_in">require</span>(<span class="string">'gulp-notify'</span>),</div><div class="line">    cache = <span class="built_in">require</span>(<span class="string">'gulp-cache'</span>),</div><div class="line">    livereload = <span class="built_in">require</span>(<span class="string">'gulp-livereload'</span>),</div><div class="line">    del = <span class="built_in">require</span>(<span class="string">'del'</span>);</div></pre></td></tr></table></figure></p>
<h2 id="建立任务"><a href="#建立任务" class="headerlink" title="建立任务"></a>建立任务</h2><hr>
<ul>
<li><p>编译sass、自动添加css前缀和压缩<br>  首先我们编译sass，添加前缀，保存到我们指定的目录下面，还没结束，我们还要压缩，给文件添加<code>.min</code>后缀再输出压缩文件到指定目录，最后提醒任务完成了：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">gulp.task(<span class="string">'styles'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">   <span class="keyword">return</span> gulp.src(<span class="string">'src/styles/main.scss'</span>)</div><div class="line">     .pipe(sass(&#123; style: <span class="string">'expanded'</span> &#125;))</div><div class="line">     .pipe(autoprefixer(<span class="string">'last 2 version'</span>, <span class="string">'safari 5'</span>, <span class="string">'ie 8'</span>, <span class="string">'ie 9'</span>, <span class="string">'opera 12.1'</span>, <span class="string">'ios 6'</span>, <span class="string">'android 4'</span>))</div><div class="line">     .pipe(gulp.dest(<span class="string">'dist/assets/css'</span>))</div><div class="line">     .pipe(rename(&#123;suffix: <span class="string">'.min'</span>&#125;))</div><div class="line">     .pipe(minifycss())</div><div class="line">     .pipe(gulp.dest(<span class="string">'dist/assets/css'</span>))</div><div class="line">     .pipe(notify(&#123; message: <span class="string">'Styles task complete'</span> &#125;));</div><div class="line"> &#125;);</div></pre></td></tr></table></figure>
<p>  代码详解：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gulp.task(<span class="string">'styles'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;...&#125;);</div></pre></td></tr></table></figure>
<p>  <code>gulp.task</code>这个api用来创建任务，在命令行下可以输入<code>gulp styles</code>来执行上面的任务</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> gulp.src(<span class="string">'src/styles/main.scss'</span>)</div></pre></td></tr></table></figure>
<p>  <code>gulp.src</code>这个API设置需要处理的文件的路径，可以是多个文件以数组的形式<code>[main.scss, vender.scss]</code>，也可以是正则表达<code>/**/*.scss</code>。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">. pipe(sass(&#123; style: <span class="string">'expanded'</span> &#125;))</div></pre></td></tr></table></figure>
<p>  我们使用<code>.pipe()</code>这个API将需要处理的文件导向sass插件</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">. pipe(gulp.dest(<span class="string">'dist/assets/css'</span>));</div></pre></td></tr></table></figure>
<p>  <code>gulp.dest()</code>API设置生成文件的路径，一个任务可以有多个生成路径，一个可以输出未压缩的版本，另一个可以输出压缩后的版本。</p>
</li>
<li><p>js代码校验、合并和压缩</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">gulp.task(<span class="string">'scripts'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">   <span class="keyword">return</span> gulp.src(<span class="string">'src/scripts/**/*.js'</span>)</div><div class="line">     .pipe(jshint(<span class="string">'.jshintrc'</span>))</div><div class="line">     .pipe(jshint.reporter(<span class="string">'default'</span>))</div><div class="line">     .pipe(concat(<span class="string">'main.js'</span>))</div><div class="line">     .pipe(gulp.dest(<span class="string">'dist/assets/js'</span>))</div><div class="line">     .pipe(rename(&#123;suffix: <span class="string">'.min'</span>&#125;))</div><div class="line">     .pipe(uglify())</div><div class="line">     .pipe(gulp.dest(<span class="string">'dist/assets/js'</span>))</div><div class="line">     .pipe(notify(&#123; message: <span class="string">'Scripts task complete'</span> &#125;));</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>  需要提醒的是我们要设置JSHint的reporter方式，上面使用的是default默认的</p>
</li>
<li><p>压缩图片</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">      gulp.task(<span class="string">'images'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">         <span class="keyword">return</span> gulp.src(<span class="string">'src/images/**/*'</span>)</div><div class="line">           .pipe(imagemin(&#123; optimizationLevel: <span class="number">3</span>, progressive: <span class="literal">true</span>, interlaced: <span class="literal">true</span> &#125;))</div><div class="line">           .pipe(gulp.dest(<span class="string">'dist/assets/img'</span>))</div><div class="line">.pipe(notify(&#123; message: <span class="string">'Images task complete'</span> &#125;));</div><div class="line">      &#125;);</div></pre></td></tr></table></figure>
<p>   这个任务使用<code>imagemin</code>插件把所有在<code>src/images/</code>目录以及其子目录下的所有图片（文件）进行压缩，我们可以进一步优化，利用缓存保存已经压缩过的图片，使用之前装过的<code>gulp-cache</code>插件，不过要修改一下上面的代码：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.pipe(imagemin(&#123; optimizationLevel: <span class="number">3</span>, progressive: <span class="literal">true</span>, interlaced: <span class="literal">true</span> &#125;))</div></pre></td></tr></table></figure>
<p>  修改成：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.pipe(cache(imagemin(&#123; optimizationLevel: <span class="number">5</span>, progressive: <span class="literal">true</span>, interlaced: <span class="literal">true</span> &#125;)))</div></pre></td></tr></table></figure>
<p>  现在，只有新建或者修改过的图片才会被压缩了。</p>
</li>
<li><p>清除文件<br>  在任务执行前，最好先清除之前生成的文件：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">gulp.task(<span class="string">'clean'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</div><div class="line">     del([<span class="string">'dist/assets/css'</span>, <span class="string">'dist/assets/js'</span>, <span class="string">'dist/assets/img'</span>], cb)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>  在这里没有必要使用Gulp插件了(没有gulp前缀)，可以使用NPM提供的插件。我们用一个回调函数（<code>cb</code>）确保在退出前完成任务。</p>
</li>
<li><p>设置默认任务<br>  我们在命令行下输入<code>$ gulp</code>执行的就是默认任务，现在我们为默认任务指定执行上面写好的三个任务：</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">gulp.task(<span class="string">'default'</span>, [<span class="string">'clean'</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">     gulp.start(<span class="string">'styles'</span>, <span class="string">'scripts'</span>, <span class="string">'images'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>  在这个例子里面，clean任务执行完成了才会去运行其他的任务，在<code>gulp.start()</code>里的任务执行的顺序是不确定的，所以将要在它们之前执行的任务写在数组里面。</p>
</li>
</ul>
<ul>
<li><p>监听文件<br>   为了监听文件的是否修改以便执行相应的任务，我们需要创建一个新的任务，然后利用<code>gulp.watch</code>API实现:</p>
   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">gulp.task(<span class="string">'watch'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">   <span class="comment">// Watch .scss files</span></div><div class="line">   gulp.watch(<span class="string">'src/styles/**/*.scss'</span>, [<span class="string">'styles'</span>]);</div><div class="line">   <span class="comment">// Watch .js files</span></div><div class="line">   gulp.watch(<span class="string">'src/scripts/**/*.js'</span>, [<span class="string">'scripts'</span>]);</div><div class="line">   <span class="comment">// Watch image files</span></div><div class="line">   gulp.watch(<span class="string">'src/images/**/*'</span>, [<span class="string">'images'</span>]);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>   我们将不同类型的文件分开处理，执行对应的数组里的任务。现在我们可以在命令行输入<code>$ gulp watch</code>执行监听任务，当<code>.sass</code>、<code>.js</code>和图片修改时将执行对应的任务。</p>
</li>
</ul>
<ul>
<li><p>自动刷新页面<br>   Gulp也可以实现当文件修改时自动刷新页面，我们要修改<code>watch</code>任务，配置LiveReload：</p>
   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">gulp.task(<span class="string">'watch'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">   <span class="comment">// Create LiveReload server</span></div><div class="line">   livereload.listen();</div><div class="line">   <span class="comment">// Watch any files in dist/, reload on change</span></div><div class="line">   gulp.watch([<span class="string">'dist/**'</span>]).on(<span class="string">'change'</span>, livereload.changed);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>   要使这个能够工作，还需要在浏览器上安装LiveReload插件</p>
</li>
</ul>
<ul>
<li>所有任务放在一起<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*!</span></div><div class="line">*gulp</div><div class="line">*$ npm install gulp-ruby-sass gulp-autoprefixer gulp-minify-css gulp-jshint gulp-concat gulp-uglify gulp-imagemin gulp-notify         gulp-rename gulp-livereload gulp-cache del --save-dev</div><div class="line">*/</div><div class="line"><span class="comment">// Load plugins</span></div><div class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>),</div><div class="line">    sass = <span class="built_in">require</span>(<span class="string">'gulp-ruby-sass'</span>),</div><div class="line">    autoprefixer = <span class="built_in">require</span>(<span class="string">'gulp-autoprefixer'</span>),</div><div class="line">    minifycss = <span class="built_in">require</span>(<span class="string">'gulp-minify-css'</span>),</div><div class="line">    jshint = <span class="built_in">require</span>(<span class="string">'gulp-jshint'</span>),</div><div class="line">    uglify = <span class="built_in">require</span>(<span class="string">'gulp-uglify'</span>),</div><div class="line">    imagemin = <span class="built_in">require</span>(<span class="string">'gulp-imagemin'</span>),</div><div class="line">    rename = <span class="built_in">require</span>(<span class="string">'gulp-rename'</span>),</div><div class="line">    concat = <span class="built_in">require</span>(<span class="string">'gulp-concat'</span>),</div><div class="line">    notify = <span class="built_in">require</span>(<span class="string">'gulp-notify'</span>),</div><div class="line">    cache = <span class="built_in">require</span>(<span class="string">'gulp-cache'</span>),</div><div class="line">    livereload = <span class="built_in">require</span>(<span class="string">'gulp-livereload'</span>),</div><div class="line">    del = <span class="built_in">require</span>(<span class="string">'del'</span>);</div><div class="line"><span class="comment">// Styles</span></div><div class="line">gulp.task(<span class="string">'styles'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'src/styles/main.scss'</span>)</div><div class="line">    .pipe(sass(&#123; style: <span class="string">'expanded'</span>, &#125;))</div><div class="line">    .pipe(autoprefixer(<span class="string">'last 2 version'</span>, <span class="string">'safari 5'</span>, <span class="string">'ie 8'</span>, <span class="string">'ie 9'</span>, <span class="string">'opera 12.1'</span>, <span class="string">'ios 6'</span>, <span class="string">'android 4'</span>))</div><div class="line">    .pipe(gulp.dest(<span class="string">'dist/styles'</span>))</div><div class="line">    .pipe(rename(&#123; suffix: <span class="string">'.min'</span> &#125;))</div><div class="line">    .pipe(minifycss())</div><div class="line">    .pipe(gulp.dest(<span class="string">'dist/styles'</span>))</div><div class="line">    .pipe(notify(&#123; message: <span class="string">'Styles task complete'</span> &#125;));</div><div class="line">&#125;);</div><div class="line"><span class="comment">// Scripts</span></div><div class="line">gulp.task(<span class="string">'scripts'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'src/scripts/**/*.js'</span>)</div><div class="line">    .pipe(jshint(<span class="string">'.jshintrc'</span>))</div><div class="line">    .pipe(jshint.reporter(<span class="string">'default'</span>))</div><div class="line">    .pipe(concat(<span class="string">'main.js'</span>))</div><div class="line">    .pipe(gulp.dest(<span class="string">'dist/scripts'</span>))</div><div class="line">    .pipe(rename(&#123; suffix: <span class="string">'.min'</span> &#125;))</div><div class="line">    .pipe(uglify())</div><div class="line">    .pipe(gulp.dest(<span class="string">'dist/scripts'</span>))</div><div class="line">    .pipe(notify(&#123; message: <span class="string">'Scripts task complete'</span> &#125;));</div><div class="line">&#125;);</div><div class="line"><span class="comment">// Images</span></div><div class="line">gulp.task(<span class="string">'images'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'src/images/**/*'</span>)</div><div class="line">    .pipe(cache(imagemin(&#123; optimizationLevel: <span class="number">3</span>, progressive: <span class="literal">true</span>, interlaced: <span class="literal">true</span> &#125;)))</div><div class="line">    .pipe(gulp.dest(<span class="string">'dist/images'</span>))</div><div class="line">    .pipe(notify(&#123; message: <span class="string">'Images task complete'</span> &#125;));</div><div class="line">&#125;);</div><div class="line"><span class="comment">// Clean</span></div><div class="line">gulp.task(<span class="string">'clean'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</div><div class="line">    del([<span class="string">'dist/assets/css'</span>, <span class="string">'dist/assets/js'</span>, <span class="string">'dist/assets/img'</span>], cb())</div><div class="line">&#125;);</div><div class="line"><span class="comment">// Default task</span></div><div class="line">gulp.task(<span class="string">'default'</span>, [<span class="string">'clean'</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    gulp.start(<span class="string">'styles'</span>, <span class="string">'scripts'</span>, <span class="string">'images'</span>);</div><div class="line">&#125;);</div><div class="line"><span class="comment">// Watch</span></div><div class="line">gulp.task(<span class="string">'watch'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">// Watch .scss files</span></div><div class="line">  gulp.watch(<span class="string">'src/styles/**/*.scss'</span>, [<span class="string">'styles'</span>]);</div><div class="line">  <span class="comment">// Watch .js files</span></div><div class="line">  gulp.watch(<span class="string">'src/scripts/**/*.js'</span>, [<span class="string">'scripts'</span>]);</div><div class="line">  <span class="comment">// Watch image files</span></div><div class="line">  gulp.watch(<span class="string">'src/images/**/*'</span>, [<span class="string">'images'</span>]);</div><div class="line">  <span class="comment">// Create LiveReload server</span></div><div class="line">  livereload.listen();</div><div class="line">  <span class="comment">// Watch any files in dist/, reload on change</span></div><div class="line">  gulp.watch([<span class="string">'dist/**'</span>]).on(<span class="string">'change'</span>, livereload.changed);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></li>
</ul>
]]></content>
    </entry>
    
  
  
</search>
